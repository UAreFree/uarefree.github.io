<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title> Blog</title>
    <link>http://localhost:1313/</link>
    <description>æ¬¢è¿æ¥è¿™ä¸ªå°ç«™çœ‹çœ‹ã€‚ğŸ˜Š</description>
    <generator>Hugo 0.148.2 &amp; FixIt v0.4.0-alpha-20250823084643-0f68046a</generator>
    <language>zh-CN</language>
    <managingEditor>1022440588@qq.com (UAreFree)</managingEditor>
    <webMaster>1022440588@qq.com (UAreFree)</webMaster>
    <lastBuildDate>Mon, 08 Sep 2025 17:10:32 +0800</lastBuildDate>
    <atom:link href="http://localhost:1313/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>xv6è¯»ä¹¦ç¬”è®°</title>
      <link>http://localhost:1313/posts/xv6-note/</link>
      <pubDate>Sat, 30 Aug 2025 10:42:57 +0800</pubDate><author>1022440588@qq.com (UAreFree)</author>
      <guid>http://localhost:1313/posts/xv6-note/</guid>
      <category domain="http://localhost:1313/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      <description>&lt;p&gt;xv6: a simple, Unix-like teaching operating system (book-riscv-rev4)&lt;/p&gt;&#xA;&lt;p&gt;æ“ä½œç³»ç»ŸåŸå‹â€”â€”xv6åˆ†æä¸å®éªŒ (ç½—ç§‹æ˜)&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;xv6-book-chapter-1&#34;&gt;&lt;span&gt;xv6 book chapter 1&lt;/span&gt;&#xA;  &lt;a href=&#34;#xv6-book-chapter-1&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;xv6å®ç°äº†Unixæ‰€å¼•å…¥çš„æ¥å£ï¼Œè¿˜å¤åˆ»äº†Unixçš„å†…éƒ¨æ¶æ„è®¾è®¡ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å½“è¿›ç¨‹éœ€è¦è°ƒç”¨å†…æ ¸æœåŠ¡æ—¶ï¼Œä¼šè°ƒç”¨ç³»ç»Ÿè°ƒç”¨ï¼ˆOSçš„ä¸€ä¸ªæ¥å£è°ƒç”¨ï¼‰ï¼Œè¿›å…¥å†…æ ¸ï¼Œå†…æ ¸æ‰§è¡Œå®ŒæœåŠ¡åå†è¿”å›ã€‚å½“ç”¨æˆ·è°ƒç”¨ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œç¡¬ä»¶ä¼šæå‡ç‰¹æƒçº§åˆ«å¹¶å¯åŠ¨å†…æ ¸ä¸­é¢„å…ˆå®‰æ’çš„åŠŸèƒ½ï¼ˆè¿™é‡Œåº”è¯¥æŒ‡çš„æ˜¯trapï¼‰ã€‚&lt;/p&gt;&#xA;&lt;p&gt;xv6è¿›ç¨‹ç”±ç”¨æˆ·å†…å­˜ç©ºé—´ï¼ˆæŒ‡ä»¤ã€æ•°æ®å’Œå †æ ˆï¼‰ä»¥åŠè¿›ç¨‹çŠ¶æ€ç»„æˆã€‚å†…æ ¸ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªè¿›ç¨‹æ ‡è¯†ç¬¦ï¼ˆPIDï¼‰ï¼Œforkåˆ›å»ºæ–°è¿›ç¨‹ï¼Œä¼šå°†åŸè¿›ç¨‹çš„å†…å­˜ï¼ˆåŒ…æ‹¬æŒ‡ä»¤ã€æ•°æ®å’Œå †æ ˆï¼‰å®Œå…¨å¤åˆ¶åˆ°æ–°è¿›ç¨‹ä¸­ï¼Œè¿”å›ä¸¤ä¸ªå‚æ•°ï¼šåœ¨åŸè¿›ç¨‹ä¸­è¿”å›æ–°è¿›ç¨‹çš„PIDã€åœ¨æ–°è¿›ç¨‹ä¸­è¿”å›é›¶ã€‚&lt;/p&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/xv6_syscall.png&#34; title=&#34;/xv6/xv6_syscall.png&#34; data-thumbnail=&#34;/xv6/xv6_syscall.png&#34; data-sub-html=&#34;&lt;h2&gt;xv6 syscall&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/xv6_syscall.png&#39; alt=&#34;/xv6/xv6_syscall.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;xv6 syscall&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;p&gt;è¿™é‡Œsystem callè¡¨ä¸­åˆ—å‡ºäº†sleepçš„æè¿°ï¼Œä¼ å…¥intç±»å‹æ•´æ•°ï¼Œä¼šæš‚åœnä¸ªæ—¶é’Ÿå‘¨æœŸã€‚exitç»ˆæ­¢å½“å‰è¿›ç¨‹ï¼Œé‡Šæ”¾èµ„æºï¼Œä¼ å…¥0è¡¨ç¤ºæˆåŠŸï¼Œ1è¡¨ç¤ºå¤±è´¥ï¼›waitè¿”å›å­è¿›ç¨‹exitåçš„PIDï¼Œå¹¶å°†å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€å¤åˆ¶åˆ°ä¼ å…¥çš„statuså‚æ•°ï¼Œå¦‚æœæœ‰å­è¿›ç¨‹åˆ™ç­‰å¾…ä¸€ä¸ªé€€å‡ºï¼Œå¦‚æœæ²¡æœ‰å­è¿›ç¨‹ç«‹å³è¿”å›-1;execä¼šä»æ–‡ä»¶ç³»ç»Ÿä¸­åŠ è½½ä¸€ä¸ªæ–‡ä»¶æ›¿æ¢è°ƒç”¨è¿›ç¨‹çš„å†…å­˜ï¼Œè¯¥æ–‡ä»¶éœ€ä¸ºELFæ ¼å¼ï¼Œé€šå¸¸æ˜¯ç¼–è¯‘ç¨‹åºåçš„ç»“æœï¼ŒæŒ‡ä»¤ä¼šä»ELFå£°æ˜çš„å…¥å£ç‚¹å¼€å§‹æ‰§è¡Œï¼Œç¬¬äºŒå‚æ•°æ˜¯å­—ç¬¦ä¸²å‚æ•°ï¼Œé€šå¸¸å­—ç¬¦ä¸²æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ç¨‹åºåç§°ï¼ˆè¢«å¿½ç•¥æ‰ï¼‰ï¼Œæ³¨æ„execè¦æ±‚æœ€åä¸€ä¸ªå…ƒç´ å¿…é¡»æ˜¯0ï¼ˆNULLï¼‰è¡¨ç¤ºå‚æ•°åˆ—è¡¨çš„ç»“æŸï¼›sbrkå°†è¿›ç¨‹å†…å­˜æ‰©å±•nä¸ªå­—èŠ‚ï¼Œè¿”å›æ–°å†…å­˜çš„åœ°å€ï¼›readä»æ–‡ä»¶æè¿°ç¬¦fdä¸­è¯»å–nä¸ªå­—èŠ‚å¤åˆ¶åˆ°bufä¸­ï¼Œå¹¶è¿”å›å·²è¯»å–çš„å­—èŠ‚æ•°ï¼Œæ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦éƒ½å…³è”ä¸€ä¸ªåç§»é‡ï¼Œreadä¼šä»å½“å‰æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„æ–‡ä»¶åç§»é‡è¯»å–æ•°æ®ï¼Œæ— æ³•è¯»å–æ—¶è¿”å›0è¡¨ç¤ºç»“æŸï¼›writeä¼šå°†nä¸ªå­—èŠ‚ä»ç¼“å†²åŒºå†™å…¥fdï¼Œä¹Ÿä¼šä»æ–‡ä»¶åç§»é‡å¼€å§‹ï¼›dupå¤åˆ¶ä¸€ä¸ªç°æœ‰æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿”å›ä¸€ä¸ªæŒ‡å‘åŸæè¿°ç¬¦å¯¹è±¡çš„æ–°æè¿°ç¬¦ï¼Œä¸¤ä¸ªæè¿°ç¬¦å…±äº«ä¸€ä¸ªåç§»é‡ï¼›pipeåˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œp[0]æ”¾è¯»fdï¼Œp[1]æ”¾å†™fdã€‚&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;xv6-book-chapter-2&#34;&gt;&lt;span&gt;xv6 book chapter 2&lt;/span&gt;&#xA;  &lt;a href=&#34;#xv6-book-chapter-2&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;OSå¿…é¡»æ»¡è¶³ä¸‰å¤§æ ¸å¿ƒè¦æ±‚ï¼šå¤šè·¯å¤ç”¨ã€éš”ç¦»ä¸äº¤äº’ã€‚xv6è¿è¡Œåœ¨å¤šæ ¸RISC-Vå¤„ç†å™¨ä¸Šï¼ŒRISC-Væ˜¯ä¸€æ¬¾64ä½CPUï¼Œxv6ä¸“ä¸ºqemuçš„&amp;quot;-machine virt&amp;quot;é€‰é¡¹æ¨¡æ‹Ÿç¡¬ä»¶ç¯å¢ƒè®¾è®¡ï¼ŒåŒ…æ‹¬å†…å­˜ã€ROMã€ä¸²å£ã€ç£ç›˜é©±åŠ¨å™¨ç­‰ã€‚&lt;/p&gt;&#xA;&lt;p&gt;æŸäº›åµŒå…¥å¼è®¾å¤‡æˆ–å®æ—¶OSç³»ç»Ÿå®ç°çš„æ–¹å¼æ˜¯ï¼šå°†ç³»ç»Ÿè°ƒç”¨å®ç°ä¸ºåº“ï¼Œä¾›åº”ç”¨ç¨‹åºè°ƒç”¨ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä»¥è¿™ç§æ–¹å¼ç›´æ¥ä¸ç¡¬ä»¶èµ„æºäº¤äº’ã€‚å½“æœ‰å¤šä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œå¿…é¡»å®šæœŸè®©å‡ºCPUæƒï¼Œè¿™ç§åä½œåˆ†æ—¶æœºåˆ¶éœ€è¦åº”ç”¨ç¨‹åºä¹‹é—´æ˜¯ç›¸äº’ä¿¡ä»»çš„ï¼Œä½†æ›´å¤šçš„æ˜¯éœ€è¦éš”ç¦»çš„ã€‚å®ç°éš”ç¦»å°±åº”é¿å…ç›´æ¥è®¿é—®ç¡¬ä»¶èµ„æºï¼Œè€Œå°†å…¶æŠ½è±¡ä¸ºæœåŠ¡ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä¸ºå®ç°å¼ºéš”ç¦»æœºåˆ¶ï¼ŒOSéœ€è¦ç¡®ä¿ï¼šåº”ç”¨ç¨‹åºæ— æ³•ä¿®æ”¹OSçš„æ•°æ®ç»“æ„å’ŒæŒ‡ä»¤ï¼Œåº”ç”¨ç¨‹åºæ— æ³•è®¿é—®å…¶ä»–è¿›ç¨‹çš„å†…å­˜ã€‚ç¡¬ä»¶ä¸Šçš„å¼ºéš”ç¦»ï¼šRISC-Vå…·æœ‰ä¸‰ç§æŒ‡ä»¤æ¨¡å¼ï¼šæœºå™¨æ¨¡å¼ã€ç›‘ç£æ¨¡å¼ï¼ˆç‰¹æƒæŒ‡ä»¤ã€å†…æ ¸ç©ºé—´ï¼‰å’Œç”¨æˆ·æ¨¡å¼ï¼ˆç”¨æˆ·æŒ‡ä»¤ã€ç”¨æˆ·ç©ºé—´ï¼‰ã€‚è‹¥åº”ç”¨ç¨‹åºéœ€è¦è°ƒç”¨å†…æ ¸å‡½æ•°ï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰å¿…é¡»åˆ‡æ¢è‡³å†…æ ¸æ¨¡å¼ã€‚ä¸ºæ­¤ï¼ŒRISC-Væä¾›äº†ecallæŒ‡ä»¤ï¼Œå°†CPUåˆ‡æ¢è‡³å†…æ ¸æ¨¡å¼ï¼Œå¹¶é€šè¿‡å†…æ ¸æŒ‡å®šçš„å…¥å£ç‚¹ï¼ˆå…¥å£ç‚¹ä½ç½®å¾ˆé‡è¦ï¼Œå†…æ ¸å¿…é¡»èƒ½å¤Ÿæ§åˆ¶ï¼‰è¿›å…¥å†…æ ¸ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä¸ºäº†å‡å°‘å†…æ ¸ä»£ç å‡ºé”™å¯¼è‡´å†…æ ¸å´©æºƒçš„å¯èƒ½æ€§ï¼Œå¾®å†…æ ¸æ¶æ„å°½é‡å‡å°‘äº†å†…æ ¸ç©ºé—´çš„ä»£ç ï¼Œä»…åŒ…å«å¯åŠ¨åº”ç”¨ç¨‹åºã€å‘é€æ¶ˆæ¯ã€è®¿é—®ç¡¬ä»¶è®¾å¤‡ç­‰å°‘æ•°åº•å±‚åŠŸèƒ½ï¼Œå…¶ä»–å¤§éƒ¨åˆ†åŠŸèƒ½é©»ç•™åˆ°ç”¨æˆ·ç©ºé—´ä¸­ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å°†æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨çš„å®ç°éƒ½åœ¨ç›‘ç£æ¨¡å¼ä¸‹è¿è¡Œï¼Œè¿™ç§æ¶æ„æ˜¯å®å†…æ ¸ï¼Œæ•´ä¸ªOSæœ‰ä¸€ä¸ªæ‹¥æœ‰å®Œæ•´ç¡¬ä»¶ç‰¹æƒçš„å•ä¸€ç¨‹åºæ„æˆï¼Œå„ä¸ªç»„ä»¶ä¹‹é—´çš„åä½œæ›´ä¸ºä¾¿æ·ã€‚Linuxé‡‡ç”¨çš„æ˜¯å®å†…æ ¸ï¼Œé‡‡ç”¨å¾®å†…æ ¸æ¶æ„çš„OSåœ¨åµŒå…¥å¼é¢†åŸŸå¾—åˆ°å¹¿æ³›ä½¿ç”¨ã€‚xv6é‡‡ç”¨çš„æ˜¯å®å†…æ ¸ï¼Œè™½ç„¶æ•´ä½“åŠŸèƒ½é‡è¦æ¯”ç°å®å·¥ä¸šçº§çš„å¾®å†…æ ¸è¿˜å°ã€‚&lt;/p&gt;&#xA;&lt;p&gt;xv6ä¸­éš”ç¦»çš„åŸºæœ¬å•å…ƒæ˜¯è¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹ä¸ºç¨‹åºæä¾›çœ‹ä¼¼ç§æœ‰çš„åœ°å€ç©ºé—´ä»¥åŠçœ‹ä¼¼ç‹¬ç«‹çš„CPUæ¥æ‰§è¡ŒæŒ‡ä»¤ã€‚xv6è¿›ç¨‹è™šæ‹Ÿåœ°å€æœ€å¤§æ˜¯0x3fffffffffï¼ˆMAXVAï¼‰ï¼Œåœ¨é¡¶ç«¯æ”¾äº†ä¸€ä¸ª4096å­—èŠ‚çš„è·³è½¬é¡µï¼ˆtrampolineï¼Œç”¨æˆ·æ€è½¬ä¸ºå†…æ ¸æ€ï¼‰å’Œé™·é˜±é¡µï¼ˆtrapframeï¼Œä¿å­˜è¿›ç¨‹ç”¨æˆ·å¯„å­˜å™¨ï¼‰ï¼Œè¿›ç¨‹æœ€é‡è¦çš„å†…æ ¸çŠ¶æ€åŒ…æ‹¬é¡µè¡¨ã€å†…æ ¸æ ˆå’Œè¿è¡ŒçŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€ä¿¡æ¯ç”±procç»“æ„ä½“ç»´æŠ¤ã€‚æ¯ä¸ªè¿›ç¨‹åˆæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œç”¨äºä¿å­˜æ‰§è¡Œè¿›ç¨‹æ‰€éœ€çš„çŠ¶æ€ä¿¡æ¯ã€‚çº¿ç¨‹çš„å¤§éƒ¨åˆ†çŠ¶æ€ä¿¡æ¯ï¼ˆå±€éƒ¨å˜é‡ã€å‡½æ•°è°ƒç”¨è¿”å›åœ°å€ç­‰ï¼‰éƒ½å­˜å‚¨åœ¨çº¿ç¨‹æ ˆä¸­ã€‚æ¯ä¸ªè¿›ç¨‹æœ‰ä¸¤ä¸ªæ ˆï¼šç”¨æˆ·æ ˆå’Œå†…æ ¸æ ˆï¼Œç”¨æˆ·æ€ä½¿ç”¨ç”¨æˆ·æ ˆï¼Œå†…æ ¸æ€ä½¿ç”¨å†…æ ¸æ ˆã€‚å¯ä»¥é€šè¿‡ecallå‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œecallæå‡ç¡¬ä»¶çº§åˆ«ï¼Œå¹¶å°†PCæŒ‡å‘å†…æ ¸å®šä¹‰çš„å…¥å£ç‚¹ï¼Œæ‰§è¡Œå…¥å£ç‚¹çš„ä»£ç ï¼Œå…¥å£ç‚¹çš„ä»£ç ä¼šåˆ‡æ¢è¿›ç¨‹çš„å†…æ ¸æ ˆï¼Œå¹¶æ‰§è¡Œå®ç°ç³»ç»Ÿè°ƒç”¨çš„å†…æ ¸æŒ‡ä»¤ï¼Œæ‰§è¡Œå®Œæˆååˆ‡æ¢å›ç”¨æˆ·æ ˆï¼Œå¹¶é€šè¿‡sretæŒ‡ä»¤è¿”å›ç”¨æˆ·ç©ºé—´ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¿›ç¨‹é€šè¿‡ä¸¤ç§è®¾è®¡æ€è·¯å®ç°ä¸Šè¿°ä¸¤ç§è™šæ‹ŸåŒ–ï¼ˆå†…å­˜è™šæ‹ŸåŒ–å’ŒCPUè™šæ‹ŸåŒ–ï¼‰ï¼Œå†…å­˜è™šæ‹ŸåŒ–ï¼šè™šæ‹Ÿåœ°å€ç©ºé—´ï¼ŒCPUè™šæ‹ŸåŒ–ï¼šçº¿ç¨‹ã€‚åœ¨xv6ä¸­ï¼Œè¿›ç¨‹ä»…åŒ…å«ä¸€ä¸ªåœ°å€ç©ºé—´å’Œä¸€ä¸ªçº¿ç¨‹ï¼Œå®é™…ä¸ºå……åˆ†åˆ©ç”¨å¤šæ ¸CPUä¼šé…ç½®å¤šä¸ªçº¿ç¨‹ã€‚&lt;/p&gt;&#xA;&lt;p&gt;xv6å†…æ ¸å¦‚ä½•å¯åŠ¨å¹¶è¿è¡Œç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Ÿå½“RISC-Vå¼€æœºæ—¶ï¼Œä¼šåˆå§‹åŒ–ç¡¬ä»¶å¹¶è¿è¡Œå­˜å‚¨åœ¨ROMä¸­çš„å¼•å¯¼åŠ è½½ç¨‹åºï¼Œè¯¥ç¨‹åºå°†xv6å†…æ ¸åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶ååœ¨æœºå™¨æ¨¡å¼ä¸‹ï¼Œä»å…¥å£ç‚¹ï¼ˆentry.Sï¼‰å¼€å§‹æ‰§è¡Œxv6æŒ‡ä»¤ï¼Œè®¾ç½®å †æ ˆä»¥ä¾¿è¿è¡Œstart.cä»£ç ã€‚å‡½æ•°startä¼šæ‰§è¡Œä¸€äº›ä»…åœ¨æœºå™¨æ¨¡å¼ä¸‹è¿è¡Œçš„é…ç½®æ“ä½œï¼Œç„¶ååˆ‡æ¢è‡³ç›‘ç£æ¨¡å¼ï¼ˆå¯„å­˜å™¨mstatusï¼‰ï¼Œå°†è¿”å›åœ°å€è®¾ä¸ºä¸»ç¨‹åºåœ°å€ï¼ˆå†™å…¥ä¸»ç¨‹åºåœ°å€åˆ°å¯„å­˜å™¨mepcï¼‰ï¼Œç¦ç”¨ç›‘ç£æ¨¡å¼ä¸‹çš„è™šæ‹Ÿåœ°å€è½¬æ¢ï¼ˆå‘é¡µè¡¨å¯„å­˜å™¨satpå†™å…¥0ï¼‰ï¼Œå¹¶å°†æ‰€æœ‰ä¸­æ–­å’Œå¼‚å¸¸éƒ½å§”æ‰˜ç»™ç›‘ç£æ¨¡å¼å¤„ç†ã€‚ä¸»ç¨‹åºmain.cåˆå§‹åŒ–å¤šä¸ªè®¾å¤‡åè°ƒç”¨ç”¨æˆ·åˆå§‹åŒ–å‡½æ•°proc.cåˆ›å»ºé¦–ä¸ªè¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹é¦–å…ˆæ‰§è¡Œä¸€æ®µæ±‡ç¼–ä»£ç initcode.Sï¼ŒåŠ è½½execç³»ç»Ÿè°ƒç”¨ï¼Œå°†execç³»ç»Ÿè°ƒç”¨å·SYS_EXECåŠ è½½åˆ°å¯„å­˜å™¨a7ä¸­ï¼Œç„¶åè°ƒç”¨ecallè¿›å…¥å†…æ ¸ã€‚å†…æ ¸é€šè¿‡ç³»ç»Ÿè°ƒç”¨ä¸­a7å¯„å­˜å™¨çš„å€¼æ¥è°ƒç”¨æ‰€éœ€çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œexecç³»ç»Ÿè°ƒç”¨ä¼šæ‰§è¡Œexec(&amp;quot;/init&amp;quot;)æ›¿æ¢å½“å‰è¿›ç¨‹çš„å†…å­˜å’Œå¯„å­˜å™¨ï¼Œinitè¿›ç¨‹ä¼šåœ¨éœ€è¦æ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„æ§åˆ¶å°è®¾å¤‡æ–‡ä»¶ï¼ˆå¼€å¯æ–‡ä»¶æè¿°ç¬¦0ã€1ã€2ï¼‰ï¼Œæ¥ç€åœ¨æ§åˆ¶å°ä¸Šå¯åŠ¨ä¸€ä¸ªshellï¼Œç³»ç»Ÿå°±å¯åŠ¨äº†ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç”¨æˆ·è°ƒç”¨å¦‚ä½•ä¼ é€’åˆ°å†…æ ¸ä¸­çš„execç³»ç»Ÿè°ƒç”¨å®ç°ï¼Ÿåˆå§‹åŒ–ä»£ç .Så°†execçš„å‚æ•°å­˜å…¥å¯„å­˜å™¨a0å’Œa1ï¼Œå¹¶å°†ç³»ç»Ÿè°ƒç”¨å·å­˜å…¥a7ï¼Œecallè¿›å…¥å†…æ ¸ï¼Œä¾æ¬¡æ‰§è¡Œuservecã€usertrapå’Œsystem callæ“ä½œï¼Œsystem callä»é™·é˜±é¡µä¸­ä¿å­˜çš„a7è¯»å–ç³»ç»Ÿè°ƒç”¨å·ï¼Œä»è€Œæ‰§è¡Œå¯¹åº”çš„system callã€‚è¿”å›æ—¶ï¼Œå°†è¿”å›å€¼è®°å½•åœ¨p-&amp;gt;trapframe-&amp;gt;a0ä¸­ï¼Œå°±å¯¼è‡´ç”¨æˆ·ç©ºé—´çš„exec()è°ƒç”¨è¿”å›è¯¥å€¼ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å†…æ ¸ä¸­ç³»ç»Ÿè°ƒç”¨å‚æ•°æ˜¯ç”¨æˆ·ä»£ç ä¼ é€’çš„å‚æ•°ï¼Œè¿™äº›å‚æ•°ä¼šæ”¾åœ¨å¯„å­˜å™¨ä¸­ï¼Œå†…æ ¸trapä»£ç ä¼šå°†ç”¨æˆ·å¯„å­˜å™¨ä¿å­˜åˆ°å½“å‰è¿›ç¨‹çš„é™·é˜±é¡µä¸­ï¼Œä»¥ä¾¿å†…æ ¸ä»£ç è¿›è¡Œæå–ã€‚å†…æ ¸å‡½æ•°argintã€argaddrã€argfdä¼šä»é™·é˜±é¡µä¸­æå–ç³»ç»Ÿè°ƒç”¨å‚ç¬¬nä¸ªæ•°ï¼ŒåŒæ—¶è°ƒç”¨argrawæ¥è·å–ç›¸åº”çš„ç”¨æˆ·å¯„å­˜å™¨ä¿å­˜å€¼ã€‚&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;xv6-book-chapter-3&#34;&gt;&lt;span&gt;xv6 book chapter 3&lt;/span&gt;&#xA;  &lt;a href=&#34;#xv6-book-chapter-3&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;xv6ä¸»è¦ç”¨äº†ä¸¤ç§æŠ€å·§ï¼š1. å°†ç›¸åŒå†…å­˜ï¼ˆtrampolineï¼‰æ˜ å°„åˆ°å¤šä¸ªåœ°å€ç©ºé—´ï¼›2. ç”¨æœªæ˜ å°„é¡µæ¥ä¿æŠ¤å†…æ ¸å †æ ˆå’Œç”¨æˆ·å †æ ˆã€‚&lt;/p&gt;&#xA;&lt;p&gt;xv6åŸºäºSv39 RISC-Vè¿è¡Œï¼Œä½¿ç”¨äº†ä½39ä½çš„è™šæ‹Ÿåœ°å€ã€‚è€Œè¿™39ä½åˆåˆ’åˆ†ä¸ºä½12ä½åŠå‰©ä½™çš„27ä½ï¼Œ27ä½å¯æ„æˆ2^27ä¸ªé¡µè¡¨é¡¹ï¼ˆPTEï¼‰ï¼Œå¯¹åº”è½¬æ¢ä¸º44ä½çš„ç‰©ç†åœ°å€ï¼Œä½12ä½åˆ™ä¸ºåç§»é‡ï¼Œç›´æ¥å¤åˆ¶åˆ°ç‰©ç†åœ°å€çš„ä½12ä½ã€‚&lt;/p&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e5%9c%b0%e5%9d%80%e8%bd%ac%e6%8d%a2.png&#34; title=&#34;/xv6/åœ°å€è½¬æ¢.png&#34; data-thumbnail=&#34;/xv6/åœ°å€è½¬æ¢.png&#34; data-sub-html=&#34;&lt;h2&gt;åœ°å€è½¬æ¢&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/åœ°å€è½¬æ¢.png&#39; alt=&#34;/xv6/åœ°å€è½¬æ¢.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;åœ°å€è½¬æ¢&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;p&gt;RISC-V CPUå…·ä½“å°†è™šæ‹Ÿåœ°å€è½¬ä¸ºç‰©ç†åœ°å€çš„æ­¥éª¤ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;é¡µè¡¨ä»¥ä¸‰çº§æ ‘çŠ¶ç»“æ„å­˜å‚¨åœ¨ç‰©ç†å†…å­˜ä¸­ï¼ˆæ³¨æ„ï¼Œé¡µè¡¨å­˜åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œæ²¡å­˜åœ¨è™šæ‹Ÿå†…å­˜ï¼Œä¹Ÿæ²¡å­˜åœ¨MMUä¸­ï¼‰ï¼Œæ¯ä¸€çº§é¡µè¡¨å¤§å°æ˜¯4KBï¼Œå ä¸€é¡µï¼Œå†…å«512ï¼ˆ2^9ï¼‰ä¸ªé¡µè¡¨é¡¹ã€‚&lt;/li&gt;&#xA;&lt;li&gt;å°†ä¸Šè¿°27ä½è™šæ‹Ÿåœ°å€åˆ’åˆ†ä¸º3ä¸ª9ä½ï¼Œæ¯9ä½é€‰æ‹©æ¯çº§é¡µè¡¨ä¸­çš„é¡µè¡¨é¡¹ã€‚å¦‚æœæ‰€éœ€çš„ä¸‰ä¸ªPTEä¸­ä»»ä½•ä¸€ä¸ªä¸å­˜åœ¨ï¼Œåˆ†é¡µç¡¬ä»¶ä¼šå¼•å‘åˆ†é¡µé”™è¯¯å¼‚å¸¸ï¼Œå¹¶ç”±å†…æ ¸å¤„ç†è¯¥å¼‚å¸¸ã€‚ä¸å•çº§é¡µè¡¨ç›¸æ¯”ï¼Œä¸‰çº§é¡µè¡¨èƒ½èŠ‚çœè¾ƒå¤§çš„å†…å­˜ç©ºé—´ï¼Œæ¯”å¦‚å½“åº”ç”¨ç¨‹åºä»…ä½¿ç”¨ä»åœ°å€é›¶å¼€å§‹çš„å°‘æ•°é¡µé¢æ—¶ï¼Œé¡¶å±‚ç›®å½•ä¸­çš„1è‡³511å·æ¡ç›®å°†å¤±æ•ˆï¼Œå†…æ ¸æ— éœ€ä¸ºè¿™äº›æ¡ç›®åˆ†é…ä¸­é—´ç›®å½•ï¼Œä¹Ÿå°±æ— éœ€åˆ†é…å¯¹åº”çš„åº•å±‚é¡µé¢ï¼Œä»è€Œä¸ºä¸­é—´ç›®å½•èŠ‚çœäº†511ä¸ªé¡µé¢ï¼Œä¸ºåº•å±‚ç›®å½•èŠ‚çœäº†511*512ä¸ªé¡µé¢ã€‚&lt;/li&gt;&#xA;&lt;li&gt;è¿™æ ·è™½ç„¶èŠ‚çœäº†é¡µé¢ï¼Œä½†å¢åŠ äº†CPUåŠ è½½PTEçš„å¼€é”€ï¼Œæ¯æ¬¡è¦è¯»å–3ä¸ªPTEï¼Œä¸ºé¿å…å¼€é”€ï¼Œä¼šå°†PTEç¼“å­˜åœ¨TLBä¸­ã€‚&lt;/li&gt;&#xA;&lt;li&gt;æ¯ä¸ªPTEçš„ä½10ä½æ˜¯æ ‡å¿—ä½ï¼Œç”¨äºå‘ŠçŸ¥åˆ†é¡µç¡¬ä»¶å¦‚ä½•ä½¿ç”¨ç›¸å…³è™šæ‹Ÿåœ°å€ï¼Œå¦‚æ˜¯å¦æœ‰æ•ˆã€æ˜¯å¦å¯è¯»ã€æ˜¯å¦å¯å†™ç­‰ã€‚&lt;/li&gt;&#xA;&lt;li&gt;è¦è®©CPUä½¿ç”¨é¡µè¡¨ï¼Œå°±è¦å°†é¡¶å±‚é¡µç›®å½•çš„ç‰©ç†åœ°å€å†™åˆ°satpå¯„å­˜å™¨ä¸­ï¼Œä»è€Œè¯»å–åˆ°é¡¶å±‚é¡µç›®å½•çš„å†…å®¹è¿›è¡Œåç»­æŸ¥è¡¨ã€‚æ¯ä¸ªCPUæœ‰è‡ªå·±çš„satpå¯„å­˜å™¨ï¼Œä»è€Œå®ç°æ‹¥æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè¿›è€ŒåŒæ—¶è¿è¡Œä¸åŒçš„è¿›ç¨‹ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e5%a4%9a%e7%ba%a7%e9%a1%b5%e8%a1%a8.png&#34; title=&#34;/xv6/å¤šçº§é¡µè¡¨.png&#34; data-thumbnail=&#34;/xv6/å¤šçº§é¡µè¡¨.png&#34; data-sub-html=&#34;&lt;h2&gt;å¤šçº§é¡µè¡¨&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/å¤šçº§é¡µè¡¨.png&#39; alt=&#34;/xv6/å¤šçº§é¡µè¡¨.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;å¤šçº§é¡µè¡¨&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;å†…æ ¸é¡µè¡¨åªæœ‰ä¸€ä¸ªï¼Œå¤§éƒ¨åˆ†ç›´æ¥æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œä»KERNBASEï¼ˆ0x80000000ï¼‰å¼€å§‹åˆ°PHYSTOPï¼ˆ0x88000000ï¼‰è¿™éƒ¨åˆ†æ˜¯QEMUæ¨¡æ‹Ÿçš„åœ°å€ç©ºé—´èŒƒå›´ï¼Œä¸»è¦å­˜æ”¾kernelçš„ä»£ç æ®µã€æ•°æ®æ®µã€å †åŒºï¼›åœ¨KERNBASEä¹‹ä¸‹å°†IOè®¾å¤‡æ¥å£ä»¥å†…å­˜æ˜ å°„å¯„å­˜å™¨çš„æ–¹å¼æš´éœ²ç»™è½¯ä»¶ï¼Œç›´æ¥ä¸ç¡¬ä»¶é€šä¿¡ï¼›trampolineå’Œæ ˆé¡µä¸æ˜¯ç›´æ¥æ˜ å°„çš„ï¼Œç”±äºæ ˆé¡µæ”¾åœ¨äº†è™šæ‹Ÿåœ°å€çš„é«˜åœ°å€ï¼Œå› æ­¤ä¿ç•™äº†ä¸€ä¸ªæœªæ˜ å°„çš„ä¿æŠ¤é¡µï¼Œå½“å†…æ ¸æ ˆæº¢å‡ºæ—¶ä¼šè§¦å‘å¼‚å¸¸ã€‚&lt;/p&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e5%9c%b0%e5%9d%80%e7%a9%ba%e9%97%b4%e6%98%a0%e5%b0%84.png&#34; title=&#34;/xv6/åœ°å€ç©ºé—´æ˜ å°„.png&#34; data-thumbnail=&#34;/xv6/åœ°å€ç©ºé—´æ˜ å°„.png&#34; data-sub-html=&#34;&lt;h2&gt;åœ°å€ç©ºé—´æ˜ å°„&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/åœ°å€ç©ºé—´æ˜ å°„.png&#39; alt=&#34;/xv6/åœ°å€ç©ºé—´æ˜ å°„.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;åœ°å€ç©ºé—´æ˜ å°„&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;p&gt;ä»£ç å±‚é¢ä¸Šï¼Œä»¥kvmå¼€å¤´çš„æ“ä½œå†…æ ¸é¡µè¡¨ï¼Œä»¥uvmå¼€å¤´çš„æ“ä½œç”¨æˆ·é¡µè¡¨ï¼Œå…¶ä»–åŒæ—¶ç”¨äºä¸¤è€…ã€‚RISC-Vä¸­åŒ…å«ä¸€ä¸ªåä¸ºsfence.vmaçš„æŒ‡ä»¤ï¼Œç”¨äºåˆ·æ–°å½“å‰CPUçš„TLBï¼Œxv6ä¼šåœ¨é‡æ–°åŠ è½½satpå¯„å­˜å™¨ä¹‹åï¼Œtrampolineåˆ‡æ¢ç”¨æˆ·é¡µè¡¨å›åˆ°ç”¨æˆ·ç©ºé—´ä¹‹é—´æ‰§è¡Œè¯¥æŒ‡ä»¤ï¼ˆåˆ·æ–°å†…æ ¸é¡µè¡¨çš„TLBï¼‰ã€‚kallocç»´æŠ¤ç‰©ç†å†…å­˜é“¾è¡¨ï¼Œkinitå°†ç©ºé—²é“¾è¡¨åˆå§‹åŒ–ä¸ºå†…æ ¸ç»“æŸåˆ°PHYSTOPä¹‹é—´çš„æ¯ä¸ªé¡µé¢ï¼Œkfreeä¼šå°†é‡Šæ”¾å†…å­˜ä¸­æ¯ä¸ªå­—èŠ‚éƒ½è®¾ä¸º1ï¼Œç„¶åå°†è¯¥é¡µæ·»åŠ åˆ°ç©ºé—²é“¾è¡¨å¤´ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç”¨æˆ·é¡µè¡¨é’ˆå¯¹æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„é¡µè¡¨ï¼Œç”¨æˆ·ç©ºé—´ä»0å¼€å§‹å¯æ‰©å±•è‡³MAXVAï¼Œé€šè¿‡è®¾ç½®PTEæƒé™æ˜¯å¼ºåŒ–ç”¨æˆ·è¿›ç¨‹å®‰å…¨çš„å¸¸ç”¨æŠ€æœ¯ã€‚ç”¨æˆ·æ ˆç©ºé—´å ä¸€é¡µï¼Œæ ˆé¡¶åŒ…å«å‘½ä»¤è¡Œå‚æ•°çš„å­—ç¬¦ä¸²å³æŒ‡å‘è¿™äº›å‚æ•°çš„æŒ‡é’ˆæ•°ç»„ï¼Œç´§é‚»ä¸‹æ–¹çš„å€¼å…è®¸ç¨‹åºåƒåˆšè°ƒç”¨å‡½æ•°main(argc, argv)ä¸€æ ·ç›´æ¥ä»mainå‡½æ•°å¼€å§‹æ‰§è¡Œã€‚åŒæ—¶ä¸ºæ£€æµ‹æ ˆæº¢å‡ºï¼Œåœ¨æ ˆä¸‹æ–¹è®¾ç½®äº†ä¸å¯è®¿é—®çš„ä¿æŠ¤é¡µï¼Œå½“æ ˆæº¢å‡ºå¹¶å°è¯•ä½¿ç”¨ä¿æŠ¤é¡µçš„åœ°å€æ—¶ä¼šç”Ÿæˆé¡µé¢é”™è¯¯å¼‚å¸¸ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e7%94%a8%e6%88%b7%e5%9c%b0%e5%9d%80%e7%a9%ba%e9%97%b4.png&#34; title=&#34;/xv6/ç”¨æˆ·åœ°å€ç©ºé—´.png&#34; data-thumbnail=&#34;/xv6/ç”¨æˆ·åœ°å€ç©ºé—´.png&#34; data-sub-html=&#34;&lt;h2&gt;ç”¨æˆ·åœ°å€ç©ºé—´&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/ç”¨æˆ·åœ°å€ç©ºé—´.png&#39; alt=&#34;/xv6/ç”¨æˆ·åœ°å€ç©ºé—´.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;ç”¨æˆ·åœ°å€ç©ºé—´&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;xv6-book-chapter-4&#34;&gt;&lt;span&gt;xv6 book chapter 4&lt;/span&gt;&#xA;  &lt;a href=&#34;#xv6-book-chapter-4&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;æœ‰ä¸‰ç§æƒ…å†µCPUä¼šæ”¾å¼ƒå½“å‰å¸¸è§„æŒ‡ä»¤ç„¶åå¼ºåˆ¶æ‰§è¡Œç‰¹æ®Šä»£ç å¤„ç†äº‹ä»¶ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;ç³»ç»Ÿè°ƒç”¨ï¼šç”¨æˆ·ç¨‹åºæ‰§è¡ŒecallæŒ‡ä»¤é™·å…¥å†…æ ¸&lt;/li&gt;&#xA;&lt;li&gt;å¼‚å¸¸ï¼šç”¨æˆ·æˆ–å†…æ ¸æŒ‡ä»¤æ‰§è¡Œéæ³•æ“ä½œï¼ˆé™¤ä»¥é›¶æˆ–ä½¿ç”¨æ— æ•ˆè™šæ‹Ÿåœ°å€ï¼‰&lt;/li&gt;&#xA;&lt;li&gt;ä¸­æ–­ï¼šå½“è®¾å¤‡å‘å‡ºä¸­æ–­ä¿¡å·è§¦å‘ï¼ˆç£ç›˜ç¡¬ä»¶å®Œæˆè¯»å†™è¯·æ±‚ï¼‰&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;å°†ä¸Šè¿°è¿™äº›æƒ…å†µç§°ä¸ºé™·é˜±trapï¼Œå…¸å‹çš„å¤„ç†æµç¨‹æ˜¯ï¼štrapå¼ºåˆ¶å°†æ§åˆ¶æƒè½¬ç§»è‡³å†…æ ¸ï¼›å†…æ ¸ä¿å­˜å¯„å­˜å™¨ç­‰çŠ¶æ€ä¿¡æ¯ï¼›å†…æ ¸æ‰§è¡Œç›¸åº”çš„å¤„ç†ç¨‹åºä»£ç ï¼›å†…æ ¸æ¢å¤ä¿å­˜çš„å¯„å­˜å™¨çŠ¶æ€å¹¶è¿”å›ï¼›åŸå§‹ä»£ç ç»§ç»­ä»æ–­ç‚¹å¤„æ‰§è¡Œã€‚&lt;/p&gt;&#xA;&lt;p&gt;åˆ†ä¸ºç”¨æˆ·ç©ºé—´é™·é˜±å’Œå†…æ ¸ç©ºé—´é™·é˜±ï¼Œå¤„ç†é™·é˜±çš„å†…æ ¸ä»£ç ç§°ä¸ºå¤„ç†ç¨‹åºhandlerï¼Œå¤„ç†ç¨‹åºçš„å‰æ¡æŒ‡ä»¤ä½¿ç”¨æ±‡ç¼–vectorã€‚&lt;/p&gt;&#xA;&lt;p&gt;RISC-V CPUæ‰€é…å¤‡çš„å¯„å­˜å™¨ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;stvecï¼šå†…æ ¸å†™å…¥é™·é˜±å¤„ç†ç¨‹åºtrap handlerçš„åœ°å€&lt;/li&gt;&#xA;&lt;li&gt;sepcï¼šä¿å­˜ç¨‹åºè®¡æ•°å™¨pcçš„å€¼&lt;/li&gt;&#xA;&lt;li&gt;scauseï¼šè§¦å‘trapçš„åŸå› &lt;/li&gt;&#xA;&lt;li&gt;sscratchï¼šé¿å…åœ¨ä¿å­˜ç”¨æˆ·å¯„å­˜å™¨æ—¶è¦†ç›–é™·é˜±å¤„ç†ç¨‹åº&lt;/li&gt;&#xA;&lt;li&gt;sstatusï¼šSIEä½æ§åˆ¶æ˜¯å¦å¯ç”¨è®¾å¤‡ä¸­æ–­ï¼›SSPä½æŒ‡ç¤ºtrapæ¥è‡ªç”¨æˆ·æ¨¡å¼è¿˜æ˜¯ç‰¹æƒæ¨¡å¼&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;CPUç¡¬ä»¶åœ¨trapçš„æ—¶å€™æ˜¯ä¼šä¿å­˜ç¨‹åºè®¡æ•°å™¨pcï¼Œå…¶ä»–äº¤ç”±å†…æ ¸è½¯ä»¶å®Œæˆã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä»ç”¨æˆ·ç©ºé—´è§¦å‘trapçš„è·¯å¾„æ˜¯ï¼šuservec(trampoline.S)-&amp;gt;usertrap(trap.c)ï¼Œè¿”å›è·¯å¾„æ˜¯ï¼šusertrapret(trap.c)-&amp;gt;userret(trampoline.S)ã€‚å› ä¸ºåœ¨trapæ—¶ï¼ŒCPUç¡¬ä»¶ä¸ä¼šæ›´æ¢é¡µè¡¨ï¼Œæ‰€ä»¥åœ¨ç”¨æˆ·é¡µè¡¨ä¸Šå¿…é¡»è¦æœ‰trap handleråœ°å€çš„æ˜ å°„ã€‚åœ¨æ‰¾åˆ°trap handlerç‰©ç†åœ°å€æ‰§è¡Œå¯¹åº”ä»£ç æ—¶ä¹Ÿè¦å®ç°åˆ‡æ¢ä¸ºå†…æ ¸é¡µè¡¨ï¼Œå†…æ ¸é¡µè¡¨ä¹Ÿå¿…é¡»è¦æœ‰trap handleråœ°å€çš„æ˜ å°„ã€‚&lt;/p&gt;&#xA;&lt;p&gt;trampolineé¡µåŒ…å«ç”¨æˆ·ç©ºé—´ä¸­çš„trap handlerä»£ç ï¼Œåœ¨æ¯ä¸ªè¿›ç¨‹çš„é¡µè¡¨ä¸­éƒ½æ˜ å°„åˆ°äº†TRAMPOLINEåœ°å€ä¸Šã€‚åŒæ—¶ä¹Ÿæ˜ å°„åœ¨å†…æ ¸é¡µè¡¨ä¸­çš„TRAMPOLINEåœ°å€ä¸Šã€‚uservecæ‰§è¡Œæ—¶ï¼Œæ‰€æœ‰32ä¸ªå¯„å­˜å™¨éƒ½è¢«å ç”¨ï¼Œéœ€è¦æŠŠè¿™32ä¸ªé€šç”¨å¯„å­˜å™¨çš„å€¼å­˜åˆ°å†…å­˜ä¸­ï¼Œç„¶è€Œå°†å¯„å­˜å™¨çš„å€¼ä¿å­˜åˆ°å†…å­˜ä¸­éœ€è¦ä¸€ä¸ªå¯„å­˜å™¨ä¿å­˜åœ°å€æ‰è¡Œï¼Œåœ¨ä¸­æ–­å¼€å§‹çš„csrwæŒ‡ä»¤ä¼šå°†a0å¯„å­˜å™¨çš„å€¼å­˜åˆ°sscratchå¯„å­˜å™¨ä¸­ï¼Œè¿™æ ·å°±è…¾å‡ºa0å¯„å­˜å™¨æ¥æ“ä½œäº†ã€‚æŠŠa0å¯„å­˜å™¨çš„å€¼è®¾ä¸ºtrapframeçš„åœ°å€ï¼Œè¿™æ ·æ‰€æœ‰32ä¸ªå¯„å­˜å™¨çš„å€¼å°±ä¿å­˜åœ¨äº†trapframeä¸­ã€‚trapframeè¿˜åŒ…å«å½“å‰è¿›ç¨‹çš„å†…æ ¸æ ˆã€å½“å‰CPUçš„hartidã€usertrapå‡½æ•°çš„åœ°å€å’Œå†…æ ¸é¡µè¡¨åœ°å€ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è®¸å¤šå†…æ ¸é€šè¿‡é¡µé”™è¯¯æœºåˆ¶å®ç°å†™æ—¶å¤åˆ¶ç‰ˆçš„forkï¼Œåœ¨forkæ—¶å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹å…±äº«ç›¸åŒçš„ç‰©ç†å†…å­˜ã€‚å½“è™šæ‹Ÿåœ°å€åœ¨é¡µè¡¨ä¸­ä¸å­˜åœ¨æ˜ å°„ï¼Œæˆ–PTE_Væ ‡å¿—ä½è¢«æ¸…é™¤ï¼Œæˆ–æƒé™ä½ç¦æ­¢æ“ä½œæ—¶ï¼ŒCPUä¼šè§¦å‘é¡µé¢é”™è¯¯å¼‚å¸¸ã€‚RISC-Vå°†é¡µé”™è¯¯åˆ†ä¸ºä¸‰ç±»ï¼šåŠ è½½é¡µé”™è¯¯ã€å­˜å‚¨é¡µé”™è¯¯ã€æŒ‡ä»¤é¡µé”™è¯¯ï¼Œscauseå¯„å­˜å™¨è¡¨ç¤ºé¡µé”™è¯¯ç±»å‹ï¼Œstvalå¯„å­˜å™¨ä¿å­˜é”™è¯¯åœ°å€ã€‚&lt;/p&gt;&#xA;&lt;p&gt;COWçš„åŸºæœ¬æ–¹æ¡ˆæ˜¯çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å…±äº«æ‰€ä»¥ç‰©ç†é¡µï¼Œä½†æ˜¯è®¾ç½®åªè¯»æ˜ å°„ï¼Œä¸è®¾ç½®PTE_Wã€‚è‹¥ä»»ä¸€è¿›ç¨‹å†™å…¥ç‰¹å®šé¡µå°±ä¼šè§¦å‘é¡µé¢é”™è¯¯å¼‚å¸¸ï¼Œtrap handlerä¼šåˆ†é…æ–°çš„ç‰©ç†å†…å­˜é¡µé¢å¹¶å°†å‡ºé”™åœ°å€å¯¹åº”çš„ç‰©ç†é¡µé¢å†…å®¹å¤åˆ¶åˆ°è¯¥é¡µé¢ï¼Œå¹¶ä¿®æ”¹ç›¸å…³PTEçš„æƒé™ä¸ºå¯è¯»å¯å†™ã€‚æ³¨æ„è¿™é‡Œéœ€è¦å¢åŠ å¼•ç”¨è®¡æ•°ï¼Œç»Ÿè®¡ä¸€ä¸ªç‰©ç†é¡µé¢è¢«å¤šå°‘è¿›ç¨‹é¡µè¡¨æ‰€æ˜ å°„ï¼Œä»¥ä¾¿æ­£ç¡®é‡Šæ”¾ã€‚COWè®©forkæ›´å¿«ï¼Œå› ä¸ºä¸éœ€è¦å¤åˆ¶å¤§éƒ¨åˆ†ç‰©ç†å†…å­˜ï¼Œé€šå¸¸å¤§éƒ¨åˆ†å†…å­˜æ ¹æœ¬æ— éœ€å¤åˆ¶ï¼Œå…¸å‹ä¾‹å­æ˜¯forkåexecï¼›ä»¥åŠCOWå…·æœ‰é€æ˜æ€§ï¼Œåº”ç”¨ç¨‹åºæ— éœ€ä¿®æ”¹å³å¯å—ç›Šã€‚&lt;/p&gt;&#xA;&lt;p&gt;é¡µè¡¨åˆ†é¡µä¸é¡µé¢é”™è¯¯æœºåˆ¶ç»“åˆé™¤äº†ä¸Šè¿°COWç‰ˆçš„forkå¤–è¿˜æœ‰ä¸€ä¸ªå¹¿æ³›åº”ç”¨çš„åŠŸèƒ½æ˜¯å»¶è¿Ÿåˆ†é…ï¼ˆæ‡’åˆ†é…ï¼‰ã€‚1. è°ƒç”¨sbrk()ç³»ç»Ÿè°ƒç”¨ç”³è¯·æ›´å¤šå†…å­˜æ—¶ï¼Œå†…æ ¸ä¼šè®°å½•è™šæ‹Ÿåœ°å€èŒƒå›´çš„æ‰©å±•ï¼Œä½†ä¸ä¼šç«‹å³åˆ†é…ç‰©ç†å†…å­˜ï¼Œä¹Ÿä¸ä¼šä¸ºæ–°å¢çš„è™šæ‹Ÿåœ°å€èŒƒå›´åˆ›å»ºPTEï¼›2. å½“è¿™äº›æ–°åœ°å€ä¸­çš„æŸä¸ªé¡µé¢å‘ç”Ÿé”™è¯¯æ—¶ï¼Œå†…æ ¸ä¼šåˆ†é…ä¸€ä¸ªç‰©ç†å†…å­˜é¡µå¹¶å°†å…¶æ˜ å°„åˆ°é¡µè¡¨ä¸­ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¦ä¸€ä¸ªåº”ç”¨é¡µé¢é”™è¯¯æœºåˆ¶çš„æ˜¯æŒ‰éœ€åˆ†é¡µï¼Œåœ¨execä¸­ï¼Œä¸ºäº†ç¼©çŸ­å¯åŠ¨æ—¶é—´ï¼Œå†…æ ¸ä¸ä¼šä¸€å¼€å§‹å°±å°†å¯æ‰§è¡Œæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œæ˜¯åˆ›å»ºç”¨æˆ·é¡µè¡¨å°†æ‰€æœ‰PTEæ ‡è®°ä¸ºæ— æ•ˆï¼Œæ¯å½“ç¨‹åºé¦–æ¬¡ä½¿ç”¨æŸä¸ªé¡µé¢æ—¶ï¼Œå°±ä¼šå‘ç”Ÿé¡µé¢é”™è¯¯ï¼Œæ­¤æ—¶å†ä»ç£ç›˜è¯»å–è¯¥é¡µé¢çš„å†…å®¹å¹¶å°†å…¶æ˜ å°„åˆ°ç”¨æˆ·åœ°å€ç©ºé—´ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è™šæ‹Ÿå†…å­˜ä¸ºè¿›ç¨‹æä¾›äº†çœ‹ä¼¼æ›´å¤§çš„åœ°å€ç©ºé—´ï¼Œè¿™ä½¿ç”¨åˆ°äº†ç£ç›˜ï¼Œä½¿ç”¨ç£ç›˜åˆ†é¡µï¼Œå°†éƒ¨åˆ†ç”¨æˆ·é¡µé¢å­˜åˆ°ç£ç›˜ä¸­ï¼Œå¹¶å°†PTEæ ‡è®°ä¸ºæ— æ•ˆï¼Œå½“è®¿é—®è¿™äº›é¡µé¢æ—¶ï¼Œé”™å‘é¡µé¢é”™è¯¯ï¼Œtrap handlerä¼šåˆ†é…ä¸€ä¸ªå†…å­˜é¡µï¼Œä»ç£ç›˜è¯»å–è¯¥é¡µé¢åˆ°å†…å­˜ï¼Œå¹¶ä¿®æ”¹ç›¸å…³çš„PTEã€‚&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;xv6-book-chapter-6&#34;&gt;&lt;span&gt;xv6 book chapter 6&lt;/span&gt;&#xA;  &lt;a href=&#34;#xv6-book-chapter-6&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;å¹¶å‘æŒ‡çš„æ˜¯å¤šå¤„ç†å™¨å¹¶è¡Œã€çº¿ç¨‹åˆ‡æ¢æˆ–ä¸­æ–­å¯¼è‡´çš„å¤šæŒ‡ä»¤æµäº¤é”™æ‰§è¡Œåœºæ™¯ã€‚å†…æ ¸ä¸­å……æ–¥å¤§é‡éœ€è¦å¹¶å‘è®¿é—®çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼Œä¸¤ä¸ªCPUå¯èƒ½åŒæ—¶è°ƒç”¨kallocå‡½æ•°ï¼Œä»è€Œå¹¶å‘åœ°ä»ç©ºé—²é“¾è¡¨å¼¹å‡ºå¤´ç»“ç‚¹ã€‚é”é€šè¿‡äº’æ–¥æœºåˆ¶ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªCPUèƒ½æŒæœ‰è¯¥é”ï¼Œè‹¥ç¨‹åºå‘˜ä¸ºæ¯ä¸ªå…±äº«æ•°æ®å…³è”ä¸€ä¸ªé”ï¼Œå¹¶åœ¨è®¿é—®æ•°æ®æ—¶å§‹ç»ˆæŒæœ‰ç›¸åº”é”ï¼Œé‚£ä¹ˆè¯¥æ•°æ®å°±èƒ½ä¿è¯åŒä¸€æ—¶é—´åªè¢«ä¸€ä¸ªCPUè®¿é—®ã€‚é”ä½œä¸ºå¹¶å‘æ§åˆ¶æœºåˆ¶æ˜“äºç†è§£ï¼Œä½†ç¼ºç‚¹åœ¨äºå¯èƒ½é™åˆ¶æ€§èƒ½â€”â€”é”ä¼šå¯¼è‡´å¹¶å‘æ“ä½œè¢«ä¸²è¡ŒåŒ–å¤„ç†ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç«æ€æ¡ä»¶æŒ‡å¤šä¸ªæ“ä½œå¹¶å‘è®¿é—®åŒä¸€å†…å­˜åœ°å€ä¸”è‡³å°‘åŒ…å«ä¸€ä¸ªå†™æ“ä½œçš„æƒ…å½¢ã€‚ç«æ€ç»“æœå–å†³äºç¼–è¯‘å™¨ç”Ÿæˆçš„æœºå™¨ç ã€CPUçš„æ—¶åºè°ƒåº¦ä»¥åŠå†…å­˜ç³»ç»Ÿå¯¹å†…å­˜æ“ä½œçš„é‡æ’ã€‚è¿™äº›å› ç´ ä½¿å¾—ç”±ç«æ€å¼•å‘çš„é”™è¯¯æéš¾å¤ç°å’Œè°ƒè¯•ã€‚è·å–å’Œé‡Šæ”¾ä¹‹å‰çš„æŒ‡ä»¤åºåˆ—é€šå¸¸è¢«ç§°ä¸ºä¸´ç•ŒåŒºã€‚&lt;/p&gt;&#xA;&lt;p&gt;å†…æ ¸è®¾è®¡çš„ä¸€å¤§æŒ‘æˆ˜æ˜¯é€šè¿‡é¿å…é”äº‰ç”¨å®ç°å¹¶è¡Œæ€§ï¼Œå¤æ‚çš„å†…æ ¸ä¼šä¸“é—¨è®¾è®¡æ•°æ®ç»“æ„å’Œç®—æ³•æ¥é¿å…é”äº‰ç”¨ã€‚ä»¥é“¾è¡¨ä¸ºä¾‹ï¼Œå†…æ ¸å¯èƒ½ä¸ºæ¯ä¸ªCPUç»´æŠ¤ç‹¬ç«‹ç©ºé—²é“¾è¡¨ï¼Œä»…å½“å½“å‰CPUçš„é“¾è¡¨ä¸ºç©ºä¸”å¿…é¡»ä»å…¶ä»–CPUçªƒå–å†…å­˜æ—¶ï¼Œæ‰ä¼šè§¦åŠåˆ°å…¶ä»–CPUçš„ç©ºé—²é“¾è¡¨ã€‚&lt;/p&gt;&#xA;&lt;p&gt;xv6æœ‰ä¸¤ç§é”ï¼šè‡ªæ—‹é”å’Œä¼‘çœ é”ã€‚ä¸‹è¾¹acquireçš„å®ç°æ— æ³•ç¡®ä¿å¤šå¤„ç†å™¨ä¸‹çš„äº’æ–¥ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸¤ä¸ªCPUåŒæ—¶æ‰§è¡Œåˆ°ç¬¬5è¡Œä»£ç ï¼Œç„¶åè¿™ä¸¤ä¸ªCPUåŒæ—¶æŒæœ‰é”ã€‚éœ€è¦å°†ç¬¬5è¡Œå’Œç¬¬6è¡Œä»£ç æ”¹ä¸ºåŸå­æ“ä½œã€‚åœ¨RISC-Vä¸­ï¼ŒåŸå­æŒ‡ä»¤æ˜¯&lt;code&gt;amoswap r, a&lt;/code&gt; è¿™æ¡æŒ‡ä»¤åŸå­æ€§çš„äº¤æ¢äº†å¯„å­˜å™¨å’Œå†…å­˜çš„å€¼ï¼Œé€šè¿‡ç‰¹æ®Šç¡¬ä»¶æ¥ä¿è¯çš„ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;spinlock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(;;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lk&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locked&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;lk&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;locked&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;é”å’Œä¸­æ–­å¤„ç†å‡½æ•°ï¼šå‡è®¾sys_sleepæŒæœ‰ticksclockæ—¶ï¼Œå…¶CPUè¢«å®šæ—¶å™¨ä¸­æ–­æ‰“æ–­ï¼Œclockinträ¼šå°è¯•è·å–tickslockï¼Œå‘ç°å·²è¢«æŒæœ‰å¹¶ç­‰å¾…é‡Šæ”¾ã€‚ä½†è¿™æ—¶å€™tickslockå°†æ°¸è¿œæ— æ³•é‡Šæ”¾ï¼Œåªæœ‰sys_sleepæ‰èƒ½é‡Šæ”¾å®ƒï¼Œä½†sys_sleepå¿…é¡»ç­‰åˆ°clockintrè¿”å›æ—¶æ‰èƒ½ç»§ç»­è¿è¡Œï¼Œäºæ˜¯CPUå°†é™·å…¥æ­»é”ã€‚ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œè‹¥ä¸­æ–­å¤„ç†ç¨‹åºä½¿ç”¨è‡ªæ—‹é”ï¼ŒCPUå¿…é¡»ç¡®ä¿åœ¨å¯ç”¨ä¸­æ–­æ—¶ä¸æŒæœ‰è¯¥é”ã€‚xv6é‡‡å–çš„ç­–ç•¥æ˜¯ï¼šå½“CPUè·å–é”æ—¶ï¼Œç¦ç”¨è¯¥CPUçš„ä¸­æ–­ã€‚å½“CPUä¸æŒæœ‰é”æ—¶ï¼Œxv6ä¼šé‡å¯ä¸­æ–­ã€‚acquireè°ƒç”¨push_offï¼Œreleaseè°ƒç”¨pop_offæ¥è¿½è¸ªå½“å‰CPUä¸Šçš„é”åµŒå¥—å±‚çº§ã€‚å½“è®¡æ•°å™¨å½’é›¶æ—¶ï¼Œpop_offä¼šæ¢å¤æœ€å¤–å±‚ä¸´ç•ŒåŒºå¼€å§‹æ—¶çš„ä¸­æ–­å¯ç”¨çŠ¶æ€ã€‚intr_offå’Œintr_onå‡½æ•°åˆ†åˆ«æ‰§è¡ŒRISC-VæŒ‡ä»¤æ¥ç¦ç”¨å’Œå¯ç”¨ä¸­æ–­ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¤šçº¿ç¨‹ä¸‹ç¨‹åºæŒ‡ä»¤ä¼šå‡ºç°ä¹±åºé—®é¢˜ï¼ŒåŸå› ä¹‹ä¸€æ˜¯ç¼–è¯‘å™¨ç”Ÿæˆçš„åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤é¡ºåºä¸æºä»£ç é¡ºåºä¸åŒï¼ŒåŸå› ä¹‹äºŒæ˜¯CPUå¯èƒ½ä¼šä¹±åºæ‰§è¡ŒæŒ‡ä»¤ä»¥æé«˜æ€§èƒ½ã€‚ä¸ºäº†å‘ŠçŸ¥ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¸è¦è¿›è¡ŒæŒ‡ä»¤é‡æ’åºï¼Œxv6åœ¨acquireå’Œreleaseä¸­éƒ½ä½¿ç”¨äº†__sync_synchronize()ï¼Œ__sync_synchronize()æ˜¯ä¸€ç§å†…å­˜å±éšœï¼šå®ƒå‘Šè¯‰ç¼–è¯‘å™¨å’ŒCPUä¸è¦è·¨å±éšœé‡æ–°æ’åºåŠ è½½æˆ–å­˜å‚¨æ“ä½œã€‚ç”±äºxv6åœ¨è®¿é—®å…±äº«æ•°æ®æ—¶éƒ½ä½¿ç”¨äº†é”ï¼Œå…¶acquireå’Œreleaseä¸­çš„å±éšœåœ¨å‡ ä¹æ‰€æœ‰å…³é”®åœºæ™¯ä¸­éƒ½å¼ºåˆ¶ä¿è¯äº†æ‰§è¡Œé¡ºåºã€‚&lt;/p&gt;&#xA;&lt;p&gt;è‹¥ä¸€ä¸ªè¿›ç¨‹è¯•å›¾è·å–è‡ªæ—‹é”ï¼Œé•¿æ—¶é—´æŒæœ‰ä¼šå¯¼è‡´èµ„æºæµªè´¹ï¼Œå› ä¸ºè·å–è¿›ç¨‹ä¼šåœ¨è‡ªæ—‹è¿‡ç¨‹ä¸­ç©ºè½¬CPUï¼Œä¸”è¿›ç¨‹æŒæœ‰è‡ªæ—‹é”æ—¶æ— æ³•è®©å‡ºCPUã€‚éœ€è¦ä¸€ç§èƒ½åœ¨ç­‰å¾…è·å–æ—¶ä»¥åŠæŒæœ‰é”æ—¶è®©å‡ºCPUçš„é”ã€‚xv6é€šè¿‡ç¡çœ é”å®ç°ï¼Œacquiresleepå‡½æ•°åœ¨ç­‰å¾…æ—¶ä¼šé‡Šæ”¾CPUä½¿ç”¨æƒï¼Œä»è€Œä½¿å¾—å…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç»§ç»­æ‰§è¡Œã€‚&lt;/p&gt;&#xA;&lt;p&gt;Real worldä¸­æåˆ°ç”¨é”ç¼–ç¨‹å……æ»¡æŒ‘æˆ˜ï¼Œè‹¥ç”¨é”ç¼–ç¨‹ï¼Œæ˜æ™ºçš„åšæ³•æ˜¯ä½¿ç”¨èƒ½æ£€æµ‹ç«æ€æ¡ä»¶çš„å·¥å…·ã€‚è™½ç„¶æ— éœ€åŸå­æŒ‡ä»¤ä¹Ÿèƒ½å®ç°é”æœºåˆ¶ï¼Œä½†è¿™ç§æ–¹å¼ä»£ä»·å¤ªé«˜ï¼Œå› æ­¤ç»å¤§å¤šæ•°OSä»é€‰æ‹©é‡‡ç”¨åŸå­æŒ‡ä»¤ã€‚ä¸ºé¿å…é”å¸¦æ¥çš„å¼€é”€ï¼Œè®¸å¤šOSé‡‡ç”¨æ— é”æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œä½†æ— é”ç¼–ç¨‹æ¯”åŸºäºé”çš„ç¼–ç¨‹æ›´ä¸ºå¤æ‚ï¼Œä¾‹å¦‚å¿…é¡»è€ƒè™‘æŒ‡ä»¤ä¸å†…å­˜é‡æ’åºçš„é—®é¢˜ã€‚&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;xv6-book-chapter-7&#34;&gt;&lt;span&gt;xv6 book chapter 7&lt;/span&gt;&#xA;  &lt;a href=&#34;#xv6-book-chapter-7&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;OSè¿è¡Œçš„è¿›ç¨‹æ•°å¾€å¾€å¤§äºCPUæ•°é‡ï¼Œæ‰€ä»¥éœ€è¦å¤šè·¯å¤ç”¨æœºåˆ¶æ¥å®ç°åœ¨è¿›ç¨‹çœ‹æ¥æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„CPUã€‚&lt;/p&gt;&#xA;&lt;p&gt;xv6é€šè¿‡ä¸¤ç§æœºåˆ¶å®ç°å¤šè¿›ç¨‹å¹¶å‘ï¼š1. å½“è¿›ç¨‹å‘å‡ºé˜»å¡ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œxv6çš„ç¡çœ å’Œå”¤é†’æœºåˆ¶ä¼šè‡ªåŠ¨åˆ‡æ¢CPUï¼›2. é’ˆå¯¹é•¿æœŸè¿è¡Œä½†ä¸ä¼šé˜»å¡çš„è¿›ç¨‹ï¼Œxv6ä¼šå®šæœŸè¿›è¡ŒCPUåˆ‡æ¢ã€‚å‰è€…å±äºè‡ªæ„¿åˆ‡æ¢ï¼Œåè€…å±äºéè‡ªæ„¿åˆ‡æ¢ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç”¨æˆ·è¿›ç¨‹åˆ‡æ¢çš„å®Œæ•´æµç¨‹ï¼šé¦–å…ˆtrapè¿›å†…æ ¸ï¼Œè¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢è‡³å½“å‰CPUçš„è°ƒåº¦çº¿ç¨‹ï¼Œéšåå†æ¬¡åˆ‡æ¢åˆ°æ–°è¿›ç¨‹çš„å†…æ ¸çº¿ç¨‹ï¼Œæœ€ç»ˆè¿”å›ç”¨æˆ·è¿›ç¨‹ã€‚xv6é€šè¿‡ç‹¬ç«‹çº¿ç¨‹ï¼ˆä¿å­˜å¯„å­˜å™¨å’Œå †æ ˆï¼‰æ¥æ‰§è¡Œè°ƒåº¦ç¨‹åºï¼Œå› ä¸ºè®©è°ƒåº¦ç¨‹åºç›´æ¥åœ¨ä»»æ„è¿›ç¨‹çš„å†…æ ¸å †æ ˆä¸Šè¿è¡Œå­˜åœ¨å®‰å…¨éšæ‚£ï¼Œå…¶ä»–CPUå¯èƒ½éšæ—¶å”¤é†’å¹¶è¿è¡Œè¯¥è¿›ç¨‹ï¼Œè‹¥ä¸¤ä¸ªä¸åŒçš„CPUä½¿ç”¨åŒä¸€å †æ ˆå°†å¼•å‘ç¾éš¾æ€§åæœã€‚æ¯ä¸ªCPUéƒ½æœ‰ä¸“é—¨çš„è°ƒåº¦çº¿ç¨‹ï¼Œå¤„ç†å¤šä¸ªCPUåŒæ—¶è¿è¡Œä¸”éœ€è¦é‡Šæ”¾èµ„æºçš„è¿›ç¨‹ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä»ä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹éœ€è¦ä¿å­˜æ—§çº¿ç¨‹çš„CPUå¯„å­˜å™¨ï¼Œå¹¶æ¢å¤æ–°çº¿ç¨‹ä¹‹å‰ä¿å­˜çš„å¯„å­˜å™¨ï¼›ç”±äºå †æ ˆæŒ‡é’ˆå’Œç¨‹åºè®¡æ•°å™¨è¢«ä¿å­˜å’Œæ¢å¤ï¼Œæ„å‘³ç€CPUå°†åˆ‡æ¢å †æ ˆå¹¶åˆ‡æ¢æ­£åœ¨æ‰§è¡Œçš„ä»£ç ã€‚&lt;/p&gt;&#xA;&lt;p&gt;swtchå‡½æ•°ä¿å­˜å¹¶æ¢å¤å¯„å­˜å™¨ï¼ˆä¸Šä¸‹æ–‡ï¼‰ï¼Œå½“è¿›ç¨‹æ”¾å¼ƒCPUæ—¶ï¼Œè¿›ç¨‹å†…æ ¸çº¿ç¨‹ä¼šè°ƒç”¨swtchå‡½æ•°ä¿å­˜å®ƒè‡ªå·±çš„ä¸Šä¸‹æ–‡å¹¶æ¢å¤è°ƒåº¦å™¨çš„ä¸Šä¸‹æ–‡ã€‚æ¯ä¸ªä¸Šä¸‹æ–‡éƒ½åŒ…å«åœ¨contextç»“æ„ä½“ä¸­ï¼Œè¯¥ç»“æ„ä½“åˆåŒ…å«åœ¨è¿›ç¨‹çš„procç»“æ„ä½“æˆ–CPUçš„ç»“æ„ä½“cpuä¸­ã€‚swtchå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šcontext* oldå’Œcontext* newï¼Œå®ƒä¿å­˜å½“å‰çš„oldï¼ŒåŠ è½½newä¸­çš„å¯„å­˜å™¨å¹¶è¿”å›ã€‚&lt;/p&gt;&#xA;&lt;p&gt;usertrapå…¶ä¸­ä¹‹ä¸€æ˜¯yieldï¼Œyieldä¼šè°ƒç”¨schedï¼Œschedä¼šè°ƒç”¨swtchä¿å­˜å½“å‰ä¸Šä¸‹æ–‡åˆ°p-&amp;gt;contextä¸­ï¼Œå¹¶åˆ‡æ¢ä¹‹å‰ä¿å­˜åœ¨cpu-&amp;gt;contextä¸­çš„è°ƒåº¦å™¨ä¸Šä¸‹æ–‡ã€‚&lt;/p&gt;&#xA;&lt;p&gt;swtchæ²¡æœ‰ä¿å­˜ç¨‹åºè®¡æ•°å™¨ï¼Œè€Œæ˜¯ä¿å­˜raå¯„å­˜å™¨ï¼Œè¯¥å¯„å­˜å™¨ä¿å­˜è°ƒç”¨swtchçš„è¿”å›åœ°å€ã€‚å½“swtchè¿”å›æ—¶ï¼Œå®ƒä¼šè¿”å›åˆ°raå¯„å­˜å™¨ä¿å­˜çš„è¿”å›åœ°å€ï¼Œå³ä¹‹å‰è°ƒç”¨swtchçš„æ–°çº¿ç¨‹ã€‚æ­¤å¤–ï¼Œswtchä¹Ÿä¼šè¿”å›spå †æ ˆæŒ‡é’ˆæŒ‡å‘çš„çº¿ç¨‹æ ˆã€‚&lt;/p&gt;&#xA;&lt;p&gt;æ¯ä¸ªCPUéƒ½æœ‰ä¸€ä¸ªä¸“ç”¨çº¿ç¨‹ä½œä¸ºè°ƒåº¦å™¨ï¼Œè¿è¡Œschedulerå‡½æ•°ï¼Œé€‰æ‹©ä¸‹ä¸€ä¸ªè¦è¿è¡Œçš„è¿›ç¨‹ã€‚å½“è¿›ç¨‹æƒ³è¦è®©å‡ºCPUæ—¶å¿…é¡»è·å–å®ƒè‡ªå·±çš„é”p-&amp;gt;lockï¼Œé‡Šæ”¾å®ƒæŒæœ‰çš„å…¶ä»–é”ï¼Œæ›´æ–°å®ƒè‡ªå·±çš„çŠ¶æ€p-&amp;gt;stateï¼Œç„¶åè°ƒç”¨schedå‡½æ•°ã€‚è¿™ä¸ªæ“ä½œæµç¨‹åŒæ ·å­˜åœ¨äºyieldã€sleepå’Œexitå‡½æ•°ä¸­ã€‚schedè°ƒç”¨swtchä¿å­˜å½“å‰ä¸Šä¸‹æ–‡p-&amp;gt;contextï¼Œåˆ‡æ¢è°ƒåº¦å™¨ä¸Šä¸‹æ–‡cpu-&amp;gt;contextã€‚éšåè°ƒåº¦å™¨ä¸€ç›´å¾ªç¯ï¼Œæ‰¾åˆ°è¦è¿è¡Œçš„è¿›ç¨‹å¹¶åˆ‡æ¢ï¼Œå¦‚æ­¤å¾ªç¯å¾€å¤ã€‚&lt;/p&gt;&#xA;&lt;p&gt;schedulerè¿è¡Œä¸€ä¸ªå¾ªç¯ï¼šæ‰¾åˆ°ä¸€ä¸ªè¿›ç¨‹æ¥è¿è¡Œï¼Œè¿è¡Œå®ƒçŸ¥é“è®©å‡ºï¼Œé‡å¤ã€‚scheduleréå†è¿›ç¨‹è¡¨å¯»æ‰¾å¯è¿è¡Œçš„è¿›ç¨‹ï¼Œå³p-&amp;gt;state == RUNNABLEçš„è¿›ç¨‹ã€‚ä¸€æ—¦æ‰¾åˆ°ä¸€ä¸ªè¿›ç¨‹ï¼Œå°±è®¾ç½®æ¯ä¸ªCPUçš„å½“å‰è¿›ç¨‹å˜é‡c-&amp;gt;procï¼Œå°†è¿›ç¨‹æ ‡è®°ä¸ºRUNNINGï¼Œç„¶åè°ƒç”¨swtchå¯åŠ¨è¿è¡Œã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç¡çœ å’Œå”¤é†’ï¼šä¿¡å·é‡PVæ“ä½œä½œä¸ºæ¡ä»¶åŒæ­¥çš„ä¸€ç§æœºåˆ¶ï¼Œxv6ä¸­ä¿¡å·é‡ç»´æŠ¤è®¡æ•°å¹¶æä¾›ä¸¤ç§æ“ä½œï¼šVæ“ä½œï¼ˆç”Ÿäº§è€…ï¼‰å¢åŠ è®¡æ•°å€¼ï¼ŒPæ“ä½œï¼ˆæ¶ˆè´¹è€…ï¼‰å‡å°‘è®¡æ•°å€¼ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªç”Ÿäº§è€…ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ï¼Œå…¶æœ€åˆå®ç°ä¸ºï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;semaphore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;spinlock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;semphore&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;semphore&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;è¿™ç§å®ç°Pæ“ä½œä¸€ç›´è‡ªæ—‹ï¼Œä¸ºäº†é¿å…é™·å…¥å¿™ç­‰å¾…ï¼Œå¯ä»¥ä½¿ç”¨sleepè°ƒç”¨å°†è°ƒç”¨è¿›ç¨‹ç½®äºç¡çœ çŠ¶æ€å’Œwakeupè°ƒç”¨å”¤é†’è¿›ç¨‹ï¼Œå®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;semaphore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;spinlock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;semphore&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;wakeup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;semphore&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;ä½†æ˜¯è¿™æ ·å­˜åœ¨è™šå‡å”¤é†’çš„é—®é¢˜ï¼Œè¿›ç¨‹Aåœ¨Pæ“ä½œåˆ¤æ–­s-&amp;gt;count == 0ä¹‹åï¼Œsleepä¹‹å‰ï¼Œå¦ä¸€è¿›ç¨‹BåŒæ—¶è°ƒç”¨äº†Væ“ä½œå¢åŠ countå¹¶wakeupï¼Œå¯¼è‡´æ­¤æ—¶è¿›ç¨‹Aæ²¡æœ‰è¢«å”¤é†’ã€‚ç„¶åè¿›ç¨‹Aç»§ç»­æ‰§è¡ŒPæ“ä½œä»è€Œsleepç¡çœ ã€‚ä¸ºäº†é¿å…è™šå‡å”¤é†’ï¼Œå¯ä»¥åœ¨Pæ“ä½œåˆ¤æ–­s-&amp;gt;count == 0æ—¶ä¹ŸåŠ ä¸Šé”ã€‚æ¯”å¦‚å¦‚ä¸‹å®ç°ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;semaphore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;spinlock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;semphore&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;wakeup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;semphore&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;ä½†è¿™æ ·å¾ˆæ˜æ˜¾åˆä¼šå¸¦æ¥æ­»é”é—®é¢˜ï¼Œè¿›ç¨‹Båœ¨æ‰§è¡ŒPæ“ä½œæ—¶ç¡çœ æŒæœ‰é”ï¼Œè¿›ç¨‹Aæ°¸è¿œæ— æ³•æ‹¿åˆ°é”æ‰§è¡ŒVæ“ä½œï¼Œæ‰€ä»¥éœ€è¦å†sleepä¸­ä¼ å…¥é”ï¼Œå½“è¿›ç¨‹è¢«æ ‡è®°ä¸ºç¡çœ çŠ¶æ€å¹¶åœ¨ç¡çœ é€šé“ç­‰å¾…æ—¶ï¼Œsleepé‡Šæ”¾é”ã€‚æœ€åçš„å®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;semaphore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;spinlock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;semphore&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;wakeup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;semphore&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;xv6-book-chapter-8&#34;&gt;&lt;span&gt;xv6 book chapter 8&lt;/span&gt;&#xA;  &lt;a href=&#34;#xv6-book-chapter-8&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;xv6æ–‡ä»¶ç³»ç»Ÿæä¾›äº†ç±»Unixçš„æ–‡ä»¶ã€ç›®å½•å’Œè·¯å¾„åï¼Œå¹¶å°†å…¶æ•°æ®æŒä¹…åŒ–å‚¨å­˜åœ¨virtioç£ç›˜ä¸Šã€‚xv6çš„æ–‡ä»¶ç³»ç»Ÿè§£å†³çš„å‡ ä¸ªæŒ‘æˆ˜ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;éœ€è¦ç£ç›˜ä¸Šçš„æ•°æ®ç»“æ„æ¥æ ‡è¯†ç›®å½•ã€æ–‡ä»¶ï¼Œè®°å½•å“ªäº›ç£ç›˜å—æ˜¯ç©ºé—²çš„ã€å“ªäº›æ˜¯å¯¹åº”æ–‡ä»¶çš„ï¼ˆä½¿ç”¨inodeã€idnodeã€direntç­‰ï¼‰&lt;/li&gt;&#xA;&lt;li&gt;å¿…é¡»æ”¯æŒå´©æºƒæ¢å¤ï¼ˆä½¿ç”¨äº‹åŠ¡ã€æ—¥å¿—ï¼‰&lt;/li&gt;&#xA;&lt;li&gt;å¿…é¡»ç»´æŠ¤å¹¶å‘ä¸‹çš„ä¸´ç•ŒåŒºï¼ˆä½¿ç”¨é”ï¼‰&lt;/li&gt;&#xA;&lt;li&gt;å¿…é¡»ç»´æŠ¤ä¸€ä¸ªå†…å­˜ä¸ç£ç›˜ä¹‹é—´çš„ç¼“å­˜ï¼ˆä½¿ç”¨buffer cacheï¼‰&#xA;é‡‡ç”¨ä¸ƒå±‚ç»„ç»‡æ¶æ„ï¼Œç£ç›˜å±‚è´Ÿè´£åœ¨virtioç¡¬ç›˜é©±åŠ¨å™¨ä¸Šè¯»å†™æ•°æ®å—ã€‚ç¼“å†²åŒºç¼“å­˜å±‚å¯¹ç£ç›˜å—è¿›è¡Œç¼“å­˜ï¼Œå¹¶åŒæ­¥è®¿é—®æ“ä½œï¼Œç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªå†…æ ¸è¿›ç¨‹èƒ½å¤Ÿä¿®æ”¹ç‰¹å®šæ•°æ®å—ä¸­å­˜å‚¨çš„ä¿¡æ¯ã€‚æ—¥å¿—å±‚å…è®¸ä¸Šå±‚å°†å¤šä¸ªæ•°æ®å—çš„æ›´æ–°æ‰“åŒ…æˆäº‹åŠ¡å¤„ç†ï¼Œå¹¶ç¡®ä¿åœ¨ç³»ç»Ÿå´©æºƒæ—¶è¿™äº›æ•°æ®å—èƒ½ä»¥åŸå­æ–¹å¼æ›´æ–°ï¼ˆå³è¦ä¹ˆå…¨éƒ¨æ›´æ–°æˆåŠŸï¼Œè¦ä¹ˆå®Œå…¨ä¸æ›´æ–°ï¼‰ã€‚ç´¢å¼•èŠ‚ç‚¹å±‚æä¾›ç‹¬ç«‹æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶ç”±å…·æœ‰å”¯ä¸€ç´¢å¼•ç¼–å·ï¼ˆi-numberï¼‰çš„inodeå’Œå­˜å‚¨æ–‡ä»¶æ•°æ®çš„è‹¥å¹²æ•°æ®å—è¡¨ç¤ºã€‚ç›®å½•å±‚å°†æ¯ä¸ªç›®å½•å®ç°ä¸ºä¸€ç§ç‰¹æ®Šç±»å‹çš„inodeï¼Œå…¶å†…å®¹æ˜¯ç”±ç›®å½•é¡¹ç»„æˆçš„åºåˆ—ï¼Œæ¯ä¸ªç›®å½•é¡¹åŒ…å«æ–‡ä»¶åå’Œç´¢å¼•ç¼–å·ã€‚è·¯å¾„åå±‚æ”¯æŒå¦‚/usr/rtm/xv6/fs.cè¿™æ ·çš„å±‚çº§è·¯å¾„å‘½åï¼Œå¹¶é€šè¿‡é€’å½’æŸ¥æ‰¾è¿›è¡Œè§£æã€‚æ–‡ä»¶æè¿°ç¬¦å±‚åˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿæ¥å£å¯¹å¤šç§Unixèµ„æºï¼ˆå¦‚ç®¡é“ã€è®¾å¤‡ã€æ–‡ä»¶ç­‰ï¼‰è¿›è¡ŒæŠ½è±¡ï¼Œä»è€Œç®€åŒ–åº”ç”¨ç¨‹åºå‘˜çš„å·¥ä½œã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%bb%84%e7%bb%87%e7%bb%93%e6%9e%84.png&#34; title=&#34;/xv6/æ–‡ä»¶ç³»ç»Ÿç»„ç»‡ç»“æ„.png&#34; data-thumbnail=&#34;/xv6/æ–‡ä»¶ç³»ç»Ÿç»„ç»‡ç»“æ„.png&#34; data-sub-html=&#34;&lt;h2&gt;æ–‡ä»¶ç³»ç»Ÿç»„ç»‡ç»“æ„&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/æ–‡ä»¶ç³»ç»Ÿç»„ç»‡ç»“æ„.png&#39; alt=&#34;/xv6/æ–‡ä»¶ç³»ç»Ÿç»„ç»‡ç»“æ„.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;æ–‡ä»¶ç³»ç»Ÿç»„ç»‡ç»“æ„&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;ç£ç›˜ç¡¬ä»¶å‘ˆç°ä¸º512ä¸ªå­—èŠ‚çš„å—åºåˆ—ï¼ˆæ¯ä¸ªæ‰‡åŒº512å­—èŠ‚ï¼‰ï¼ŒOSä½¿ç”¨çš„å—å¤§å°é€šå¸¸æ˜¯æ‰‡åŒºå¤§å°çš„æ•´æ•°å€,xv6å—å¤§å°ä¸º1024å­—èŠ‚ã€‚æ–‡ä»¶ç³»ç»Ÿå°†ç£ç›˜åˆ’åˆ†ä¸ºè‹¥å¹²åŒºåŸŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/xv6%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%bb%84%e7%bb%87.png&#34; title=&#34;/xv6/xv6æ–‡ä»¶ç³»ç»Ÿç»„ç»‡.png&#34; data-thumbnail=&#34;/xv6/xv6æ–‡ä»¶ç³»ç»Ÿç»„ç»‡.png&#34; data-sub-html=&#34;&lt;h2&gt;xv6æ–‡ä»¶ç³»ç»Ÿç»„ç»‡&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/xv6æ–‡ä»¶ç³»ç»Ÿç»„ç»‡.png&#39; alt=&#34;/xv6/xv6æ–‡ä»¶ç³»ç»Ÿç»„ç»‡.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;xv6æ–‡ä»¶ç³»ç»Ÿç»„ç»‡&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;Buffer cacheæœ‰ä¸¤ä¸ªä¸»è¦åŠŸèƒ½ï¼š&lt;/li&gt;&#xA;&lt;li&gt;å®ç°å¯¹ç£ç›˜å—çš„åŒæ­¥è®¿é—®ï¼Œç¡®ä¿å†…å­˜ä¸­åªä¿ç•™ä¸€ä¸ªå—å‰¯æœ¬ï¼Œä¸”åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ä½¿ç”¨è¯¥å‰¯æœ¬ï¼›&lt;/li&gt;&#xA;&lt;li&gt;ç¼“å­˜é«˜é¢‘è®¿é—®å—ï¼Œé¿å…ä»ä½é€Ÿç£ç›˜é‡å¤è¯»å–ã€‚ç›¸å…³ä»£ç ä½äºbio.cæ–‡ä»¶ä¸­ã€‚&#xA;Buffer cacheä¸»è¦æ¥å£ï¼š&lt;/li&gt;&#xA;&lt;li&gt;breadï¼Œä»ç£ç›˜ä¸­è·å–åŒ…å«å—å‰¯æœ¬çš„bufç»“æ„ï¼›&lt;/li&gt;&#xA;&lt;li&gt;bwriteï¼Œå°†ä¿®æ”¹åçš„ç¼“å†²åŒºå†™å…¥ç£ç›˜å¯¹åº”å—ï¼›&lt;/li&gt;&#xA;&lt;li&gt;brelseï¼Œé‡Šæ”¾ä¸€å—bufferçš„ç¡çœ é”ï¼Œåœ¨breadæ—¶ä¼šacquireå¯¹åº”bufferçš„é”ï¼Œè¿™é‡Œè¦é‡Šæ”¾ã€‚æ¯ä¸ªbufferæœ‰å…¶ç¡çœ é”ï¼Œè€Œæ•´ä¸ªbuffer cacheé“¾è¡¨æœ‰ä¸€æŠŠå¤§é”bcache.lockï¼Œè¿™ä¸ªé”åœ¨å¯¹æ•´ä¸ªbuffer cacheé“¾è¡¨è¿›è¡Œæ“ä½œæ—¶è¦acquireã€‚sleep lockä¿æŠ¤çš„æ˜¯å—çš„bufferå†…å®¹è¯»å†™ï¼Œè€Œbcache.lockä¿æŠ¤çš„æ˜¯æ‰€æœ‰è¢«ç¼“å­˜å—çš„ä¿¡æ¯ã€‚&#xA;Buffer cacheçš„ç»´æŠ¤ä½¿ç”¨LRUç­–ç•¥ï¼ŒåŸºäºåŒå‘å¾ªç¯é“¾è¡¨ï¼Œé“¾è¡¨headèŠ‚ç‚¹æ˜¯æœ€æ–°çš„bufferã€headèŠ‚ç‚¹å‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯æœ€ä¹…æœªè¢«ä½¿ç”¨çš„bufferã€‚æ‰€ä»¥ä»headèŠ‚ç‚¹å‘åéå†æ˜¯æ‰¾æœ€è¿‘ä½¿ç”¨çš„bufferï¼Œå‘å‰éå†æ˜¯æ‰¾æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„bufferï¼Œä¸€èˆ¬ä¼šè¸¢å‡ºæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„bufferï¼Œç„¶åå‘headä¹‹åæ’å…¥æ–°çš„bufferã€‚&#xA;ç³»ç»Ÿå´©æºƒé—®é¢˜çš„å‡ºç°æ˜¯å¯¹ç£ç›˜å†™å…¥æ—¶ï¼Œåªæ‰§è¡Œäº†éƒ¨åˆ†å†™æ“ä½œï¼Œä»è€Œä½¿ç£ç›˜ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿå¤„äºä¸ä¸€è‡´çš„çŠ¶æ€ã€‚&#xA;xv6é€šè¿‡ä¸€ç§ç®€å•çš„æ—¥å¿—è®°å½•å½¢å¼è§£å†³äº†æ–‡ä»¶ç³»ç»Ÿå´©æºƒé—®é¢˜ã€‚syscallä¸ä¼šç›´æ¥å†™å…¥ç£ç›˜ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿæ•°æ®ç»“æ„ï¼Œè€Œæ˜¯ä¼šå°†æ‰€æœ‰å†™å…¥æ“ä½œè®°å½•åˆ°ç£ç›˜çš„æ—¥å¿—ä¸­ã€‚å½“syscallå®Œæˆæ‰€æœ‰å†™å…¥æ“ä½œçš„æ—¥å¿—è®°å½•åï¼Œä¼šå‘ç£ç›˜å†™å…¥ä¸€ä¸ªcommitï¼Œè¡¨æ˜è¯¥æ—¥å¿—åŒ…å«å®Œæ•´çš„æ“ä½œã€‚æ­¤æ—¶ï¼Œsyscallä¼šå°†è¿™äº›å†™å…¥æ“ä½œå¤åˆ¶åˆ°ç£ç›˜çš„æ–‡ä»¶ç³»ç»Ÿæ•°æ®ç»“æ„ä¸­ã€‚ç­‰è¿™äº›å†™å…¥å®Œæˆåï¼Œsyscallå°†æ“¦é™¤ç£ç›˜ä¸Šçš„æ—¥å¿—ã€‚æ—¥å¿—èƒ½ç¡®ä¿åœ¨å´©æºƒæ—¶å…·æœ‰åŸå­æ€§ï¼šæ¢å¤åï¼Œè¦ä¹ˆæ“ä½œçš„æ‰€æœ‰å†™å…¥éƒ½å‡ºç°åœ¨ç£ç›˜ä¸Šï¼Œè¦ä¹ˆä¸€ä¸ªéƒ½ä¸ä¼šå‡ºç°ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;ä¸ªäººæ„Ÿè§‰xv6çš„æ–‡ä»¶ç³»ç»Ÿæ¯”è¾ƒå¤æ‚ï¼Œæ¶‰åŠå¾ˆå¤šä»£ç ï¼Œä¸åƒä¹‹å‰çš„å†…å­˜ç®¡ç†ã€è™šæ‹ŸåŒ–CPUï¼Œæ˜¯ç†è§£ä¸ŠæŠ½è±¡ï¼Œä½†æœ‰é€»è¾‘ï¼Œä¸å¤æ‚ã€‚è€Œæ–‡ä»¶ç³»ç»Ÿéƒ¨åˆ†éœ€è¦ä»”ç»†é˜…è¯»ä¼—å¤šå‡½æ•°æºç åæ‰èƒ½æ›´å¥½çš„ç†è§£ï¼Œxv6 bookåªç”¨äº†ä¸€ç« æ¥è®²è§£äº†è¿™ä¸ªå¤æ‚çš„ç³»ç»Ÿï¼Œæ‰€ä»¥åœ¨æ­¤é˜…è¯»ã€Šæ“ä½œç³»ç»ŸåŸå‹â€”â€”xv6åˆ†æä¸å®éªŒã€‹çš„æ–‡ä»¶ç®¡ç†éƒ¨åˆ†è¿›è¡Œè¡¥å……ã€‚&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;xv6fs-æ–‡ä»¶ç®¡ç†&#34;&gt;&lt;span&gt;xv6fs æ–‡ä»¶ç®¡ç†&lt;/span&gt;&#xA;  &lt;a href=&#34;#xv6fs-%e6%96%87%e4%bb%b6%e7%ae%a1%e7%90%86&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;é™æ€æ¦‚å¿µï¼šç£ç›˜æ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼åŠå…¶ç»†èŠ‚ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åŠ¨æ€æ¦‚å¿µï¼šç”¨æˆ·è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨è®¿é—®ç£ç›˜æ•°æ®çš„è¿‡ç¨‹åŠå…¶æ‰€ä½¿ç”¨çš„ä»£ç ã€‚&lt;/p&gt;&#xA;&lt;p&gt;æ–‡ä»¶çš„é€»è¾‘ç»“æ„ï¼šç”¨æˆ·è¿›ç¨‹çœ‹æ¥æ˜¯ä¸€ä¸ªçº¿æ€§å¯å¯»å€çš„å­—èŠ‚é›†åˆï¼Œåªè¦ç»™å‡ºå…·ä½“çš„åç§»é‡å°±å¯ä»¥è®¿é—®åˆ°æ–‡ä»¶çš„ä»»æ„å†…å®¹ã€‚å…·ä½“åˆ°æ“ä½œç³»ç»Ÿæ–‡ä»¶åˆ™æ˜¯ä½¿ç”¨fileç»“æ„ä½“è¡¨ç¤ºï¼Œposæˆå‘˜è¡¨ç¤ºåç§»é‡ã€‚åœ¨æ–‡ä»¶é€»è¾‘å±‚ç»´æŠ¤äº†fileæ–‡ä»¶ç»“æ„ä½“æ•°ç»„ï¼Œå…¶ä½¿ç”¨inodeã€dinodeä½œä¸ºæ–‡ä»¶ç´¢å¼•ï¼Œå¯¹åº”åˆ°ç£ç›˜çš„å—ã€‚ç±»ä¼¼äºé¡µè¡¨å°†è™šæ‹Ÿå†…å­˜åœ°å€æ˜ å°„åˆ°ç‰©ç†å†…å­˜åœ°å€ï¼Œinodeç´¢å¼•å°†é€»è¾‘æ–‡ä»¶æ˜ å°„åˆ°ç‰©ç†ç£ç›˜å—ä¸Šã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84.png&#34; title=&#34;/xv6/æ–‡ä»¶ç»“æ„.png&#34; data-thumbnail=&#34;/xv6/æ–‡ä»¶ç»“æ„.png&#34; data-sub-html=&#34;&lt;h2&gt;æ–‡ä»¶ç»“æ„&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/æ–‡ä»¶ç»“æ„.png&#39; alt=&#34;/xv6/æ–‡ä»¶ç»“æ„.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;æ–‡ä»¶ç»“æ„&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;xv6ç£ç›˜æ–‡ä»¶ç³»ç»Ÿçš„å¸ƒå±€ï¼šå¯åŠ¨å—ã€è¶…çº§å—ã€æ—¥å¿—å—ã€inodeå—ã€ä½å›¾å—ã€æ•°æ®å—ã€‚å…¶ä¸­è¶…çº§å—è®°å½•æ—¥å¿—å—ã€inodeå—ã€ä½å›¾å—ã€æ•°æ®å—çš„èµ·å§‹å—å·å’Œæ•°é‡ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%bb%84%e7%bb%87.png&#34; title=&#34;/xv6/æ–‡ä»¶ç³»ç»Ÿç»„ç»‡.png&#34; data-thumbnail=&#34;/xv6/æ–‡ä»¶ç³»ç»Ÿç»„ç»‡.png&#34; data-sub-html=&#34;&lt;h2&gt;æ–‡ä»¶ç³»ç»Ÿç»„ç»‡&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/æ–‡ä»¶ç³»ç»Ÿç»„ç»‡.png&#39; alt=&#34;/xv6/æ–‡ä»¶ç³»ç»Ÿç»„ç»‡.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;æ–‡ä»¶ç³»ç»Ÿç»„ç»‡&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;ç›®å½•ä¹Ÿæ˜¯æ–‡ä»¶ï¼Œä¸è¿‡å†…å®¹æ˜¯ï¼ˆinode numï¼Œpathï¼‰å½¢å¼çš„ç›®å½•é¡¹ï¼ŒæŒ‡å‘äº†å¤šä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±å½¢æˆäº†æ ‘çŠ¶ç»“æ„ï¼Œç›¸å¯¹äºæ‰å¹³çš„ï¼Œæ›´å…·æœ‰å±‚æ¬¡æ€§ã€‚ç›®å½•çš„å‰ä¸¤ä¸ªç›®å½•é¡¹éƒ½æ˜¯ä¸€è‡´çš„ï¼Œæ˜¯â€œ.â€å’Œâ€œ..â€ï¼Œåˆ†åˆ«æŒ‡å‘è‡ªå·±å’Œçˆ¶ç›®å½•ï¼Œé‚£æˆ‘ä»¬åœ¨æŸ¥æ‰¾æ–‡ä»¶æ—¶ï¼Œè¾“å…¥pathï¼Œå°±å¯ä»¥æŒ‰ç…§è·¯å¾„åä»ç›®å½•æ ‘ä¸­è‡ªé¡¶å‘ä¸‹æŸ¥æ‰¾ï¼Œç›®å½•ä¹Ÿæ˜¯æ–‡ä»¶è¯´æ˜å®ƒä¹Ÿè¦æœ‰çˆ¶ç›®å½•ï¼Œç›®å½•é¡¹æŒ‡å‘å®ƒï¼Œè¿™æ ·æœ‰ç›®å½•å°±å¿…é¡»è¦æœ‰çˆ¶ç›®å½•ï¼Œä¸ºäº†é¿å…è¿™ç§å…ˆé¸¡åè›‹çš„é—®é¢˜ï¼Œå®šä¹‰æ ¹ç›®å½•â€œ/â€ï¼ˆè¿™ä¸ªæ–œæ å’Œé™¤å·ä¸€æ ·ï¼Œä¸æ˜¯åæ–œæ ï¼‰çš„inodeä¸º1ï¼Œè¿™æ ·å›ºå®šäº†æ ¹ç›®å½•èŠ‚ç‚¹çš„inodeå°±å¯ä»¥ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç”±ä¹‹å‰çš„ç« èŠ‚æˆ‘ä»¬çŸ¥é“ï¼ŒOSå¯¹æ–‡ä»¶çš„è¯»å†™æ“ä½œéƒ½æ˜¯é’ˆå¯¹æ–‡ä»¶æè¿°ç¬¦çš„ï¼Œæ‰€ä»¥è¿›ç¨‹æ“ä½œçš„æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œä¸æ˜¯ä¸Šè¿°çš„fileç»“æ„ä½“æˆ–æ˜¯inodeç»“æ„ä½“ã€‚xv6æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦è¡¨proc-&amp;gt;ofile[]ï¼Œæ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦éƒ½æŒ‡å‘äº†ä¸€ä¸ªftableçš„fileç»“æ„ä½“ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆåˆå¢åŠ ä¸€å±‚ï¼Œæ˜¯å› ä¸ºæ–‡ä»¶æè¿°ç¬¦ä¸fileå¯èƒ½æ˜¯å¤šå¯¹ä¸€çš„å…³ç³»ï¼Œå¤šä¸ªæ–‡ä»¶æè¿°ç¬¦å¯èƒ½æŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e6%96%87%e4%bb%b6%e6%8f%8f%e8%bf%b0%e7%ac%a6%e8%a1%a8.png&#34; title=&#34;/xv6/æ–‡ä»¶æè¿°ç¬¦è¡¨.png&#34; data-thumbnail=&#34;/xv6/æ–‡ä»¶æè¿°ç¬¦è¡¨.png&#34; data-sub-html=&#34;&lt;h2&gt;æ–‡ä»¶æè¿°ç¬¦è¡¨&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/æ–‡ä»¶æè¿°ç¬¦è¡¨.png&#39; alt=&#34;/xv6/æ–‡ä»¶æè¿°ç¬¦è¡¨.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;æ–‡ä»¶æè¿°ç¬¦è¡¨&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;dinodeç»“æ„ä½“åŒ…å«typeç±»å‹ï¼Œå¯èƒ½æ˜¯ç›®å½•ã€ç£ç›˜æ–‡ä»¶ã€è®¾å¤‡ï¼›nlinkè®°å½•æœ‰å¤šå°‘ç›®å½•é¡¹æŒ‡å‘äº†è¯¥dinodeï¼Œå®é™…ä¸Šä»£è¡¨è¿™ä¸ªæ–‡ä»¶æœ‰å¤šå°‘è·¯å¾„åï¼›addressæ•°ç»„ï¼Œå…ƒç´ å†…å®¹æ˜¯ç£ç›˜å—å·ï¼Œä¹Ÿå°±ç»„ç»‡èµ·æ¥äº†ä¸€å †å—ä¸ºè¯¥dinodeæ–‡ä»¶æ‰€å±ã€‚ä¹¦ä¸­çš„indirect blockæœ‰128ä¸ªå…ƒç´ ï¼Œè€Œxv6æºç ï¼ˆ2024ï¼‰ä¸­æ˜¯æœ‰256ä¸ªå…ƒç´ çš„ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/dinode%e7%bb%93%e6%9e%84.png&#34; title=&#34;/xv6/dinodeç»“æ„.png&#34; data-thumbnail=&#34;/xv6/dinodeç»“æ„.png&#34; data-sub-html=&#34;&lt;h2&gt;dinodeç»“æ„&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/dinodeç»“æ„.png&#39; alt=&#34;/xv6/dinodeç»“æ„.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;dinodeç»“æ„&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;æ–‡ä»¶ç³»ç»Ÿæ“ä½œ&#34;&gt;&lt;span&gt;æ–‡ä»¶ç³»ç»Ÿæ“ä½œ&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e6%93%8d%e4%bd%9c&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;ä¸ŠèŠ‚æ‰€è¿°çš„æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„å¤§ä½“ç»“æ„ï¼Œæœ¬èŠ‚è‡ªåº•å‘ä¸Šè®¨è®ºæ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä¹¦ä¸­æœ‰ä¸€å¥ï¼šxv6ä½¿ç”¨äº†æ—¥å¿—ç³»ç»Ÿï¼Œå› æ­¤æ‰€æœ‰å†™æ“ä½œéƒ½æ˜¯é€šè¿‡log_write()å®Œæˆçš„ï¼Œä½†æ˜¯è¯»æ“ä½œå¹¶ä¸éœ€è¦æ—¥å¿—ç³»ç»Ÿã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç”±äºç£ç›˜å—çš„è¯»å†™æ“ä½œæ¯”è¾ƒæ…¢ï¼Œå› æ­¤ä½¿ç”¨å†…å­˜ä¸­çš„å—ç¼“å­˜æ¥åŠ å¿«å…¶è®¿é—®é€Ÿåº¦ï¼Œä¾‹å¦‚å¯¹ä¸€ä¸ªå—çš„å¤šæ¬¡å†™æ“ä½œå¯ä»¥åœ¨å†…å­˜ä¸­å®Œæˆï¼Œç›´åˆ°æ¢å‡ºåˆ°ç£ç›˜ä¸Šæ‰çœŸæ­£æ‰§è¡Œå†™æ“ä½œã€‚xv6å—ç¼“å­˜ä½¿ç”¨bcacheç»“æ„ç®¡ç†30ä¸ªå—ç¼“å­˜bufferï¼Œå•ä¸ªbufferä½¿ç”¨bufç»“æ„ä½“ï¼ŒåŒ…å«è®¾å¤‡å·ã€å—å·ã€å‰é©±ç»“æ„ä½“æŒ‡é’ˆã€åç»§ç»“æ„ä½“æŒ‡é’ˆã€å—æ•°æ®ã€‚è€Œè¿™30ä¸ªå—ç¼“å­˜ä½¿ç”¨åŒå‘é“¾è¡¨æ¥ç»´æŠ¤ï¼Œé“¾è¡¨å¤´ç»“ç‚¹æŒ‡å‘æœ€è¿‘ä½¿ç”¨çš„bufferï¼Œå¤´ç»“ç‚¹çš„å‰é©±æŒ‡å‘æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„bufferï¼Œbcacheäº’æ–¥é”ç»´æŠ¤åŒå‘é“¾è¡¨çš„bcacheã€‚å—ç¼“å­˜çš„æŸ¥æ‰¾å’Œé‡Šæ”¾ä½¿ç”¨bget()å’Œbrelse()ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å—çš„è¯»å†™æ“ä½œbread()å’Œbwrite()æ˜¯æ–‡ä»¶ç³»ç»Ÿæœ€åŸºæœ¬çš„æ“ä½œã€‚å½“è¦è¯»å…¥ä¸€ä¸ªç›˜å—æ•°æ®æ—¶ï¼Œå›å…ˆbget()å¾—åˆ°å—ç¼“å­˜ï¼›writei()è°ƒç”¨bwrite()ä¹‹å‰ä¼šè°ƒç”¨bread()å¾—åˆ°å—ç¼“å­˜ï¼Œç„¶åå†å»å†™ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä¸ºäº†åŠ å¿«ç´¢å¼•èŠ‚ç‚¹çš„è¯»å†™æ“ä½œï¼Œxv6ä¹Ÿä¼šå»ºç«‹inodeçš„ç¼“å­˜ï¼Œdinodeæ˜¯ç£ç›˜çš„inodeã€inodeæ˜¯å†…å­˜ç¼“å­˜çš„inodeï¼Œinodeåœ¨ä¸Šè¿°dinodeç»“æ„ä½“åŸºç¡€ä¸Šå¢åŠ äº†éƒ¨åˆ†æˆå‘˜å˜é‡ï¼Œå¦‚devè®¾å¤‡å·ã€inumå·ã€refå¼•ç”¨è®¡æ•°ã€lockç¡çœ é”ã€validæ ‡å¿—ä½ç­‰ï¼ˆè¿™é‡Œ2024xv6æºç ä¸æ­¤ä¹¦ä¸åŒï¼Œæ˜æ˜¾æ˜¯æœ‰æ‰€æ›´æ”¹ï¼‰ï¼Œè¿™é‡Œçš„refå¼•ç”¨è®¡æ•°æ˜¯æŒ‡æœ‰å¤šå°‘ä¸ªæ‰“å¼€çš„æ–‡ä»¶ä½¿ç”¨è¯¥inodeï¼Œä¹Ÿå°±æ˜¯ä¸Šå±‚fileæŒ‡å‘æ­¤inodeçš„æ•°é‡ï¼Œæ³¨æ„ä¸nlinkåŒºåˆ†ã€‚&lt;/p&gt;&#xA;&lt;p&gt;æ–‡ä»¶è¯»å†™æ“ä½œï¼šreadi()ä»inodeå¯¹åº”çš„æ–‡ä»¶åç§»offå¤„ï¼Œè¯»å…¥nä¸ªå­—èŠ‚åˆ°dstæŒ‡å‘çš„æ•°æ®ç¼“å†²åŒºï¼Œå…ˆé€šè¿‡bmap()æ‰¾åˆ°å¯¹åº”çš„ç‰©ç†å—å·ï¼›writei()å…ˆè°ƒç”¨bread()å°†ç£ç›˜å—è¯»å…¥åˆ°å—ç¼“å­˜ï¼Œå†å°†æ•°æ®å¤åˆ¶åˆ°å—ç¼“å­˜ä¸­ï¼Œæœ€åç”±log_write()å‘æ—¥å¿—ç³»ç»Ÿå†™å‡ºã€‚&lt;/p&gt;&#xA;&lt;p&gt;xv6çš„struct fileæ˜¯å¯¹inodeçš„ä¸€æ¬¡åŠ¨æ€æŠ½è±¡å’Œå°è£…ã€‚å¯¹fileè€Œè¨€ï¼Œæ–‡ä»¶å†…å®¹æ˜¯ä¸€ç»´çš„å­—èŠ‚æ•°ç»„ï¼Œå¯ä»¥ç”¨åç§»é‡è®¿é—®æ–‡ä»¶ä¸­çš„ä»»æ„æ•°æ®ã€‚å‘ä¸Šä¸æ–‡ä»¶æè¿°ç¬¦è¡¨å»ºç«‹è”ç³»ï¼Œå‘ä¸‹ä¸inodeç›¸å…³è”ã€‚fileç‰¹æŒ‡ç£ç›˜æ–‡ä»¶çš„ä¸€æ¬¡åŠ¨æ€æ‰“å¼€ï¼Œæ˜¯åŠ¨æ€æ¦‚å¿µï¼Œè€Œinodeä»£è¡¨çš„ç£ç›˜æ–‡ä»¶åˆ™æ˜¯é™æ€æ¦‚å¿µã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¿™éƒ¨åˆ†çš„ä»£ç å¤ªå¤šäº†ï¼Œå¾ˆå¤šå‡½æ•°ï¼Œå¾ˆéš¾ä¸€ä¸€è®°å½•ã€‚æ­¤ä¹¦ä¹Ÿæ˜¯ç²˜è´´äº†å¤§éƒ¨åˆ†æºä»£ç åšæ³¨é‡Šï¼Œä¸ªäººçš„è¯è¿˜æ˜¯å»ºè®®ç›´æ¥è¯»xv6çš„ä»£ç ç»“åˆä¹¦ä¸Šçš„å‡½æ•°å¤§æ„æ¥ç†è§£ã€‚å†æ¬¡å°±ä¸å†èµ˜è¿°äº†ï¼Œåªæ˜¯éœ€è¦å›ç­”ä»¥ä¸‹å‡ ä¸ªé—®é¢˜æ¥æŒæ¡æ–‡ä»¶ç³»ç»Ÿçš„ç»„ç»‡è„‰ç»œã€‚&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;æ–‡ä»¶æ€ä¹ˆåˆ›å»ºçš„ï¼Ÿ&#xA;sys_open()-&amp;gt;create()ï¼Œæ‰¾åˆ°pathå¯¹åº”çš„çˆ¶ç›®å½•ï¼Œä¸ºå…¶æ·»åŠ ç›®å½•é¡¹ï¼Œialloc()åˆ†é…inodeï¼Œå¹¶è°ƒç”¨filealloc()åˆ†é…ç©ºé—²çš„fileå¯¹è±¡ï¼Œfdalloc()åˆ†é…å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ã€‚&lt;/li&gt;&#xA;&lt;li&gt;æ–‡ä»¶æ€ä¹ˆåˆ é™¤çš„ï¼Ÿ&#xA;file.cä½œä¸ºä¸Šå±‚syscallå’Œä¸‹å±‚inodeçš„ä¸­é—´å±‚ï¼Œæä¾›fileclose()ï¼Œå®ƒä¼šåˆ¤æ–­fileçš„refæ˜¯å¦ä¸º1ï¼ˆåªæœ‰ä¸€ä¸ªsyscallä½¿ç”¨è¯¥fileï¼‰ï¼Œå¦‚æœæ˜¯ï¼Œä¼šè°ƒç”¨iput()å°è¯•é‡Šæ”¾inodeï¼Œåœ¨inodeçš„nlinkä¸º0ï¼ˆæ²¡æœ‰pathæŒ‡å‘å®ƒï¼‰æ—¶ï¼Œä¼šçœŸæ­£é‡Šæ”¾inodeï¼ŒåŒæ—¶è°ƒç”¨bfree()æŠŠå¯¹åº”çš„ç£ç›˜å—é‡Šæ”¾æ‰ã€‚&lt;/li&gt;&#xA;&lt;li&gt;æ–‡ä»¶æ€ä¹ˆè¯»ï¼Ÿ&#xA;åŒæ ·file.cæä¾›fileread()ï¼Œå¯¹äºç£ç›˜æ–‡ä»¶è°ƒç”¨readi()ï¼Œä¼ å…¥fileå¯¹åº”çš„inodeå’Œåç§»é‡ï¼Œç„¶åå»è°ƒç”¨bread()è¯»å–ç£ç›˜å—ã€‚&lt;/li&gt;&#xA;&lt;li&gt;æ–‡ä»¶æ€ä¹ˆå†™ï¼Ÿ&#xA;file.cæä¾›filewrite()ï¼Œç„¶åè°ƒç”¨writei()ï¼Œä¼ å…¥fileå¯¹åº”çš„inodeå’Œåç§»é‡ï¼Œä»¥åŠä¸ºé˜²æ­¢ä¸€æ¬¡å†™å…¥çš„æ•°æ®è¶…è¿‡æ—¥å¿—ç³»ç»Ÿçš„ä¸Šé™ï¼Œä¸€æ¬¡æœ€å¤šå†™å…¥maxä¸ªå­—èŠ‚ï¼Œå¦‚æœè¶…è¿‡å°†åˆ†æˆå¤šæ¬¡å†™å…¥ã€‚writei()è°ƒç”¨log_write()ï¼Œå†™å…¥æ“ä½œè¿˜æ˜¯å…ˆå†™åˆ°æ—¥å¿—ä¸Šå»ã€‚å‡½æ•°è°ƒç”¨é“¾æ˜¯ï¼šwrite()-&amp;gt;sys_write()-&amp;gt;filewrite()-&amp;gt;writei()-&amp;gt;log_write()ã€‚è€Œåœ¨æ–‡ä»¶è¯»å†™å‰éƒ½è¦sys_open()æ–‡ä»¶å¾—åˆ°æ–‡ä»¶çš„æè¿°ç¬¦ï¼Œsys_open()å¯¹äºåˆ›å»ºæ–‡ä»¶ä¼šä½¿ç”¨create()æ‰“å¼€æ–‡ä»¶ã€‚å¦åˆ™é€šè¿‡namei()æŸ¥æ‰¾å¯¹åº”çš„inodeï¼Œç„¶åç”±fileallocåˆ†é…æ–‡ä»¶å¯¹è±¡ï¼Œæœ€åfdalloc()åˆ›å»ºæ–‡ä»¶æè¿°ç¬¦ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;éæ ¸å¿ƒåŠŸèƒ½&#34;&gt;&lt;span&gt;éæ ¸å¿ƒåŠŸèƒ½&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e9%9d%9e%e6%a0%b8%e5%bf%83%e5%8a%9f%e8%83%bd&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;è¿™é‡ŒæŒ‡æ—¥å¿—åŠŸèƒ½ï¼Œxv6æ–‡ä»¶ç³»ç»Ÿçš„æ—¥å¿—ç¡®ä¿å†™æ“ä½œä¸ä¼šå¯¼è‡´æ–‡ä»¶ç³»ç»Ÿçš„ç ´åï¼Œè¿›ç¨‹çš„å†™æ“ä½œæ˜¯ä¸€ç§åŸå­æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨ä¸æ‰§è¡Œã€‚å½“ä¿®æ”¹äº†å†…å­˜ä¸­çš„å—ç¼“å†²åŒºåï¼Œlog_write()åŒæ—¶åœ¨blockæ•°ç»„ä¸­è®°å½•è¿™ä¸ªå—éœ€è¦å†™åˆ°ç£ç›˜çš„å“ªä¸€å—ï¼Œä½†æ˜¯æ²¡æœ‰ç«‹å³å†™ï¼Œå½“è°ƒç”¨commit()æ—¶ï¼Œè°ƒç”¨write_log()å°†å¾…å†™å…¥çš„æ•°æ®ä¿å­˜åœ¨æ—¥å¿—åŒºç›˜å—ä¸Šï¼Œå¹¶è°ƒç”¨write_head()æ›´æ–°ç£ç›˜çš„æ—¥å¿—è®°å½•ï¼Œæœ€åè°ƒç”¨install_trans()çœŸæ­£çš„æ›´æ–°æ–‡ä»¶ç³»ç»Ÿã€‚æ­¤æ—¶ï¼Œè‹¥å‘ç”Ÿå´©æºƒä¼šå¯¼è‡´æ—¥å¿—æœ‰éé›¶çš„è®¡æ•°ï¼Œä»¥ä¾¿é‡å¯åå†æ¬¡è¿›è¡Œå†™æ“ä½œï¼Œæœ€åå°†è®¡æ•°å˜é‡ç½®é›¶ï¼Œä½¿æ—¥å¿—å¤±æ•ˆå¹¶æ›´æ–°æ—¥å¿—åˆå§‹å—ã€‚xv6æ—¥å¿—è¯»å†™æ”¯æŒå¹¶å‘æ“ä½œï¼Œbegin_op()æ£€æŸ¥æ—¥å¿—æ˜¯å¦åœ¨æäº¤ï¼Œå¦‚æœåœ¨æäº¤ï¼Œåˆ™ç¡çœ å½“å‰è¿›ç¨‹ï¼›å¦‚æœä¸åœ¨æäº¤ï¼Œå½“æ²¡æœ‰ä»»ä½•è¿›ç¨‹æ“ä½œlogæ—¶è°ƒç”¨commitæäº¤æ—¥å¿—ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e6%97%a5%e5%bf%97%e5%8c%ba.png&#34; title=&#34;/xv6/æ—¥å¿—åŒº.png&#34; data-thumbnail=&#34;/xv6/æ—¥å¿—åŒº.png&#34; data-sub-html=&#34;&lt;h2&gt;æ—¥å¿—åŒº&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/æ—¥å¿—åŒº.png&#39; alt=&#34;/xv6/æ—¥å¿—åŒº.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;æ—¥å¿—åŒº&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;è¿™ä¸ªç¤ºæ„å›¾åœ¨2024çš„xv6æºç ä¸­åº”è¯¥æ˜¯æ—¥å¿—åŒºåœ¨å‰ï¼Œæ•°æ®å—åœ¨åï¼Œå’Œä¸Šè¾¹æ‰€è¿°çš„ä½ç½®ä¹Ÿä¸ä¸€è‡´ã€‚ä¸è¿‡ä¸å½±å“ç¤ºæ„ï¼Œå…¶å«ä¹‰å°±æ˜¯headerè®°å½•äº†30ä¸ªlogå—ï¼Œblockçš„å†…å®¹æ˜¯è¦å†™å…¥çš„å—ä½ç½®ã€‚ä¸‹å›¾æ˜¯å¯¹åº”çš„æ—¥å¿—å†™ç›˜è¿‡ç¨‹ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e6%97%a5%e5%bf%97%e5%8a%9f%e8%83%bd%e7%a4%ba%e6%84%8f.png&#34; title=&#34;/xv6/æ—¥å¿—åŠŸèƒ½ç¤ºæ„.png&#34; data-thumbnail=&#34;/xv6/æ—¥å¿—åŠŸèƒ½ç¤ºæ„.png&#34; data-sub-html=&#34;&lt;h2&gt;æ—¥å¿—åŠŸèƒ½ç¤ºæ„&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/æ—¥å¿—åŠŸèƒ½ç¤ºæ„.png&#39; alt=&#34;/xv6/æ—¥å¿—åŠŸèƒ½ç¤ºæ„.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;æ—¥å¿—åŠŸèƒ½ç¤ºæ„&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>æ“ä½œç³»ç»Ÿå¯¼è®ºè¯»ä¹¦ç¬”è®°</title>
      <link>http://localhost:1313/posts/ostep-note/</link>
      <pubDate>Sat, 23 Aug 2025 10:28:53 +0800</pubDate><author>1022440588@qq.com (UAreFree)</author>
      <guid>http://localhost:1313/posts/ostep-note/</guid>
      <category domain="http://localhost:1313/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      <description>&lt;img src=&#34;http://localhost:1313/ostep_note_pic/OSTEPface.png&#34; alt=&#34;featured image&#34; referrerpolicy=&#34;no-referrer&#34;&gt;&lt;p&gt;ã€ŠOperating Systems:Three Easy Piecesã€‹æ˜¯Arpaci-Dusseauæ•™æˆå¤«å¦‡æ‰€è‘—ï¼Œå‘Richard Feynmançš„ã€Šè´¹æ›¼ç‰©ç†å­¦è®²ä¹‰ã€‹è‡´æ•¬ã€‚æœ¬ä¹¦å›´ç»•è™šæ‹ŸåŒ–ã€å¹¶å‘å’ŒæŒä¹…åŒ–ä¸‰ä¸ªä¸»é¢˜å±•å¼€ã€‚â€œæ•™è‚²è¿‡ç¨‹çš„çœŸæ­£æ„ä¹‰åœ¨äºï¼šå‰è¿›ï¼Œå­¦ä¹ è®¸å¤šæ–°çš„å’Œå¼•äººå…¥èƒœçš„ä¸»é¢˜ï¼Œé€šè¿‡å­¦ä¹ ä¸æ–­æˆç†Ÿï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œæ‰¾åˆ°èƒ½ä¸ºä½ ç‚¹ç«çš„ä¸œè¥¿ã€‚â€&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;æ“ä½œç³»ç»Ÿä»‹ç»&#34;&gt;&lt;span&gt;æ“ä½œç³»ç»Ÿä»‹ç»&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e4%bb%8b%e7%bb%8d&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;å†¯è¯ºä¾æ›¼è®¡ç®—æ¨¡å‹çš„åŸºæœ¬æ¦‚å¿µï¼Œè¿è¡Œçš„ç¨‹åºä¼šåšä¸€ä»¶éå¸¸ç®€å•çš„äº‹æƒ…ï¼šæ‰§è¡ŒæŒ‡ä»¤ï¼ˆCPUæ˜¯ä¸€ä¸ªæ— æƒ…æ‰§è¡ŒæŒ‡ä»¤çš„æœºå™¨ï¼Œç¨‹åºæ˜¯çŠ¶æ€æœºï¼‰ã€‚å¤„ç†å™¨ä¸æ–­å–æŒ‡ï¼ˆå†…å­˜ä¸­ï¼‰ã€è¯‘ç ã€æ‰§è¡Œã€å†™å›ã€‚æ“ä½œç³»ç»Ÿæ˜¯ä¸€ç±»è½¯ä»¶ï¼Œè´Ÿè´£è®©ç¨‹åºè¿è¡Œå˜å¾—å®¹æ˜“ã€‚&lt;/p&gt;&#xA;&lt;p&gt;æ“ä½œç³»ç»Ÿä¸»è¦åˆ©ç”¨è™šæ‹ŸåŒ–æŠ€æœ¯å°†ç‰©ç†èµ„æºè½¬æ¢ä¸ºè™šæ‹Ÿå½¢å¼ï¼Œè™šæ‹ŸåŒ–CPUå°†å•ä¸ªCPUè½¬æ¢ä¸ºçœ‹ä¼¼æ— é™æ•°é‡çš„CPUï¼Œä»è€Œè®©è®¸å¤šç¨‹åºçœ‹ä¼¼åŒæ—¶è¿è¡Œï¼›è™šæ‹ŸåŒ–å†…å­˜ï¼Œæ¯ä¸ªè¿›ç¨‹è®¿é—®è‡ªå·±çš„ç§æœ‰è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œæ“ä½œç³»ç»Ÿä»¥æŸç§æ–¹å¼æ˜ å°„åˆ°æœºå™¨çš„ç‰©ç†å†…å­˜ä¸Šï¼Œç‰©ç†å†…å­˜æ˜¯æ“ä½œç³»ç»Ÿç®¡ç†çš„å…±äº«èµ„æºã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¹¶å‘é—®é¢˜åœ¨åŒæ—¶ï¼ˆå¹¶å‘åœ°ï¼‰å¤„ç†å¾ˆå¤šäº‹æƒ…æ—¶å‡ºç°ä¸”å¿…é¡»è§£å†³ã€‚å¤šçº¿ç¨‹ç¨‹åºå¯¹å…±äº«è®¡æ•°å™¨å¿…é¡»è¿›è¡Œå¤„ç†ï¼Œå¯¹äºè¿™ç§å¢åŠ è®¡æ•°å€¼æ—¶éœ€è¦ä¸‰æ¡æŒ‡ä»¤ï¼š1. å°†è®¡æ•°å™¨çš„å€¼ä»å†…å­˜åŠ è½½åˆ°å¯„å­˜å™¨ï¼›2. é€’å¢å€¼ï¼›3. å°†å¯„å­˜å™¨çš„å€¼ä¿å­˜å›å†…å­˜ã€‚è¿™ä¸‰æ¡æŒ‡ä»¤ä¸æ˜¯åŸå­æ‰§è¡Œï¼ˆæ‰€æœ‰æŒ‡ä»¤ä¸€æ¬¡æ€§æ‰§è¡Œï¼‰çš„ï¼Œæ‰€ä»¥ä¼šæœ‰æ€ªäº‹å‘ç”Ÿã€‚&lt;/p&gt;&#xA;&lt;p&gt;æ–­ç”µæˆ–ç³»ç»Ÿå´©æºƒï¼Œå†…å­˜ä¸­çš„æ•°æ®å°±ä¼šä¸¢å¤±ï¼Œéœ€è¦ç¡¬ä»¶ï¼ˆç£ç›˜ï¼‰å’Œè½¯ä»¶ï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰æŒä¹…åœ°å­˜å‚¨æ•°æ®ã€‚æ“ä½œç³»ç»Ÿä¸ä¼šè™šæ‹ŸåŒ–ç£ç›˜è€Œæ˜¯å‡è®¾ç”¨æˆ·ç»å¸¸éœ€è¦å…±äº«æ–‡ä»¶ä¸­çš„ä¿¡æ¯ã€‚æ–‡ä»¶ç³»ç»Ÿéƒ¨åˆ†çš„ç³»ç»Ÿè°ƒç”¨æœ‰open()ã€write()ã€close()ç­‰ï¼Œé¦–å…ˆç¡®å®šæ–°æ•°æ®æ”¾åˆ°ç£ç›˜å“ªä¸ªä½ç½®ï¼Œç„¶ååœ¨æ–‡ä»¶ç³»ç»Ÿæ‰€ç»´æŠ¤çš„å„ç§ç»“æ„ä¸­è¿›è¡Œè®°å½•ï¼Œéœ€è¦å‘åº•å±‚å­˜å‚¨è®¾å¤‡å‘å‡ºI/Oè¯·æ±‚ã€‚å‡ºäºæ€§èƒ½æ–¹é¢è€ƒè™‘ï¼Œé¦–å…ˆå»¶è¿Ÿå†™æ“ä½œä¸€æ®µæ—¶é—´ï¼Œå°†å…¶æ‰¹é‡åˆ†ç»„ä¸ºè¾ƒå¤§çš„ç»„ã€‚ä¸ºäº†å¤„ç†å†™å…¥æœŸé—´ç³»ç»Ÿå´©æºƒçš„é—®é¢˜ï¼Œæ–‡ä»¶ç³»ç»ŸåŒ…å«æŸç§å¤æ‚çš„å†™å…¥åè®®ï¼Œå¦‚æ—¥å¿—æˆ–å†™æ—¶å¤åˆ¶ï¼Œä»”ç»†æ’åºå†™å…¥ç£ç›˜çš„æ“ä½œï¼Œä»¥ç¡®ä¿æ¢å¤åˆ°åˆç†çš„çŠ¶æ€ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è®¾è®¡ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„ç›®æ ‡ï¼š1. å»ºç«‹ä¸€äº›æŠ½è±¡ï¼›2. æä¾›é«˜æ€§èƒ½ï¼›3. åœ¨OSå’Œåº”ç”¨ç¨‹åºä¹‹é—´æä¾›éš”ç¦»ï¼›4. å¯é ã€‚&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;è™šæ‹ŸåŒ–&#34;&gt;&lt;span&gt;è™šæ‹ŸåŒ–&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e8%99%9a%e6%8b%9f%e5%8c%96&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;è¿›ç¨‹&#34;&gt;&lt;span&gt;è¿›ç¨‹&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e8%bf%9b%e7%a8%8b&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;è¿›ç¨‹ï¼šè¿è¡Œä¸­çš„ç¨‹åºï¼ŒOSä¸ºè¿è¡Œçš„ç¨‹åºæ‰€æä¾›çš„æŠ½è±¡ã€‚è¿›ç¨‹çš„æœºå™¨çŠ¶æ€ï¼šå†…å­˜å’Œå¯„å­˜å™¨ã€‚æ‰€æœ‰OSéœ€è¦æä¾›çš„APIï¼šåˆ›å»ºã€é”€æ¯ã€ç­‰å¾…ã€å…¶ä»–æ§åˆ¶ã€çŠ¶æ€ã€‚OSè¿è¡Œç¨‹åºå¿…é¡»åšçš„ç¬¬ä¸€ä»¶äº‹ï¼šå°†ç£ç›˜ä¸­çš„ä»£ç å’Œæ‰€æœ‰é™æ€æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼ŒåŠ è½½åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ã€‚OSåœ¨åŠ è½½æ—¶ä¹Ÿæ˜¯æƒ°æ€§åŠ è½½ï¼Œä»…åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´éœ€è¦åŠ è½½çš„ä»£ç å’Œæ•°æ®æ‰ä¼šåŠ è½½ã€‚ç¬¬äºŒä»¶äº‹ï¼Œä¸ºç¨‹åºè¿è¡Œæ—¶æ ˆåˆ†é…å†…å­˜ç©ºé—´ï¼Œä¹Ÿå¯èƒ½åˆ†é…å †ç©ºé—´ã€‚è¿˜ä¼šæ‰§è¡Œä¸€äº›å…¶ä»–åˆå§‹åŒ–ä»»åŠ¡ï¼Œç‰¹åˆ«æ˜¯I/Oç›¸å…³ã€‚é»˜è®¤æ¯ä¸ªè¿›ç¨‹æœ‰ä¸‰ä¸ªæ–‡ä»¶æè¿°ç¬¦fdï¼Œæ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¿›ç¨‹çŠ¶æ€ï¼šè¿è¡Œã€å°±ç»ªã€é˜»å¡ã€‚è¿è¡Œå’Œå°±ç»ªå¯ä»¥ç›¸äº’è½¬æ¢ï¼Œé€šè¿‡CPUè°ƒåº¦å’Œå–æ¶ˆè°ƒåº¦ã€‚é˜»å¡ï¼ˆè¢«æŸç§äº‹ä»¶é˜»å¡ï¼‰éœ€è¦ç­‰å¾…æŸç§äº‹ä»¶å‘ç”Ÿã€‚åˆå§‹ï¼šè¿›ç¨‹åˆšåˆ›å»ºï¼›æœ€ç»ˆï¼šå·²é€€å‡ºä½†å°šæœªæ¸…ç†ï¼ˆåƒµå°¸çŠ¶æ€ï¼‰ã€‚è¿™é‡Œåƒµå°¸è¿›ç¨‹æ˜¯æŒ‡å­è¿›ç¨‹å…ˆäºçˆ¶è¿›ç¨‹é€€å‡ºåï¼Œçˆ¶è¿›ç¨‹æ²¡æœ‰é‡Šæ”¾å­è¿›ç¨‹çš„PCBï¼Œå¦‚æœçˆ¶è¿›ç¨‹ä¸ç»“æŸï¼Œé‚£ä¹ˆä¸€ç›´ä¿æŒåƒµå°¸è¿›ç¨‹çŠ¶æ€ï¼Œå ç”¨ç³»ç»Ÿèµ„æºï¼Œå¦‚æœçˆ¶è¿›ç¨‹ç»“æŸäº†ï¼Œinitè¿›ç¨‹ä¼šè‡ªåŠ¨æ¥æ‰‹å­è¿›ç¨‹å¹¶æ”¶å°¸ã€‚ä¸ä¹‹ç›¸å¯¹çš„æ˜¯å­¤å„¿è¿›ç¨‹ï¼Œå­¤å„¿è¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹å…ˆäºå­è¿›ç¨‹é€€å‡ºï¼Œé‚£ä¹ˆä¼šè¢«initè¿›ç¨‹æ”¶å…»ï¼Œä¸ä¼šå ç”¨ç³»ç»Ÿèµ„æºã€‚åƒµå°¸è¿›ç¨‹çš„å¤„ç†åŠæ³•ï¼š1. æ€æ­»çˆ¶è¿›ç¨‹ï¼Œå¤§å¤šæ•°æƒ…å†µä¸å¯å–ã€‚2. SIGCHLDä¿¡å·å¤„ç†ï¼Œå®é™…ä¸Šå½“å­è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œå†…æ ¸ä¼šå‘å®ƒçš„çˆ¶è¿›ç¨‹å‘é€ä¸€ä¸ªSIGCHLDä¿¡å·ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥é€‰æ‹©å¿½ç•¥ï¼ˆé»˜è®¤ï¼‰è¿˜æ˜¯æä¾›å¤„ç†å‡½æ•°ï¼ˆè°ƒç”¨waitæˆ–waitpidå‡½æ•°é‡Šæ”¾å­è¿›ç¨‹å ç”¨çš„èµ„æºï¼‰ã€‚&lt;/p&gt;&#xA;&lt;p&gt;fork()ï¼šè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ç¡®å®æ¯”è¾ƒå¥‡æ€ªï¼Œåˆå­¦æ—¶å¾ˆéš¾æ¥å—æ˜¯æ€ä¹ˆåšåˆ°åŒä¸€ä¸ªç¨‹åºåŒæ—¶è¿è¡Œç›¸åŒçš„ä»£ç çš„ã€‚forkçš„è¯ä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹copyäº†çˆ¶è¿›ç¨‹ï¼ˆå†…å­˜å’Œå¯„å­˜å™¨å€¼ï¼‰ï¼Œä½†æ˜¯è¿”å›å€¼ä¸åŒï¼ˆå­è¿›ç¨‹è¿”å›å€¼ä¸º0ï¼‰ã€‚forkçš„å­è¿›ç¨‹ä¸ä¼šæ‰§è¡Œforkä¹‹å‰çš„ä»£ç ã€‚&lt;/p&gt;&#xA;&lt;p&gt;wait()ï¼šçˆ¶è¿›ç¨‹å¯ä»¥å»¶è¿Ÿæ‰§è¡Œï¼Œè°ƒç”¨waitç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œï¼Œè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ä¹Ÿä¼šå›æ”¶å­è¿›ç¨‹çš„èµ„æºã€‚&lt;/p&gt;&#xA;&lt;p&gt;exec()ï¼šå¯ä»¥è®©å­è¿›ç¨‹æ‰§è¡Œä¸çˆ¶è¿›ç¨‹ä¸åŒçš„ç¨‹åºï¼Œexecä¼šä»å¯æ‰§è¡Œç¨‹åºä¸­åŠ è½½ä»£ç å’Œé™æ€æ•°æ®ï¼Œå¹¶è¦†ç›–è‡ªå·±çš„ä»£ç æ®µå’Œé™æ€æ•°æ®ï¼Œå †ã€æ ˆåŠå…¶ä»–å†…å­˜ç©ºé—´ä¹Ÿä¼šè¢«é‡æ–°åˆå§‹åŒ–ï¼Œç„¶åOSå°±ä¼šæ‰§è¡Œè¯¥ç¨‹åºï¼Œå°†å‚æ•°é€šè¿‡argvä¼ ç»™è¯¥è¿›ç¨‹ã€‚è¿™é‡Œè¯´æ˜execæ˜¯å®Œå…¨è½¬å¤´è°ƒç”¨æ‰€æŒ‡å®šçš„å¯æ‰§è¡Œç¨‹åºã€‚è¿™ç§åˆ†ç¦»forkå’Œexecçš„åšæ³•åœ¨æ„å»ºshellæ—¶éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºè¿™ç»™äº†shellåœ¨forkä¹‹åexecä¹‹å‰è¿è¡Œä»£ç çš„æœºä¼šã€‚æ¯”å¦‚shellä½œä¸ºä¸»è¿›ç¨‹åœ¨forkäº†ä¸€ä¸ªå­è¿›ç¨‹åé€šè¿‡execæ‰§è¡Œwcç³»ç»Ÿè°ƒç”¨ç»Ÿè®¡æ–‡ä»¶å­—ç¬¦æ•°ï¼Œå¯ä»¥ä½¿ç”¨é‡å®šå‘å°†è¾“å‡ºä»æ ‡å‡†è¾“å‡ºæ”¹ä¸ºæŸä¸ªæ–‡ä»¶ï¼Œè€Œè¿™å®ç°åŸç†å°±æ˜¯åœ¨forkä¹‹åexecä¹‹å‰å…³é—­æ ‡å‡†è¾“å‡ºçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰“å¼€æ–‡ä»¶ï¼Œæ–°æ‰“å¼€çš„æ–‡ä»¶å°†æˆä¸ºç¬¬ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»è€Œå‘æ–‡ä»¶ä¸­å†™å…¥ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;å—é™ç›´æ¥æ‰§è¡Œ&#34;&gt;&lt;span&gt;å—é™ç›´æ¥æ‰§è¡Œ&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%8f%97%e9%99%90%e7%9b%b4%e6%8e%a5%e6%89%a7%e8%a1%8c&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;æ—¶åˆ†å…±äº«CPUå®ç°è™šæ‹ŸåŒ–ï¼šçœ‹èµ·æ¥åŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ã€‚åœ¨ä¿æŒæ§åˆ¶æƒçš„åŒæ—¶è·å¾—é«˜æ€§èƒ½æ˜¯æ„å»ºæ“ä½œç³»ç»Ÿçš„ä¸»è¦æŒ‘æˆ˜ä¹‹ä¸€ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢ï¼šåˆ’åˆ†ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´åŒºåˆ†å—é™æ“ä½œæ‰§è¡Œï¼Œå†…æ ¸ç©ºé—´å¯ä»¥åševerythingï¼Œæ‰§è¡Œå—é™çš„æŒ‡ä»¤ï¼›ç”¨æˆ·ç©ºé—´éœ€è¦æ‰§è¡Œè¿™äº›å—é™çš„æŒ‡ä»¤å°±éœ€è¦æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œè€Œè¦æ‰§è¡Œç³»ç»Ÿè°ƒç”¨å°±å¿…é¡»æ‰§è¡ŒtrapæŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤åŒæ—¶è·³è½¬å…¥å†…æ ¸ï¼Œä»è€Œæ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼Œå®Œæˆåï¼ŒOSè°ƒç”¨ä¸€ä¸ªtrapè¿”å›æŒ‡ä»¤è¿”å›åˆ°ç”¨æˆ·ç©ºé—´ã€‚è¿™æ¶‰åŠåˆ°å†…æ ¸æ€åˆ°ç”¨æˆ·æ€çš„è½¬æ¢ï¼Œåœ¨trapæ—¶å¤„ç†å™¨éœ€è¦å°†ä¸€äº›å¯„å­˜å™¨ä¿å­˜åˆ°æ¯ä¸ªè¿›ç¨‹çš„å†…æ ¸æ ˆä¸Šï¼Œtrapè¿”å›æ—¶ä»æ ˆä¸­å¼¹å‡ºè¿™äº›å€¼ã€‚open()ç³»ç»Ÿè°ƒç”¨å’ŒCçš„è¿‡ç¨‹è°ƒç”¨çœ‹èµ·æ¥å·®ä¸å¤šï¼Œæ˜¯çš„ï¼Œopen()æ˜¯ä¸€ä¸ªè¿‡ç¨‹è°ƒç”¨ä½†å†…éƒ¨æœ‰trapæŒ‡ä»¤ï¼Œåœ¨æ‰§è¡Œopen()æ—¶ä¼šç”¨æ±‡ç¼–å¤„ç†å‚æ•°å’Œè¿”å›å€¼ä»¥åŠæ‰§è¡ŒtrapæŒ‡ä»¤ã€‚ç„¶è€Œéœ€è¦è€ƒè™‘çš„ä¸€ç‚¹æ˜¯ï¼Œtrapè¿›å†…æ ¸çš„ä»£ç åœ°å€ä¸èƒ½æ˜¯ä»»æ„çš„ï¼ˆå‡ºäºå®‰å…¨è€ƒè™‘ï¼‰ï¼Œé‚£ä¹ˆæ¯ä¸ªç³»ç»Ÿè°ƒç”¨æˆ–ä¸­æ–­åœ¨trapè¿›å†…æ ¸åéƒ½ä¼šè¢«æŒ‡å®šå¯¹åº”çš„å¤„ç†ç¨‹åºåœ°å€ï¼Œè¿™ä¸ªå¯¹åº”å…³ç³»ä¿å­˜åœ¨trapè¡¨ä¸­ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¿›ç¨‹é—´åˆ‡æ¢ï¼šOSä½œä¸ºä¸€ä¸ªè¿›ç¨‹ï¼ˆç±»ä¼¼çš„ï¼‰ä¹Ÿè¦è¿è¡Œåœ¨CPUä¸Šï¼Œå¦‚æœå­è¿›ç¨‹å»æ‰§è¡Œä¸€ä¸ªæ­»å¾ªç¯è€Œä¸ä¸»åŠ¨è®©å‡ºCPUçš„æ§åˆ¶æƒé‚£ä¹ˆOSå°±å¤±å»äº†CPUçš„æ§åˆ¶æƒï¼Œå”¯ä¸€åŠæ³•æ˜¯é‡å¯å¤§æ³•ã€‚è¿™æ˜¾ç„¶ä¸åˆç†ï¼Œéœ€è¦å…¶ä»–åŠæ³•è·å¾—CPUçš„æ§åˆ¶æƒã€‚æ—¶é’Ÿä¸­æ–­ï¼Œå’Œç³»ç»Ÿè°ƒç”¨ä¸€æ ·ï¼Œå¿…é¡»æœ‰å¯¹åº”çš„ä¸­æ–­å¤„ç†å‡½æ•°ï¼Œä»¥åŠåœ¨ç³»ç»Ÿå¼€å§‹æ—¶ä¹Ÿå¿…é¡»å¯åŠ¨æ—¶é’Ÿã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šç³»ç»Ÿå¼€å¯æ—¶é’Ÿä¸­æ–­ï¼Œä¸­æ–­äº§ç”Ÿåï¼Œå‘ç”Ÿè¿›ç¨‹åˆ‡æ¢ï¼Œä¹Ÿå°±æœ‰è¿›ç¨‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ä¸Šä¸‹æ–‡åˆ‡æ¢å°±æ˜¯ä¿å­˜å½“å‰æ‰§è¡Œè¿›ç¨‹çš„å¯„å­˜å™¨çš„å€¼ï¼Œæ¢å¤å³å°†æ‰§è¡Œè¿›ç¨‹çš„å¯„å­˜å™¨çš„å€¼ã€‚ä¸ºäº†ä¿å­˜å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼ŒOSä¼šæ‰§è¡Œä¸€äº›æ±‡ç¼–ä»£ç æ¥ä¿å­˜é€šç”¨å¯„å­˜å™¨ã€ç¨‹åºè®¡æ•°å™¨ã€å†…æ ¸æ ˆæŒ‡é’ˆï¼Œç„¶åæ¢å¤é€šç”¨å¯„å­˜å™¨ã€ç¨‹åºè®¡æ•°å™¨ã€åˆ‡æ¢å†…æ ¸æ ˆï¼Œä»¥ä¾›å³å°†æ‰§è¡Œè¿›ç¨‹ä½¿ç”¨ã€‚é€šè¿‡åˆ‡æ¢æ ˆï¼Œå†…æ ¸åœ¨è¿›å…¥åˆ‡æ¢ä»£ç è°ƒç”¨æ—¶ï¼Œæ˜¯ä¸€ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œè¿”å›æ—¶ï¼Œæ˜¯å¦ä¸€ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ã€‚å½“OSæœ€ç»ˆæ‰§è¡Œä»é™·é˜±è¿”å›æŒ‡ä»¤æ—¶ï¼Œå³å°†æ‰§è¡Œçš„è¿›ç¨‹å˜æˆäº†å½“å‰è¿è¡Œçš„è¿›ç¨‹ï¼Œè‡³æ­¤ä¸Šä¸‹æ–‡åˆ‡æ¢å®Œæˆã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¿™é‡Œå¯ä»¥è¿™æ ·ç†è§£ï¼Œè¿›ç¨‹è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡ï¼Ÿä¸Šä¸‹æ–‡è‚¯å®šæ˜¯æè¿°è¿›ç¨‹çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆè¿›ç¨‹ç”±ä»€ä¹ˆæ¥æè¿°ï¼Ÿå°±æ˜¯PCBï¼Œç®€å•æ¥è¯´ä¸»è¦åŒ…æ‹¬å¯„å­˜å™¨å’Œå†…å­˜ï¼Œæ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±è¿è¡Œæ—¶å¯„å­˜å™¨çš„å€¼ï¼Œæ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çœ‹èµ·æ¥ç‹¬æœ‰çš„å†…å­˜ç©ºé—´ï¼ˆåŒ…æ‹¬æ ˆå’Œå †ï¼‰ã€‚é‚£ä¹ˆä¸Šä¸‹æ–‡å°±åŒ…æ‹¬è¿™äº›ï¼Œåˆ‡æ¢çš„ä¹Ÿå°±æ˜¯å¯„å­˜å™¨çš„å€¼ã€å†…å­˜ç©ºé—´ã€‚å…·ä½“è¿‡ç¨‹å°±æ˜¯ä¿å­˜æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹Açš„å¯„å­˜å™¨ï¼ˆé€šç”¨å¯„å­˜å™¨ã€ç¨‹åºè®¡æ•°å™¨ã€æ ˆæŒ‡é’ˆç­‰ï¼‰åˆ°å†…æ ¸ç©ºé—´çš„ä¸€å—å†…å­˜ä¸­ï¼ˆcpu_contextç»“æ„ä½“ä¿å­˜ï¼‰ï¼ŒæŠŠå³å°†è¦æ‰§è¡Œçš„è¿›ç¨‹Bæ‰€ä¿å­˜çš„ä¸Šä¸‹æ–‡å†…å­˜å—ä¸­ï¼ˆcpu_contextï¼‰çš„å€¼æ¢å¤åˆ°å¯„å­˜å™¨ä¸­ï¼Œè¿™æ˜¯ç¡¬ä»¶ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼›ä¹Ÿåˆ«å¿˜äº†è¿˜æœ‰å†…å­˜ç©ºé—´çš„åˆ‡æ¢ï¼Œå…·ä½“å°±æ˜¯åˆ‡æ¢è¿›ç¨‹Bçš„pgdï¼ˆé¡µå…¨å±€ç›®å½•çš„è™šæ‹Ÿåœ°å€ï¼‰æ‰€å¯¹åº”çš„é¡µå…¨å±€ç›®å½•çš„ç‰©ç†åœ°å€åˆ°é¡µè¡¨åŸºå€å¯„å­˜å™¨ä¸­ï¼Œå½“è®¿é—®ç”¨æˆ·ç©ºé—´æ—¶MMUä¼šé€šè¿‡é¡µè¡¨åŸºå€å¯„å­˜å™¨æ¥éå†é¡µè¡¨å¾—åˆ°ç‰©ç†åœ°å€ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è€Œä¸‹è¾¹è¡¨ä¸­ä¿å­˜å’Œæ¢å¤äº†ä¸¤æ¬¡å¯„å­˜å™¨ï¼Œå®¹æ˜“è¯¯å¯¼ã€‚å®é™…ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å°±æ˜¯è°ƒç”¨switch()ä¾‹ç¨‹çš„ä¸€æ¬¡å¯„å­˜å™¨çš„ä¿å­˜å’Œæ¢å¤ï¼Œè€Œå¦ä¸€æ¬¡æ˜¯ä¸­æ–­æ‰€ä¼´éšçš„ï¼Œå³ä¸è®ºæ˜¯å¦æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢çš„åœºæ™¯ï¼Œåªè¦ä¸­æ–­äº§ç”Ÿéƒ½ä¼šå°†ç”¨æˆ·æ€çš„å¯„å­˜å™¨çš„å€¼ä¿å­˜åˆ°å†…æ ¸æ ˆï¼Œç„¶åæ¢å¤ï¼Œè¿™é‡Œç§°ä¸ºä¿å­˜ç°åœºï¼Œä¸è¦ä¸è¿›ç¨‹ä¸Šä¸‹æ–‡ææ··ã€‚&lt;/p&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/ostep_note_pic/%e5%8f%97%e9%99%90%e7%9b%b4%e6%8e%a5%e6%89%a7%e8%a1%8c%e5%8d%8f%e8%ae%ae.png&#34; title=&#34;/ostep_note_pic/å—é™ç›´æ¥æ‰§è¡Œåè®®.png&#34; data-thumbnail=&#34;/ostep_note_pic/å—é™ç›´æ¥æ‰§è¡Œåè®®.png&#34; data-sub-html=&#34;&lt;h2&gt;å—é™ç›´æ¥æ‰§è¡Œåè®®ï¼ˆæ—¶é’Ÿä¸­æ–­ï¼‰&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/ostep_note_pic/å—é™ç›´æ¥æ‰§è¡Œåè®®.png&#39; alt=&#34;/ostep_note_pic/å—é™ç›´æ¥æ‰§è¡Œåè®®.png&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;å—é™ç›´æ¥æ‰§è¡Œåè®®ï¼ˆæ—¶é’Ÿä¸­æ–­ï¼‰&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;p&gt;æ‰€è°“çš„å—é™ç›´æ¥æ‰§è¡Œçš„å«ä¹‰æ˜¯ï¼šOSåœ¨å¯åŠ¨æ—¶è®¾ç½®é™·é˜±å¤„ç†ç¨‹åºå¹¶å¯åŠ¨æ—¶é’Ÿä¸­æ–­ï¼Œç„¶åä»…åœ¨å—é™æ¨¡å¼ä¸‹è¿è¡Œè¿›ç¨‹ï¼Œä»¥æ­¤ä¸ºCPUæä¾›å®å®é˜²æŠ¤ã€‚è¿™æ˜¯è™šæ‹ŸåŒ–CPUçš„åŸºæœ¬æœºåˆ¶ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;è¿›ç¨‹è°ƒåº¦&#34;&gt;&lt;span&gt;è¿›ç¨‹è°ƒåº¦&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e8%bf%9b%e7%a8%8b%e8%b0%83%e5%ba%a6&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;è°ƒåº¦æŒ‡æ ‡ï¼šå‘¨è½¬æ—¶é—´ï¼Œå‘¨è½¬æ—¶é—´=å®Œæˆæ—¶é—´-åˆ°è¾¾æ—¶é—´ï¼Œè¿™æ˜¯ä¸€ä¸ªæ€§èƒ½æŒ‡æ ‡ã€‚å¦ä¸€ä¸ªæœ‰è¶£çš„ç›®æ ‡æ˜¯å…¬å¹³ï¼Œä¸¤è€…å¾€å¾€æ˜¯çŸ›ç›¾çš„ã€‚&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;å…ˆè¿›å…ˆå‡º FIFO&lt;/li&gt;&#xA;&lt;li&gt;æœ€çŸ­ä»»åŠ¡ä¼˜å…ˆ SJF&#xA;&lt;ul&gt;&#xA;&lt;li&gt;åŒæ—¶åˆ°è¾¾çš„ä»»åŠ¡å…ˆè¿è¡ŒçŸ­æ—¶é—´çš„&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;æœ€çŸ­å®Œæˆæ—¶é—´ä¼˜å…ˆ STCF&#xA;&lt;ul&gt;&#xA;&lt;li&gt;å‘SJFæ·»åŠ æŠ¢å åˆ™ä¸ºæœ€çŸ­å®Œæˆæ—¶é—´ä¼˜å…ˆï¼Œéšæ—¶åˆ°è¾¾éšæ—¶è¯„ä¼°&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;æ–°çš„è°ƒåº¦æŒ‡æ ‡ï¼šå“åº”æ—¶é—´ï¼Œå“åº”æ—¶é—´=é¦–æ¬¡è¿è¡Œæ—¶é—´-åˆ°è¾¾æ—¶é—´ã€‚å…¶å®å°±å¯¹åº”äº†ä»»åŠ¡çš„å“åº”ä¼˜å…ˆçº§ï¼Œè€ƒè™‘åˆ°äº†æŸäº›è¿è¡Œæ—¶é—´é•¿çš„ä»»åŠ¡ä¸€ç›´å¾—ä¸åˆ°å“åº”çš„æƒ…å†µã€‚&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;è½®è½¬ RR&#xA;&lt;ul&gt;&#xA;&lt;li&gt;æ—¶é—´ç‰‡è½®è½¬ï¼Œåˆ’åˆ†å›ºå®šçš„æ—¶é—´ç‰‡ç»™æ¯ä¸ªä»»åŠ¡ï¼ŒæŒ‰ä»»åŠ¡é˜Ÿåˆ—é¡ºåºä¾æ¬¡å æœ‰CPU&lt;/li&gt;&#xA;&lt;li&gt;æ—¶é—´ç‰‡æ—¶é—´è¶ŠçŸ­å“åº”æ—¶é—´è¶Šå¥½ï¼Œä½†æ˜¯éœ€è¦æ‘Šé”€ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ï¼Œè®©ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶é—´å æ¯”ä¸è¦å¤ªé«˜&lt;/li&gt;&#xA;&lt;li&gt;ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬ä¸ä»…æ¥è‡ªä¸Šè¿°æ‰€è¯´çš„æ“ä½œï¼Œåœ¨CPU cacheã€TLBç­‰ç¡¬ä»¶ä¸Šå»ºç«‹äº†å¤§é‡çš„çŠ¶æ€ï¼Œè¿™äº›åˆ‡æ¢ä¹Ÿå¯èƒ½å¯¼è‡´æ˜¾è‘—çš„æ€§èƒ½æˆæœ¬ã€‚&lt;/li&gt;&#xA;&lt;li&gt;è¿™æ ·ä¼šå¯¼è‡´å‘¨è½¬æ—¶é—´æŒ‡æ ‡å¾ˆå·®ï¼Œå› ä¸ºä½œä¸ºä¸€ä¸ªå…¬å¹³çš„ç­–ç•¥&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;ç»“åˆI/O&#xA;&lt;ul&gt;&#xA;&lt;li&gt;è¿™é‡Œä¸»è¦æ˜¯æŒ‡å®é™…åœºæ™¯ä¸­å¯ä»¥åˆ©ç”¨I/Oæ“ä½œè€—æ—¶çš„é—´éš™è¿›è¡ŒCPUæ“ä½œä»è€Œæ›´å¥½åˆ©ç”¨CPU&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;å¤šçº§åé¦ˆé˜Ÿåˆ— MLFQ&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Corbatoæå‡ºï¼Œè·å¾—å›¾çµå¥–&lt;/li&gt;&#xA;&lt;li&gt;éœ€è¦è”åˆè€ƒè™‘å‘¨è½¬æ—¶é—´å’Œå“åº”æ—¶é—´ä¸¤ä¸ªæŒ‡æ ‡&lt;/li&gt;&#xA;&lt;li&gt;æ˜¯ç”¨å†å²ç»éªŒé¢„æµ‹æœªæ¥çš„ä¸€ä¸ªç»å…¸ä¾‹å­ï¼Œä»¥å²ä¸ºé‰´ï¼Œæ›´å¤šçš„æ˜¯åŸºäºè¡Œä¸ºåˆ¶å®šè§„åˆ™ï¼Œè€Œä¸æ˜¯å…ˆéªŒçŸ¥è¯†&lt;/li&gt;&#xA;&lt;li&gt;åˆ’åˆ†ä¸åŒä¼˜å…ˆçº§çš„ä¸åŒé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¹‹é—´ç”¨RRï¼ŒI/Oå¯†é›†å‹çš„ä¼˜å…ˆçº§é«˜ï¼ˆå ç”¨CPUæ—¶é—´çŸ­ï¼‰ï¼ŒCPUå¯†é›†å‹çš„ä¼˜å…ˆçº§ä½ï¼ˆå ç”¨CPUæ—¶é—´é•¿ï¼‰ï¼Œä¼˜å…ˆçº§å¤§çš„å…ˆè¿è¡Œï¼Œç›¸åŒä¼˜å…ˆçº§çš„è½®è½¬è¿è¡Œã€‚ä½†ä¸èƒ½ä¸€æˆä¸å˜ï¼Œéœ€è¦æ”¹å˜ä¼˜å…ˆçº§ï¼Œå·¥ä½œè¿›å…¥ç³»ç»Ÿæ—¶æ”¾åœ¨æœ€é«˜ä¼˜å…ˆçº§ï¼Œç”¨å®Œä¸€ä¸ªæ—¶é—´ç‰‡åä¸‹é™ä¸€ä¸ªä¼˜å…ˆçº§ï¼Œå¦‚æœåœ¨å…¶æ—¶é—´ç‰‡å†…ä¸»åŠ¨é‡Šæ”¾CPUä¼˜å…ˆçº§ä¸å˜ï¼Œï¼ˆè¿™é‡Œä¸ºäº†é˜²æ­¢ä»»åŠ¡é€šè¿‡ä¸»åŠ¨è°ƒç”¨I/Oæ“ä½œé‡Šæ”¾CPUæ„šå¼„OSä¿æŒä¼˜å…ˆçº§è€Œæå‡ºè®¡ç®—ä¸€å±‚æ€»çš„æ—¶é—´é…é¢ï¼Œè€Œä¸æ˜¯æ—¶é—´ç‰‡ï¼‰ï¼ŒåŒæ—¶ä¸ºäº†é¿å…é¥¥é¥¿é—®é¢˜ï¼ˆCPUå¯†é›†å‹çš„ä»»åŠ¡å ç”¨ä¸åˆ°CPUï¼‰éœ€è¦å‘¨æœŸæ€§çš„æå‡æ‰€æœ‰å·¥ä½œçš„ä¼˜å…ˆçº§ã€‚&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;å¤šå¤„ç†å™¨è°ƒåº¦&#34;&gt;&lt;span&gt;å¤šå¤„ç†å™¨è°ƒåº¦&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%a4%9a%e5%a4%84%e7%90%86%e5%99%a8%e8%b0%83%e5%ba%a6&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;å¤šCPUç›¸å¯¹äºå•CPUçš„åŒºåˆ«æ ¸å¿ƒåœ¨äºå¯¹cacheçš„ä½¿ç”¨ä»¥åŠå¤šCPUä¹‹é—´å…±äº«æ•°æ®çš„æ–¹å¼ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åœ¨å•CPUä¸­å­˜åœ¨å¤šçº§cacheï¼ˆL1ã€L2ã€L3ï¼‰ï¼Œcacheæ˜¯å¾ˆå°ä½†å¾ˆå¿«çš„å­˜å‚¨è®¾å¤‡ï¼ˆå¿«äºå†…å­˜æ…¢äºå¯„å­˜å™¨ï¼‰ï¼ŒcacheåŸºäºæ—¶é—´å±€éƒ¨æ€§ï¼ˆçƒ­ç‚¹æ•°æ®å¯èƒ½ä¼šå†æ¬¡è®¿é—®ï¼‰å’Œç©ºé—´å±€éƒ¨æ€§ï¼ˆè®¿é—®xçš„æ•°æ®å¯èƒ½ç´§æ¥è®¿é—®xå‘¨å›´çš„æ•°æ®ï¼Œéå†æ•°ç»„æŒ‰è¡Œï¼‰ã€‚è€Œå¯¹äºå¤šCPUå°±ä¼šå‡ºç°ç¼“å­˜ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œå°±æ˜¯åœ¨CPU1å†™å†…å­˜Aæ—¶åªæ›´æ–°äº†ç¼“å­˜è€Œæ²¡æœ‰ç«‹å³å†™å›åˆ°åŸå†…å­˜åœ°å€ï¼Œè¿™æ—¶OSä¸­æ–­CPU1è€Œå»è¿è¡ŒCPU2çš„ç¨‹åºï¼Œé‚£ä¹ˆCPU2è¯»çš„æ•°å°±æ˜¯åŸå€¼è€Œä¸æ˜¯æ›´æ”¹åçš„å€¼ã€‚è§£å†³ç¼“å­˜ä¸€è‡´æ€§çš„åŠæ³•ï¼šæ€»çº¿å—…æ¢ã€‚æ¯ä¸ªç¼“å­˜éƒ½é€šè¿‡ç›‘å¬è¿æ¥æ‰€æœ‰ç¼“å­˜å’Œå†…å­˜çš„æ€»çº¿æ¥å‘ç°å†…å­˜è®¿é—®ï¼Œå¦‚æœå‘ç°CPUå¯¹ç¼“å­˜ä¸­çš„æ•°æ®è¿›è¡Œæ›´æ–°ä¼šç§»é™¤ç¼“å­˜æˆ–æ›´æ–°å®ƒã€‚æ€»çº¿å—…æ¢é€šè¿‡äº‹ä»¶å¹¿æ’­é€šçŸ¥åˆ°å…¶ä»–æ ¸å¿ƒï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯äº‹åŠ¡çš„ä¸²è¡ŒåŒ–ï¼ˆæ˜¯æŒ‡æŸä¸ªCPUæ ¸å¿ƒå¯¹æ•°æ®çš„æ“ä½œé¡ºåºå¿…é¡»åœ¨å…¶ä»–æ ¸å¿ƒçœ‹èµ·æ¥é¡ºåºæ˜¯ä¸€æ ·çš„ï¼‰ã€‚MESIï¼ˆå·²ä¿®æ”¹ã€ç‹¬å ã€å…±äº«ã€å·²å¤±æ•ˆï¼‰åè®®åŸºäºæ€»çº¿å—…æ¢æœºåˆ¶å®ç°äº†äº‹åŠ¡çš„ä¸²è¡ŒåŒ–ï¼Œæ„æˆä¸€ä¸ªæµåŠ¨çš„çŠ¶æ€æœºã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¤šCPUè®¿é—®å…±äº«æ•°æ®æ—¶éœ€è¦ä½¿ç”¨äº’æ–¥åŸè¯­ï¼Œæ‰èƒ½ä¿è¯å‡†ç¡®æ€§ã€‚å¯¹äºå…±äº«æ•°æ®ï¼Œå¦‚å¤šCPUå¯¹åŒä¸€é“¾è¡¨ã€å®¹å™¨æ‰§è¡Œå¢åˆ æ“ä½œéƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œéœ€è¦åŠ é”ï¼Œåœ¨å‡½æ•°å¼€å§‹æ—¶è°ƒç”¨lock()ï¼Œå‡½æ•°ç»“æŸæ—¶è°ƒç”¨unlock()ï¼Œä½†éšç€CPUæ•°é‡å¢åŠ ï¼Œè®¿é—®è¿™äº›å…±äº«çš„æ•°æ®ä¼šå˜å¾—å¾ˆæ…¢ã€‚&lt;/p&gt;&#xA;&lt;p&gt;Linuxå¤šå¤„ç†å™¨è°ƒåº¦ç›®å‰å­˜åœ¨3ç§ä¸åŒçš„è°ƒåº¦ç¨‹åºï¼šO(1)åŸºäºä¼˜å…ˆçº§çš„å¤šé˜Ÿåˆ—è°ƒåº¦ã€CFSç¡®å®šçš„æ¯”ä¾‹è°ƒåº¦å¤šé˜Ÿåˆ—è°ƒåº¦å’ŒBFSå°å¿ƒè„å—ä¸äº†çš„å•é˜Ÿåˆ—è°ƒåº¦ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;åœ°å€ç©ºé—´&#34;&gt;&lt;span&gt;åœ°å€ç©ºé—´&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%9c%b0%e5%9d%80%e7%a9%ba%e9%97%b4&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;åœ°å€ç©ºé—´æ˜¯OSæä¾›çš„ä¸€ä¸ªæ˜“ç”¨çš„ç‰©ç†å†…å­˜æŠ½è±¡ã€‚ä¸€ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´åŒ…å«è¿è¡Œçš„ç¨‹åºçš„æ‰€æœ‰å†…å­˜çŠ¶æ€ï¼Œæ¯”å¦‚ï¼Œä»£ç ã€æ ˆã€å †ã€‚å¿…é¡»æä¾›è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢ï¼Œè¿™æ˜¯å†…å­˜è™šæ‹ŸåŒ–çš„å…³é”®ã€‚ä½œä¸ºç”¨æˆ·çº§çš„ç¨‹åºå‘˜ï¼Œå¯ä»¥çœ‹åˆ°ï¼ˆæ‰“å°ï¼‰çš„ä»»ä½•åœ°å€éƒ½æ˜¯è™šæ‹Ÿåœ°å€ï¼Œåªæœ‰OSå’Œç¡¬ä»¶æ‰çŸ¥é“ç‰©ç†åœ°å€ã€‚è™šæ‹Ÿå†…å­˜ä¸ºç¨‹åºæä¾›äº†ä¸€ä¸ªå·¨å¤§çš„ã€ç¨€ç–çš„ã€ç§æœ‰çš„åœ°å€ç©ºé—´å‡è±¡ï¼Œå…¶ä¸­ä¿å­˜äº†ç¨‹åºçš„æ‰€æœ‰æŒ‡ä»¤å’Œæ•°æ®ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¿˜è®°åˆ†é…å†…å­˜å¯¼è‡´çš„æ®µé”™è¯¯ï¼Œåœ¨ä½¿ç”¨strcpy(dst,src)æ—¶ï¼Œdstæ²¡æœ‰åˆ†é…å†…å­˜è€Œå¯¼è‡´ï¼Œæ­£ç¡®çš„ä»£ç æ˜¯ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;src&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;hello&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dst&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;strlen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;src&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;strcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;src&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æ²¡æœ‰åˆ†é…è¶³å¤Ÿçš„å†…å­˜ï¼Œå¯¼è‡´çš„ç¼“å†²åŒºæº¢å‡ºï¼Œå¦‚ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;src&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;hello&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dst&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;strlen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;src&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;strcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;src&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;å¿˜è®°é‡Šæ”¾å†…å­˜ï¼Œå¯¼è‡´çš„å†…å­˜æ³„æ¼ï¼Œmallocå¿…é¡»å¯¹åº”freeï¼Œä¸ç„¶ä¼šå› ä¸ºç¼“æ…¢æ³„æ¼çš„å†…å­˜å¯¼è‡´å†…å­˜ä¸è¶³ï¼Œåªèƒ½é‡å¯ã€‚&lt;/p&gt;&#xA;&lt;p&gt;mallocæ˜¯åº“è°ƒç”¨ï¼Œç”¨åˆ°çš„ç³»ç»Ÿè°ƒç”¨æœ‰ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;brkæˆ–sbrkï¼Œç”¨æ¥æ”¹å˜ç¨‹åºå †ç»“æŸçš„ä½ç½®ï¼Œéœ€è¦ä¸€ä¸ªåœ°å€å‚æ•°æ¥å¢åŠ æˆ–å‡å°å †çš„å¤§å°ã€‚&lt;/li&gt;&#xA;&lt;li&gt;mmapç³»ç»Ÿè°ƒç”¨ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ¿åçš„å†…å­˜åŒºåŸŸï¼Œä¸äº¤æ¢ç©ºé—´ç›¸å…³è”ï¼Œè¿™ç§å†…å­˜ä¹Ÿå¯ä»¥å‘å †ä¸€æ ·å¯¹å¾…å¹¶ç®¡ç†ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;åœ°å€è½¬æ¢&#34;&gt;&lt;span&gt;åœ°å€è½¬æ¢&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%9c%b0%e5%9d%80%e8%bd%ac%e6%8d%a2&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;ç¡¬ä»¶å¯¹æ¯æ¬¡å†…å­˜è®¿é—®è¿›è¡Œå¤„ç†ï¼Œå°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚ä»…é ç¡¬ä»¶ä¹Ÿä¸è¶³ä»¥å®ç°è™šæ‹Ÿå†…å­˜ï¼ŒOSå¿…é¡»åœ¨å…³é”®çš„ä½ç½®ä»‹å…¥ï¼Œè®¾ç½®å¥½ç¡¬ä»¶ï¼Œå› æ­¤å¿…é¡»ç®¡ç†å†…å­˜ï¼Œè®°å½•è¢«å ç”¨å’Œç©ºé—²çš„å†…å­˜ä½ç½®ã€‚æ‰€æœ‰çš„å·¥ä½œéƒ½æ˜¯ä¸ºäº†åˆ›é€ ä¸€ç§å‡è±¡ï¼šæ¯ä¸ªç¨‹åºéƒ½æ‹¥æœ‰ç§æœ‰çš„å†…å­˜ï¼Œå®é™…ä¸Šæ˜¯åŒä¸€æ—¶é—´å…±äº«ç€å†…å­˜ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åŠ¨æ€é‡å®šä½ï¼šåŸºå€åŠ ç•Œé™æœºåˆ¶ï¼Œæ¯ä¸ªCPUéœ€è¦ä¸¤ä¸ªç¡¬ä»¶å¯„å­˜å™¨ï¼ŒåŸºå€å¯„å­˜å™¨å’Œç•Œé™å¯„å­˜å™¨ï¼Œèƒ½å¤Ÿå°†åœ°å€ç©ºé—´æ”¾åˆ°ç‰©ç†å†…å­˜çš„ä»»ä½•ä½ç½®ï¼ŒåŒæ—¶åˆèƒ½ç¡®ä¿è¿›ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„åœ°å€ç©ºé—´ã€‚ç¨‹åºå‡è®¾åœ°å€ç©ºé—´ä»é›¶å¼€å§‹ï¼ŒOSå°†èµ·å§‹åœ°å€è®°å½•åœ¨åŸºå€å¯„å­˜å™¨ä¸­ï¼Œå…¶å®å°±æ˜¯OSç¡®å®šè¦åŠ è½½çš„ç‰©ç†åœ°å€ä½œä¸ºåŸºå€ï¼Œè™šæ‹Ÿåœ°å€ä½œä¸ºåç§»é‡ï¼Œä»è€Œå¾—åˆ°å®é™…çš„ç‰©ç†åœ°å€ã€‚ç•Œé™å¯„å­˜å™¨æä¾›è®¿é—®ä¿æŠ¤ï¼Œè¶…è¿‡è¿™ä¸ªç•Œé™ï¼ŒCPUè§¦å‘å¼‚å¸¸ã€‚è¿™ä¸¤ä¸ªå¯„å­˜å™¨çš„ç¡¬ä»¶ç»“æ„æ˜¯MMUå†…å­˜ç®¡ç†å•å…ƒã€‚ä½†æ˜¯è¿™ç§ç®€å•çš„åŠ¨æ€é‡å®šä½æŠ€æœ¯æ•ˆç‡ä½ä¸‹ï¼Œå®¹æ˜“äº§ç”Ÿå¤§é‡çš„å†…éƒ¨ç¢ç‰‡ï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ°å€ç©ºé—´åˆ’åˆ†äº†å›ºå®šå¤§å°çš„æ§½å—ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä¸ºäº†è§£å†³å†…éƒ¨ç¢ç‰‡çš„é—®é¢˜ï¼Œåˆ†æ®µæ¦‚å¿µåº”è¿è€Œç”Ÿã€‚ä¸€ä¸ªæ®µæ˜¯åœ°å€ç©ºé—´é‡Œçš„ä¸€ä¸ªè¿ç»­å®šé•¿çš„åŒºåŸŸï¼Œå…¸å‹çš„åœ°å€ç©ºé—´æœ‰ä¸‰ä¸ªé€»è¾‘æ®µï¼šä»£ç æ®µã€æ ˆå’Œå †ã€‚è¿™æ ·å°±éœ€è¦3å¯¹åŸºå€å¯„å­˜å™¨å’Œç•Œé™å¯„å­˜å™¨ï¼Œæ¯ä¸ªç•Œé™å¯„å­˜å™¨è®°å½•ä¸€ä¸ªæ®µçš„å¤§å°ï¼Œå¦‚æœè¶…å‡ºè¾¹ç•Œå°±ä¼šå‘ç”Ÿæ®µå¼‚å¸¸æˆ–æ®µé”™è¯¯ã€‚ç¡¬ä»¶åœ¨åœ°å€è½¬æ¢æ—¶ä½¿ç”¨æ®µå¯„å­˜å™¨ï¼Œå¦‚ä½•çŸ¥é“æ®µå†…åç§»é‡å‘¢ï¼Ÿæ˜¾å¼æ–¹å¼å°±æ˜¯ç”¨è™šæ‹Ÿåœ°å€çš„å¼€å¤´å‡ ä½æ¥æ ‡è¯†ä¸åŒçš„æ®µï¼Œæ¯”å¦‚å‰ä¸¤ä½æ ‡è¯†ï¼Œ00æ˜¯ä»£ç æ®µåœ°å€ï¼Œä½¿ç”¨ä»£ç æ®µçš„åŸºåœ°å€å’Œç•Œé™å¯„å­˜å™¨ï¼›01æ˜¯å †åœ°å€ï¼›02æ˜¯æ ˆåœ°å€ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¯¹äº†ï¼Œå¯¹äºæ ˆæ˜¯åå‘å¢é•¿çš„ï¼Œå³ä»é«˜åœ°å€å‘ä½åœ°å€ï¼Œä¸å¦ä¸¤ä¸ªæ®µä¸åŒï¼Œæ‰€ä»¥ç¡¬ä»¶é™¤äº†åŸºå€å’Œç•Œé™ä»¥å¤–è¿˜éœ€è¦çŸ¥é“æ®µçš„å¢é•¿æ–¹å‘ï¼ˆç”¨ä¸€ä½0æˆ–1åŒºåˆ†æ˜¯å¦åå‘å¢é•¿ï¼‰ï¼Œå¯¹åº”çš„åœ°å€è½¬æ¢è®¡ç®—ä¹Ÿå°±ä¸åŒã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¦èŠ‚çœå†…å­˜ï¼Œåœ¨åœ°å€ç©ºé—´ä¹‹é—´å…±äº«æŸäº›å†…å­˜æ®µæ—¶æœ‰ç”¨çš„ã€‚ä¸ºäº†æ”¯æŒå…±äº«ï¼Œéœ€è¦ä¸€äº›é¢å¤–çš„ç¡¬ä»¶æ”¯æŒï¼Œå°±æ˜¯ä¿æŠ¤ä½ï¼ˆå¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œï¼‰ã€‚å› æ­¤ç‰©ç†å†…å­˜ä¸€ä¸ªæ®µå¯ä»¥æ˜ å°„åˆ°å¤šä¸ªè™šæ‹Ÿå†…å­˜ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç„¶è€Œï¼Œåˆ†æ®µä¹Ÿå¸¦æ¥äº†ä¸€äº›æ–°é—®é¢˜ã€‚ç¬¬ä¸€ä¸ªï¼šOSåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼Œæ¯ä¸ªæ®µå¯„å­˜å™¨ä¸­çš„å†…å®¹å¿…é¡»ä¿å­˜å’Œæ¢å¤ã€‚ç¬¬äºŒä¸ªï¼šå­˜åœ¨å¤–éƒ¨ç¢ç‰‡é—®é¢˜ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹éœ€è¦åˆ†é…20KBçš„æ®µæ—¶ï¼Œæœ‰24KBç©ºé—²ä½†ä¸è¿ç»­ï¼Œæ— æ³•æ»¡è¶³éœ€æ±‚ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æœ‰æˆç™¾ä¸Šåƒç§ä½†éƒ½æ— æ³•å®Œå…¨æ¶ˆé™¤å¤–éƒ¨ç¢ç‰‡ï¼Œåªæ˜¯è¯•å›¾å‡å°å®ƒã€‚æ¯”å¦‚ï¼Œé‡æ–°å®‰æ’æ‰€æœ‰æ®µï¼ˆcopyæ‰€æœ‰æ•°æ®æˆæœ¬å¾ˆé«˜ï¼‰ï¼›ç©ºé—²é“¾è¡¨ç®¡ç†ï¼ˆæœ€ä¼˜åŒ¹é…ã€æœ€ååŒ¹é…ã€é¦–æ¬¡åŒ¹é…ã€ä¼™ä¼´ç®—æ³•ç­‰ï¼‰ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;ç©ºé—²å†…å­˜ç®¡ç†&#34;&gt;&lt;span&gt;ç©ºé—²å†…å­˜ç®¡ç†&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e7%a9%ba%e9%97%b2%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;æ— è®ºæ˜¯mallocï¼ˆç®¡ç†è¿›ç¨‹ä¸­å †çš„é¡µï¼‰è¿˜æ˜¯OSæœ¬èº«ï¼ˆç®¡ç†è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼‰ï¼Œéƒ½æ¶‰åŠåˆ°ç©ºé—²å†…å­˜ç®¡ç†ã€‚å¦‚æœç®¡ç†çš„ç©ºé—²å†…å­˜å•å…ƒå¤§å°ä¸æ˜¯å›ºå®šçš„ï¼Œå¦‚ç”¨mallocå’Œfreeï¼ŒOSä½¿ç”¨åˆ†æ®µçš„æ–¹å¼ï¼Œç®¡ç†å°±å˜å¾—å›°éš¾ã€‚&lt;/p&gt;&#xA;&lt;p&gt;mallocåœ¨å †ä¸Šç®¡ç†ç©ºé—²çš„æ•°æ®ç»“æ„ç§°ä¸ºç©ºé—²é“¾è¡¨ï¼ŒåŒ…å«æ‰€æœ‰ç©ºé—²å—çš„å¼•ç”¨ã€‚mallocåœ¨æ‰€æœ‰ç©ºé—´å¿«ç”¨å®Œæ—¶ï¼Œå¯ä»¥å‘å†…æ ¸ç”³è¯·å¢åŠ å †ç©ºé—´ï¼ˆsbrkï¼‰ï¼Œä»¥ä¸‹å‡è®¾mallocç»´æŠ¤çš„ç©ºé—´å¤§å°å›ºå®šã€‚&lt;/p&gt;&#xA;&lt;p&gt;åˆ†å‰²ä¸åˆå¹¶ï¼šç©ºé—²é“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤åœ°å€ç©ºé—´çš„èµ·å§‹åœ°å€å’Œé•¿åº¦ï¼Œæ‰¾åˆ°æ»¡è¶³è¦åˆ†é…å¤§å°çš„èŠ‚ç‚¹è¿›è¡Œåˆ†å‰²ï¼Œfreeåå°†è¿ç»­åœ°å€ç©ºé—´çš„èŠ‚ç‚¹åˆå¹¶ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¿½è¸ªå·²åˆ†é…ç©ºé—´çš„å¤§å°ï¼šfreeå‡½æ•°å¹¶æ²¡æœ‰æ¥æ”¶è¦freeæ‰åœ°å€ç©ºé—´å¤§å°çš„å‚æ•°ï¼Œè€Œæ˜¯åœ¨headerï¼ˆåˆ†é…çš„ç©ºé—²å—å¤´å—ï¼‰ä¸­ä¿å­˜è¿™ä¸ªç©ºé—²å—çš„å¤§å°ï¼Œæ‰€ä»¥åœ¨ç”¨æˆ·è¯·æ±‚Nå­—èŠ‚å†…å­˜æ—¶ï¼Œåº“æ˜¯åœ¨å¯»æ‰¾N+header sizeçš„ç©ºé—²å—ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åµŒå…¥ç©ºé—²é“¾è¡¨ï¼šä¸Šè¿°æ‰€ä½¿ç”¨çš„ç©ºé—²é“¾è¡¨ä¹Ÿéœ€è¦åˆ†é…å†…å­˜ç©ºé—´æ¥å­˜å‚¨ï¼Œè¿™é‡Œå¤§æ¦‚è®²çš„æ„æ€æ˜¯å…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹çš„é—®é¢˜ï¼Œç»´æŠ¤ç©ºé—²å—çš„é“¾è¡¨ä¹Ÿéœ€è¦ç©ºé—²å—æ¥å­˜å‚¨ï¼Œmallocè¦åˆ†é…å†…å­˜å°±éœ€è¦ç©ºé—²é“¾è¡¨ï¼Œè€Œç©ºé—²é“¾è¡¨è¿˜æ²¡æœ‰åˆ›å»ºï¼Œé‚£ä¹ˆå°±éœ€è¦OSå…ˆç”¨mmapç›´æ¥åˆ†é…ä¸€æ®µå¤§å—çš„ç‰©ç†å†…å­˜ï¼ˆ4KBï¼‰ä½œä¸ºç©ºé—²å †ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç®¡ç†ç©ºé—²å—çš„ä¸€äº›ç­–ç•¥ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;æœ€ä¼˜åŒ¹é…ï¼šéå†æ•´ä¸ªç©ºé—²é“¾è¡¨ï¼Œæ‰¾åˆ°å’Œè¯·æ±‚ä¸€æ ·æˆ–æ›´å¤§çš„æ‰€æœ‰ç©ºé—²å—ï¼Œé€‰æœ€å°çš„ã€‚&lt;/li&gt;&#xA;&lt;li&gt;æœ€å·®åŒ¹é…ï¼šå°è¯•æ‰¾æœ€å¤§çš„ç©ºé—²å—ï¼Œè¿›è¡Œåˆ†å‰²ã€‚&lt;/li&gt;&#xA;&lt;li&gt;é¦–æ¬¡åŒ¹é…ï¼šæ‰¾ç¬¬ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å—ï¼Œç©ºé—²é“¾è¡¨åŸºäºåœ°å€æ’åºæ–¹ä¾¿åˆå¹¶ã€‚&lt;/li&gt;&#xA;&lt;li&gt;ä¸‹æ¬¡åŒ¹é…ï¼šåŸºäºé¦–æ¬¡åŒ¹é…å¤šç»´æŠ¤ä¸€ä¸ªæŒ‡å‘ä¸Šä¸€æ¬¡æŸ¥æ‰¾ç»“æŸä¸ºæ­¢çš„æŒ‡é’ˆã€‚&lt;/li&gt;&#xA;&lt;li&gt;ä¼™ä¼´ç³»ç»Ÿï¼šæ–¹ä¾¿åˆå¹¶ï¼Œç©ºé—²ç©ºé—´è¢«é€’å½’äºŒåˆ†ï¼Œå¦‚æœfreeæ‰ï¼Œä¼šæ£€æŸ¥ç›¸é‚»çš„äºŒåˆ†ä¼™ä¼´æ˜¯å¦ç©ºé—²ï¼Œå‘ä¸Šå›æº¯ä¸€ç›´åˆå¹¶ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/ostep_note_pic/%e4%bc%99%e4%bc%b4%e7%b3%bb%e7%bb%9f%e5%90%88%e5%b9%b6.png&#34; title=&#34;/ostep_note_pic/ä¼™ä¼´ç³»ç»Ÿåˆå¹¶.png&#34; data-thumbnail=&#34;/ostep_note_pic/ä¼™ä¼´ç³»ç»Ÿåˆå¹¶.png&#34; data-sub-html=&#34;&lt;h2&gt;ä¼™ä¼´ç³»ç»Ÿåˆå¹¶&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/ostep_note_pic/ä¼™ä¼´ç³»ç»Ÿåˆå¹¶.png&#39; alt=&#34;/ostep_note_pic/ä¼™ä¼´ç³»ç»Ÿåˆå¹¶.png&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;ä¼™ä¼´ç³»ç»Ÿåˆå¹¶&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;åˆ†é¡µ&#34;&gt;&lt;span&gt;åˆ†é¡µ&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%88%86%e9%a1%b5&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;åˆ†æ®µä¼šå¸¦æ¥å¤–éƒ¨ç¢ç‰‡çš„é—®é¢˜ï¼Œåˆ†é¡µä¸ä¼šå¯¼è‡´å¤–éƒ¨ç¢ç‰‡ã€‚åˆ†é¡µæ˜¯å°†ç©ºé—´åˆ†å‰²æˆå›ºå®šå¤§å°çš„é¡µï¼Œå¯¹åº”çš„ç‰©ç†å†…å­˜ä¹Ÿçœ‹æˆæ˜¯å®šé•¿æ§½å—çš„é¡µå¸§ï¼Œè¿™æ ·æ¯ä¸€ä¸ªç‰©ç†é¡µå¸§å°±å¯¹åº”ä¸€ä¸ªè™šæ‹Ÿå†…å­˜é¡µã€‚é¡µè¡¨è®°å½•äº†æ¯ä¸ªè™šæ‹Ÿé¡µåœ¨ç‰©ç†å†…å­˜ä¸­çš„ä½ç½®ï¼Œä¸ºæ¯ä¸ªè™šæ‹Ÿé¡µä¿å­˜åœ°å€è½¬æ¢ã€‚é‡è¦çš„æ˜¯è®°ä½é¡µè¡¨æ˜¯æ¯ä¸€ä¸ªè¿›ç¨‹çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„é¡µè¡¨ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è½¬æ¢è™šæ‹Ÿåœ°å€éœ€è¦è™šæ‹Ÿé¡µé¢å·ï¼ˆVPNï¼‰å’Œé¡µå†…åç§»é‡ï¼ˆoffsetï¼‰ï¼Œå°†è™šæ‹Ÿåœ°å€å˜æˆäºŒè¿›åˆ¶æ ¼å¼ï¼Œå‰å‡ ä½è¡¨ç¤ºVPNï¼Œåå‡ ä½è¡¨ç¤ºoffsetï¼ŒVPNä¼šæ ¹æ®é¡µè¡¨æ‰¾åˆ°å¯¹åº”çš„ç‰©ç†é¡µå¸§ï¼ˆPFNï¼‰ï¼Œoffsetä¿æŒä¸å˜ï¼Œä»è€Œå¾—åˆ°ç‰©ç†åœ°å€çš„äºŒè¿›åˆ¶å½¢å¼ã€‚&lt;/p&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/ostep_note_pic/%e5%9c%b0%e5%9d%80%e8%bd%ac%e6%8d%a2%e8%bf%87%e7%a8%8b.png&#34; title=&#34;/ostep_note_pic/åœ°å€è½¬æ¢è¿‡ç¨‹.png&#34; data-thumbnail=&#34;/ostep_note_pic/åœ°å€è½¬æ¢è¿‡ç¨‹.png&#34; data-sub-html=&#34;&lt;h2&gt;åœ°å€è½¬æ¢è¿‡ç¨‹&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/ostep_note_pic/åœ°å€è½¬æ¢è¿‡ç¨‹.png&#39; alt=&#34;/ostep_note_pic/åœ°å€è½¬æ¢è¿‡ç¨‹.png&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;åœ°å€è½¬æ¢è¿‡ç¨‹&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;p&gt;æ³¨æ„MMUä¸­æ²¡æœ‰å­˜å‚¨é¡µè¡¨ï¼Œè€Œæ˜¯å°†æ¯ä¸ªè¿›ç¨‹çš„é¡µè¡¨å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚é¡µè¡¨å°±æ˜¯å°†è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ç‰©ç†åœ°å€ï¼Œæœ€ç®€å•å°±å¯ä»¥é‡‡ç”¨æ•°ç»„å®ç°ï¼ŒOSé€šè¿‡VPNæ£€ç´¢åˆ°é¡µè¡¨é¡¹PTEï¼Œä»è€Œæ‰¾åˆ°å¯¹åº”çš„PFNã€‚å¯¹äºæ¯ä¸ªPTEæœ‰è®¸å¤šä¸åŒçš„æ ‡å¿—ä½ï¼Œå¦‚ï¼šæœ‰æ•ˆä½ï¼ˆæ ‡è®°ç©ºé—´æ˜¯å¦æœ‰æ•ˆï¼‰ï¼Œä¿æŠ¤ä½ï¼ˆå¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œï¼‰ï¼Œå­˜åœ¨ä½ï¼ˆæ˜¯å¦è¢«æ¢å‡ºï¼‰ï¼Œè„ä½ï¼ˆé¡µé¢æ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼‰ç­‰ã€‚&lt;/p&gt;&#xA;&lt;p&gt;MMUå†…å­˜ç®¡ç†å•å…ƒæ˜¯è´Ÿè´£è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€è½¬æ¢çš„ç¡¬ä»¶ï¼Œå…¶ä¸»è¦ç»„ä»¶æœ‰é¡µè¡¨åŸºå€å¯„å­˜å™¨ã€åœ°å€è½¬æ¢é€»è¾‘ã€TLBã€è®¿é—®æƒé™æ§åˆ¶é€»è¾‘ã€é¡µé¢å¼‚å¸¸å¤„ç†é€»è¾‘ï¼ŒMMUé€šè¿‡é¡µè¡¨åŸºå€å¯„å­˜å™¨è®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨ï¼Œå¹¶åˆ©ç”¨TLBç¼“å­˜åŠ é€Ÿåœ°å€è½¬æ¢ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä¸ºäº†è¿›è¡Œä¸Šè¿°è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢å¿…é¡»çŸ¥é“é¡µè¡¨çš„ä½ç½®ï¼Œé¡µè¡¨çš„èµ·å§‹ä½ç½®çš„ç‰©ç†åœ°å€å­˜åœ¨äºé¡µè¡¨åŸºå€å¯„å­˜å™¨ä¸­ã€‚å…·ä½“è½¬æ¢è¿‡ç¨‹å°±æ˜¯æŒ‰ä½ä¸MASK+å³ç§»æå–VPNä½å¾—åˆ°è™šæ‹Ÿé¡µå·ï¼Œæ ¹æ®é¡µè¡¨åŸºå€å¯„å­˜å™¨çš„èµ·å§‹åœ°å€åšVPN*sizeof(PTE)çš„åç§»å¾—åˆ°å¯¹åº”çš„PTEï¼Œä¹Ÿå°±å¾—åˆ°äº†ç‰©ç†é¡µå¸§ï¼›ç±»ä¼¼åœ°æå–offsetï¼Œåœ¨ç‰©ç†é¡µå¸§åŸºç¡€ä¸Šåšåç§»å³å¾—åˆ°äº†ç‰©ç†åœ°å€ã€‚&lt;/p&gt;&#xA;&lt;p&gt;æœ‰ä¸¤ä¸ªå¿…é¡»è§£å†³çš„å®é™…é—®é¢˜ï¼š1. é¡µè¡¨æŸ¥è¯¢ä¼šä½¿ç³»ç»Ÿè¿è¡Œå˜æ…¢ï¼›2. é¡µè¡¨å ç”¨å¤ªå¤šå†…å­˜ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;tlb&#34;&gt;&lt;span&gt;TLB&lt;/span&gt;&#xA;  &lt;a href=&#34;#tlb&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;åˆ†é¡µä¼šå¸¦æ¥è¾ƒé«˜çš„æ€§èƒ½å¼€é”€ï¼Œè¿™æ˜¯å› ä¸ºåœ¨è½¬æ¢è™šæ‹Ÿåœ°å€æ—¶ï¼Œåˆ†é¡µéœ€è¦é¢å¤–çš„ä¸€æ¬¡å†…å­˜è®¿é—®ï¼ˆé¡µè¡¨è®¿é—®ï¼‰ï¼Œæ¯æ¬¡æŒ‡ä»¤çš„è·å–ã€åŠ è½½æˆ–ä¿å­˜éƒ½éœ€è¦é¢å¤–è¯»ä¸€æ¬¡ï¼Œè¿™ä¼šæ…¢å¾—æ— æ³•æ¥å—ã€‚æƒ³è®©æŸäº›ä¸œè¥¿æ›´å¿«ï¼Œå¾€å¾€éœ€è¦ç¡¬ä»¶æ”¯æŒï¼Œé‚£å°±æ˜¯TLBåœ°å€è½¬æ¢æ—è·¯ç¼“å†²å­˜å‚¨å™¨ï¼ˆå¤ªé•¿äº†è¿™ä¸­æ–‡åï¼Œå…¶å®å°±æ˜¯é¡µè¡¨é¡¹ç¼“å­˜ã€å¿«è¡¨ï¼Œé€šå¸¸ä½äºMMUä¸­ï¼‰ã€‚ç¼“å†²å‘½ä¸­æ˜¾ç„¶ä¼šä½¿é¡µè¡¨è½¬æ¢æ›´å¿«ã€‚ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬è¦å°½é‡é¿å…TLBæœªå‘½ä¸­ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¾—ç›Šäºç©ºé—´å±€éƒ¨æ€§ï¼ŒåŒä¸€é¡µå­˜å‚¨æ•°ç»„ç›¸é‚»å…ƒç´ ï¼Œä¸€ä¸ªPTEä¼šæ”¾åˆ°TLBä¸­ä»è€Œç›¸é‚»å…ƒç´ å‘½ä¸­TLBã€‚ä¸€ä¸ªé¡µå¤§å°ä¸º4KBï¼Œèƒ½å­˜å¾ˆå¤šæ•°ï¼Œé‚£ä¹ˆä¼šæä¾›å¾ˆå¥½çš„TLBæ€§èƒ½ï¼›ä»¥åŠå¾—ç›Šäºæ—¶é—´å±€éƒ¨æ€§ï¼ŒçŸ­æ—¶é—´å†…å¯¹å†…å­˜é¡¹å†æ¬¡å¼•ç”¨ï¼Œæ‰€ä»¥TLBçš„å‘½ä¸­ç‡ä¼šå¾ˆé«˜ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶å¯¹TLBçš„å¤„ç†ï¼šå› ä¸ºæ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„é¡µè¡¨ï¼ŒåŒæ ·ç¼“å­˜åœ¨TLBçš„PTEåœ¨åˆ‡æ¢å¦ä¸€ä¸ªè¿›ç¨‹æ—¶ä¹Ÿä¼šå¤±æ•ˆï¼Œæ‰€ä»¥è¦å¯¹TLBè¿›è¡Œå¤„ç†ã€‚æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯æ¸…ç©ºTLBï¼Œä½†å­˜åœ¨ä¸€å®šçš„å¼€é”€ã€‚ä¸ºäº†å‡å°‘è¿™ç§å¼€é”€ï¼Œæœ‰çš„OSåœ¨TLBä¸­æ·»åŠ äº†ä¸€ä¸ªåœ°å€ç©ºé—´æ ‡è¯†ç¬¦ï¼ˆASIDï¼‰ï¼Œæ·»åŠ è¿™ä¸ªå­—æ®µåˆ°TLBä¸­ï¼Œç±»ä¼¼äºè¿›ç¨‹æ ‡è¯†ç¬¦PIDæ ‡è¯†ä¸åŒçš„è¿›ç¨‹ã€‚å› æ­¤ç¡¬ä»¶å¿…é¡»çŸ¥é“é‚£ä¸ªè¿›ç¨‹åœ¨è¿è¡Œï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶å¿…é¡»å°†æŸä¸ªç‰¹æƒå¯„å­˜å™¨è®¾ç½®ä¸ºå½“å‰è¿›ç¨‹çš„ASIDã€‚&lt;/p&gt;&#xA;&lt;p&gt;TLBæ›¿æ¢ç­–ç•¥ï¼šåœ¨TLBä¸­æ’å…¥æ–°é¡¹æ—¶ï¼Œå¾ˆè‡ªç„¶è¦è€ƒè™‘æ›¿æ¢å“ªä¸ªæ—§é¡¹ã€‚é¡µæ¢å‡ºç£ç›˜æ—¶ä¹Ÿè¦è€ƒè™‘å“ªä¸ªå†…å­˜é¡µè¢«æ›¿æ¢æ‰ã€‚å¸¸è§çš„ç­–ç•¥å°±æ˜¯æ›¿æ¢æœ€è¿‘æœ€å°‘ï¼ˆLRUï¼‰ä½¿ç”¨çš„é¡¹ï¼›å¦ä¸€ä¸ªç­–ç•¥å°±æ˜¯éšæœºç­–ç•¥ï¼Œé¿å…äº†å¾ªç¯è®¿é—®n+1é¡µï¼Œä½†TLBåªèƒ½å­˜æ”¾nä¸ªé¡µå¯¼è‡´LRUæ¯æ¬¡éƒ½è¦æ›¿æ¢çš„æç«¯æƒ…å†µã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;è¾ƒå°çš„è¡¨&#34;&gt;&lt;span&gt;è¾ƒå°çš„è¡¨&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e8%be%83%e5%b0%8f%e7%9a%84%e8%a1%a8&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;ç”±äºè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢éœ€è¦é¡µè¡¨ï¼Œé¡µè¡¨å­˜åœ¨äºå†…å­˜ä¸­ï¼Œä¹Ÿä¼šå ç”¨å†…å­˜ç©ºé—´ï¼Œè€Œä¸”æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªé¡µè¡¨ï¼Œå¤šä¸ªè¿›ç¨‹ä¸‹é¡µè¡¨å†…å­˜æ€»å¼€é”€æ˜¯å¾ˆå¤§çš„ã€‚é‰´äºæ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›å°½é‡å‡å°é¡µè¡¨çš„å¤§å°ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åˆ†æ®µä¼šå¯¼è‡´å¤–éƒ¨ç¢ç‰‡ï¼Œåˆ†é¡µä¼šå¯¼è‡´å†…éƒ¨ç¢ç‰‡ï¼Œé‚£ä¹ˆä¸¤ä¸ªç»“åˆèµ·æ¥æ˜¯å¦ä¼šæ›´å¥½å‘¢ï¼Ÿå°†åˆ†æ®µå’Œåˆ†é¡µç»“åˆæ¥å‡å°‘é¡µè¡¨çš„å†…å­˜å¼€é”€ã€‚è¿™ç§ç»“åˆæ–¹æ³•å°±æ˜¯ä¸ä¸ºè¿›ç¨‹çš„æ•´ä¸ªåœ°å€ç©ºé—´æä¾›å•ä¸ªé¡µè¡¨ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªé€»è¾‘æ®µï¼ˆä»£ç æ®µã€å †ã€æ ˆï¼‰æä¾›ä¸€ä¸ªã€‚ä¸çº¿æ€§é¡µè¡¨ç›¸æ¯”ï¼Œæ‚åˆæ–¹å¼å®ç°äº†æ˜¾è‘—çš„å†…å­˜èŠ‚çœã€‚ä½†æ˜¯å®ƒä¾ç„¶æ˜¯åŸºäºåˆ†æ®µçš„å¤§æ¡†æ¶ä¸‹çš„ï¼Œä¾æ—§ä¼šé¢ä¸´æŸä¸ªæ®µåŒºç¨€ç–å¯¼è‡´çš„å¤§é‡é¡µè¡¨æµªè´¹ï¼Œä»¥åŠå¤–éƒ¨ç¢ç‰‡ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä½¿ç”¨å¤šçº§é¡µè¡¨æœ‰æ•ˆçš„å‡å°äº†é¡µè¡¨çš„å†…å­˜å¤§å°ï¼Œå› ä¸ºå®ƒå°†çº¿æ€§é¡µè¡¨å˜æˆäº†ç±»ä¼¼æ ‘çš„ä¸œè¥¿ã€‚å¤šçº§é¡µè¡¨çš„æ€æƒ³ï¼šå°†é¡µè¡¨åˆ†æˆé¡µå¤§å°çš„å•å…ƒï¼ˆå€¼å¾—æ³¨æ„çš„æ˜¯é¡µè¡¨ä¹Ÿå­˜åœ¨äºå†…å­˜ä¸­æ‰€ä»¥ä¹ŸæŒ‰é¡µå¤§å°åˆ’åˆ†äº†ï¼‰ï¼Œå¦‚æœæ•´é¡µçš„PTEæ— æ•ˆå°±å®Œå…¨ä¸åˆ†é…è¯¥é¡µçš„é¡µè¡¨ã€‚è€Œä¸ºäº†åˆ¤æ–­è¿™é¡µçš„PTEæ˜¯å¦éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œä½¿ç”¨é¡µç›®å½•çš„ç»“æ„ã€‚å¢åŠ äº†é¡µç›®å½•çš„ä¸­é—´å±‚ï¼Œä»è€Œç±»ä¼¼äºæ‡’åˆ†é…çš„ç­–ç•¥ï¼ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚&lt;/p&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/ostep_note_pic/%e5%a4%9a%e7%ba%a7%e9%a1%b5%e8%a1%a8.png&#34; title=&#34;/ostep_note_pic/å¤šçº§é¡µè¡¨.png&#34; data-thumbnail=&#34;/ostep_note_pic/å¤šçº§é¡µè¡¨.png&#34; data-sub-html=&#34;&lt;h2&gt;å¤šçº§é¡µè¡¨&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/ostep_note_pic/å¤šçº§é¡µè¡¨.png&#39; alt=&#34;/ostep_note_pic/å¤šçº§é¡µè¡¨.png&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;å¤šçº§é¡µè¡¨&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;p&gt;è¿™ä¸ªå›¾ç”»çš„å·¨æ¸…æ¥šï¼Œamazingæ„Ÿå—åˆ°äº†è¿™çœŸæ˜¯æœ¬å¥½ä¹¦ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¤šçº§é¡µè¡¨æ˜¯ä¸€ä¸ªæ—¶é—´å’Œç©ºé—´çš„trade-offï¼ŒèŠ‚çœäº†ç©ºé—´å°±ç‰ºç‰²äº†éƒ¨åˆ†æ—¶é—´æˆæœ¬ï¼Œä½“ç°åœ¨TLBä¸ºå‘½ä¸­æ—¶è¦ä»å†…å­˜åŠ è½½ä¸¤æ¬¡ï¼ˆä¸€æ¬¡æ˜¯é¡µç›®å½•ï¼Œä¸€æ¬¡æ˜¯PTEæœ¬èº«ï¼Œå› ä¸ºå¼•å…¥äº†ä¸­é—´å±‚ï¼‰ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¦‚ä½•è·å–VPNï¼Œå¹¶ç”¨å®ƒé¦–å…ˆç´¢å¼•åˆ°é¡µç›®å½•ï¼ˆPDEï¼‰ä¸­ï¼Œç„¶åå†ç´¢å¼•åˆ°é¡µè¡¨çš„é¡µä¸­ã€‚PDEAddr = PageDirBase + (PDIndex*sizeof(PDE)) ï¼Œè¿™æ ·å¾—åˆ°é¡µç›®å½•ï¼Œå¦‚æœé¡µç›®å½•æœ‰æ•ˆï¼Œä½¿ç”¨VPNå‰©ä½™ä½ç´¢å¼•åˆ°é¡µè¡¨çš„éƒ¨åˆ†ï¼ŒPTEAddr = (PDE.PFN &amp;laquo; SHIFT) + (PTIndex * sizeof(PTE))ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;è¶…è¶Šç‰©ç†å†…å­˜æœºåˆ¶&#34;&gt;&lt;span&gt;è¶…è¶Šç‰©ç†å†…å­˜ï¼šæœºåˆ¶&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e8%b6%85%e8%b6%8a%e7%89%a9%e7%90%86%e5%86%85%e5%ad%98%e6%9c%ba%e5%88%b6&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;ä¸ºäº†èƒ½æ”¯æŒè®¸å¤šåŒæ—¶è¿è¡Œçš„å·¨å¤§è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œéœ€è¦ä½¿ç”¨ç¡¬ç›˜çš„äº¤æ¢ç©ºé—´ã€‚åœ¨ç¡¬ç›˜ä¸Šå¼€è¾Ÿä¸€éƒ¨åˆ†ç©ºé—´ç”¨äºç‰©ç†é¡µçš„ç§»å…¥å’Œç§»å‡ºï¼Œè¿™æ ·çš„ç©ºé—´ç§°ä¸ºäº¤æ¢ç©ºé—´ï¼Œæˆ‘ä»¬å°†å†…å­˜ä¸­çš„é¡µäº¤æ¢åˆ°å…¶ä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶åˆäº¤æ¢å›å»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¼šå‡è®¾OSèƒ½ä»¥é¡µä¸ºå•å…ƒè¯»å–æˆ–è€…å†™å…¥äº¤æ¢ç©ºé—´ï¼ŒOSå°±éœ€è¦è®°ä½ç»™å®šé¡µçš„ç¡¬ç›˜åœ°å€ã€‚äº¤æ¢ç©ºé—´ä¸æ˜¯å”¯ä¸€çš„ç¡¬ç›˜äº¤æ¢ç›®çš„åœ°ï¼Œè¿™é‡Œæ˜¯æŒ‡äº¤æ¢ç©ºé—´æ›´å¤šçš„æ˜¯è¿›ç¨‹å†…å­˜ä¸ç¡¬ç›˜çš„äº¤æ¢ï¼Œè€Œç¡¬ç›˜ä¸­ä¸€ç›´å­˜æ”¾çš„ç¨‹åºä»£ç ä¹Ÿæ˜¯å¦ä¸€ä¸ªç›®çš„åœ°äº¤æ¢åˆ°å†…å­˜ä¸­æ‰§è¡Œæˆ–è…¾å‡ºã€‚&lt;/p&gt;&#xA;&lt;p&gt;å½“ç»™å‡ºä¸€ä¸ªVPNï¼Œé¦–å…ˆæŸ¥TLBï¼ŒTLBå‘½ä¸­ç›´æ¥è¿”å›PFNï¼›æœªå‘½ä¸­ï¼ŒæŸ¥é¡µè¡¨ï¼Œå¦‚æœé¡µæœ‰æ•ˆä¸”å­˜åœ¨äºç‰©ç†å†…å­˜ï¼Œåˆ™è·å¾—PFNå¹¶æ’å…¥TLBï¼Œå¹¶é‡è¯•è¯¥æŒ‡ä»¤äº§ç”ŸTLBå‘½ä¸­ã€‚ä½†å¦‚æœæŸ¥é¡µè¡¨æœ‰æ˜ å°„å´å­˜åœ¨ä½ï¼ˆä¸æ˜¯æœ‰æ•ˆä½ï¼‰ä¸ä¸º1ï¼ˆä¸å­˜åœ¨ç‰©ç†å†…å­˜ä¸­ï¼‰ï¼Œç§°ä¸ºé¡µé”™è¯¯ï¼ŒOSä¼šè¢«å”¤é†’ï¼Œå¤„ç†é¡µé”™è¯¯ã€‚æ³¨æ„è¿™é‡Œæ˜¯å®Œå…¨åˆæ³•çš„è®¿é—®ï¼Œé¡µè¢«æ˜ å°„åˆ°äº†è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œä½†ä¸å­˜åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œç§°ä¸ºé¡µæœªå‘½ä¸­æ›´åˆé€‚ã€‚ä½†é€šå¸¸ï¼Œç§°ä¸ºäº†é¡µé”™è¯¯ï¼Œå†æ¬¡è¯´æ˜ä¸æ˜¯æœªå»ºç«‹æ˜ å°„å¯¼è‡´çš„é¡µé”™è¯¯ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¤„ç†é¡µé”™è¯¯æ˜¯é€šè¿‡PTEä¸­çš„æŸäº›ä½å­˜å‚¨ç¡¬ç›˜åœ°å€ï¼ŒæŸ¥æ‰¾è¿™äº›ä½å¯¹åº”çš„ç¡¬ç›˜åœ°å€ï¼Œå°†è¯·æ±‚å‘é€åˆ°ç¡¬ç›˜ï¼Œå°†é¡µè¯»å–åˆ°å†…å­˜ä¸­ã€‚å½“ç¡¬ç›˜I/Oå®Œæˆæ—¶ï¼ŒOSä¼šæ›´æ–°é¡µè¡¨ï¼Œå°†æ­¤é¡µæ ‡è®°ä¸ºå­˜åœ¨ï¼Œæ›´æ–°PTEçš„PFNå­—æ®µã€‚è¿™æ˜¯æ¢å…¥æ“ä½œã€‚&lt;/p&gt;&#xA;&lt;p&gt;å½“å†…å­˜æ»¡äº†æˆ‘ä»¬è¿˜éœ€è¦å°†å†…å­˜ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªé¡µæ¢å‡ºï¼Œç„¶åæ‰èƒ½å°†ç¡¬ç›˜ä¸­çš„é¡µæ¢å…¥ã€‚è€Œé€‰æ‹©å“ªäº›é¡µæ¢å‡ºçš„è¿‡ç¨‹ç§°ä¸ºé¡µäº¤æ¢ç­–ç•¥ã€‚&lt;/p&gt;&#xA;&lt;p&gt;é¡µé”™è¯¯ç¡¬ä»¶æ§åˆ¶æµç®—æ³•ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;é¡µå­˜åœ¨ä¸”æœ‰æ•ˆï¼ŒTLBæœªå‘½ä¸­å¯ä»PTEä¸­è·å–PFNï¼Œç„¶åé‡è¯•æŒ‡ä»¤TLBå‘½ä¸­ã€‚&lt;/li&gt;&#xA;&lt;li&gt;é¡µä¸å­˜åœ¨ä¸”æœ‰æ•ˆï¼Œè¯´æ˜æ˜¯åˆæ³•é¡µä½†ä¸å­˜åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œè¿è¡Œé¡µé”™è¯¯å¤„ç†ç¨‹åºã€‚&lt;/li&gt;&#xA;&lt;li&gt;é¡µæ— æ•ˆï¼Œéæ³•è®¿é—®ï¼Œè¿è¡Œtrapå¤„ç†ç¨‹åºã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;é¡µé¢äº¤æ¢ä¸æ˜¯åœ¨å†…å­˜æ»¡äº†ä»¥åæ‰å‘ç”Ÿçš„ï¼Œä¼šä¿è¯æœ‰å°‘é‡çš„ç©ºé—²å†…å­˜ã€‚OSä¼šè®¾ç½®é«˜æ°´ä½çº¿HWå’Œä½æ°´ä½çº¿LWï¼Œå†³å®šä½•æ—¶ä»å†…å­˜ä¸­æ¸…é™¤é¡µã€‚OSå‘ç°æœ‰å°‘äºLWä¸ªé¡µå¯ç”¨æ—¶ï¼Œäº¤æ¢å®ˆæŠ¤çº¿ç¨‹ä¼šè¿è¡Œé‡Šæ”¾å†…å­˜ï¼Œç›´åˆ°æœ‰HWä¸ªå¯ç”¨çš„ç‰©ç†é¡µï¼Œç„¶åä¼‘çœ ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;è¶…è¶Šç‰©ç†å†…å­˜ç­–ç•¥&#34;&gt;&lt;span&gt;è¶…è¶Šç‰©ç†å†…å­˜ï¼šç­–ç•¥&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e8%b6%85%e8%b6%8a%e7%89%a9%e7%90%86%e5%86%85%e5%ad%98%e7%ad%96%e7%95%a5&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;ä»»ä½•åƒFIFOæˆ–éšæœºè¿™æ ·ç®€å•çš„ç­–ç•¥éƒ½å¯èƒ½ä¼šè¸¢å‡ºä¸€ä¸ªé‡è¦çš„é¡µï¼Œè€Œè¿™ä¸ªé¡µé©¬ä¸Šä¼šè¢«å¼•ç”¨ï¼Œä¸å¤ªå¯èƒ½è¾¾åˆ°æœ€ä¼˜ï¼Œéœ€è¦æ›´æ™ºèƒ½çš„ç­–ç•¥ã€‚ä¸ºäº†æé«˜åç»­çš„å‘½ä¸­ç‡ï¼Œåƒä¹‹å‰çš„è°ƒåº¦ç­–ç•¥ä¸€æ ·ï¼Œé€šè¿‡å¼•å…¥å†å²ä¿¡æ¯ä½œä¸ºå‚è€ƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŸä¸ªç¨‹åºåœ¨è¿‡å»è®¿é—®è¿‡æŸä¸ªé¡µï¼Œåˆ™å¾ˆæœ‰å¯èƒ½åœ¨ä¸ä¹…çš„å°†æ¥ä¼šå†æ¬¡è®¿é—®è¯¥é¡µã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä¸€ä¸ªå†å²ä¿¡æ¯ï¼šé¢‘ç‡ï¼Œå¦‚æœä¸€ä¸ªé¡µè¢«è®¿é—®äº†å¾ˆå¤šæ¬¡ï¼Œä¹Ÿè®¸ä¸è¯¥è¢«æ›¿æ¢ã€‚ä»¥åŠè®¿é—®çš„è¿‘æœŸæ€§ï¼Œè¶Šè¿‘è¢«è®¿é—®è¿‡çš„é¡µï¼Œä¹Ÿè®¸å†æ¬¡è®¿é—®çš„å¯èƒ½æ€§è¶Šå¤§ã€‚åŸºäºå†å²çš„ç®—æ³•ï¼šæœ€ä¸ç»å¸¸ä½¿ç”¨ï¼ˆLFUï¼‰ä¼šæ›¿æ¢æœ€ä¸ç»å¸¸ä½¿ç”¨çš„é¡µï¼›æœ€å°‘æœ€è¿‘ä½¿ç”¨ï¼ˆLRUï¼‰ä¼šæ›¿æ¢æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é¡µã€‚å±€éƒ¨æ€§åŸåˆ™ä¸æ˜¯ç¡¬æ€§è§„å®šï¼Œæ˜¯ä¸€ä»¶å¥½äº‹ï¼Œä½†ä¸èƒ½ä¿è¯æˆåŠŸï¼Œè€Œæ˜¯ä¸€ç§ç»å¸¸è¯æ˜åœ¨è®¡ç®—æœºç³»ç»Ÿè®¾è®¡ä¸­æœ‰ç”¨çš„å¯å‘å¼æ–¹æ³•ã€‚LRUç®—æ³•å®ç°å‚è€ƒåŠ›æ‰£LRU cacheï¼Œä½¿ç”¨å“ˆå¸Œè¡¨å’ŒåŒå‘é“¾è¡¨ç»´æŠ¤å›ºå®šå®¹é‡cacheçš„æ¢å…¥æ¢å‡ºæ“ä½œã€‚ç”±äºæ¯æ¬¡é¡µè®¿é—®æ—¶éƒ½å¿…é¡»æ›´æ–°ä¸€äº›æ•°æ®ï¼Œç³»ç»Ÿå¿…é¡»å¯¹æ¯æ¬¡å†…å­˜å¼•ç”¨åšä¸€äº›è®°å½•å·¥ä½œï¼Œè¿™æ ·çš„è®°å½•ä¼šæå¤§å½±å“æ€§èƒ½ã€‚ç°ä»£OSä»è®¡ç®—å¼€é”€è§’åº¦æ¥çœ‹ä½¿ç”¨äº†è¿‘ä¼¼LRUï¼Œé€šè¿‡ç¡¬ä»¶å¢åŠ ä¸€ä¸ªå¼•ç”¨ä½ï¼Œæ—¶é’Ÿç®—æ³•å°†æ‰€æœ‰é¡µæ”¾åˆ°ä¸€ä¸ªå¾ªç¯åˆ—è¡¨ä¸­ï¼Œéœ€è¦è¿›è¡Œé¡µæ›¿æ¢æ—¶éšæœºæ‰«æå„é¡µï¼Œå¦‚æœé‡åˆ°ä¸€ä¸ªé¡µçš„å¼•ç”¨ä½ä¸º1ï¼Œå°±æ¸…é™¤è¯¥ä½ï¼ˆè®¾ç½®ä¸º0ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªä½¿ç”¨ä½ä¸º0çš„é¡µï¼Œå°†è¿™ä¸ªé¡µè¿›è¡Œæ›¿æ¢ã€‚æ—¶é’Ÿç®—æ³•æ¯ä¸ªé¡µåªéœ€ç»´æŠ¤ä¸€ä¸ªè®¿é—®ä½ï¼Œè€Œä¸”é€šå¸¸ç”±ç¡¬ä»¶MMUè‡ªåŠ¨è®¾ç½®ï¼Œä¸éœ€è½¯ä»¶å¹²é¢„ï¼Œä¸éœ€æ¯æ¬¡è®¿é—®æ—¶éƒ½åšè®°å½•ï¼ˆLRUå¯¹æ¯”ï¼‰ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è„é¡µï¼šå¦‚æœé¡µè¢«ä¿®æ”¹å› æ­¤å˜è„ï¼Œåˆ™è¸¢å‡ºå®ƒå¿…é¡»å†™å›ç£ç›˜ï¼Œä»£ä»·å¾ˆå¤§ï¼Œå› æ­¤å°½é‡è¸¢å‡ºéè„é¡µã€‚ç¡¬ä»¶å¢åŠ ä¸€ä¸ªä¿®æ”¹ä½ï¼ˆè„ä½ï¼‰ï¼Œæ¯æ¬¡å†™å…¥é¡µæ—¶éƒ½ä¼šè®¾ç½®æ­¤ä½ï¼Œå› æ­¤åˆå¹¶åˆ°é¡µé¢ç½®æ¢ç®—æ³•ä¸­ã€‚&lt;/p&gt;&#xA;&lt;p&gt;OSè¿è¡Œçš„è¿›ç¨‹æ‰€éœ€çš„å†…å­˜éœ€æ±‚ç´§å¼ ï¼Œä»è€Œä¸æ–­è¿›è¡Œæ¢é¡µçš„æƒ…å†µç§°ä¸ºæŠ–åŠ¨ï¼Œæ­¤æ—¶OSä¼šä½¿ç”¨å®ˆæŠ¤è¿›ç¨‹é€‰æ‹©ä¸€ä¸ªå†…å­˜å¯†é›†å‹çš„è¿›ç¨‹å¹¶æ€æ­»å®ƒã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;vaxvmsè™šæ‹Ÿå†…å­˜ç³»ç»Ÿ&#34;&gt;&lt;span&gt;VAX/VMSè™šæ‹Ÿå†…å­˜ç³»ç»Ÿ&lt;/span&gt;&#xA;  &lt;a href=&#34;#vaxvms%e8%99%9a%e6%8b%9f%e5%86%85%e5%ad%98%e7%b3%bb%e7%bb%9f&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;VMSæ˜¯åœ¨å¤šç§ç¡¬ä»¶ç³»ç»Ÿä¸‹æ„å»ºçš„ä¸€ä¸ªé€šç”¨æœ‰æ•ˆçš„å·¥ä½œç³»ç»Ÿã€‚å› ä¸ºVAXé¡µå¤§å°éå¸¸å°ï¼Œé¦–è¦ç›®æ ‡æ˜¯ç¡®ä¿VMSä¸ä¼šç”¨é¡µè¡¨å æ»¡å†…å­˜ï¼Œé€šè¿‡ä¸¤ç§æ–¹å¼ï¼šé¦–å…ˆå°†ç”¨æˆ·ç©ºé—´åˆ†ä¸ºä¸¤éƒ¨åˆ†P0å’ŒP1ï¼Œæ¯éƒ¨åˆ†å¯¹åº”ä¸€ä¸ªé¡µè¡¨ï¼›å…¶æ¬¡ï¼Œåœ¨å†…æ ¸è™šæ‹Ÿå†…å­˜ä¸­æ”¾ç½®ç”¨æˆ·é¡µè¡¨ã€‚å®é™…çš„åœ°å€ç©ºé—´é¡µ0æ ‡è®°ä¸ºæ— æ•ˆï¼Œä»£ç æ®µä¸ä¼šä»ç¬¬0é¡µå¼€å§‹ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¡¥å……ï¼šä¸ºä»€ä¹ˆç©ºæŒ‡é’ˆè®¿é—®ä¼šå¯¼è‡´æ®µé”™è¯¯ï¼Ÿå¯¹ä¸€ä¸ªç©ºæŒ‡é’ˆè§£å¼•ç”¨ï¼Œä¼šå¯¼è‡´æ®µé”™è¯¯ã€‚å› ä¸ºç©ºæŒ‡é’ˆåœ°å€å¯¹åº”è™šæ‹Ÿåœ°å€0ï¼Œå¯¹è¯¥åœ°å€è§£å¼•ç”¨æ—¶ï¼Œç¡¬ä»¶è¯•å›¾åœ¨TLBä¸­æŸ¥æ‰¾VPNï¼ŒTLBæœªå‘½ä¸­ï¼ŒæŸ¥æ‰¾é¡µè¡¨ï¼Œå‘ç°VPN 0 çš„PTEæ ‡è®°ä¸ºæ— æ•ˆã€‚å› æ­¤ï¼Œé‡åˆ°æ— æ•ˆçš„è®¿é—®ï¼Œå°†æ§åˆ¶æƒè½¬äº¤ç»™OSï¼Œè¿™å¯èƒ½ä¼šç»ˆæ­¢è¿›ç¨‹ï¼Œè§¦å‘æ®µé”™è¯¯ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å†…æ ¸è™šæ‹Ÿåœ°å€ç©ºé—´æ˜¯æ¯ä¸ªç”¨æˆ·åœ°å€ç©ºé—´çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä»¬å…±äº«ç›¸åŒçš„å†…æ ¸åœ°å€æ˜ å°„ï¼Œå¹¶æ˜ å°„åˆ°åŒæ ·çš„ç‰©ç†åœ°å€ã€‚åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼ŒOSæ”¹å˜P0å’ŒP1å¯„å­˜å™¨ä»¥æŒ‡å‘å³å°†è¿è¡Œçš„è¿›ç¨‹çš„é¡µè¡¨ã€‚å¦‚æœOSæ”¶åˆ°ç”¨æˆ·ç¨‹åºé€’äº¤çš„æŒ‡é’ˆï¼Œå¾ˆå®¹æ˜“å°†æ•°æ®ä»è¯¥æŒ‡é’ˆå¤åˆ¶åˆ°è‡ªå·±çš„ç»“æ„ï¼ˆè¿™é‡Œæ˜¯æŒ‡æ¯ä¸ªç”¨æˆ·è¿›ç¨‹éƒ½æœ‰å†…æ ¸ç©ºé—´æ˜ å°„åˆ°å…¶è™šæ‹Ÿå†…å­˜ç©ºé—´ä¸Šï¼Œè™šæ‹Ÿå†…å­˜åœ°å€æ˜¯è¿ç»­çš„ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ç”¨æˆ·ä¼ æ¥çš„åœ°å€ï¼‰ã€‚è¿™æ ·å‡å°‘äº†å†…æ ¸ç©ºé—´åˆ‡æ¢é¡µè¡¨çš„å¼€é”€ï¼ŒèŠ‚çœäº†å†…å­˜èµ„æºã€‚&lt;/p&gt;&#xA;&lt;p&gt;OSä¸å¸Œæœ›ç”¨æˆ·ç¨‹åºè¯»å–æˆ–å†™å…¥OSæ•°æ®æˆ–ä»£ç ï¼Œå› æ­¤ï¼Œç¡¬ä»¶å¿…é¡»æ”¯æŒé¡µé¢æ‰€éœ€çš„ç‰¹æƒçº§åˆ«æ¥å®ç°ã€‚è¯•å›¾è®¿é—®OSå†…æ ¸çš„æ•°æ®æˆ–ä»£ç å°†ä¼šåœ¨OSä¸­äº§ç”Ÿä¸€ä¸ªtrapï¼Œå¹¶å¯èƒ½ä¼šç»ˆæ­¢è¿è§„è¿›ç¨‹ã€‚&lt;/p&gt;&#xA;&lt;p&gt;VMSæœ‰ä¸¤ä¸ªç°åœ¨æˆä¸ºæ ‡å‡†çš„æŠ€å·§ï¼šæŒ‰éœ€ç½®é›¶å’Œå†™æ—¶å¤åˆ¶ã€‚&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;æŒ‰éœ€ç½®é›¶ï¼ˆæ‡’åˆ†é…ï¼‰ï¼šè€ƒè™‘åœ¨åœ°å€ç©ºé—´æ·»åŠ ä¸€ä¸ªé¡µï¼Œåˆçº§å®ç°æ˜¯åœ¨ç‰©ç†å†…å­˜ä¸­æ‰¾åˆ°ç‰©ç†é¡µå¸§ï¼Œå°†è¯¥é¡µåŠ å…¥åˆ°è™šæ‹Ÿå†…å­˜çš„å †ä¸­ï¼Œå¹¶å°†å…¶ç½®é›¶ï¼Œç„¶åå°†å…¶æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜ä¸Šã€‚åˆ©ç”¨æŒ‰éœ€ç½®é›¶ï¼Œå½“é¡µæ·»åŠ åˆ°è™šæ‹Ÿåœ°å€ç©ºé—´æ—¶ï¼Œä¼šåœ¨é¡µè¡¨ä¸­æ”¾å…¥ä¸€ä¸ªæ ‡è®°ä¸å¯è®¿é—®çš„PTEï¼Œå¦‚æœè¿›ç¨‹è¯»æˆ–å†™è¯¥é¡µï¼Œä¼šå‘OSå‘é€trapï¼Œåœ¨å¤„ç†trapæ—¶ï¼ŒOSæ ¹æ®PTEæ‰€æ ‡è®°çš„ä¸å¯è®¿é—®é¡µçŸ¥é“è¦å¯»æ‰¾ç‰©ç†é¡µï¼Œå°†å…¶ç½®é›¶å†æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜ä¸­ã€‚&lt;/li&gt;&#xA;&lt;li&gt;å†™æ—¶å¤åˆ¶ï¼šå¦‚æœOSéœ€è¦å°†ä¸€ä¸ªé¡µé¢ä»ä¸€ä¸ªåœ°å€ç©ºé—´å¤åˆ¶åˆ°å¦ä¸€ä¸ªåœ°å€ç©ºé—´ï¼Œä¸æ˜¯å®é™…å¤åˆ¶å®ƒï¼Œè€Œæ˜¯å°†å…¶æ˜ å°„åˆ°ç›®æ ‡ç‰©ç†åœ°å€ç©ºé—´ï¼Œå¹¶åœ¨ä¸¤ä¸ªåœ°å€ç©ºé—´ä¸­å°†å…¶æ ‡è®°ä¸ºåªè¯»ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªåœ°å€ç©ºé—´å°è¯•å†™å…¥é¡µé¢ï¼Œä¼šå‘ç”Ÿtrapï¼ŒOSæ³¨æ„åˆ°è¿™æ˜¯ä¸€ä¸ªCOWé¡µé¢ï¼Œä¼šåˆ†é…ä¸€ä¸ªæ–°é¡µï¼Œå¡«å……æ•°æ®ï¼Œå¹¶å°†è¯¥é¡µå»ºç«‹æ˜ å°„ã€‚COWçš„ç”¨å¤„ï¼šï¼ˆ1ï¼‰ä»»ä½•ç±»å‹çš„å…±äº«åº“ï¼ˆmaybeåŠ¨æ€é“¾æ¥åº“ï¼‰éƒ½å¯ä»¥é€šè¿‡COWæ˜ å°„åˆ°è®¸å¤šè¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼ŒèŠ‚çœå†…å­˜ã€‚ï¼ˆ2ï¼‰fork()ä¼šcopyçˆ¶è¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼Œä½†ä¸€èˆ¬ç«‹å³æ‰§è¡Œexec()ï¼Œè¿™äº›å†…å­˜ç©ºé—´çš„æ•°æ®ä¼šè¢«exec()æ‰§è¡Œçš„ç¨‹åºè¦†ç›–ï¼Œé€šè¿‡å†™æ—¶å¤åˆ¶ç‰ˆçš„fork()ï¼Œé¿å…äº†å¤§é‡ä¸å¿…è¦çš„copyï¼Œæ—¢ä¿ç•™äº†æ­£ç¡®çš„è¯­ä¹‰ï¼Œåˆæé«˜äº†æ€§èƒ½ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;å¹¶å‘&#34;&gt;&lt;span&gt;å¹¶å‘&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%b9%b6%e5%8f%91&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;çº¿ç¨‹&#34;&gt;&lt;span&gt;çº¿ç¨‹&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e7%ba%bf%e7%a8%8b&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;å¤šçº¿ç¨‹ç¨‹åºä¼šæœ‰å¤šä¸ªæ‰§è¡Œç‚¹ï¼ˆå¤šä¸ªç¨‹åºè®¡æ•°å™¨ï¼Œæ¯ä¸ªéƒ½ç”¨äºå–æŒ‡å’Œæ‰§è¡Œï¼‰ï¼Œå…±äº«åœ°å€ç©ºé—´ï¼Œä»è€Œèƒ½è®¿é—®ç›¸åŒçš„æ•°æ®ã€‚çº¿ç¨‹æœ‰ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨ï¼Œä¸€ç»„ç”¨äºè®¡ç®—çš„å¯„å­˜å™¨ã€‚çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ç±»ä¼¼äºè¿›ç¨‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿›ç¨‹å°†çŠ¶æ€ä¿å­˜åˆ°è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCBï¼‰ä¸­ï¼ŒåŒæ ·éœ€è¦ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹æ§åˆ¶å—ï¼ˆTCBï¼‰ä¿å­˜æ¯ä¸ªçº¿ç¨‹çš„çŠ¶æ€ã€‚ä½†æ˜¯çº¿ç¨‹æœ‰ä¸€ç‚¹ä¸»è¦åŒºåˆ«ï¼šåœ°å€ç©ºé—´ä¿æŒä¸å˜ï¼ˆä¸éœ€è¦åˆ‡æ¢å½“å‰ä½¿ç”¨çš„é¡µè¡¨ï¼‰ã€‚å¦ä¸€ä¸ªä¸»è¦åŒºåˆ«æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªæ ˆï¼Œè¿›ç¨‹åªæœ‰ä¸€ä¸ªæ ˆã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç«æ€æ¡ä»¶ï¼šç»“æœå–å†³äºä»£ç çš„æ—¶é—´æ‰§è¡Œï¼Œå¯èƒ½æ¯æ¬¡éƒ½ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœï¼Œç»“æœæ˜¯ä¸ç¡®å®šçš„ã€‚å¯¼è‡´ç«æ€æ¡ä»¶çš„è¿™æ®µä»£ç ç§°ä¸ºä¸´ç•ŒåŒºï¼Œä¸´ç•ŒåŒºæ˜¯è®¿é—®å…±äº«èµ„æºçš„ä»£ç ç‰‡æ®µï¼Œä¸€å®šä¸èƒ½ç”±å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œã€‚è€ŒçœŸæ­£æƒ³è¦çš„ä»£ç æ˜¯äº’æ–¥çš„ï¼Œè¿™ä¸ªå±æ€§ä¿è¯å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨ä¸´ç•ŒåŒºå†…æ‰§è¡Œï¼Œå…¶ä»–çº¿ç¨‹å°†è¢«é˜»æ­¢è¿›å…¥ä¸´ç•ŒåŒºã€‚æ‰€æœ‰è¿™äº›æœ¯è¯­æ˜¯ç”±Dijkstraåˆ›é€ çš„ï¼Œå› æ­¤è·å¾—å›¾çµå¥–ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¯¹ä¸€ä¸ªå…±äº«å˜é‡è¿›è¡ŒåŠ æ“ä½œï¼Œåœ¨ç¡¬ä»¶ä¸ŠæŒ‡ä»¤æ˜¯æœ‰ä¸‰æ¡çš„ï¼Œå¦‚æœæœ‰ä¸€æ¡è¶…çº§æŒ‡ä»¤èƒ½åŸå­æ€§åœ°æ‰§è¡Œè¿™ä¸‰æ¡æŒ‡ä»¤çš„æ“ä½œå°±ä¸ä¼šå‡ºç°ä¸Šè¿°å¾—åˆ°ä¸ç¡®å®šæ€§ç»“æœçš„é—®é¢˜ã€‚æˆ‘ä»¬è¦åšçš„æ˜¯è¦æ±‚ç¡¬ä»¶æä¾›åŒæ­¥åŸè¯­ï¼ŒåŠ ä¸ŠOSçš„ä¸€äº›å¸®åŠ©ï¼Œä»¥åŒæ­¥å’Œå—æ§çš„æ–¹å¼è®¿é—®ä¸´ç•ŒåŒºï¼Œä»è€Œäº§ç”Ÿæ­£ç¡®çš„ç»“æœã€‚&lt;/p&gt;&#xA;&lt;p&gt;çº¿ç¨‹é—´è¿˜æœ‰å¦å¤–ä¸€ç§å¸¸è§çš„äº¤äº’ï¼Œå³ä¸€ä¸ªçº¿ç¨‹åœ¨ç»§ç»­ä¹‹å‰å¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹å®ŒæˆæŸäº›æ“ä½œï¼Œå¦‚ç£ç›˜I/Oæ“ä½œè¿›å…¥ç¡çœ çŠ¶æ€åéœ€è¦è¢«å”¤é†’ã€‚æ¡ä»¶å˜é‡æ”¯æŒå¤šçº¿ç¨‹ç¡çœ å”¤é†’æœºåˆ¶ã€‚&lt;/p&gt;&#xA;&lt;p&gt;OSæ˜¯ç¬¬ä¸€ä¸ªå¹¶å‘ç¨‹åºï¼Œå› ä¸ºOSå¼•å…¥äº†ä¸­æ–­ï¼Œä¸­æ–­ä¹Ÿä¼šéšæ—¶å‘ç”Ÿï¼Œæ‰€ä»¥æ›´æ–°è¿™äº›å…±äº«ç»“æ„éƒ½å¿…é¡»å°å¿ƒè®¿é—®ï¼Œå¹¶ä½¿ç”¨æ­£ç¡®çš„åŒæ­¥åŸè¯­æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;çº¿ç¨‹api&#34;&gt;&lt;span&gt;çº¿ç¨‹API&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e7%ba%bf%e7%a8%8bapi&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;çº¿ç¨‹åˆ›å»ºï¼špthread_create()ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥pthread_tç»“æ„ä½“æŒ‡é’ˆï¼Œéœ€è¦åˆ©ç”¨è¿™ä¸ªç»“æ„ä½“ä¸è¯¥çº¿ç¨‹äº¤äº’ï¼Œä»¥ä¾¿åˆå§‹åŒ–ã€‚ç¬¬äºŒä¸ªå‚æ•°ä¸€èˆ¬ä¼ NULLã€‚ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯åœ¨é—®è¿™ä¸ªçº¿ç¨‹åº”è¯¥åœ¨å“ªä¸ªå‡½æ•°ä¸­è¿è¡Œï¼Œæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼ˆå‡½æ•°åç§°start_routineï¼Œå‚æ•°void*ï¼Œè¿”å›å€¼void*ï¼‰ã€‚ç¬¬å››ä¸ªå‚æ•°æ˜¯ä¼ é€’ç»™çº¿ç¨‹å¼€å§‹æ‰§è¡Œçš„å‡½æ•°çš„å‚æ•°ã€‚ä¸€æ—¦åˆ›å»ºäº†çº¿ç¨‹ï¼Œå°±æ‹¥æœ‰äº†ä¸€ä¸ªæ´»ç€çš„æ‰§è¡Œå®ä½“ï¼Œæœ‰è‡ªå·±çš„è°ƒç”¨æ ˆï¼Œä¸ç¨‹åºä¸­æ‰€æœ‰å½“å‰å­˜åœ¨çš„çº¿ç¨‹åœ¨ç›¸åŒçš„åœ°å€ç©ºé—´å†…è¿è¡Œã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pthread_create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;pthread_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;kr&#34;&gt;thread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;pthread_attr_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;attr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_routine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;arg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;çº¿ç¨‹å®Œæˆï¼špthread_join()ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¼ å…¥pthread_tç»“æ„ä½“æŒ‡é’ˆï¼ŒæŒ‡å®šè¦ç­‰å¾…çš„çº¿ç¨‹ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä½ å¸Œæœ›å¾—åˆ°çš„è¿”å›å€¼ã€‚åœ¨å‡½æ•°è°ƒç”¨è¿”å›å€¼æ—¶éœ€è¦æ³¨æ„æ°¸è¿œä¸è¦è¿”å›å±€éƒ¨å˜é‡ï¼ˆæ ˆä¸Šï¼‰çš„å¼•ç”¨æˆ–æŒ‡å‘å±€éƒ¨å˜é‡çš„æŒ‡é’ˆã€‚è¿™ä¸ªç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæˆçš„ä½œç”¨æ˜¯ï¼šåˆ›å»ºçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œç‰¹å®šä»»åŠ¡çš„å¹¶è¡Œç¨‹åºï¼Œä½¿ç”¨joinæ¥ç¡®ä¿åœ¨é€€å‡ºæˆ–è¿›å…¥ä¸‹ä¸€é˜¶æ®µè®¡ç®—å‰å®Œæˆæ‰€æœ‰è¿™äº›å·¥ä½œã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pthread_join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;pthread_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;kr&#34;&gt;thread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;**&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;é”ï¼šæä¾›äº’æ–¥è¿›å…¥ä¸´ç•ŒåŒºçš„å‡½æ•°ã€‚æ‰€æœ‰é”å¿…é¡»å‡†ç¡®åˆå§‹åŒ–ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pthread_mutex_lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;pthread_mutex_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pthread_mutex_unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;pthread_mutex_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mutex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æ¡ä»¶å˜é‡ï¼šå½“çº¿ç¨‹ä¹‹é—´å¿…é¡»å‘ç”ŸæŸç§ä¿¡å·æ—¶ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡ŒæŸäº›æ“ä½œï¼Œæ¡ä»¶å˜é‡å°±å¾ˆæœ‰ç”¨ã€‚ä½¿ç”¨æ¡ä»¶å˜é‡å¿…é¡»æœ‰ä¸€ä¸ªä¸æ­¤æ¡ä»¶ç›¸å…³çš„é”ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;pthread_mutex_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PTHREAD_MUTEX_INITIALIZER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;pthread_cond_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cond&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PTHREAD_COND_INITIALIZER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;Pthread_mutex_lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ready&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;Pthread_cond_wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//readyæ²¡æœ‰è®¾ä¸º0ä»¥å¤–çš„å€¼å°±è°ƒç”¨ç­‰å¾…å‡½æ•°ä¼‘çœ &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pthread_mutex_unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;å…¶ä»–çº¿ç¨‹è¿›è¡Œå”¤é†’ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;Pthread_mutex_lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ready&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;Pthread_cond_signal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;Pthread_mutex_unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;é”&#34;&gt;&lt;span&gt;é”&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e9%94%81&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;é”å°±æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å£°æ˜ä¸€ä¸ªæŸç§ç±»å‹çš„é”å˜é‡æ‰èƒ½ä½¿ç”¨ã€‚lock()å°è¯•è·å–é”ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹æŒæœ‰é”ï¼Œè¯¥çº¿ç¨‹ä¼šè·å¾—é”ï¼Œå¤„äºä¸´ç•ŒåŒºã€‚é”çš„æŒæœ‰è€…ä¸€æ—¦è°ƒç”¨unlock()ï¼Œé”çš„çŠ¶æ€å°±å˜æˆå¯ç”¨äº†ã€‚å¦‚æœæœ‰ç­‰å¾…çº¿ç¨‹ï¼ˆå¡åœ¨lock()é‡Œï¼‰ï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ä¼šæ³¨æ„åˆ°ï¼ˆæ”¶åˆ°é€šçŸ¥ï¼‰é”çŠ¶æ€çš„å˜åŒ–ï¼Œè·å–é”ï¼Œè¿›å…¥ä¸´ç•ŒåŒºã€‚é”ä¸ºç¨‹åºå‘˜æä¾›äº†æœ€å°ç¨‹åº¦çš„è°ƒåº¦æ§åˆ¶ï¼Œå°†åŸæœ¬ç”±OSè°ƒåº¦çš„æ··ä¹±çŠ¶æ€å˜å¾—æ›´ä¸ºå¯æ§ã€‚&lt;/p&gt;&#xA;&lt;p&gt;POSIXåº“å°†é”ç§°ä¸ºäº’æ–¥é‡ï¼Œä¸åŒäºä»»ä½•ä¸´ç•ŒåŒºéƒ½ä½¿ç”¨åŒä¸€ä¸ªå¤§é”ï¼ˆç²—ç²’åº¦çš„é”ï¼‰ï¼Œé€šå¸¸å¤§å®¶ä¼šç”¨ä¸åŒçš„é”ä¿æŠ¤ä¸åŒçš„æ•°æ®å’Œç»“æ„ï¼Œä»è€Œå…è®¸æ›´å¤šçš„çº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºï¼ˆç»†ç²’åº¦çš„é”ï¼‰ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¯„ä»·é”å®ç°çš„æ•ˆæœï¼š1. äº’æ–¥æ€§ï¼›2. å…¬å¹³æ€§ï¼› 3. æ€§èƒ½ã€‚æœ€æ—©æä¾›çš„äº’æ–¥å°±æ˜¯åœ¨ä¸´ç•ŒåŒºå…³é—­ä¸­æ–­ï¼Œä¼˜ç‚¹æ˜¯ç®€å•ï¼Œç¼ºç‚¹æœ‰å¾ˆå¤šï¼š1. æ¶æ„è°ƒç”¨lock()åæ­»å¾ªç¯ï¼Œç³»ç»Ÿå¤±å»æ§åˆ¶æƒï¼›2. ä¸æ”¯æŒå¤šå¤„ç†å™¨ï¼Œå…³ä¸­æ–­æ˜¯é’ˆå¯¹ä¸€ä¸ªå¤„ç†å™¨è€Œè¨€çš„ï¼›3. å…³ä¸­æ–­ä¼šå¯¼è‡´ä¸­æ–­ä¸¢å¤±ï¼›4. æ•ˆç‡ä½ï¼Œå…³é—­å’Œæ‰“å¼€ä¸­æ–­çš„ä»£ç æ‰§è¡Œå¾—å¾ˆæ…¢ã€‚åŸºäºä»¥ä¸ŠåŸå› ï¼Œåªåœ¨æœ‰é™çš„æƒ…å†µä¸‹ç”¨å…³é—­ä¸­æ–­æ¥å®ç°äº’æ–¥åŸè¯­ã€‚&lt;/p&gt;&#xA;&lt;p&gt;æµ‹è¯•å¹¶è®¾ç½®æŒ‡ä»¤ï¼šè¿”å›old_ptræŒ‡å‘çš„æ—§å€¼ï¼ŒåŒæ—¶æ›´æ–°ä¸ºnewçš„æ–°å€¼ï¼Œè¿™äº›ä»£ç æ˜¯åŸå­æ‰§è¡Œçš„ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;lock_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;lock_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;init&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;lock_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flag&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;lock_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TestAndSet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;lock_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flag&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;å°†testå’Œsetåˆå¹¶ä¸ºä¸€ä¸ªåŸå­æ“ä½œåï¼Œä¿è¯äº†åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è·å–é”ï¼Œè¿™å°±æ˜¯å®ç°äº†ä¸€ä¸ªæœ‰æ•ˆçš„äº’æ–¥åŸè¯­ã€‚è¿™ç§ä½¿ç”¨whileå¾ªç¯çš„é”æ˜¯è‡ªæ—‹é”ï¼Œåœ¨å•å¤„ç†å™¨ä¸Šéœ€è¦æŠ¢å å¼çš„è°ƒåº¦å™¨ï¼Œå¦åˆ™åœ¨å•CPUä¸Šæ— æ³•ä½¿ç”¨ï¼Œå› ä¸ºä¸€ä¸ªè‡ªæ—‹çš„çº¿ç¨‹æ°¸ä¸ä¼šæ”¾å¼ƒCPUã€‚&lt;/p&gt;&#xA;&lt;p&gt;è‡ªæ—‹é”æ²¡æœ‰å…¬å¹³æ€§ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¥¿æ­»ï¼›åœ¨å•CPUä¸Šæ€§èƒ½å¼€é”€å¾ˆå¤§ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œå…¶ä»–çº¿ç¨‹éƒ½åœ¨ç«äº‰é”ï¼Œéƒ½ä¼šåœ¨æ”¾å¼ƒCPUä¹‹å‰è‡ªæ—‹ä¸€ä¸ªæ—¶é—´ç‰‡æµªè´¹CPUå‘¨æœŸã€‚ä½†æ˜¯åœ¨å¤šCPUä¸Šï¼Œè‡ªæ—‹é”æ€§èƒ½ä¸é”™ã€‚&lt;/p&gt;&#xA;&lt;p&gt;æ¯”è¾ƒå¹¶äº¤æ¢ï¼šæ£€æµ‹ptræŒ‡å‘çš„å€¼æ˜¯å¦å’Œexpectedç›¸ç­‰ï¼›å¦‚æœæ˜¯ï¼Œæ›´æ–°ptræ‰€æŒ‡å‘çš„å€¼ä¸ºæ–°å€¼ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è·å–å¹¶å¢åŠ ï¼šåŸå­åœ°è¿”å›ç‰¹å®šåœ°å€çš„æ—§å€¼ä¸”è®©è¯¥å€¼è‡ªå¢ä¸€ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åŸºäºä»¥ä¸Šç¡¬ä»¶åŸå­æŒ‡ä»¤å®ç°çš„é”ç®€å•ä¸”æœ‰æ•ˆï¼Œä½†å¯èƒ½ä¼šäº§ç”Ÿè‡ªæ—‹è¿‡å¤šï¼šä¸¤ä¸ªçº¿ç¨‹è¿è¡Œåœ¨åŒä¸€ä¸ªCPUä¸Šï¼Œå½“çº¿ç¨‹AæŒæœ‰é”æ—¶ï¼Œè¢«ä¸­æ–­ã€‚çº¿ç¨‹Bè·å–é”ï¼Œå‘ç°é”å·²è¢«å ç”¨ï¼Œå®ƒå°±ä¼šè‡ªæ—‹ï¼Œç›´åˆ°æ—¶é’Ÿä¸­æ–­äº§ç”Ÿï¼Œçº¿ç¨‹Aé‡æ–°è¿è¡Œã€‚å¦‚æœæœ‰Nä¸ªçº¿ç¨‹å»ç«äº‰ä¸€ä¸ªé”ï¼Œä¼šæµªè´¹N-1ä¸ªæ—¶é—´ç‰‡ï¼Œæ—¶é—´ç‰‡å†…åªæ˜¯è‡ªæ—‹å¹¶ç­‰å¾…ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾è¯¥é”ã€‚&lt;/p&gt;&#xA;&lt;p&gt;é‚£è¿™æ ·åªé ç¡¬ä»¶æ”¯æŒæ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜éœ€è¦OSæ”¯æŒï¼Œç®€å•æ–¹æ³•æ˜¯ï¼šè®©å‡ºæ¥ã€‚åœ¨è¦è‡ªæ—‹çš„æ—¶å€™ï¼Œæ”¾å¼ƒCPUã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼ŒOSæä¾›åŸè¯­yield()ï¼Œä¸»åŠ¨æ”¾å¼ƒCPUï¼Œè®©å…¶ä»–çº¿ç¨‹è¿è¡Œã€‚yield()ç³»ç»Ÿè°ƒç”¨èƒ½è®©è¿è¡Œæ€å˜ä¸ºå°±ç»ªæ€ï¼Œä»è€Œå…è®¸å…¶ä»–çº¿ç¨‹è¿è¡Œã€‚ä½†æ˜¯è¿™æ ·ä¾æ—§å­˜åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬ï¼Œå¦‚æœæœ‰100ä¸ªçº¿ç¨‹ç«äº‰ä¸€æŠŠé”ï¼Œå…¶ä¸­99ä¸ªçº¿ç¨‹è™½ç„¶ä¸ä¼šè‡ªæ—‹æµªè´¹æ—¶é—´ç‰‡ï¼Œä½†æ˜¯ä¾æ—§æœ‰è¿è¡Œ-è®©å‡ºçš„ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬ã€‚&lt;/p&gt;&#xA;&lt;p&gt;æ— è®ºè‡ªæ—‹è¿˜æ˜¯è®©å‡ºéƒ½å¯èƒ½é€ æˆæµªè´¹å’Œé¥¿æ­»ï¼Œæˆ‘ä»¬å¿…é¡»æ˜¾ç¤ºåœ°æ–½åŠ æŸç§æ§åˆ¶ï¼Œå†³å®šé”é‡Šæ”¾æ—¶ï¼Œè°èƒ½æŠ¢åˆ°é”ã€‚ä½¿ç”¨é˜Ÿåˆ—ï¼Œé€šè¿‡ä¼‘çœ ä»£æ›¿è‡ªæ—‹ã€‚park()èƒ½è®©è°ƒç”¨çº¿ç¨‹ä¼‘çœ ï¼Œunpark(threadID)åˆ™ä¼šå”¤é†’threadIDæ ‡è¯†çš„çº¿ç¨‹ï¼Œç”¨è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨å®ç°é”ï¼Œè®©è°ƒç”¨è€…åœ¨è·å–ä¸åˆ°é”æ—¶ç¡çœ ï¼Œåœ¨é”å¯ç”¨æ—¶è¢«å”¤é†’ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;lock_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;guard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;queue_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;lock_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;lock_init&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;lock_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flag&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;guard&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;queue_init&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;lock_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TestAndSet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;guard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flag&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é”è¢«è·å–&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flag&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;guard&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é”è¢«å ç”¨&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nf&#34;&gt;queue_add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;gettid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;guard&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;park&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ä¼‘çœ &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;lock_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TestAndSet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;guard&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;queue_empty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é˜Ÿåˆ—æ˜¯ç©ºçš„ æŠŠé”é‡Šæ”¾ æ— çº¿ç¨‹éœ€è¦&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flag&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;unpark&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;queue_remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;guard&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;ä¸¤é˜¶æ®µé”ï¼ˆè‡ªæ—‹å’Œç¡çœ çš„æ‚åˆï¼‰ï¼šç¬¬ä¸€é˜¶æ®µè‡ªæ—‹ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœæ²¡æœ‰è·å¾—é”ï¼Œç¬¬äºŒé˜¶æ®µä¼‘çœ ï¼Œç›´åˆ°é”å¯ç”¨ã€‚Linuxé”å°±æ˜¯è¿™ç§é”ï¼Œä¸è¿‡åªè‡ªæ—‹ä¸€æ¬¡ï¼›æ›´å¸¸è§çš„æ–¹å¼æ˜¯åœ¨å¾ªç¯ä¸­è‡ªæ—‹å›ºå®šçš„æ¬¡æ•°ï¼Œç„¶åä½¿ç”¨futexä¼‘çœ ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;æ¡ä»¶å˜é‡&#34;&gt;&lt;span&gt;æ¡ä»¶å˜é‡&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%9d%a1%e4%bb%b6%e5%8f%98%e9%87%8f&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;é”å¹¶ä¸æ˜¯å¹¶å‘ç¨‹åºè®¾è®¡æ‰€éœ€çš„å”¯ä¸€åŸè¯­ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œçº¿ç¨‹éœ€è¦æ£€æŸ¥æŸä¸€æ¡ä»¶æ»¡è¶³ä¹‹åï¼Œæ‰ä¼šç»§ç»­è¿è¡Œã€‚çº¿ç¨‹å¯ä»¥ä½¿ç”¨æ¡ä»¶å˜é‡ç­‰å¾…ä¸€ä¸ªæ¡ä»¶å˜æˆçœŸï¼Œæ¡ä»¶å˜é‡æ˜¯ä¸€ä¸ªæ˜¾ç¤ºé˜Ÿåˆ—ï¼Œå½“æŸäº›æ‰§è¡ŒçŠ¶æ€ä¸æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹å¯ä»¥æŠŠè‡ªå·±åŠ å…¥é˜Ÿåˆ—ï¼Œç­‰å¾…è¯¥æ¡ä»¶ã€‚å¦å¤–æŸä¸ªçº¿ç¨‹ï¼Œå½“å®ƒæ”¹å˜äº†ä¸Šè¿°çŠ¶æ€æ—¶ï¼Œå°±å¯ä»¥å”¤é†’ä¸€ä¸ªæˆ–å¤šä¸ªç­‰å¾…çº¿ç¨‹è®©ä»–ä»¬ç»§ç»­æ‰§è¡Œã€‚&lt;/p&gt;&#xA;&lt;p&gt;æ¡ä»¶å˜é‡çš„å£°æ˜ï¼špthread_cond_t c;æœ‰ä¸¤ç§ç›¸å…³æ“ä½œï¼šwait()å’Œsignal()ï¼Œçº¿ç¨‹è¦ç¡çœ çš„æ—¶å€™è°ƒç”¨wait()ï¼Œæƒ³è¦å”¤é†’ç­‰å¾…åœ¨æŸä¸ªæ¡ä»¶å˜é‡ä¸Šçš„ç¡çœ çº¿ç¨‹æ—¶ï¼Œè°ƒç”¨signal()ã€‚wait()ä½œç”¨æ˜¯é‡Šæ”¾é”ï¼Œå¹¶è®©è°ƒç”¨çº¿ç¨‹ä¼‘çœ ï¼Œå½“çº¿ç¨‹è¢«å”¤é†’æ—¶ï¼Œå¿…é¡»é‡æ–°è·å–é”ï¼Œå†è¿”å›è°ƒç”¨è€…ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä½¿ç”¨æ¡ä»¶å˜é‡ï¼Œçˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹çš„ç¤ºä¾‹ä»£ç ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;done&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;pthread_mutex_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PTHREAD_MUTEX_INITIALIZER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;pthread_cond_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PTHREAD_COND_INITIALIZER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;thr_exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;Pthread_mutex_lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è·å–é”&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;done&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;                &lt;span class=&#34;c1&#34;&gt;// æ ‡å¿—ä½é¿å…è™šå‡å”¤é†’&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;Pthread_cond_signal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ¿€æ´»å…¶ä»–ç¡çœ çº¿ç¨‹&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;Pthread_mutex_unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;arg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;child&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;thr_exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;thr_join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;Pthread_mutex_lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åŒæ ·ä¹Ÿè¦è·å–é”&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;done&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;Pthread_cond_wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ç¡çœ ç­‰å¾…&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;Pthread_mutex_unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;parent:begin&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;pthread_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;Pthread_create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºçº¿ç¨‹æ‰§è¡Œchildå‡½æ•°&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;thr_join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;parent:end&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æœ‰ä¸¤ç§æƒ…å†µéœ€è¦è€ƒè™‘ï¼š1. çˆ¶è¿›ç¨‹å…ˆäºå­è¿›ç¨‹æ‰§è¡Œï¼Œå³çˆ¶è¿›ç¨‹å…ˆthr_join()ç¡çœ ç­‰å¾…ï¼Œå­è¿›ç¨‹å†thr_exit()æ¿€æ´»çˆ¶è¿›ç¨‹ç»§ç»­æ‰§è¡Œã€‚2. å­è¿›ç¨‹å…ˆäºçˆ¶è¿›ç¨‹æ‰§è¡Œï¼Œå³å­è¿›ç¨‹ç«‹å³å”¤é†’å…¶ä»–çº¿ç¨‹ï¼Œçˆ¶è¿›ç¨‹è°ƒç”¨thr_join()æ—¶å‘ç°doneæ˜¯1ï¼Œå°±ä¸éœ€è¦ç¡çœ äº†ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¦‚æœä¸ä½¿ç”¨çŠ¶æ€å˜é‡doneï¼Œæ˜¯æœ‰é—®é¢˜çš„ï¼Œå‡è®¾æ˜¯ä¸Šè¿°æƒ…å†µ2ï¼Œè€Œæ²¡æœ‰doneçš„åˆ¤æ–­ï¼Œçˆ¶è¿›ç¨‹å°±ä¼šä¸€ç›´ç¡çœ ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¦‚æœä½¿ç”¨å‘ä¿¡å·å’Œç­‰å¾…æ—¶ä¸åŠ é”ï¼Œä¼šäº§ç”Ÿç«æ€æ¡ä»¶ï¼Œçˆ¶è¿›ç¨‹åœ¨è°ƒç”¨thr_join()æ—¶ï¼Œåˆ¤æ–­done==0ï¼Œåœ¨è°ƒç”¨wait()è¿›å…¥ç¡çœ ä¹‹å‰ï¼Œä¸­æ–­äº§ç”Ÿè¿è¡Œå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹æ­¤æ—¶å°†doneè®¾ä¸º1ï¼Œå”¤é†’å…¶ä»–è¿›ç¨‹ï¼Œä½†å‘ç°æ²¡æœ‰ç¡çœ è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹å†æ¬¡è¿è¡Œæ—¶ï¼Œå°±ä¼šé•¿çœ ä¸é†’ã€‚è°ƒç”¨siganlå’Œwaitæ—¶è¦æŒæœ‰é”ï¼Œä¼šä¿æŒèº«å¿ƒå¥åº·ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;thr_exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;done&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;Pthread_cond_signal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;thr_join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;done&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;Pthread_cond_wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ï¼šå‡è®¾æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç”Ÿäº§è€…çº¿ç¨‹å’Œä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ã€‚ç”Ÿäº§è€…æŠŠç”Ÿäº§çš„æ•°æ®æ”¾å…¥ç¼“å†²åŒºï¼Œæ¶ˆè´¹è€…ä»ç¼“å†²åŒºå–å‡ºæ•°æ®ï¼Œä»¥æŸç§æ–¹å¼æ¶ˆè´¹ã€‚ä¾‹å¦‚ï¼Œå¤šçº¿ç¨‹çš„ç½‘ç»œæœåŠ¡å™¨ä¸­ï¼Œä¸€ä¸ªç”Ÿäº§è€…å°†HTTPè¯·æ±‚æ”¾å…¥å·¥ä½œé˜Ÿåˆ—ï¼ˆæœ‰ç•Œç¼“å†²åŒºï¼‰ï¼Œæ¶ˆè´¹çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­å–èµ°è¯·æ±‚å¹¶å¤„ç†ï¼›ä½¿ç”¨ç®¡é“æ—¶ä¹Ÿä¼šä½¿ç”¨æœ‰ç•Œç¼“å†²åŒºï¼Œä¾‹å¦‚grep foo file.txt | wc -lï¼Œå¹¶å‘æ‰§è¡Œä¸¤ä¸ªè¿›ç¨‹ï¼Œgrepè¿›ç¨‹ä»file.txtä¸­æŸ¥æ‰¾åŒ…æ‹¬&amp;quot;foo&amp;quot;çš„è¡Œï¼Œå†™åˆ°æ ‡å‡†è¾“å‡ºï¼›shellé‡å®šå‘åˆ°ç®¡é“ï¼Œç®¡é“çš„ä¸€ç«¯æ˜¯wcè¿›ç¨‹çš„æ ‡å‡†è¾“å…¥ï¼Œwcç»Ÿè®¡å®Œè¡Œæ•°åæ‰“å°å‡ºç»“æœã€‚å› æ­¤ï¼Œgrepæ˜¯ç”Ÿäº§è€…ï¼Œwcæ˜¯æ¶ˆè´¹è€…ï¼Œä¹‹é—´æ˜¯å†…æ ¸ä¸­çš„æœ‰ç•Œç¼“å†²åŒºã€‚ç”±äºMesaè¯­ä¹‰ï¼Œè®°ä½ä¸€æ¡å…³äºæ¡ä»¶å˜é‡çš„ç®€å•è§„åˆ™ï¼šæ€»æ˜¯ä½¿ç”¨whileå¾ªç¯ã€‚å¤šçº¿ç¨‹ç¨‹åºåœ¨æ£€æŸ¥æ¡ä»¶å˜é‡æ—¶ï¼Œä½¿ç”¨whileå¾ªç¯æ€»æ˜¯å¯¹çš„ï¼Œä¹Ÿè§£å†³äº†è™šå‡å”¤é†’çš„é—®é¢˜ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;å¸¸è§å¹¶å‘é—®é¢˜&#34;&gt;&lt;span&gt;å¸¸è§å¹¶å‘é—®é¢˜&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%b8%b8%e8%a7%81%e5%b9%b6%e5%8f%91%e9%97%ae%e9%a2%98&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;å¸¸è§å¹¶å‘é—®é¢˜åˆ†ä¸ºä¸¤ç±»ï¼šéæ­»é”ç¼ºé™·å’Œæ­»é”ç¼ºé™·ã€‚éæ­»é”é—®é¢˜ï¼šè¿ååŸå­æ€§ç¼ºé™·ï¼ˆè¿åå¤šæ¬¡å†…å­˜è®¿é—®ä¸­é¢„æœŸçš„å¯ä¸²è¡Œæ€§ï¼Œå¯¹å…±äº«å˜é‡åŠ é”ï¼‰å’Œé”™è¯¯é¡ºåºç¼ºé™·ï¼ˆä¸¤ä¸ªå†…å­˜è®¿é—®çš„é¢„æœŸé¡ºåºè¢«æ‰“ç ´äº†ï¼Œæ¡ä»¶å˜é‡+é”å®ç°åŒæ­¥ï¼‰ã€‚å¤§éƒ¨åˆ†ï¼ˆ97%ï¼‰çš„éæ­»é”é—®é¢˜æ˜¯è¿ååŸå­æ€§å’Œè¿åé¡ºåºè¿™ä¸¤ç§ã€‚&lt;/p&gt;&#xA;&lt;p&gt;æ­»é”ï¼šå½“çº¿ç¨‹1æŒæœ‰é”L1ï¼Œæ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªé”2ï¼Œè€Œçº¿ç¨‹2æŒæœ‰é”L2ï¼Œå´åœ¨ç­‰å¾…é”L1é‡Šæ”¾ã€‚æ­»é”ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿï¼š1. åœ¨å¤§å‹ä»£ç åº“é‡Œå­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œå¦‚è™šæ‹Ÿå†…å­˜ç³»ç»Ÿéœ€è¦è®¿é—®æ–‡ä»¶ç³»ç»Ÿæ‰èƒ½ä»ç£ç›˜è¯»åˆ°å†…å­˜é¡µï¼›æ–‡ä»¶ç³»ç»Ÿéšååˆè¦å’Œå†…å­˜ç³»ç»Ÿäº¤äº’å»ç”³è¯·å†…å­˜ã€‚2. å°è£…ï¼ŒæŸäº›çœ‹èµ·æ¥æ²¡æœ‰å…³ç³»çš„æ¥å£å¯èƒ½ä¼šå¯¼è‡´æ­»é”ã€‚æ¯”å¦‚ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Java&#34; data-lang=&#34;Java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Vector&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;AddAll&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;åœ¨å†…éƒ¨ï¼Œvectoréœ€è¦çº¿ç¨‹å®‰å…¨ï¼Œè¿™ä¸ªçº¿ç¨‹å…ˆå¯¹v1åŠ é”ï¼Œå†å¯¹v2åŠ é”ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹å‡ ä¹åŒæ—¶è°ƒç”¨v2.AddAll(v1);å°±å¯èƒ½é‡åˆ°æ­»é”ã€‚&lt;/p&gt;&#xA;&lt;p&gt;äº§ç”Ÿæ­»é”çš„æ¡ä»¶ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;äº’æ–¥ï¼šçº¿ç¨‹å¯¹èµ„æºè¿›è¡Œäº’æ–¥çš„è®¿é—®ã€‚&lt;/li&gt;&#xA;&lt;li&gt;æŒæœ‰å¹¶ç­‰å¾…ï¼šçº¿ç¨‹æŒæœ‰äº†èµ„æºï¼ˆå¯¹åº”çš„é”ï¼‰ï¼ŒåŒæ—¶åˆåœ¨ç­‰å¾…å…¶ä»–èµ„æºï¼ˆéœ€è¦è·å¾—å…¶ä»–é”ï¼‰ã€‚&lt;/li&gt;&#xA;&lt;li&gt;éæŠ¢å ï¼šçº¿ç¨‹è·å¾—çš„èµ„æºä¸èƒ½è¢«æŠ¢å ã€‚&lt;/li&gt;&#xA;&lt;li&gt;å¾ªç¯ç­‰å¾…ï¼šçº¿ç¨‹ä¹‹é—´å­˜åœ¨ä¸€ä¸ªç¯è·¯ï¼Œç¯è·¯æ¯ä¸ªçº¿ç¨‹éƒ½é¢å¤–æŒæœ‰ä¸€ä¸ªèµ„æºï¼Œè€Œè¿™ä¸ªèµ„æºåˆæ˜¯ä¸‹ä¸€ä¸ªçº¿ç¨‹è¦ç”³è¯·çš„ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;é¢„é˜²æ­»é”ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;å¾ªç¯ç­‰å¾…ï¼šè·å–é”æ—¶æä¾›ä¸€ä¸ªå…¨åºï¼Œæ¯æ¬¡æŒ‰åºç”³è¯·é”ã€‚åœ¨å¤æ‚çš„ç³»ç»Ÿä¸­ä¸ä¼šåªæœ‰ä¸¤ä¸ªé”ï¼Œé”çš„å…¨åºå¯èƒ½å¾ˆéš¾åšåˆ°ï¼Œååºæ˜¯ä¸€ç§æœ‰ç”¨çš„æ–¹æ³•ã€‚Linuxçš„å†…å­˜æ˜ å°„ä»£ç å°±æ˜¯ä¸€ä¸ªååºé”çš„å¥½ä¾‹å­ï¼Œç„¶è€Œè¿™æ˜¯ä¸€ç§çº¦å®šï¼Œå¾ˆå®¹æ˜“å‡ºé”™ã€‚&lt;/li&gt;&#xA;&lt;li&gt;æŒæœ‰å¹¶ç­‰å¾…ï¼šé€šè¿‡åŸå­åœ°æŠ¢é”æ¥é¿å…ï¼Œä»»ä½•çº¿ç¨‹åœ¨æŠ¢é”æ—¶å…ˆæŠ¢åˆ°å…¨å±€çš„preventioné”ã€‚&lt;/li&gt;&#xA;&lt;li&gt;éæŠ¢å ï¼šåœ¨è°ƒç”¨unlockä¹‹å‰ï¼Œä½¿ç”¨trylock()å‡½æ•°ï¼Œå°è¯•è·å¾—æ‰€éœ€è¦çš„é”ã€‚&lt;/li&gt;&#xA;&lt;li&gt;äº’æ–¥ï¼šä½¿ç”¨ç¡¬ä»¶æä¾›çš„åŸå­æŒ‡ä»¤ï¼Œæ¯”å¦‚æ¯”è¾ƒå¹¶äº¤æ¢æŒ‡ä»¤ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;é€šè¿‡è°ƒåº¦é¿å…æ­»é”ï¼š&#xA;é€šè¿‡äº†è§£å…¨å±€çš„ä¿¡æ¯ï¼Œä½¿å¾—åç»­çš„è°ƒåº¦èƒ½å¤Ÿé¿å…äº§ç”Ÿæ­»é”ã€‚é¿å…åœ¨åŒä¸€CPUä¸Šè¿è¡Œéœ€è¦ç«äº‰åŒä¸€é”çš„çº¿ç¨‹ï¼Œè¿™ç§ä¿å®ˆçš„é™æ€æ–¹æ¡ˆä¼šæ˜æ˜¾å¢åŠ å®Œæˆä»»åŠ¡çš„æ€»æ—¶é—´ï¼Œä»˜å‡ºç‰ºç‰²æ€§èƒ½çš„ä»£ä»·ã€‚é“¶è¡Œå®¶ç®—æ³•å°±æ˜¯ç±»ä¼¼çš„è‘—åè§£å†³æ–¹æ¡ˆï¼Œä½†è¿™ç§æ–¹æ³•ä¼šé™åˆ¶å¹¶å‘ï¼Œä¸æ˜¯å¹¿æ³›ä½¿ç”¨çš„é€šç”¨æ–¹æ¡ˆã€‚&#xA;æ£€æŸ¥å’Œæ¢å¤ï¼šå…è®¸æ­»é”å¶å°”å‘ç”Ÿï¼Œæ£€æŸ¥åˆ°æ­»é”æ—¶å†é‡‡å–è¡ŒåŠ¨ã€‚å¾ˆå¤šæ•°æ®åº“ç³»ç»Ÿä½¿ç”¨äº†æ­»é”æ£€æµ‹å’Œæ¢å¤æŠ€æœ¯ï¼Œæ­»é”æ£€æµ‹å™¨å®šæœŸè¿è¡Œï¼Œå½“æ­»é”å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿé‡å¯ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;åŸºäºäº‹ä»¶çš„å¹¶å‘&#34;&gt;&lt;span&gt;åŸºäºäº‹ä»¶çš„å¹¶å‘&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%9f%ba%e4%ba%8e%e4%ba%8b%e4%bb%b6%e7%9a%84%e5%b9%b6%e5%8f%91&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;ä¸€äº›åŸºäºå›¾å½¢ç”¨æˆ·ç•Œé¢çš„åº”ç”¨æˆ–æŸäº›ç±»å‹çš„ç½‘ç»œæœåŠ¡å™¨ï¼Œå¸¸å¸¸é‡‡ç”¨å¦ä¸€ç§å¹¶å‘æ–¹å¼ï¼ˆéçº¿ç¨‹å®ç°ï¼‰ï¼Œè¿™ç§æ–¹å¼æ˜¯åŸºäºäº‹ä»¶çš„å¹¶å‘ã€‚æˆ‘ä»¬ç­‰å¾…æŸäº‹ä»¶å‘ç”Ÿï¼Œå½“å®ƒå‘ç”Ÿæ—¶ï¼Œæ£€æŸ¥äº‹ä»¶ç±»å‹ï¼Œç„¶ååšå°‘é‡çš„ç›¸åº”å·¥ä½œã€‚åŸºäºäº‹ä»¶çš„æœåŠ¡å™¨ï¼šåŸºäºä¸€ä¸ªç®€å•çš„ç»“æ„ï¼ˆäº‹ä»¶å¾ªç¯ï¼‰ï¼Œä¸»å¾ªç¯ç­‰å¾…æŸäº›äº‹ä»¶å‘ç”Ÿï¼Œç„¶åä¾æ¬¡å¤„ç†è¿™äº›å‘ç”Ÿçš„äº‹ä»¶ï¼ˆäº‹ä»¶å¤„ç†ç¨‹åºï¼‰ï¼Œè°ƒåº¦å†³å®šæ¥ä¸‹æ¥å¤„ç†å“ªä¸ªäº‹ä»¶ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è§£å†³å¦‚ä½•æ¥æ”¶äº‹ä»¶ï¼šselect()ã€poll()ã€epoll()ç³»ç»Ÿè°ƒç”¨ï¼Œselect()æ£€æŸ¥I/Oæè¿°ç¬¦é›†åˆï¼Œæè¿°ç¬¦é›†åˆçš„åœ°å€é€šè¿‡readfdsã€writefdså’Œerrorfdsä¼ å…¥ï¼Œåˆ†åˆ«æŸ¥çœ‹å®ƒä»¬ä¸­çš„æŸäº›æè¿°ç¬¦æ˜¯å¦å·²å‡†å¤‡å¥½è¯»å–ï¼Œæ˜¯å¦å‡†å¤‡å¥½å†™å…¥ã€æ˜¯å¦æœ‰å¼‚å¸¸æƒ…å†µå¾…å¤„ç†ã€‚è¿”å›æ‰€æœ‰é›†åˆä¸­å°±ç»ªæè¿°ç¬¦çš„æ€»æ•°ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä½¿ç”¨å•ä¸ªCPUå’ŒåŸºäºäº‹ä»¶çš„åº”ç”¨ç¨‹åºï¼Œå°±ä¸å­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œä½†ä¸èƒ½é˜»å¡åŸºäºäº‹ä»¶çš„æœåŠ¡å™¨ã€‚ä½¿ç”¨åŸºäºçº¿ç¨‹çš„æœåŠ¡å™¨æ—¶ï¼Œä¸€ä¸ªäº‹ä»¶å› ä¸ºI/Oè¯·æ±‚è€Œé˜»å¡ä¸æ˜¯é—®é¢˜ï¼Œå¯ä»¥æŒ‚èµ·è¯¥çº¿ç¨‹è¿è¡Œå…¶ä»–çº¿ç¨‹ï¼›ä½†æ˜¯ä½¿ç”¨åŸºäºäº‹ä»¶çš„æ–¹æ³•æ—¶ï¼Œåªæœ‰ä¸»äº‹ä»¶å¾ªç¯ï¼Œæ„å‘³ç€åœ¨åŸºäºäº‹ä»¶çš„ç³»ç»Ÿä¸­å¿…é¡»éµå®ˆä¸€æ¡è§„åˆ™ï¼šä¸å…è®¸é˜»å¡è°ƒç”¨ã€‚&#xA;å¼‚æ­¥I/Oï¼šä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿå‘å‡ºI/Oè¯·æ±‚ï¼Œå¹¶åœ¨I/Oå®Œæˆä¹‹å‰ç«‹å³å°†æ§åˆ¶æƒè¿”å›ç»™è°ƒç”¨è€…ï¼Œä»¥åŠè®©åº”ç”¨ç¨‹åºç¡®å®šå„ç§I/Oæ˜¯å¦å·²å®Œæˆã€‚AIOæ§åˆ¶å—ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;aiocb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;             &lt;span class=&#34;n&#34;&gt;aio_fildes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ–‡ä»¶æè¿°ç¬¦&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;off_t&lt;/span&gt;            &lt;span class=&#34;n&#34;&gt;aio_offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ–‡ä»¶åç§»é‡&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;volatile&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;aio_buf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å¤åˆ¶è¯»å–å†…å®¹çš„ç›®æ ‡å†…å­˜ä½ç½®&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;size_t&lt;/span&gt;            &lt;span class=&#34;n&#34;&gt;aio_nbytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é•¿åº¦&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;å…ˆå¡«å……ä¸Šè¿°AIOæ§åˆ¶å—ï¼Œå†å‘å‡ºå¼‚æ­¥è°ƒç”¨aio_read()å¼‚æ­¥è¯»å–ã€‚å¦‚ä½•çŸ¥é“I/Oä½•æ—¶å®Œæˆï¼Œå¹¶ä¸”ç¼“å†²åŒºï¼ˆaio_bufæŒ‡å‘çš„ï¼‰ç°åœ¨æœ‰äº†è¯·æ±‚çš„æ•°æ®ï¼Ÿè¿˜éœ€è¦ä¸€ä¸ªaio_error()çš„APIæ¥æ£€æŸ¥aiocbå¼•ç”¨çš„è¯·æ±‚æ˜¯å¦å·²å®Œæˆã€‚å¯¹äºæœªå®Œæˆçš„å¼‚æ­¥I/Oï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡è°ƒç”¨aio_error()æ¥å‘¨æœŸæ€§åœ°è½®è¯¢ç³»ç»Ÿæ¥ç¡®å®šI/Oæ˜¯å¦å®Œæˆã€‚è€Œè¿™ç§åŸºäºè½®è¯¢çš„æ–¹å¼å¾ˆä½æ•ˆï¼Œä¸€äº›ç³»ç»Ÿæä¾›äº†åŸºäºä¸­æ–­çš„æ–¹æ³•ï¼Œä½¿ç”¨UNIXä¿¡å·åœ¨å¼‚æ­¥I/Oå®Œæˆæ—¶é€šçŸ¥åº”ç”¨ç¨‹åºã€‚&#xA;è¿™ç§åŸºäºäº‹ä»¶çš„æ–¹æ³•å­˜åœ¨ä¸€äº›å›°éš¾ï¼š1. éœ€è¦ä¿å­˜å¼‚æ­¥ç¨‹åºçŠ¶æ€ï¼›2. ç°ä»£å¤šæ ¸ç³»ç»Ÿä¸Šä¾æ—§å­˜åœ¨åŒæ­¥é—®é¢˜ï¼›3. ä¸ç°ä»£ç³»ç»Ÿå…¶ä»–æ–¹é¢ï¼ˆä¾‹å¦‚åˆ†é¡µï¼‰é›†æˆæœ‰éš¾åº¦ã€‚&lt;/p&gt;&#xA;&lt;p&gt;çº¿ç¨‹å’Œäº‹ä»¶åœ¨æœªæ¥å¤šå¹´å¯èƒ½ä¼šæŒç»­ä½œä¸ºè§£å†³åŒä¸€å¹¶å‘é—®é¢˜çš„ä¸¤ç§ä¸åŒæ–¹æ³•ã€‚&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;æŒä¹…æ€§&#34;&gt;&lt;span&gt;æŒä¹…æ€§&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%8c%81%e4%b9%85%e6%80%a7&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;ioè®¾å¤‡&#34;&gt;&lt;span&gt;I/Oè®¾å¤‡&lt;/span&gt;&#xA;  &lt;a href=&#34;#io%e8%ae%be%e5%a4%87&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;è®¡ç®—æœºåŸå‹ç³»ç»Ÿçš„æ¶æ„ï¼Œåˆ†å±‚æ¶æ„ï¼ŒCPUå’Œå†…å­˜é€šè¿‡å†…å­˜æ€»çº¿è¿æ¥ï¼Œå›¾åƒæˆ–å…¶ä»–é«˜æ€§èƒ½I/Oè®¾å¤‡é€šè¿‡å¸¸è§„çš„I/Oæ€»çº¿è¿æ¥ï¼Œå¤–å›´å°†æœ€æ…¢çš„è®¾å¤‡è¿æ¥åˆ°ç³»ç»Ÿã€‚ä¸ºä»€ä¹ˆåˆ†å±‚ï¼Ÿç‰©ç†å¸ƒå±€åŠé€ ä»·æˆæœ¬ï¼Œè¶Šå¿«çš„æ€»çº¿è¶ŠçŸ­ï¼Œé€ ä»·è¶Šè´µï¼Œé«˜æ€§èƒ½è®¾å¤‡ç¦»CPUæ›´è¿‘ä¸€äº›ï¼Œä½æ€§èƒ½è®¾å¤‡ç¦»CPUæ›´è¿œä¸€äº›ï¼Œä¸”å¯ä»¥åœ¨å¤–å›´æ€»çº¿ä¸Šè¿æ¥å¤§é‡è®¾å¤‡ã€‚&lt;/p&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/ostep_note_pic/%e8%ae%a1%e7%ae%97%e6%9c%ba%e5%8e%9f%e5%9e%8b%e7%b3%bb%e7%bb%9f%e6%9e%b6%e6%9e%84.png&#34; title=&#34;/ostep_note_pic/è®¡ç®—æœºåŸå‹ç³»ç»Ÿæ¶æ„.png&#34; data-thumbnail=&#34;/ostep_note_pic/è®¡ç®—æœºåŸå‹ç³»ç»Ÿæ¶æ„.png&#34; data-sub-html=&#34;&lt;h2&gt;è®¡ç®—æœºåŸå‹ç³»ç»Ÿæ¶æ„&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/ostep_note_pic/è®¡ç®—æœºåŸå‹ç³»ç»Ÿæ¶æ„.png&#39; alt=&#34;/ostep_note_pic/è®¡ç®—æœºåŸå‹ç³»ç»Ÿæ¶æ„.png&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;è®¡ç®—æœºåŸå‹ç³»ç»Ÿæ¶æ„&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;p&gt;æ ‡å‡†è®¾å¤‡ï¼ˆå‡æƒ³çš„ï¼‰åŒ…å«ï¼š1. æ¥å£ï¼Œå‘ç³»ç»Ÿå±•ç°çš„ç¡¬ä»¶æ¥å£ï¼Œæ‰€æœ‰è®¾å¤‡éƒ½æœ‰è‡ªå·±çš„ç‰¹å®šæ¥å£ä»¥åŠå…¸å‹äº¤äº’çš„åè®®ã€‚2. å†…éƒ¨ç»“æ„ï¼Œå®ç°è®¾å¤‡å±•ç¤ºç»™ç³»ç»Ÿçš„æŠ½è±¡æ¥å£ï¼Œå…¶å®å°±æ˜¯ç¡¬ä»¶è®¾å¤‡ã€‚&lt;/p&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/ostep_note_pic/%e6%a0%87%e5%87%86%e8%ae%be%e5%a4%87.png&#34; title=&#34;/ostep_note_pic/æ ‡å‡†è®¾å¤‡.png&#34; data-thumbnail=&#34;/ostep_note_pic/æ ‡å‡†è®¾å¤‡.png&#34; data-sub-html=&#34;&lt;h2&gt;æ ‡å‡†è®¾å¤‡&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/ostep_note_pic/æ ‡å‡†è®¾å¤‡.png&#39; alt=&#34;/ostep_note_pic/æ ‡å‡†è®¾å¤‡.png&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;æ ‡å‡†è®¾å¤‡&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;p&gt;ä¸€ä¸ªè®¾å¤‡æ¥å£åŒ…å«ä¸‰ä¸ªå¯„å­˜å™¨ï¼š1. çŠ¶æ€å¯„å­˜å™¨ï¼›2. å‘½ä»¤å¯„å­˜å™¨ï¼›3. æ•°æ®å¯„å­˜å™¨ï¼›&lt;/p&gt;&#xA;&lt;p&gt;OSä¸è®¾å¤‡çš„å…¸å‹äº¤äº’åè®®ï¼š1. è½®è¯¢è®¾å¤‡ï¼Œåå¤è¯»å–çŠ¶æ€å¯„å­˜å™¨ï¼Œç­‰å¾…è®¾å¤‡è¿›å…¥å¯ä»¥æ¥æ”¶å‘½ä»¤çš„å°±ç»ªçŠ¶æ€ï¼›2. OSä¸‹å‘æ•°æ®åˆ°æ•°æ®å¯„å­˜å™¨ï¼›3. OSå°†å‘½ä»¤å†™å…¥å‘½ä»¤å¯„å­˜å™¨ï¼Œå¼€å§‹æ‰§è¡Œå‘½ä»¤ï¼›4. OSå†æ¬¡ä¸æ–­è½®è¯¢è®¾å¤‡ï¼Œç­‰å¾…å¹¶åˆ¤æ–­è®¾å¤‡æ˜¯å¦æ‰§è¡Œå®Œæˆå‘½ä»¤ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä¸­æ–­å…è®¸è®¡ç®—ä¸I/Oé‡å ï¼Œè¿™æ˜¯æé«˜CPUåˆ©ç”¨ç‡çš„å…³é”®ã€‚å¦‚æœè®¾å¤‡éå¸¸å¿«ï¼Œä¸­æ–­åè€Œä¼šä½¿ç³»ç»Ÿå˜æ…¢ï¼Œå› ä¸ºè¿›ç¨‹åˆ‡æ¢ä»£ä»·é«˜äºè®¾å¤‡å¤„ç†ä»£ä»·ï¼Œæœ€å¥½çš„åŠæ³•åè€Œæ˜¯è½®è¯¢ã€‚å¦ä¸€ä¸ªæœ€å¥½ä¸è¦ç”¨ä¸­æ–­çš„åœºæ™¯æ˜¯ç½‘ç»œï¼Œç½‘ç»œæ”¶åˆ°çš„æ¯ä¸ªåŒ…éƒ½é€šè¿‡ä¸­æ–­è¿›è¡Œå¤„ç†å¯èƒ½å¯¼è‡´OSå‘ç”Ÿæ´»é”ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä½¿ç”¨DMAè¿›è¡Œé«˜æ•ˆçš„æ•°æ®ä¼ é€ï¼šè¿›ç¨‹éœ€è¦å‘ç£ç›˜å†™ä¸€äº›æ•°æ®ï¼Œè¦å…ˆå°†æ•°æ®ä»å†…å­˜æ‹·è´åˆ°ç£ç›˜ï¼Œæ‹·è´ç»“æŸåï¼Œç£ç›˜çš„I/Oæ“ä½œæ‰å¼€å§‹æ‰§è¡Œï¼ŒCPUæ‰å¯ä»¥å¤„ç†å…¶ä»–è¯·æ±‚ã€‚&lt;/p&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/ostep_note_pic/%e6%b2%a1%e7%94%a8DMA%e7%9a%84%e6%95%b0%e6%8d%ae%e4%bc%a0%e9%80%81.png&#34; title=&#34;/ostep_note_pic/æ²¡ç”¨DMAçš„æ•°æ®ä¼ é€.png&#34; data-thumbnail=&#34;/ostep_note_pic/æ²¡ç”¨DMAçš„æ•°æ®ä¼ é€.png&#34; data-sub-html=&#34;&lt;h2&gt;æ²¡ç”¨DMAçš„æ•°æ®ä¼ é€&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/ostep_note_pic/æ²¡ç”¨DMAçš„æ•°æ®ä¼ é€.png&#39; alt=&#34;/ostep_note_pic/æ²¡ç”¨DMAçš„æ•°æ®ä¼ é€.png&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;æ²¡ç”¨DMAçš„æ•°æ®ä¼ é€&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;p&gt;è¿™ä¸ªå›¾å¾ˆæœ‰æ„æ€çš„å±•ç¤ºäº†ï¼Œcï¼ˆcopyï¼‰æ˜¯å ç”¨CPUæ—¶é—´çš„ï¼Œcopyä¹‹åæ‰å¯ä»¥åˆ‡è¿›ç¨‹é‡å I/Oæ“ä½œï¼Œå³è¿™ä¸ªcopyæ˜¯è¯¥è¿›ç¨‹å¿…é¡»çš„ã€‚è§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨DMAï¼ˆDirect Memory Accessï¼‰ï¼Œç›´æ¥å†…å­˜è®¿é—®ï¼Œæ˜¯ä¸€ä¸ªç‰¹æ®Šè®¾å¤‡ï¼Œå¯ä»¥ä¸éœ€è¦CPUä»‹å…¥å®Œæˆå†…å­˜å’Œè®¾å¤‡é—´çš„æ•°æ®ä¼ é€’ã€‚å…¶å·¥ä½œè¿‡ç¨‹æ˜¯ï¼šOSå‘Šè¯‰DMAæ•°æ®åœ¨å†…å­˜çš„ä½ç½®ï¼Œè¦æ‹·è´çš„å¤§å°åŠç›®çš„åœ°ï¼Œå½“DMAå®Œæˆåä¼šæŠ›å‡ºä¸­æ–­å‘Šè¯‰OSå·²ç»å®Œæˆæ•°æ®ä¼ è¾“ï¼Œå³ï¼š&lt;/p&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/ostep_note_pic/%e4%bd%bf%e7%94%a8DMA%e7%9a%84%e6%95%b0%e6%8d%ae%e4%bc%a0%e9%80%81.png&#34; title=&#34;/ostep_note_pic/ä½¿ç”¨DMAçš„æ•°æ®ä¼ é€.png&#34; data-thumbnail=&#34;/ostep_note_pic/ä½¿ç”¨DMAçš„æ•°æ®ä¼ é€.png&#34; data-sub-html=&#34;&lt;h2&gt;ä½¿ç”¨DMAçš„æ•°æ®ä¼ é€&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/ostep_note_pic/ä½¿ç”¨DMAçš„æ•°æ®ä¼ é€.png&#39; alt=&#34;/ostep_note_pic/ä½¿ç”¨DMAçš„æ•°æ®ä¼ é€.png&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;ä½¿ç”¨DMAçš„æ•°æ®ä¼ é€&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;p&gt;OSå¦‚ä½•ä¸ç¡¬ä»¶é€šä¿¡ï¼Ÿ1. ç”¨æ˜ç¡®çš„I/OæŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤è§„å®šäº†OSå°†æ•°æ®å‘é€åˆ°ç‰¹å®šè®¾å¤‡å¯„å­˜å™¨çš„æ–¹æ³•ï¼›2. å†…å­˜æ˜ å°„I/Oï¼Œç¡¬ä»¶å°†è®¾å¤‡å¯„å­˜å™¨ä½œä¸ºå†…å­˜åœ°å€ã€‚å½“éœ€è¦è®¿é—®è®¾å¤‡æ—¶ï¼ŒOSè£…è½½æˆ–å­˜å…¥åˆ°è¯¥å†…å­˜åœ°å€ï¼Œç„¶åç¡¬ä»¶ä¼šå°†è£…è½½æˆ–å­˜å…¥è½¬ç§»åˆ°è®¾å¤‡ä¸Šï¼Œè€Œä¸æ˜¯ç‰©ç†å†…å­˜ã€‚è¿™ä¸¤ç§æ–¹æ³•ä»Šå¤©éƒ½åœ¨ç”¨ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è®¾å¤‡é©±åŠ¨ç¨‹åºï¼šæ¯ä¸ªè®¾å¤‡éƒ½æœ‰å…·ä½“çš„æ¥å£ï¼Œéœ€è¦å°†ä»–ä»¬çº³å…¥åˆ°OSä¸­ã€‚æˆ‘ä»¬å¸Œæœ›æ„å»ºå°½å¯èƒ½é€šç”¨çš„OSï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥å·¥ä½œåœ¨å„ç§ç¡¬ç›˜è®¾å¤‡ä¹‹ä¸Šä¸”å¸Œæœ›æ–‡ä»¶ç³»ç»Ÿä¸éœ€è¦æ¸…æ¥šè¯»å†™è¯·æ±‚çš„å…¨éƒ¨ç»†èŠ‚ã€‚è¿™å°±è¦ç”¨åˆ°æŠ½è±¡æŠ€æœ¯ï¼Œåœ¨åº•å±‚è®¾å¤‡OSçš„éƒ¨åˆ†è½¯ä»¶ç§°ä¸ºé©±åŠ¨ç¨‹åºï¼Œå°†æ‰€æœ‰è®¾å¤‡äº¤äº’çš„ç»†èŠ‚è¿›è¡Œäº†å°è£…ã€‚&lt;/p&gt;&#xA;&lt;p&gt;æ–‡ä»¶ç³»ç»Ÿå®Œå…¨ä¸çŸ¥é“å®ƒä½¿ç”¨çš„ä»€ä¹ˆç±»å‹ç£ç›˜ï¼Œåªéœ€è¦ç®€å•åœ°å‘é€šç”¨å—è®¾å¤‡å±‚å‘é€è¯»å†™è¯·æ±‚å³å¯ï¼Œå—è®¾å¤‡å±‚ä¼šè®²è¿™äº›è¯·æ±‚è·¯ç”±åˆ°å¯¹åº”çš„è®¾å¤‡é©±åŠ¨ï¼Œç„¶åè®¾å¤‡é©±åŠ¨å®ŒæˆçœŸæ­£çš„åº•å±‚æ“ä½œã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;æ–‡ä»¶å’Œç›®å½•&#34;&gt;&lt;span&gt;æ–‡ä»¶å’Œç›®å½•&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%96%87%e4%bb%b6%e5%92%8c%e7%9b%ae%e5%bd%95&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;å­˜å‚¨è™šæ‹ŸåŒ–å½¢æˆäº†ä¸¤ä¸ªå…³é”®çš„æŠ½è±¡ï¼š1. æ–‡ä»¶ï¼Œæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªçº¿æ€§å­—èŠ‚æ•°ç»„ï¼Œæ¯ä¸ªå­—èŠ‚éƒ½å¯ä»¥è¯»å–æˆ–å†™å…¥ã€‚æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰æŸç§ä½çº§åç§°ï¼Œé€šå¸¸æ˜¯æ•°å­—ï¼Œç”¨æˆ·ä¸çŸ¥é“è¿™ä¸ªæ•°å­—ï¼Œç§°ä¸ºinodeã€‚2. ç›®å½•ï¼Œä¹Ÿæœ‰ä¸€ä¸ªä½çº§åå­—ï¼ˆå³inodeï¼‰ï¼Œä½†æ˜¯å®ƒçš„å†…å®¹éå¸¸å…·ä½“ï¼šåŒ…å«ä¸€ä¸ªï¼ˆç”¨æˆ·å¯è¯»åå­—ï¼Œä½çº§åå­—ï¼‰å¯¹çš„åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œå‡è®¾å­˜åœ¨inodeä¸ºâ€œ10â€çš„æ–‡ä»¶ï¼Œå®ƒçš„å¯è¯»ç”¨æˆ·åç§°ä¸ºâ€œfooâ€ï¼Œâ€œfooâ€æ‰€åœ¨çš„ç›®å½•å› æ­¤ä¼šæœ‰æ¡ç›®ï¼ˆâ€œfooâ€ï¼Œâ€œ10â€ï¼‰ï¼Œç›®å½•ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½æŒ‡å‘æ–‡ä»¶æˆ–å…¶ä»–ç›®å½•ã€‚é€šè¿‡å°†ç›®å½•æ”¾åˆ°å…¶ä»–ç›®å½•ä¸­ï¼Œç”¨æˆ·å¯ä»¥æ„å»ºä»»æ„çš„ç›®å½•æ ‘ï¼Œåœ¨è¯¥ç›®å½•æ ‘ä¸‹å­˜å‚¨æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œç›®å½•ç»“æ„ä»æ ¹ç›®å½•ï¼ˆâ€œ/â€ï¼‰å¼€å§‹ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åˆ›å»ºæ–‡ä»¶ï¼šé€šè¿‡openç³»ç»Ÿè°ƒç”¨ï¼Œè°ƒç”¨open()ï¼Œå¹¶ä¼ å…¥O_CREATæ ‡å¿—ï¼Œç¨‹åºå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚openè¿”å›å€¼æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œæ¯ä¸ªè¿›ç¨‹ç§æœ‰ã€‚ä¸€æ—¦ä¸€ä¸ªæ–‡ä»¶è¢«openï¼Œä½ å°±å¯ä»¥ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦æ¥è¯»å–æˆ–å†™å…¥æ–‡ä»¶ï¼›æˆ–è€…å°†å…¶ä½œä¸ºæŒ‡å‘æ–‡ä»¶ç±»å‹å¯¹è±¡çš„æŒ‡é’ˆã€‚ä¸€æ—¦æœ‰äº†æ–‡ä»¶æè¿°ç¬¦å°±å¯ä»¥è°ƒç”¨read()å’Œwrite()æ¥è®¿é—®æ–‡ä»¶ã€‚&lt;/p&gt;&#xA;&lt;p&gt;catç³»ç»Ÿè°ƒç”¨æ˜¯æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œå®ƒæ˜¯å¦‚ä½•åšåˆ°çš„ï¼Ÿä½¿ç”¨straceå·¥å…·ï¼Œå¯ä»¥è·Ÿè¸ªç¨‹åºåœ¨è¿è¡Œæ—¶æ‰€åšçš„æ¯ä¸ªç³»ç»Ÿè°ƒç”¨ã€‚&lt;/p&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/ostep_note_pic/strace_cat.png&#34; title=&#34;/ostep_note_pic/strace_cat.png&#34; data-thumbnail=&#34;/ostep_note_pic/strace_cat.png&#34; data-sub-html=&#34;&lt;h2&gt;strace cat&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/ostep_note_pic/strace_cat.png&#39; alt=&#34;/ostep_note_pic/strace_cat.png&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;strace cat&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;æ‰“å¼€fooæ–‡ä»¶ï¼Œä»¥åªè¯»çš„å½¢å¼ï¼Œè¿”å›æ–‡ä»¶æè¿°ç¬¦3ï¼ˆ0ï¼šæ ‡å‡†è¾“å…¥ï¼›1ï¼šæ ‡å‡†è¾“å‡ºï¼›2ï¼šæ ‡å‡†é”™è¯¯ï¼›ç¬¬ä¸€æ¬¡æ‰“å¼€å¦ä¸€ä¸ªæ–‡ä»¶æ—¶å‡ ä¹è‚¯å®šæ˜¯æ–‡ä»¶æè¿°ç¬¦3ï¼‰&lt;/li&gt;&#xA;&lt;li&gt;readç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œç¬¬äºŒä¸ªå‚æ•°æŒ‡å‘ä¸€ä¸ªç”¨äºæ”¾readç»“æœçš„ç¼“å†²åŒºï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ç¼“å†²åŒºçš„å¤§å°&lt;/li&gt;&#xA;&lt;li&gt;writeå°†ç¼“å†²åŒºçš„ç»“æœå†™å…¥åˆ°æ–‡ä»¶æè¿°ç¬¦1å¯¹åº”çš„è¾“å‡ºä¸­&lt;/li&gt;&#xA;&lt;li&gt;ç»§ç»­è¯•å›¾readæ›´å¤šçš„å†…å®¹ï¼Œä½†æ²¡æœ‰å‰©ä½™å­—èŠ‚å¯è¯»ï¼Œè¿”å›0&lt;/li&gt;&#xA;&lt;li&gt;ç¨‹åºè°ƒç”¨close()ï¼Œä¼ å…¥å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå…³é—­å¯¹åº”çš„æ–‡ä»¶&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;ä½¿ç”¨lseek()ç³»ç»Ÿè°ƒç”¨èƒ½è¯»å–æˆ–å†™å…¥æ–‡ä»¶ä¸­ç‰¹å®šåç§»é‡çš„æ•°æ®ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å½“ç¨‹åºè°ƒç”¨write()æ—¶ä¸æ˜¯ç«‹å³å†™å…¥åˆ°ç£ç›˜ï¼Œè€Œæ˜¯æ–‡ä»¶ç³»ç»Ÿå°†è¿™äº›å†™å…¥åœ¨å†…å­˜ä¸­ç¼“å†²åŒºï¼ˆbufferï¼‰ä¸€æ®µæ—¶é—´ï¼Œä¹‹åå†™å…¥åˆ°å­˜å‚¨è®¾å¤‡ã€‚ä½†å¯èƒ½å°±åœ¨write()è°ƒç”¨ä¹‹åï¼Œå†™å…¥åˆ°å­˜å‚¨è®¾å¤‡ä¹‹å‰ï¼Œè®¾å¤‡å‘ç”Ÿå´©æºƒï¼Œæ•°æ®ä¼šä¸¢å¤±ã€‚å¯¹äºæ•°æ®åº“ç®¡ç†ç³»ç»Ÿéœ€è¦ä¿è¯è¿™äº›æ•°æ®èƒ½å¼ºåˆ¶å†™å…¥ç£ç›˜ï¼Œåœ¨UNIXä¸­æä¾›äº†fsync(int fd)ç³»ç»Ÿè°ƒç”¨ï¼Œæ–‡ä»¶ç³»ç»Ÿå°†æŠŠæ‰€æœ‰è„æ•°æ®ï¼ˆä¸Šè¿°åœ¨å†…å­˜ç¼“å†²åŒºçš„æ•°æ®ï¼‰å¼ºåˆ¶å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œè€Œä¸ç­‰å¾…ï¼Œä¸€æ—¦fsync()è¿”å›ï¼Œåº”ç”¨ç¨‹åºå°±çŸ¥é“æ•°æ®å·²è¢«ä¿å­˜äº†ã€‚&lt;/p&gt;&#xA;&lt;p&gt;æ–‡ä»¶å…ƒæ•°æ®ï¼šæ–‡ä»¶ç³»ç»Ÿä¿å­˜çš„æ¯ä¸ªæ–‡ä»¶çš„ä¿¡æ¯ã€‚å¯ä»¥ä½¿ç”¨stat()æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œè¯¥ç³»ç»Ÿè°ƒç”¨å°†è·¯å¾„åæ·»åŠ åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶å¡«å……ä¸€ä¸ªstatç»“æ„ï¼ŒåŒ…æ‹¬å¤§å°ã€inodeå·ã€è®¾å¤‡idç­‰ä¿¡æ¯ã€‚æ–‡ä»¶ç³»ç»Ÿä¼šå°†è¿™ç§ç±»å‹çš„ä¿¡æ¯ä¿å­˜åœ¨ä¸€ä¸ªåä¸ºinodeçš„ç»“æ„ä¸­ï¼Œå¯ä»¥å°†å…¶çœ‹ä½œæ˜¯ç”±æ–‡ä»¶ç³»ç»Ÿä¿å­˜çš„æŒä¹…æ•°æ®ç»“æ„ã€‚&#xA;mvæ–‡ä»¶é‡å‘½åï¼Œä½¿ç”¨äº†rename()ï¼›rmåˆ é™¤æ–‡ä»¶ï¼Œä½¿ç”¨äº†unlink()ã€‚rm *åˆ é™¤å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶ï¼Œè‹¥ä¹Ÿåˆ é™¤ç›®å½•ï¼šrm -rf *é€’å½’æ–¹å¼è¿›å…¥æ¯ä¸ªç›®å½•å¹¶åˆ é™¤å…¶å†…å®¹ã€‚&lt;/p&gt;&#xA;&lt;p&gt;mkdiråˆ›å»ºç›®å½•ï¼Œåˆ›å»ºçš„ç›®å½•æ˜¯â€œç©ºçš„â€ï¼Œæœ‰ä¸¤ä¸ªæ¡ç›®ï¼šä¸€ä¸ªå¼•ç”¨è‡ªèº«çš„æ¡ç›®ï¼ˆâ€œ.â€ï¼‰ï¼Œä¸€ä¸ªå¼•ç”¨å…¶çˆ¶ç›®å½•çš„æ¡ç›®ï¼ˆâ€œ..â€ï¼‰ã€‚lsè¯»å–ç›®å½•ï¼Œä½¿ç”¨opendir()ã€readdir()å’Œclosedir()ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨æ‰“å°ç›®å½•ä¸­æ¯ä¸ªæ–‡ä»¶çš„åç§°å’Œinodeç¼–å·ã€‚rmdiråˆ é™¤ç›®å½•ï¼Œè¦æ±‚è¯¥ç›®å½•åœ¨è¢«åˆ é™¤ä¹‹å‰æ˜¯ç©ºçš„ï¼ˆåªæœ‰â€œ.â€å’Œâ€œ..â€ï¼‰ï¼Œè¯•å›¾åˆ é™¤ä¸€ä¸ªéç©ºç›®å½•ï¼Œå¯¹rmdir()çš„è°ƒç”¨å°±ä¼šå¤±è´¥ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç¡¬é“¾æ¥ï¼šln file file2ï¼Œå°†ä¸€ä¸ªæ–°çš„æ–‡ä»¶åâ€œé“¾æ¥â€åˆ°ä¸€ä¸ªæ—§çš„æ–‡ä»¶åæ—¶ï¼Œå®é™…ä¸Šåˆ›å»ºäº†å¦ä¸€ç§å¼•ç”¨åŒä¸€ä¸ªæ–‡ä»¶çš„æ–¹æ³•ã€‚linkåœ¨è¦åˆ›å»ºé“¾æ¥çš„ç›®å½•ä¸­åˆ›å»ºäº†å¦ä¸€ä¸ªåç§°ï¼Œå¹¶å°†å…¶æŒ‡å‘åŸæœ‰æ–‡ä»¶çš„ç›¸åŒinodeå·ã€‚å…¶å®å°±æ˜¯ä¸¤ä¸ªæ–‡ä»¶æŒ‡å‘äº†ä¸€ä¸ªinodeå·ï¼Œå¯¹åŒä¸€ä¸ªinodeçš„å¼•ç”¨ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åˆ›å»ºæ–‡ä»¶æ—¶å®é™…åšäº†ä¸¤ä»¶äº‹ï¼š1. åˆ›å»ºä¸€ä¸ªç»“æ„inodeï¼Œè·Ÿè¸ªå‡ ä¹æ‰€æœ‰å…³äºæ–‡ä»¶çš„ä¿¡æ¯ï¼ˆå¤§å°ã€æ–‡ä»¶å—åœ¨ç£ç›˜ä¸Šçš„ä½ç½®ç­‰ï¼‰ã€‚2. å°†æˆ‘ä»¬å¯è¯»çš„åç§°é“¾æ¥åˆ°è¯¥æ–‡ä»¶å¹¶æ”¾åˆ°ç›®å½•ä¸­ã€‚&lt;/p&gt;&#xA;&lt;p&gt;unlink()å°±æ˜¯åˆ é™¤æ–‡ä»¶ååˆ°inodeçš„é“¾æ¥ï¼Œä¸ä¸€å®šçœŸæ­£åˆ é™¤inodeå¯¹åº”çš„æ–‡ä»¶ï¼Œæ–‡ä»¶ç³»ç»Ÿä¼šæ£€æŸ¥inodeå·ä¸­çš„å¼•ç”¨è®¡æ•°ï¼Œåªæœ‰å½“å¼•ç”¨è®¡æ•°ä¸ºé›¶ï¼ˆæ²¡æœ‰å¯¹åº”çš„é“¾æ¥äº†ï¼‰æ‰ä¼šé‡Šæ”¾inodeå’Œç›¸å…³çš„æ•°æ®å—ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç¬¦å·é“¾æ¥ï¼šç¡¬é“¾æ¥å­˜åœ¨å±€é™ï¼Œå³ä¸èƒ½åˆ›å»ºç›®å½•çš„ç¡¬é“¾æ¥ï¼ˆå¯èƒ½ä¼šåœ¨ç›®å½•æ ‘ä¸­åˆ›å»ºä¸€ä¸ªç¯ï¼‰ï¼›ä¸èƒ½ç¡¬é“¾æ¥åˆ°å…¶ä»–ç£ç›˜åˆ†åŒºçš„æ–‡ä»¶ï¼ˆinodeå·åœ¨ç‰¹å®šæ–‡ä»¶ç³»ç»Ÿæ˜¯å”¯ä¸€çš„ï¼‰ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ln -s file file2åˆ›å»ºè½¯é“¾æ¥ï¼Œè½¯é“¾æ¥æ˜¯åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æ˜¯æŒ‡å‘æ–‡ä»¶çš„è·¯å¾„åã€‚é‚£è¿™æ ·å¯èƒ½ä¼šäº§ç”Ÿæ‚¬ç©ºå¼•ç”¨ï¼Œå³åˆ é™¤çœŸæ­£æŒ‡å‘çš„æ–‡ä»¶åï¼Œåˆ›å»ºçš„è½¯è¿æ¥å°†æŒ‡å‘ä¸å­˜åœ¨çš„è·¯å¾„ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¦‚ä½•ä»è®¸å¤šåº•å±‚æ–‡ä»¶ç³»ç»Ÿç»„å»ºå®Œæ•´çš„ç›®å½•æ ‘ï¼Ÿå…ˆåˆ¶ä½œæ–‡ä»¶ç³»ç»Ÿï¼Œç„¶åæŒ‚è½½å®ƒä»¬ï¼Œä½¿å…¶å†…å®¹å¯ä»¥è®¿é—®ã€‚å¤§å¤šæ•°æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨mkfsåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½œä¸ºè¾“å…¥ï¼Œä¸ºè¯¥å·¥å…·æä¾›ä¸€ä¸ªè®¾å¤‡ï¼ˆä¾‹å¦‚ç£ç›˜åˆ†åŒºï¼Œ/dev/sda1ï¼‰ï¼Œä¸€ç§æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼ˆä¾‹å¦‚ext3ï¼‰ï¼Œå°±åœ¨è¯¥ç£ç›˜åˆ†åŒºä¸Šå†™å…¥ä¸€ä¸ªç©ºæ–‡ä»¶ç³»ç»Ÿï¼Œä»æ ¹ç›®å½•å¼€å§‹ã€‚ç„¶åè¿˜éœ€è¦é€šè¿‡mountæŒ‚è½½åˆ°æ–‡ä»¶ç³»ç»Ÿæ ‘ä¸­è¿›è¡Œè®¿é—®ï¼Œæœ¬è´¨ä¸Šæ˜¯å°†æ–°å»ºçš„æ–‡ä»¶ç³»ç»Ÿç²˜è´´åˆ°ç›®å½•æ ‘çš„æŒ‚è½½ç‚¹ä¸Šã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mount -t ext3 /dev/sda1 /home/users&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;å°†è®¾å¤‡/dev/sda1åˆ›å»ºçš„æ–‡ä»¶ç³»ç»Ÿext3æŒ‚è½½åˆ°/home/usersæŒ‚è½½ç‚¹ä¸Šï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡/home/usersè®¿é—®åŸæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶äº†ã€‚mountçš„ç¾å¦™ä¹‹å¤„åœ¨äºï¼šå®ƒå°†æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿç»Ÿä¸€åˆ°ä¸€æ£µæ ‘ä¸­ï¼Œè€Œä¸æ˜¯æ‹¥æœ‰å¤šä¸ªç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå‘½åç»Ÿä¸€ä¸”æ–¹ä¾¿ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;æ–‡ä»¶ç³»ç»Ÿå®ç°&#34;&gt;&lt;span&gt;æ–‡ä»¶ç³»ç»Ÿå®ç°&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e5%ae%9e%e7%8e%b0&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®ç»“æ„ï¼šåœ¨ç£ç›˜ä¸Šä½¿ç”¨å“ªäº›ç±»å‹çš„ç»“æ„æ¥ç»„ç»‡å…¶æ•°æ®å’Œå…ƒæ•°æ®ï¼Ÿ&lt;/p&gt;&#xA;&lt;p&gt;æ–‡ä»¶ç»„ç»‡ï¼šå°†ç£ç›˜åˆ†å—ï¼ˆç±»ä¼¼å†…å­˜åˆ†é¡µï¼‰ï¼Œæ¯ä¸€å—å¤§å°4KBï¼Œå¦‚ä¸€å—ç£ç›˜åˆ’åˆ†äº†64ä¸ªå—ï¼Œå56ä¸ªå­˜çš„æ˜¯ç”¨æˆ·æ•°æ®ï¼Œç§°ä¸ºæ•°æ®åŒºåŸŸã€‚å†æŠŠå…¶ä¸­5ä¸ªå—ç”¨äºinodeã€‚è¿˜éœ€è¦è®°å½•è¿™äº›inodeå—å’Œæ•°æ®å—æ˜¯ç©ºé—²è¿˜æ˜¯å·²åˆ†é…ï¼Œå¯ä»¥ä½¿ç”¨ä½å›¾ï¼Œä¸€ä¸ªä½å›¾å—ç”¨äºè¡¨ç¤ºinodeï¼Œä¸€ä¸ªä½å›¾å—ç”¨äºè¡¨ç¤ºæ•°æ®å—ã€‚è¿˜æœ‰ä¸€ä¸ªå—æ˜¯è¶…çº§å—ï¼ŒåŒ…å«å…³äºè¯¥ç‰¹å®šæ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯¥æ–‡ä»¶ç³»ç»Ÿæœ‰å¤šå°‘ä¸ªinodeå’Œæ•°æ®å—ã€inodeè¡¨çš„å¼€å§‹ä½ç½®ç­‰ç­‰ï¼Œå› æ­¤åœ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæ—¶ä¼šOSå…ˆè¯»å–è¶…çº§å—ï¼Œåˆå§‹åŒ–å„ç§å‚æ•°ï¼Œç„¶åå°†è¯¥å·æ·»åŠ åˆ°æ–‡ä»¶ç³»ç»Ÿæ ‘ä¸­ã€‚è¯»å–inodeå·32æ—¶ï¼Œä¼šè®¡ç®—inodeåŒºåŸŸçš„åç§»é‡ï¼ˆ32 * inodeçš„å¤§å°ï¼‰ï¼Œå†åŠ ä¸Šinodeè¡¨çš„èµ·å§‹åœ°å€ï¼Œä»è€Œå¾—åˆ°inodeå—çš„æ­£ç¡®å­—èŠ‚åœ°å€ã€‚åœ¨æ¯ä¸ªinodeä¸­ï¼Œå­˜çš„æ˜¯å…ƒæ•°æ®ï¼Œå…³äºæ–‡ä»¶çš„ä¿¡æ¯ï¼ˆæ–‡ä»¶ç±»å‹ã€å¤§å°ã€åˆ†é…çš„å—æ•°ç­‰ï¼‰ï¼Œåœ¨inodeä¸­æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç›´æ¥æŒ‡é’ˆï¼Œæ¯ä¸ªæŒ‡é’ˆæŒ‡å‘å±äºè¯¥æ–‡ä»¶çš„ä¸€ä¸ªç£ç›˜å—ï¼ˆæ•°æ®å—ï¼‰ã€‚é‚£ä¹ˆå¦‚æœä¸€ä¸ªæ–‡ä»¶å¾ˆå¤§ï¼Œå°±éœ€è¦å¾ˆå¤šæŒ‡é’ˆï¼Œè€Œè¶…å‡ºinodeå—èƒ½å­˜æ”¾çš„æŒ‡é’ˆæ•°ï¼Œå°±ä¸è¡Œäº†ã€‚é—´æ¥æŒ‡é’ˆï¼šä¸ç›´æ¥æŒ‡å‘æ•°æ®å—ï¼Œè€Œæ˜¯æŒ‡å‘åŒ…å«æ›´å¤šæŒ‡é’ˆçš„å—ã€‚å› æ­¤ï¼Œinodeå¯ä»¥æœ‰ä¸€äº›å›ºå®šæ•°é‡çš„ç›´æ¥æŒ‡é’ˆå’Œä¸€ä¸ªé—´æ¥æŒ‡é’ˆã€‚å¦‚æœæ–‡ä»¶å˜å¾—è¶³å¤Ÿå¤§ï¼Œå°±ä¼šåˆ†é…ä¸€ä¸ªé—´æ¥å—ï¼ˆæ•°æ®å—åŒºåŸŸï¼‰ï¼Œå‡è®¾ä¸€ä¸ªå—æ˜¯4KBï¼Œç£ç›˜åœ°å€æ˜¯4å­—èŠ‚ï¼Œé‚£å°±å¢åŠ äº†1024ä¸ªæŒ‡é’ˆï¼Œæ–‡ä»¶å¯ä»¥æœ‰13 * 4KBå¢é•¿åˆ°ï¼ˆ12 + 1024ï¼‰* 4KB = 4144KBã€‚æƒ³è¦æ”¯æŒæ›´å¤§çš„æ–‡ä»¶ï¼ŒåŒé‡é—´æ¥æŒ‡é’ˆï¼Œæ‰€æŒ‡å‘çš„é—´æ¥å—çš„æŒ‡é’ˆå†å»æŒ‡å‘é—´æ¥å—ï¼Œè¿™æ ·å°±æ˜¯ï¼ˆ12 + 1024 + 1024 * 1024ï¼‰* 4KBï¼Œè¿™ç§ä¸å¹³è¡¡æ ‘ç§°ä¸ºæŒ‡å‘æ–‡ä»¶å—çš„å¤šçº§ç´¢å¼•ã€‚è®¸å¤šæ–‡ä»¶ç³»ç»Ÿéƒ½ä½¿ç”¨äº†å¤šçº§ç´¢å¼•ã€‚&lt;/p&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/ostep_note_pic/%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%bb%84%e7%bb%87.png&#34; title=&#34;/ostep_note_pic/æ–‡ä»¶ç³»ç»Ÿç»„ç»‡.png&#34; data-thumbnail=&#34;/ostep_note_pic/æ–‡ä»¶ç³»ç»Ÿç»„ç»‡.png&#34; data-sub-html=&#34;&lt;h2&gt;æ–‡ä»¶ç³»ç»Ÿç»„ç»‡&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/ostep_note_pic/æ–‡ä»¶ç³»ç»Ÿç»„ç»‡.png&#39; alt=&#34;/ostep_note_pic/æ–‡ä»¶ç³»ç»Ÿç»„ç»‡.png&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;æ–‡ä»¶ç³»ç»Ÿç»„ç»‡&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;p&gt;ç›®å½•ç»„ç»‡ï¼šç›®å½•åŒ…å«ä¸€ä¸ªäºŒå…ƒç»„ï¼ˆæ¡ç›®åç§°ï¼Œinodeå·ï¼‰çš„åˆ—è¡¨ã€‚æ–‡ä»¶ç³»ç»Ÿå°†ç›®å½•è§†ä¸ºç‰¹æ®Šç±»å‹çš„æ–‡ä»¶ï¼Œå› æ­¤ï¼Œç›®å½•æœ‰ä¸€ä¸ªinodeï¼Œä½äºinodeå—çš„æŸå¤„ï¼Œæ‰€ä»¥ä¸Šè¿°ç£ç›˜ç»“æ„ä¸å˜ã€‚æ¯ä¸ªæ¡ç›®æœ‰ä¸€ä¸ªinodeå·ã€è®°å½•é•¿åº¦ã€å­—ç¬¦ä¸²é•¿åº¦ã€æ¡ç›®åç§°ã€‚&lt;/p&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/ostep_note_pic/%e7%9b%ae%e5%bd%95%e7%bb%84%e7%bb%87.png&#34; title=&#34;/ostep_note_pic/ç›®å½•ç»„ç»‡.png&#34; data-thumbnail=&#34;/ostep_note_pic/ç›®å½•ç»„ç»‡.png&#34; data-sub-html=&#34;&lt;h2&gt;ç›®å½•ç»„ç»‡&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/ostep_note_pic/ç›®å½•ç»„ç»‡.png&#39; alt=&#34;/ostep_note_pic/ç›®å½•ç»„ç»‡.png&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;ç›®å½•ç»„ç»‡&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;p&gt;æ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æ–¹æ³•ï¼šå¦‚ä½•å°†è¿›ç¨‹å‘å‡ºçš„è°ƒç”¨ï¼ˆå¦‚open()ã€read()ã€write()ç­‰ï¼‰æ˜ å°„åˆ°å®ƒçš„ç»“æ„ä¸­ï¼Ÿ&lt;/p&gt;&#xA;&lt;p&gt;ä»ç£ç›˜è¯»å–æ–‡ä»¶ï¼šå‘å‡ºopen(&amp;quot;/foo/bar&amp;quot;, O_RDONLY)è°ƒç”¨æ—¶ï¼Œæ–‡ä»¶ç³»ç»Ÿé¦–å…ˆéœ€è¦æ‰¾åˆ°barçš„inodeï¼Œä»è€Œè·å¾—æ–‡ä»¶çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ã€‚æ–‡ä»¶ç³»ç»Ÿå¿…é¡»éå†è·¯å¾„åï¼Œä»è€Œæ‰¾åˆ°æ‰€éœ€çš„inodeï¼Œæ‰€æœ‰éå†éƒ½ä»æ–‡ä»¶ç³»ç»Ÿçš„æ ¹å¼€å§‹ï¼Œå³æ ¹ç›®å½•â€œ/â€ï¼Œå› æ­¤ç¬¬ä¸€æ¬¡ç£ç›˜è¯»å–æ˜¯æ ¹ç›®å½•çš„inodeï¼Œè¦æ‰¾æ ¹ç›®å½•çš„inodeï¼Œå¿…é¡»åœ¨å…¶çˆ¶ç›®å½•ä¸­æ‰¾ï¼Œä½†æ ¹ç›®å½•æ²¡æœ‰çˆ¶ç›®å½•ï¼Œæ•…æ ¹çš„inodeå·å¿…é¡»æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ï¼Œå¤§å¤šæ•°UNIXæ–‡ä»¶ç³»ç»Ÿï¼Œæ ¹çš„inodeå·æ˜¯2ï¼Œå› æ­¤æ–‡ä»¶ç³»ç»Ÿä¼šå…ˆè¯»å…¥inodeå·ä¸º2çš„å—ã€‚ç„¶åå°±æ˜¯é€’å½’éå†è·¯å¾„åï¼Œæ‰¾æ‰€éœ€çš„inodeå·ï¼Œæœ€åæ‰¾åˆ°barçš„inodeè¯»å…¥å†…å­˜ã€‚ç„¶åæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œæœ€åçš„æƒé™æ£€æŸ¥ï¼Œä¸ºæ­¤è¿›ç¨‹åˆ†é…ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¹¶å°†å®ƒè¿”å›ç»™ç”¨æˆ·ã€‚æ³¨æ„ï¼Œopenå¯¼è‡´çš„I/Oé‡ä¸è·¯å¾„åçš„é•¿åº¦æˆæ­£æ¯”ï¼Œå¯¹äºè·¯å¾„ä¸­æ¯ä¸ªå¢åŠ çš„ç›®å½•ï¼Œéƒ½å¿…é¡»è¯»å–å®ƒçš„inodeåŠå…¶æ•°æ®ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å†™å…¥ç£ç›˜ï¼šå†™å…¥ä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œæ¯æ¬¡å†™å…¥æ“ä½œä¸ä»…éœ€è¦å°†æ•°æ®å†™å…¥ç£ç›˜ï¼Œè¿˜å¿…é¡»å†³å®šå°†å“ªä¸ªå—åˆ†é…ç»™æ–‡ä»¶ï¼Œä»è€Œç›¸åº”åœ°æ›´æ–°ç£ç›˜çš„å…¶ä»–ç»“æ„ã€‚æ¯æ¬¡å†™å…¥æ—¶ï¼Œä¼šæœ‰5ä¸ªI/Oï¼š1. è¯»å–æ•°æ®ä½å›¾ï¼›2. å†™å…¥ä½å›¾ï¼›3. è¯»å–æ•°æ®å—ï¼›4. å†™å…¥inodeï¼›5. å†™å…¥æ•°æ®å—ã€‚å³ä½¿æ˜¯æœ€ç®€å•çš„æ“ä½œï¼Œå¦‚æ‰“å¼€ã€è¯»å–æˆ–å†™å…¥æ–‡ä»¶ï¼Œä¹Ÿä¼šäº§ç”Ÿå¤§é‡I/Oæ“ä½œã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç¼“å­˜å’Œç¼“å†²ï¼šç°ä»£OSé‡‡ç”¨åŠ¨æ€åˆ’åˆ†æ–¹æ³•ï¼Œå°†è™šæ‹Ÿå†…å­˜é¡µé¢å’Œæ–‡ä»¶ç³»ç»Ÿé¡µé¢é›†æˆåˆ°ç»Ÿä¸€é¡µé¢ç¼“å­˜ä¸­ã€‚å¤§å¤šæ•°ç°ä»£æ–‡ä»¶ç³»ç»Ÿå°†å†™å…¥åœ¨å†…å­˜ä¸­ç¼“å†²5-30sï¼Œå¦‚æœç³»ç»Ÿåœ¨æ›´æ–°ä¼ é€’åˆ°ç£ç›˜ä¹‹å‰å´©æºƒï¼Œæ›´æ–°å°±ä¼šä¸¢å¤±ã€‚ä½†æ˜¯ï¼Œå°†å†…å­˜å†™å…¥æ—¶é—´å»¶é•¿ï¼Œåˆ™å¯ä»¥é€šè¿‡æ‰¹å¤„ç†ã€è°ƒåº¦ç”šè‡³é¿å…å†™å…¥ï¼Œæé«˜æ€§èƒ½ã€‚æ•°æ®åº“å°±ä¸èƒ½è¿™æ ·ï¼Œè¦æ±‚å¼ºåˆ¶å†™å…¥ç£ç›˜ï¼Œè°ƒç”¨fsync()ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;å´©æºƒä¸€è‡´æ€§&#34;&gt;&lt;span&gt;å´©æºƒä¸€è‡´æ€§&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%b4%a9%e6%ba%83%e4%b8%80%e8%87%b4%e6%80%a7&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;æ–‡ä»¶ç³»ç»Ÿé¢ä¸´ä¸€ä¸ªä¸»è¦æŒ‘æˆ˜ï¼šå¦‚ä½•åœ¨å‡ºç°æ–­ç”µæˆ–ç³»ç»Ÿå´©æºƒçš„æƒ…å†µä¸‹ï¼Œæ›´æ–°æŒä¹…æ•°æ®ç»“æ„ã€‚æ–‡ä»¶æ›´æ–°æ—¶ï¼Œæ–‡ä»¶ç³»ç»Ÿå¿…é¡»å¯¹ç£ç›˜æ‰§è¡Œ3æ¬¡å•ç‹¬å†™å…¥ï¼Œåˆ†åˆ«é’ˆå¯¹inodeã€ä½å›¾å’Œæ•°æ®å—ã€‚ä½†å½“å‘å‡ºwrite()ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œè¿™äº›å†™æ“ä½œé€šå¸¸ä¸ä¼šç«‹å³å‘ç”Ÿï¼Œä¼šåœ¨å†…å­˜ä¸­å­˜åœ¨ä¸€æ®µæ—¶é—´ï¼Œç„¶åå†™å…¥ï¼Œè¿™å°±å¯èƒ½å‘ç”Ÿå´©æºƒå¯¼è‡´ç£ç›˜æ›´æ–°é”™è¯¯ã€‚è¿™å°±ä¼šäº§ç”Ÿå´©æºƒä¸€è‡´æ€§é—®é¢˜ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è§£å†³æ–¹æ¡ˆ1ï¼šæ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ç¨‹åºfsckï¼Œåœ¨è®¸å¤šé˜¶æ®µè¿è¡Œï¼Œå†³å®šè®©ä¸ä¸€è‡´çš„äº‹æƒ…å‘ç”Ÿï¼Œç„¶åå†ä¿®å¤å®ƒä»¬ï¼ˆé‡å¯æ—¶ï¼‰ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è§£å†³æ–¹æ¡ˆ2ï¼šæœ€æµè¡Œçš„æ–¹æ¡ˆï¼Œä»æ•°æ®å—ç®¡ç†ç³»ç»Ÿå€Ÿé‰´çš„ï¼Œé¢„å†™æ—¥å¿—ã€‚æ›´æ–°ç£ç›˜æ—¶ï¼Œåœ¨è¦†å†™ç»“æ„ä¹‹å‰ï¼Œé¦–å…ˆå†™ä¸‹ä¸€ç‚¹æ³¨è®°ï¼ˆé¢„å†™ï¼‰ï¼ŒæŠŠå®ƒå†™å…¥ä¸€ä¸ªç»“æ„å¹¶ç»„ç»‡æˆæ—¥å¿—ã€‚å¯ä»¥ä¿è¯åœ¨å‘ç”Ÿå´©æºƒæ—¶ï¼Œèƒ½è¿”å›å¹¶æŸ¥çœ‹æ³¨è®°ï¼Œç„¶åé‡è¯•ã€‚å› æ­¤ï¼Œåœ¨å´©æºƒåèƒ½å‡†ç¡®çŸ¥é“è¦ä¿®å¤çš„å†…å®¹ï¼Œè€Œä¸å¿…æ‰«ææ•´ä¸ªç£ç›˜ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;åˆ†å¸ƒå¼ç³»ç»Ÿ&#34;&gt;&lt;span&gt;åˆ†å¸ƒå¼ç³»ç»Ÿ&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;æ•…éšœæ˜¯æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¸å¿ƒæŒ‘æˆ˜ï¼Œé€šè¿‡èšé›†ä¸€ç»„æœºå™¨ï¼Œå¯ä»¥æ„å»ºä¸€ä¸ªçœ‹èµ·æ¥å¾ˆå°‘å¤±è´¥çš„ç³»ç»Ÿï¼Œå°½ç®¡å®ƒçš„ç»„ä»¶ç»å¸¸å‡ºç°æ•…éšœã€‚ç³»ç»Ÿæ€§èƒ½ä¹Ÿå¾ˆå…³é”®ï¼Œå¿…é¡»ç»å¸¸ä»”ç»†è€ƒè™‘å¦‚ä½•ä½¿é€šä¿¡å°½å¯èƒ½é«˜æ•ˆï¼ˆä½å»¶è¿Ÿã€é«˜å¸¦å®½ï¼‰ã€‚å®‰å…¨ä¹Ÿæ˜¯å¿…è¦å› ç´ ï¼Œè¿æ¥åˆ°è¿œç¨‹ç«™ç‚¹æ—¶ï¼Œç¡®ä¿è¿œç¨‹æ–¹æ˜¯ä»–ä»¬å£°ç§°çš„äººï¼Œä»¥åŠç¡®ä¿ç¬¬ä¸‰æ–¹æ— æ³•ç›‘å¬æˆ–æ”¹å˜åŒæ–¹ä¹‹é—´çš„é€šä¿¡ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åˆ†å¸ƒå¼å¦‚ä½•é€šä¿¡ï¼Ÿé€šä¿¡å±‚å¦‚ä½•å¤„ç†æ•…éšœï¼Ÿç°ä»£ç½‘ç»œçš„æ ¸å¿ƒåŸåˆ™æ˜¯ï¼Œé€šä¿¡åŸºæœ¬æ˜¯ä¸å¯é çš„ã€‚ä¸¢åŒ…æ˜¯ç½‘ç»œçš„åŸºæœ¬ç°è±¡ï¼Œæ‰€ä»¥é—®é¢˜å˜æˆå¦‚ä½•å¤„ç†ä¸¢åŒ…ï¼Ÿè¿™é‡Œè®²è¿°äº†UDPå’ŒTCPé€šä¿¡åè®®ï¼ŒåŸºç¡€ç½‘ç»œçŸ¥è¯†ã€‚åœ¨è¿™é‡Œå†æ¬¡è®°å½•ä¸‹TCPæ˜¯å¦‚ä½•å®ç°å¯é ä¼ è¾“çš„ã€‚1. ä½¿ç”¨ackç¡®è®¤æŠ¥æ–‡ï¼Œå‘é€æ–¹å‘é€ç»™æ¥æ”¶æ–¹åï¼Œæ¥æ”¶æ–¹è¦å›ä¸€ä¸ªç¡®è®¤æŠ¥æ–‡ï¼Œå¦‚æœæ¥æ”¶æ–¹æ²¡æ”¶åˆ°ï¼ˆä¸¢å¤±finæŠ¥æ–‡ï¼‰ï¼Œå°±è¦è¶…æ—¶é‡ä¼ ï¼›2. æ¥æ”¶æ–¹çš„ackæŠ¥æ–‡ä¸¢å¤±ï¼Œä¼šå¯¼è‡´å‘é€æ–¹è¶…æ—¶é‡ä¼ ï¼Œåœ¨æ¥æ”¶æ–¹çœ‹æ¥å‘é€æ–¹å‘äº†ä¸¤æ¬¡åŒæ ·çš„finæŠ¥æ–‡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ£€æµ‹è¿™ç§é‡å¤çš„æ¶ˆæ¯ä¼ è¾“ã€‚å‘é€æ–¹å°±è¦åœ¨å‘é€æ—¶ç”Ÿæˆå”¯ä¸€çš„IDï¼Œå°±æ˜¯åˆå§‹åŒ–éšæœºåºåˆ—å·ï¼Œåœ¨ackå›åº”æ—¶å°†åºåˆ—å·åŠ ä¸€ï¼Œä¸”é™„èµ è‡ªå·±çš„éšæœºåºåˆ—å·ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰ï¼Œä¹…é—»å¤§åçš„RPCï¼Œä½†ä¸€ç›´æœªäº†è§£ï¼Œè¿™é‡Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‡ºç°äº†ã€‚OSå¯¹äºæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€æŠ½è±¡ï¼Œæœ‰ä¸€ä¸ªç®€å•çš„ç›®æ ‡ï¼šå®ç°åœ¨è¿œç¨‹æœºå™¨ä¸Šæ‰§è¡Œä»£ç åƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·ç®€å•ç›´æ¥ã€‚RPCç³»ç»Ÿé€šå¸¸æœ‰ä¸¤éƒ¨åˆ†ï¼šå­˜æ ¹ç”Ÿæˆå™¨å’Œè¿è¡Œæ—¶åº“ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å­˜æ ¹ç”Ÿæˆå™¨ï¼šé€šè¿‡è‡ªåŠ¨åŒ–ï¼Œæ¶ˆé™¤å°†å‡½æ•°å‚æ•°å’Œç»“æœæ‰“åŒ…æˆæ¶ˆæ¯çš„ä¸€äº›ç—›è‹¦ã€‚å­˜æ ¹ç”Ÿæˆå™¨æ¥å—æ¥å£ï¼Œå¹¶ç”Ÿæˆä¸€äº›ä¸åŒçš„ä»£ç ç‰‡æ®µã€‚å¯¹äºå®¢æˆ·ç«¯ç”Ÿæˆå®¢æˆ·ç«¯å­˜æ ¹ï¼ŒåŒ…å«æ¥å£ä¸­æŒ‡å®šçš„æ¯ä¸ªå‡½æ•°ï¼Œå¸Œæœ›å®¢æˆ·ç«¯ç¨‹åºé“¾æ¥æ­¤å®¢æˆ·ç«¯å­˜æ ¹ï¼Œè°ƒç”¨å®ƒä»¥è¿›è¡ŒRPCã€‚&lt;/p&gt;&#xA;&lt;p&gt;å®¢æˆ·ç«¯å­˜æ ¹ä¸­çš„ä»£ç æ‰§è¡Œçš„æ“ä½œï¼š&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;åˆ›å»ºæ¶ˆæ¯ç¼“å†²åŒº&lt;/li&gt;&#xA;&lt;li&gt;å°†æ‰€éœ€æ¶ˆæ¯æ‰“åŒ…åˆ°æ¶ˆæ¯ç¼“å†²åŒºä¸­ï¼ˆæ¶ˆæ¯çš„åºåˆ—åŒ–ï¼šå°†è¦è°ƒç”¨å‡½æ•°çš„æŸç§æ ‡è¯†ç¬¦ï¼Œä»¥åŠå‡½æ•°æ‰€éœ€çš„æ‰€æœ‰å‚æ•°æ”¾å…¥å•ä¸ªç¼“å†²åŒºçš„è¿‡ç¨‹ï¼‰&lt;/li&gt;&#xA;&lt;li&gt;å°†æ¶ˆæ¯å‘é€åˆ°ç›®æ ‡RPCæœåŠ¡å™¨&lt;/li&gt;&#xA;&lt;li&gt;ç­‰å¾…å›å¤&lt;/li&gt;&#xA;&lt;li&gt;è§£åŒ…è¿”å›ä»£ç å’Œå…¶ä»–å‚æ•°&lt;/li&gt;&#xA;&lt;li&gt;è¿”å›è°ƒç”¨è€…&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;æœåŠ¡å™¨æ—¶æ‰§è¡Œçš„æ“ä½œï¼š&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;è§£åŒ…æ¶ˆæ¯ï¼ˆååºåˆ—åŒ–ï¼‰&lt;/li&gt;&#xA;&lt;li&gt;è°ƒç”¨å®é™…å‡½æ•°&lt;/li&gt;&#xA;&lt;li&gt;æ‰“åŒ…ç»“æœ&lt;/li&gt;&#xA;&lt;li&gt;å‘é€å›å¤&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;å¦‚æœä¸€ä¸ªRPCè°ƒç”¨é˜»å¡ï¼Œå°±ä¼šæµªè´¹æœåŠ¡å™¨èµ„æºã€‚å¤§å¤šæ•°æœåŠ¡å™¨ä»¥æŸç§å¹¶å‘æ–¹å¼æ„é€ ï¼Œå¸¸è§çš„ç»„ç»‡æ–¹å¼æ˜¯çº¿ç¨‹æ± ã€‚æœåŠ¡å™¨å¯åŠ¨æ—¶ä¼šåˆ›å»ºä¸€ç»„æœ‰é™çš„çº¿ç¨‹ï¼Œæ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œè¢«åˆ†æ´¾ç»™è¿™äº›å·¥ä½œçº¿ç¨‹ä¹‹ä¸€ï¼Œç„¶åæ‰§è¡ŒRPCè°ƒç”¨ï¼Œæœ€ç»ˆå›å¤ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¿è¡Œæ—¶åº“å¤„ç†RPCç³»ç»Ÿä¸­çš„å¤§éƒ¨åˆ†ç¹é‡å·¥ä½œï¼Œå¤„ç†å¤§å¤šæ•°æ€§èƒ½å’Œå¯é æ€§é—®é¢˜ã€‚ä½¿ç”¨IPå’Œç«¯å£å·æ‰¾åˆ°è¿œç¨‹æœåŠ¡å™¨é€šä¿¡çš„åœ°å€ï¼Œä½¿ç”¨ä¸å¯é çš„é€šä¿¡ï¼Œå¦‚UDPæ¥å®ç°æ›´é«˜æ•ˆçš„RPCå±‚ã€‚RPCå±‚é€šè¿‡ä½¿ç”¨è¶…æ—¶é‡ä¼ å’Œç¡®è®¤æ¥å®ç°æ‰€éœ€çš„è´£ä»»çº§åˆ«ï¼Œé€šè¿‡ä½¿ç”¨æŸç§å½¢å¼çš„åºåˆ—ç¼–å·ï¼Œé€šä¿¡å±‚å¯ä»¥ä¿è¯æ¯ä¸ªRPCåªå‘ç”Ÿä¸€æ¬¡ï¼Œæˆ–è€…æœ€å¤šåªå‘ç”Ÿä¸€æ¬¡ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¿è¡Œæ—¶å¿…é¡»å¤„ç†å…·æœ‰å¤§å‚æ•°çš„è¿‡ç¨‹è°ƒç”¨ï¼Œå¤§äºå¯ä»¥æ”¾å…¥å•ä¸ªæ•°æ®åŒ…çš„è¿‡ç¨‹ã€‚ä¸€äº›åº•å±‚çš„ç½‘ç»œåè®®æä¾›è¿™æ ·çš„å‘é€æ–¹åˆ†ç»„å’Œæ¥æ”¶æ–¹é‡ç»„ï¼Œå¦‚æœæ²¡æœ‰ï¼ŒRPCéœ€è¦è‡ªå·±å®ç°è¿™æ ·çš„åŠŸèƒ½ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¿˜éœ€è¦æ”¯æŒåœ¨ä¸åŒå­—èŠ‚åºï¼ˆå¤§ç«¯åºå’Œå°ç«¯åºï¼‰çš„æœºå™¨ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼ŒRPCåœ¨å…¶æ¶ˆæ¯æ ¼å¼ä¸­æä¾›æ˜ç¡®å®šä¹‰çš„å­—èŠ‚åºï¼Œå¦‚æœå‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„è®¡ç®—æœºä¸RPCä¸­å®šä¹‰çš„å­—èŠ‚åºä¸€è‡´ï¼Œå°±ä¼šæŒ‰é¢„æœŸå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼Œå¦‚æœä¸ä¸€è‡´å¿…é¡»è½¬æ¢æ¯æ¡æ¶ˆæ¯ã€‚&lt;/p&gt;</description>
    </item>
    <item>
      <title>spdlogæºç è§£æ</title>
      <link>http://localhost:1313/posts/spdlog-analysis/</link>
      <pubDate>Sun, 22 Jun 2025 17:10:32 +0800</pubDate><author>1022440588@qq.com (UAreFree)</author>
      <guid>http://localhost:1313/posts/spdlog-analysis/</guid>
      <category domain="http://localhost:1313/categories/%E8%BD%AE%E5%AD%90/">è½®å­</category>
      <description>&lt;p&gt;spdlogæ˜¯ä¸€ä¸ªå¿«é€Ÿçš„C++æ—¥å¿—åº“ã€‚ä½¿ç”¨æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œheadr-onlyçš„ç‰ˆæœ¬å’Œç¼–è¯‘ç‰ˆæœ¬ã€‚header-onlyç‰ˆæœ¬åªéœ€è¦æŠŠé¡¹ç›®includeæ–‡ä»¶å¤¹æ”¾åˆ°è‡ªå·±é¡¹ç›®ä¸­å³å¯æ„å»ºï¼Œç”¨èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚å®˜æ–¹ç»™å‡ºçš„ç‰¹ç‚¹ï¼šå¾ˆå¿«ï¼›header-only æˆ–ç¼–è¯‘ç‰ˆæœ¬ï¼›ä½¿ç”¨ fmt åº“å®ç°ä¸°å¯Œçš„æ ¼å¼åŒ–åŠŸèƒ½ï¼›å¼‚æ­¥æ¨¡å¼ï¼›è‡ªå®šä¹‰æ ¼å¼åŒ–ï¼›å¤šçº¿ç¨‹/å•çº¿ç¨‹è®°å½•å™¨ï¼›å¤šç§æ—¥å¿—ç›®æ ‡ï¼›æ—¥å¿—è¿‡æ»¤ï¼›æ”¯æŒä»argvæˆ–ç¯å¢ƒå˜é‡ä¸­åŠ è½½æ—¥å¿—çº§åˆ«ï¼›å›æº¯æ”¯æŒ - å°†è°ƒè¯•æ¶ˆæ¯å­˜å‚¨åœ¨ç¯å½¢ç¼“å†²åŒºä¸­å¹¶æŒ‰éœ€æ˜¾ç¤ºã€‚&lt;/p&gt;&#xA;&lt;p&gt;spdlogæ˜¯ä¸€ä¸ªæ—¥å¿—åº“ï¼Œè°ƒç”¨å…¶æä¾›çš„æ¥å£å®ç°æ—¥å¿—æ‰“å°åŠŸèƒ½ï¼Œå®ƒæœ¬èº«å¼•ç”¨åˆ°äº†fmtåº“ï¼Œfmtæ˜¯æ ¼å¼åŒ–çš„åº“ã€‚åˆçº§çš„æ—¥å¿—æ‰“å°çš„å®šä¹‰æ˜¯ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;spdlog&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Positional args are {1} {0}..&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;too&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;supported&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;ä¸Šè¿°å‡½æ•°é€šè¿‡è°ƒç”¨spdlogå‘½åç©ºé—´çš„infoæ¥å£ï¼Œæ‰“å°ç»“æœï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;2025-09-04 15:49:34.163&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;info&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Positional args are supported too..&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;spdlog&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;set_level&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;spdlog&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬é€šè¿‡spdlog::infoæ¥å£æ¥å‘ä¸‹æ¢ç´¢ï¼Œè¯¥æ¥å£å®šä¹‰åœ¨spdlog.hä¸­ï¼Œè¯´æ˜æ‰€æœ‰æºæ–‡ä»¶åªè¦includeäº†spdlog.hï¼Œå³å¯è°ƒç”¨spdlogåº“æ‰€æä¾›çš„æ¥å£ã€‚è¯¥å‡½æ•°æ˜¯ä¸€ä¸ªæ¨¡ç‰ˆå‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;template&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kr&#34;&gt;inline&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;format_string_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;default_logger_raw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;forward&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)...);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;Args&amp;hellip;æ˜¯å¯å˜å‚æ•°åŒ…ç±»å‹ï¼Œformat_string_t&amp;lt;Args&amp;hellip;&amp;gt; fmtæ˜¯fmtåº“æ¥å£fmt::format_string&amp;lt;Args&amp;hellip;&amp;gt;ï¼ŒArgs &amp;amp;&amp;amp;&amp;hellip;argså°†å¯å˜å‚æ•°åŒ…è½¬ä¸ºå³å€¼ç”¨äºå®Œç¾è½¬å‘ã€‚è¿˜è¦éœ€è¦æ³¨æ„çš„æ˜¯spdlog.hä¸­çš„æ‰€æœ‰å‡½æ•°éƒ½æ˜¯inlineçš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆspdlogèƒ½å®ç°header-onlyçš„åŸå› ã€‚&#xA;default_logger_raw()çš„å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;SPDLOG_INLINE&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;spdlog&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;logger&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;default_logger_raw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;details&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;registry&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;instance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_default_raw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;è¯¥å‡½æ•°ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œä½¿ç”¨staticåˆ›å»ºå…¨å±€å”¯ä¸€registryå®ä¾‹ï¼Œè°ƒç”¨get_default_raw()æ‹¿åˆ°é»˜è®¤loggerã€‚ç„¶åè°ƒç”¨loggerç±»çš„æˆå‘˜å‡½æ•°infoï¼Œè¯¥å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼Œå…¶ä¸­logå‡½æ•°æ˜¯é‡è½½å‡½æ•°ï¼Œæ”¯æŒå¤šç§å‚æ•°ç±»å‹å’Œæ•°é‡ã€‚ä¸è¿‡æœ€ç»ˆéƒ½ä¼šè°ƒç”¨log_it_å‡½æ•°ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;template&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;format_string_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;forward&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)...);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;SPDLOG_INLINE&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;logger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;log_it_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;spdlog&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;details&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;log_msg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;log_msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                   &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;log_enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                   &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;traceback_enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;log_enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;sink_it_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;log_msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;traceback_enabled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;tracer_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;push_back&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;log_msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;log_it_å‡½æ•°ä¸»è¦å°±æ˜¯æ¥æ”¶logå‡½æ•°æ ¹æ®æ—¥å¿—çº§åˆ«åˆ¤æ–­æ˜¯å¦æ—¥å¿—æ‰“å°çš„å‚æ•°ï¼Œè°ƒç”¨sink_it_å‡½æ•°ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;SPDLOG_INLINE&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;logger&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sink_it_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;details&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;log_msg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nl&#34;&gt;sink&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sinks_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sink&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;should_log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;SPDLOG_TRY&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sink&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;SPDLOG_LOGGER_CATCH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;should_flush_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;flush_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;sink_it_å‡½æ•°éå†æ‰€æœ‰sinkï¼Œè°ƒç”¨sinkçš„logå‡½æ•°ã€‚è¿™é‡Œsinks_çš„ç±»å‹æ˜¯std::vector&amp;lt;sink_ptr&amp;gt;ï¼Œå³shared_ptrçš„å®¹å™¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯æŒ‡å‘sinkå¯¹è±¡çš„æ™ºèƒ½æŒ‡é’ˆã€‚è€Œlogæ˜¯è™šå‡½æ•°ï¼Œäº¤ç”±ç»§æ‰¿sinkçš„å­ç±»å¯¹è±¡æ¥å®ç°ï¼Œè¿™é‡Œsink-&amp;gt;log(msg);å¾ˆå¥½çš„å±•ç°äº†å¤šæ€çš„å®ç°æœºåˆ¶ã€‚base_sinkç»§æ‰¿äº†sinkï¼Œä¸”å…¶ä»–sinkç»§æ‰¿äº†base_sinkï¼Œspdlogä¸­å®šä¹‰äº†å¤šç§sinkï¼Œå¦‚daily_file_sinkã€rotating_file_sinkã€stdout_sinksç­‰ï¼Œè¿™äº›sinkå®ç°çš„å¤´æ–‡ä»¶æ”¾åˆ°äº†sinksä¸­ã€‚ä»¥daily_file_sinkä¸ºä¾‹ï¼Œæœ€åå†™æ—¥å¿—çš„å‡½æ•°å®ç°ä¸ºï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;sink_it_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;details&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;log_msg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;override&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;should_rotate&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rotation_tp_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;should_rotate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FileNameCalc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;calc_filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base_filename_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;now_tm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;file_helper_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;truncate_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;rotation_tp_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;next_rotation_tp_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;memory_buf_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;formatted&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;base_sink&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Mutex&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;formatter_&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;formatted&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;file_helper_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;formatted&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Do the cleaning only at the end because it might throw on failure.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;should_rotate&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_files_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;delete_old_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æ ¹æ®msgçš„æ—¶é—´åˆ¤æ–­æ˜¯å¦å¤§äºè½®è½¬æ—¶é—´ï¼Œå¦‚æœå¤§äºå°±è¦æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰“å¼€ã€å†™æ–‡ä»¶æ˜¯é€šè¿‡æŠ½è±¡çš„fileå±‚å®ç°ã€‚å†™æ“ä½œæ˜¯æœ€åè°ƒç”¨stdio.hä¸­æ ‡å‡†åº“POSIXæ¥å£fwrite_unlockedæ¥å®ç°æ–‡ä»¶å†™æ•°æ®ï¼Œè¿™æ˜¯å•çº¿ç¨‹ä¸‹ä¸åŠ é”çš„å®ç°ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;SPDLOG_INLINE&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_helper&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memory_buf_t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fd_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;nullptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;msg_size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;auto&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;details&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fwrite_bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;msg_size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fd_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;throw_spdlog_ex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Failed writing to file &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filename_to_str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filename_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;errno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;extern&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fread_unlocked&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;__restrict&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FILE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;__restrict&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__wur&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;__nonnull&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;extern&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fwrite_unlocked&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;__restrict&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FILE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;__restrict&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;__stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;__nonnull&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šå°±æ˜¯spdlogæä¾›çš„spdlog::infoå®ç°æµç¨‹ï¼Œæ•´ä½“æ¥çœ‹å°±æ˜¯åˆ›å»ºå…¨å±€å”¯ä¸€å•ä¾‹registryï¼Œç„¶ååˆ›å»ºloggerï¼Œloggeræ„é€ æ—¶å¯ä»¥ç»‘å®šsinkè¾“å‡ºæ§½ï¼Œå°†æ—¥å¿—æ¶ˆæ¯ä¼ é€’åˆ°sinkä¸­è°ƒç”¨æ ‡å‡†åº“APIè¿›è¡Œå†™æ—¥å¿—ï¼Œå…¶ä¸­è¿˜ç”¨åˆ°äº†fmtæ ¼å¼åŒ–ã€‚è¿™æ˜¯åœ¨å•çº¿ç¨‹ä¸‹å•ä¸€loggerå•ä¸€sinkçš„æœ€ç®€å•å®ç°ã€‚åœ¨example/example.cppä¸­è¿˜ç»™å‡ºäº†å…¶ä»–ä½¿ç”¨ç¤ºä¾‹ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶å¯ä»¥ç›´æ¥åˆ›å»ºä¸€ä¸ªshared_ptr&lt;logger&gt;ç±»å‹çš„å¯¹è±¡æŒ‡å‘spdlogæ‰€æä¾›çš„sinkï¼Œåˆ›å»ºsinkæ—¶ä¸€èˆ¬æ˜¯åå­—ï¼ˆå­—ç¬¦ä¸²ï¼‰å’Œfilenameç»‘å®šçš„æ–¹å¼ã€‚ä¸€ä¸ªloggeræ˜¯å¯ä»¥å¯¹åº”å¤šä¸ªsinkçš„ï¼Œåœ¨loggerçš„æ„é€ å‡½æ•°ä¸­æä¾›äº†è¿­ä»£å™¨å¤åˆ¶æ„é€ çš„å®ç°ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;template&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typename&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;It&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;logger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;It&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;begin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;It&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;move&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)),&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;sinks_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;begin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æœ¬ç¯‡æ–‡ç« ä»ç¤ºä¾‹å‡ºå‘ï¼Œä¸€å±‚ä¸€å±‚åœ°è§£æäº†spdlogçš„å®ç°ã€‚å…¶å®æ›´æ·±å±‚æ¬¡çš„è§£æåº”è¯¥ä»æ¶æ„å‡ºå‘ï¼Œç»™å‡ºæ•´ä¸ªåº“å®ç°çš„å„ä¸ªæ¨¡å—å…³ç³»ï¼Œè¿™é‡Œå…ˆæŒ–ä¸ªå‘ï¼Œæœ‰æ—¶é—´å†æ¥å¡«ã€‚&lt;/p&gt;</description>
    </item>
    <item>
      <title>é“¾æ¥</title>
      <link>http://localhost:1313/posts/link/</link>
      <pubDate>Sun, 11 May 2025 16:00:06 +0800</pubDate><author>1022440588@qq.com (UAreFree)</author>
      <guid>http://localhost:1313/posts/link/</guid>
      <category domain="http://localhost:1313/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/">è®¡ç®—æœºç³»ç»Ÿ</category>
      <description>&lt;p&gt;é“¾æ¥ï¼šå°†ä»£ç å’Œæ•°æ®æ”¶é›†å¹¶ç»„åˆæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼ŒåŠ è½½åˆ°å†…å­˜ä¸­æ‰§è¡Œã€‚&lt;/p&gt;&#xA;&lt;p&gt;å­¦ä¹ é“¾æ¥å¯ä»¥è§£å†³çš„é—®é¢˜ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;æ„é€ å¤§å‹ç¨‹åºï¼Œé‡åˆ°ç”±äºç¼ºå°‘åº“æ–‡ä»¶æˆ–è€…åº“æ–‡ä»¶ç‰ˆæœ¬ä¸å…¼å®¹è€Œå¯¼è‡´çš„é“¾æ¥é”™è¯¯ã€‚&lt;/li&gt;&#xA;&lt;li&gt;é¿å…ä¸€äº›éš¾ä»¥å‘ç°çš„ç¼–ç¨‹é”™è¯¯ã€‚&lt;/li&gt;&#xA;&lt;li&gt;ç†è§£ç¼–ç¨‹è¯­è¨€ä¸­çš„ä½œç”¨åŸŸè§„åˆ™æ˜¯å¦‚ä½•å®ç°çš„ã€‚&lt;/li&gt;&#xA;&lt;li&gt;ç†è§£é‡è¦çš„ç³»ç»Ÿæ¦‚å¿µã€‚&lt;/li&gt;&#xA;&lt;li&gt;æ›´å¥½çš„åˆ©ç”¨å…±äº«åº“ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åº-gcc&#34;&gt;&lt;span&gt;ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åº GCC&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e7%bc%96%e8%af%91%e5%99%a8%e9%a9%b1%e5%8a%a8%e7%a8%8b%e5%ba%8f-gcc&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;GNU ç¼–è¯‘å™¨é›†åˆ GCC ä¼šè°ƒç”¨è¯­è¨€é¢„å¤„ç†å™¨ã€ç¼–è¯‘å™¨ã€æ±‡ç¼–å™¨å’Œé“¾æ¥å™¨ã€‚&lt;code&gt;gcc -Og -o prog main.c sum.c&lt;/code&gt;è°ƒç”¨gccç¼–è¯‘ï¼Œ-Ogå¯åŠ¨é€‚ä¸­ä¼˜åŒ–ã€-oç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚./progè°ƒç”¨æ“ä½œç³»ç»Ÿä¸­çš„åŠ è½½å™¨å‡½æ•°ï¼Œå°†å¯æ‰§è¡Œæ–‡ä»¶progä¸­çš„ä»£ç å’Œæ•°æ®å¤åˆ¶åˆ°å†…å­˜ï¼Œç„¶åå°†æ§åˆ¶è½¬ç§»åˆ°è¿™ä¸ªç¨‹åºçš„å¼€å¤´ã€‚&lt;/p&gt;&#xA;&lt;p&gt;GNUæ˜¯ä¸€ä¸ªè‡ªç”±è½¯ä»¶é¡¹ç›®ï¼Œæ—¨åœ¨å¼€å‘å®Œå…¨è‡ªç”±çš„æ“ä½œç³»ç»Ÿã€‚GCC æ˜¯ GNU é¡¹ç›®ä¸‹çš„ä¸€ç»„ç¼–è¯‘å·¥å…·çš„é›†åˆã€‚&lt;/p&gt;&#xA;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;å‘½ä»¤&lt;/th&gt;&#xA;          &lt;th&gt;ä½œç”¨&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;gcc -Og -E prog main.c sum.c&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;é¢„å¤„ç†ç”Ÿæˆ &lt;code&gt;.i&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;gcc -Og -S prog main.c sum.c&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;ç¼–è¯‘æˆæ±‡ç¼–æ–‡ä»¶ &lt;code&gt;.s&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;gcc -Og -c prog main.c sum.c&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;æ±‡ç¼–æˆå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ &lt;code&gt;.o&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;gcc -Og -v prog main.c sum.c&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;é“¾æ¥æˆå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ &lt;code&gt;.out&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;ç›®æ ‡æ–‡ä»¶&#34;&gt;&lt;span&gt;ç›®æ ‡æ–‡ä»¶&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e7%9b%ae%e6%a0%87%e6%96%87%e4%bb%b6&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;æ³¨æ„ä¸åªæ˜¯.oæ–‡ä»¶ï¼Œç›®æ ‡æ–‡ä»¶æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼šåŒ…å«äºŒè¿›åˆ¶ä»£ç å’Œæ•°æ®ï¼Œ.oæ–‡ä»¶å¯ä¸å…¶ä»–.oæ–‡ä»¶é“¾æ¥&lt;/li&gt;&#xA;&lt;li&gt;å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ï¼šåŒ…å«äºŒè¿›åˆ¶ä»£ç å’Œæ•°æ®ï¼Œ.outæ–‡ä»¶å¯ç›´æ¥å¤åˆ¶åˆ°å†…å­˜å¹¶æ‰§è¡Œ&lt;/li&gt;&#xA;&lt;li&gt;å…±äº«ç›®æ ‡æ–‡ä»¶ï¼šç‰¹æ®Šçš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼Œå¯ä»¥åœ¨åŠ è½½æˆ–è€…è¿è¡Œæ—¶è¢«åŠ¨æ€åœ°åŠ è½½è¿›å†…å­˜å¹¶é“¾æ¥&#xA;ç›®æ ‡æ–‡ä»¶æ˜¯æŒ‰ç…§ç‰¹å®šçš„æ ¼å¼æ¥ç»„ç»‡çš„ï¼Œå„ä¸ªç³»ç»Ÿçš„ç›®æ ‡æ–‡ä»¶æ ¼å¼éƒ½ä¸ç›¸åŒã€‚ç°ä»£ x86-64 Linux å’Œ Unix ç³»ç»Ÿä½¿ç”¨å¯æ‰§è¡Œå¯é“¾æ¥æ ¼å¼ï¼ˆExecutable and Linkable Formatï¼ŒELFï¼‰ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶&#34;&gt;&lt;span&gt;å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%8f%af%e9%87%8d%e5%ae%9a%e4%bd%8d%e7%9b%ae%e6%a0%87%e6%96%87%e4%bb%b6&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;ELF æ ¼å¼çš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ç”± ELF headerã€Sectionsã€Section header tableç»„æˆã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/link/ELF%e6%96%87%e4%bb%b6%e6%a0%bc%e5%bc%8f.png&#34; title=&#34;/link/ELFæ–‡ä»¶æ ¼å¼.png&#34; data-thumbnail=&#34;/link/ELFæ–‡ä»¶æ ¼å¼.png&#34; data-sub-html=&#34;&lt;h2&gt;ELFæ–‡ä»¶æ ¼å¼&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/link/ELFæ–‡ä»¶æ ¼å¼.png&#39; alt=&#34;/link/ELFæ–‡ä»¶æ ¼å¼.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;ELFæ–‡ä»¶æ ¼å¼&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;elf-header&#34;&gt;&lt;span&gt;ELF header&lt;/span&gt;&#xA;  &lt;a href=&#34;#elf-header&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/link/ELF%e5%a4%b4.png&#34; title=&#34;/link/ELFå¤´.png&#34; data-thumbnail=&#34;/link/ELFå¤´.png&#34; data-sub-html=&#34;&lt;h2&gt;ELFå¤´&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/link/ELFå¤´.png&#39; alt=&#34;/link/ELFå¤´.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;ELFå¤´&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;ELF header çš„é•¿åº¦æ˜¯64ä¸ªå­—èŠ‚ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;sections&#34;&gt;&lt;span&gt;Sections&lt;/span&gt;&#xA;  &lt;a href=&#34;#sections&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;.textï¼šå·²ç¼–è¯‘ç¨‹åºçš„æœºå™¨ä»£ç ã€‚&lt;/p&gt;&#xA;&lt;p&gt;.dataï¼šå·²åˆå§‹åŒ– çš„å…¨å±€å’Œé™æ€å˜é‡ã€‚&lt;/p&gt;&#xA;&lt;p&gt;.bssï¼šæœªåˆå§‹åŒ–çš„å…¨å±€å’Œé™æ€å˜é‡ï¼Œä»¥åŠæ‰€æœ‰è¢« åˆå§‹åŒ–ä¸º0 çš„å…¨å±€æˆ–é™æ€å˜é‡ã€‚åœ¨ç›®æ ‡æ–‡ä»¶ä¸­è¿™ä¸ªèŠ‚ä¸å æ®å®é™…çš„ç©ºé—´ï¼Œå®ƒä»…ä»…æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼ˆbetter save spaceï¼‰ã€‚ç›®æ ‡æ–‡ä»¶æ ¼å¼åŒºåˆ†å·²åˆå§‹åŒ–å’Œæœªåˆå§‹åŒ–å˜é‡æ˜¯ä¸ºäº†ç©ºé—´æ•ˆç‡ï¼šåœ¨ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œæœªåˆå§‹åŒ–å˜é‡ä¸éœ€è¦å æ®ä»»ä½•å®é™…çš„ç£ç›˜ç©ºé—´ã€‚è¿è¡Œ æ—¶ï¼Œåœ¨å†…å­˜ä¸­åˆ†é…è¿™äº›å˜é‡ï¼Œåˆå§‹å€¼ä¸º 0ã€‚COMMONå­˜æ”¾æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ã€‚&lt;/p&gt;&#xA;&lt;p&gt;.rodata:å­˜æ”¾ åªè¯» æ•°æ®ã€‚å¦‚printfä¸­çš„æ ¼å¼ä¸²å’Œswitchè¯­å¥ä¸­çš„è·³è½¬è¡¨ã€‚&lt;/p&gt;&#xA;&lt;p&gt;.symtabï¼šç¬¦å·è¡¨ï¼Œå­˜æ”¾åœ¨ç¨‹åºä¸­å®šä¹‰å’Œå¼•ç”¨çš„å‡½æ•°å’Œå…¨å±€å˜é‡çš„ä¿¡æ¯ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;section-header-table&#34;&gt;&lt;span&gt;Section header table&lt;/span&gt;&#xA;  &lt;a href=&#34;#section-header-table&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;å­˜æ”¾ sections ä¸­æ¯ä¸ª section çš„èµ·å§‹ä½ç½®ã€å¤§å°ã€ç±»å‹ç­‰ä¿¡æ¯ã€‚&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;ç¬¦å·å’Œç¬¦å·è¡¨&#34;&gt;&lt;span&gt;ç¬¦å·å’Œç¬¦å·è¡¨&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e7%ac%a6%e5%8f%b7%e5%92%8c%e7%ac%a6%e5%8f%b7%e8%a1%a8&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;é“¾æ¥çš„æœ¬è´¨æ˜¯æŠŠå¤šä¸ªä¸åŒçš„ç›®æ ‡æ–‡ä»¶ç²˜åˆåœ¨ä¸€èµ·ï¼Œè€Œç¬¦å·æ˜¯é“¾æ¥ä¸­çš„ç²˜åˆå‰‚ã€‚ç¬¦å·è¡¨å°±æ˜¯ GOT (Global Offset Table)ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä½¿ç”¨&lt;code&gt;readelf -S file.o&lt;/code&gt;æŸ¥çœ‹æ®µå¤´ä¿¡æ¯ï¼ˆåŒ…å«æ¯ä¸ªæ®µçš„åç§°ã€å¤§å°ã€ç±»å‹ç­‰ï¼‰ï¼Œä½¿ç”¨&lt;code&gt;readelf -s file.o&lt;/code&gt;æŸ¥çœ‹ç¬¦å·è¡¨ï¼ˆåŒ…æ‹¬ç¬¦å·çš„åç§°ã€ç±»å‹ã€å€¼ç­‰ï¼‰ï¼Œä½¿ç”¨&lt;code&gt;readelf -r file.o&lt;/code&gt;æŸ¥çœ‹é‡å®šä½ä¿¡æ¯ï¼ˆæŒ‡ç¤ºä»£ç ä¸­å“ªäº›åœ°æ–¹éœ€è¦åœ¨é“¾æ¥æ—¶è°ƒæ•´ï¼‰ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;yaf@yaf-VMware-Virtual-Platform:~/projects/csapp$ readelf -s main.o&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Symbol table &lt;span class=&#34;s1&#34;&gt;&amp;#39;.symtab&amp;#39;&lt;/span&gt; contains &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; entries:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Num:    Value          Size Type    Bind   Vis      Ndx Name&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     0: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; NOTYPE  LOCAL  DEFAULT  UND &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     1: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; FILE    LOCAL  DEFAULT  ABS main.c&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     2: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; SECTION LOCAL  DEFAULT    &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; .text&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     3: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;    &lt;span class=&#34;m&#34;&gt;30&lt;/span&gt; FUNC    GLOBAL DEFAULT    &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; main&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     4: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; OBJECT  GLOBAL DEFAULT    &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; array&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     5: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; NOTYPE  GLOBAL DEFAULT  UND sum&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;ç¬¦å·mainæ˜¯ä½äº.textèŠ‚ï¼ˆNdx = 1ï¼‰åç§»é‡ä¸º 0 ï¼ˆvalue = 0ï¼‰å¤„çš„ 30 å­—èŠ‚å‡½æ•°ï¼›ç¬¦å·arrayæ˜¯ä½äº.dataèŠ‚ï¼ˆNdx = 3ï¼‰åç§»é‡ä¸º 0 ï¼ˆvalue = 0ï¼‰å¤„çš„ 8 å­—èŠ‚å¯¹è±¡ï¼›ç¬¦å·sumæ˜¯å¯¹å¤–éƒ¨ç¬¦å·çš„å¼•ç”¨ï¼ˆNdx = UNDï¼‰&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åˆå§‹åŒ–çš„å…¨å±€å˜é‡ .data&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡  .bss&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å…¨å±€å‡½æ•°&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sum = %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åˆå§‹åŒ–çš„é™æ€å˜é‡ .data&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åˆå§‹åŒ–çš„é™æ€å˜é‡ .bss&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å±€éƒ¨å˜é‡&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Num:    Value          Size Type    Bind   Vis      Ndx Name&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     0: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; NOTYPE  LOCAL  DEFAULT  UND &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     1: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; FILE    LOCAL  DEFAULT  ABS main.c&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     2: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; SECTION LOCAL  DEFAULT    &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; .text&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     3: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; SECTION LOCAL  DEFAULT    &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; .data&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     4: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; SECTION LOCAL  DEFAULT    &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; .bss&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     5: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; SECTION LOCAL  DEFAULT    &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; .rodata&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     6: &lt;span class=&#34;m&#34;&gt;0000000000000004&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; OBJECT  LOCAL  DEFAULT    &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; a.1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     7: &lt;span class=&#34;m&#34;&gt;0000000000000004&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; OBJECT  LOCAL  DEFAULT    &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; b.0&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     8: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; OBJECT  GLOBAL DEFAULT    &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; count&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     9: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; OBJECT  GLOBAL DEFAULT    &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; value&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    10: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;    &lt;span class=&#34;m&#34;&gt;43&lt;/span&gt; FUNC    GLOBAL DEFAULT    &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; func&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    11: &lt;span class=&#34;m&#34;&gt;0000000000000000&lt;/span&gt;     &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; NOTYPE  GLOBAL DEFAULT  UND &lt;span class=&#34;nb&#34;&gt;printf&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    12: 000000000000002b    &lt;span class=&#34;m&#34;&gt;52&lt;/span&gt; FUNC    GLOBAL DEFAULT    &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; main&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;a.1å’Œb.0æ˜¯åç§°ä¿®é¥°ï¼Œä¸ºäº†é˜²æ­¢é™æ€å˜é‡çš„åå­—å†²çªã€‚å±€éƒ¨å˜é‡ç¬¦å·è¡¨é‡Œæ˜¯æ²¡æœ‰çš„ï¼Œç”±äºåœ¨æ ˆä¸Šï¼Œç¬¦å·è¡¨å¹¶ä¸å…³å¿ƒã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç¬¦å·ç±»å‹ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;å…¨å±€ç¬¦å·ï¼Œç”±è¯¥æ¨¡å—å®šä¹‰ï¼ŒåŒæ—¶èƒ½è¢«å…¶ä»–æ¨¡å—å¼•ç”¨ã€‚&lt;/li&gt;&#xA;&lt;li&gt;å¤–éƒ¨ç¬¦å·ï¼Œè¢«å…¶ä»–æ¨¡å—å®šä¹‰ï¼ŒåŒæ—¶è¢«è¯¥æ¨¡å—å¼•ç”¨ã€‚&lt;/li&gt;&#xA;&lt;li&gt;å±€éƒ¨ç¬¦å·ï¼Œåªèƒ½è¢«è¯¥æ¨¡å—å®šä¹‰å’Œå¼•ç”¨ã€‚&#xA;&lt;ul&gt;&#xA;&lt;li&gt;åŒºåˆ«å±€éƒ¨ç¬¦å·å’Œå…¨å±€ç¬¦å·ï¼šstaticå±æ€§ã€‚&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;ç¬¦å·è§£æ&#34;&gt;&lt;span&gt;ç¬¦å·è§£æ&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e7%ac%a6%e5%8f%b7%e8%a7%a3%e6%9e%90&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;å°†ç¨‹åºä¸­çš„ç¬¦å·ï¼ˆå¦‚å˜é‡åã€å‡½æ•°åç­‰ï¼‰ä¸å®ƒä»¬åœ¨å†…å­˜æˆ–ç¨‹åºä¸­çš„å®é™…åœ°å€è¿›è¡Œå…³è”çš„è¿‡ç¨‹ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;ç¬¦å·åŒåå†²çª&#34;&gt;&lt;span&gt;ç¬¦å·åŒåå†²çª&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e7%ac%a6%e5%8f%b7%e5%90%8c%e5%90%8d%e5%86%b2%e7%aa%81&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ol&gt;&#xA;&lt;li&gt;å¤šä¸ªåŒåçš„å¼ºç¬¦å·&#xA;&lt;ul&gt;&#xA;&lt;li&gt;æ‰¾æ­»ï¼Œå‡º error&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;ä¸€ä¸ªå¼ºç¬¦å·å’Œå¤šä¸ªåŒåçš„å¼±ç¬¦å·&#xA;&lt;ul&gt;&#xA;&lt;li&gt;æ²¡äº‹ï¼Œéšè— bug&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;å¤šä¸ªåŒåçš„å¼±ç¬¦å·&#xA;&lt;ul&gt;&#xA;&lt;li&gt;warningï¼Œä¸æ˜“å¯Ÿè§‰çš„è¿è¡Œæ—¶ error&lt;/li&gt;&#xA;&lt;li&gt;ç¼–è¯‘æ—¶æ·»åŠ -fno -commonçš„ç¼–è¯‘é€‰é¡¹ï¼Œå¤šä¸ªé‡åè§¦å‘é”™è¯¯ï¼›æˆ–-WerroræŠŠæ‰€æœ‰è­¦å‘Šå˜æˆé”™è¯¯&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;å¼ºç¬¦å·ï¼šå‡½æ•°å’Œå·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¼±ç¬¦å·ï¼šæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;é™æ€é“¾æ¥&#34;&gt;&lt;span&gt;é™æ€é“¾æ¥&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e9%9d%99%e6%80%81%e9%93%be%e6%8e%a5&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;printfã€atoiç­‰å‡½æ•°å­˜æ”¾åœ¨libc.aä¸­ï¼Œé™æ€åº“ä»¥ä¸€ç§ç§°ä¸ºarchiveçš„ç‰¹æ®Šæ–‡ä»¶æ ¼å¼å­˜æ”¾åœ¨ç£ç›˜ä¸Šã€‚ä½¿ç”¨&lt;code&gt;ar rcs libvector.a addvec.o multvec.o&lt;/code&gt;æ„é€ é™æ€åº“ï¼Œä½¿ç”¨&lt;code&gt;gcc -static -o prog main.o ./libvector.a&lt;/code&gt;é“¾æ¥é™æ€åº“ã€‚æ ¹æ®main.oä¸­çš„ç¬¦å·ï¼Œå°†æ‰€ç”¨åˆ°çš„ç¬¦å·å¯¹åº”çš„.oæ–‡ä»¶å¤åˆ¶è¿›å¯æ‰§è¡Œæ–‡ä»¶ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/link/%e9%9d%99%e6%80%81%e9%93%be%e6%8e%a5%e8%bf%87%e7%a8%8b.png&#34; title=&#34;/link/é™æ€é“¾æ¥è¿‡ç¨‹.png&#34; data-thumbnail=&#34;/link/é™æ€é“¾æ¥è¿‡ç¨‹.png&#34; data-sub-html=&#34;&lt;h2&gt;é™æ€é“¾æ¥è¿‡ç¨‹&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/link/é™æ€é“¾æ¥è¿‡ç¨‹.png&#39; alt=&#34;/link/é™æ€é“¾æ¥è¿‡ç¨‹.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;é™æ€é“¾æ¥è¿‡ç¨‹&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;ç›®æ ‡æ–‡ä»¶æ˜¯å­—èŠ‚å—çš„é›†åˆï¼Œæœ‰ä»£ç å—ã€æ•°æ®å—ã€å¼•å¯¼é“¾æ¥å™¨å’ŒåŠ è½½å™¨çš„æ•°æ®ç»“æ„ã€‚&lt;/p&gt;&#xA;&lt;p&gt;é“¾æ¥å™¨å¿…é¡»å®Œæˆçš„ä¸¤ä¸ªä¸»è¦ä»»åŠ¡ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;ç¬¦å·è§£æï¼š&lt;/li&gt;&#xA;&lt;li&gt;æŒ‰å‘½ä»¤è¡Œä»å·¦åˆ°å³æ‰«æå¯é‡å®šä½æ–‡ä»¶å’Œé™æ€åº“æ–‡ä»¶&#xA;&lt;ul&gt;&#xA;&lt;li&gt;å¯é‡å®šä½æ–‡ä»¶æ”¾åˆ°é›†åˆ E ä¸­ï¼Œæœ€ååˆå¹¶èµ·æ¥&lt;/li&gt;&#xA;&lt;li&gt;å¼•ç”¨äº†å½“å°šæœªå®šä¹‰çš„ç¬¦å·æ”¾åˆ°é›†åˆ U ä¸­&lt;/li&gt;&#xA;&lt;li&gt;æ–‡ä»¶ä¸­å·²å®šä¹‰çš„ç¬¦å·æ”¾åˆ°é›†åˆ D ä¸­&#xA;ä½¿ç”¨é™æ€é“¾æ¥ï¼Œå‘½ä»¤è¡Œæ–‡ä»¶çš„è¾“å…¥é¡ºåºååˆ†é‡è¦ï¼Œä¸€èˆ¬å°†åº“æ”¾åˆ°å‘½ä»¤è¡Œç»“å°¾ã€‚è€Œä¸”å¦‚æœåº“æ˜¯ç‹¬ç«‹çš„ï¼Œå¿…é¡»å¯¹å®ƒä»¬è¿›è¡Œæ’åº&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;é‡å®šä½&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;é‡å®šä½&#34;&gt;&lt;span&gt;é‡å®šä½&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e9%87%8d%e5%ae%9a%e4%bd%8d&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;é“¾æ¥å™¨åˆå¹¶è¾“å…¥æ¨¡å—ï¼Œå¹¶ä¸ºæ¯ä¸ªç¬¦å·åˆ†é…è¿è¡Œæ—¶åœ°å€ã€‚&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;é‡å®šä½èŠ‚å’Œç¬¦å·å®šä¹‰&#xA;&lt;ul&gt;&#xA;&lt;li&gt;æŠŠæ‰€æœ‰ç›¸åŒç±»å‹çš„ section åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„ section&lt;/li&gt;&#xA;&lt;li&gt;æ¯æ¡æŒ‡ä»¤å’Œå…¨å±€å˜é‡éƒ½æœ‰äº†å”¯ä¸€çš„è¿è¡Œæ—¶å†…å­˜åœ°å€&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;é‡å®šä½èŠ‚ä¸­çš„ç¬¦å·å¼•ç”¨&#xA;&lt;ul&gt;&#xA;&lt;li&gt;ä¿®æ”¹å¯¹ç¬¦å·çš„å¼•ç”¨ä½¿å…¶æŒ‡å‘æ­£ç¡®çš„è¿è¡Œæ—¶åœ°å€&#xA;é‡å®šä½æ¡ç›®ï¼šå‘Šè¯‰é“¾æ¥å™¨åœ¨åˆæˆå¯æ‰§è¡Œæ–‡ä»¶æ—¶åº”è¯¥å¦‚ä½•ä¿®æ”¹è¿™ä¸ªå¼•ç”¨ï¼Œ.rel.textæ˜¯ä»£ç çš„é‡å®šä½æ¡ç›®ï¼Œ.rel.dataæ˜¯å·²åˆå§‹åŒ–æ•°æ®çš„é‡å®šä½æ¡ç›®&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å¼•ç”¨çš„èŠ‚åç§»é‡&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;nl&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é‡å®šä½ç±»å‹ ç›¸å¯¹åœ°å€é‡å®šä½ã€ç»å¯¹åœ°å€é‡å®šä½&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;nl&#34;&gt;symbol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ä¿®æ”¹å“ªä¸ªç¬¦å·&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ELF64_Rela&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æœ€å¼€å§‹ç¼–è¯‘å‡ºæ¥çš„.oæ–‡ä»¶ call äº†å¤–éƒ¨å‡½æ•°æ˜¯ä¸çŸ¥é“å…·ä½“åœ°å€çš„ï¼Œéœ€è¦å¡«å32ä½ä¸ºâ€œS+A-Pâ€ï¼Œä½¿å¾—æ»¡è¶³çº¦æŸæ–­è¨€ï¼šï¼ˆè½¬åˆ°è°ƒç”¨å‡½æ•°çš„å®é™…åœ°å€ï¼‰&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;assert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hello&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;main&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0xf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// call hello çš„ next pc&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;main&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0xb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// call æŒ‡ä»¤çš„ offset&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;å¯æ‰§è¡Œæ–‡ä»¶&#34;&gt;&lt;span&gt;å¯æ‰§è¡Œæ–‡ä»¶&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%8f%af%e6%89%a7%e8%a1%8c%e6%96%87%e4%bb%b6&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/link/%e5%8f%af%e6%89%a7%e8%a1%8c%e6%96%87%e4%bb%b6%e6%ae%b5%e5%88%86%e5%b8%83.png&#34; title=&#34;/link/å¯æ‰§è¡Œæ–‡ä»¶æ®µåˆ†å¸ƒ.png&#34; data-thumbnail=&#34;/link/å¯æ‰§è¡Œæ–‡ä»¶æ®µåˆ†å¸ƒ.png&#34; data-sub-html=&#34;&lt;h2&gt;å¯æ‰§è¡Œæ–‡ä»¶æ®µåˆ†å¸ƒ&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/link/å¯æ‰§è¡Œæ–‡ä»¶æ®µåˆ†å¸ƒ.png&#39; alt=&#34;/link/å¯æ‰§è¡Œæ–‡ä»¶æ®µåˆ†å¸ƒ.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;å¯æ‰§è¡Œæ–‡ä»¶æ®µåˆ†å¸ƒ&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;.initèŠ‚å®šä¹‰äº†_initå‡½æ•°ï¼Œç¨‹åºåˆå§‹åŒ–ä»£ç è°ƒç”¨_initå‡½æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚ç¨‹åºæ‰§è¡Œæ—¶ä»£ç æ®µå’Œæ•°æ®æ®µåŠ è½½åˆ°å†…å­˜æ‰§è¡Œï¼Œå…¶ä»–ä¸è¢«åŠ è½½åˆ°å†…å­˜ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç¨‹åºå¤´éƒ¨è¡¨æè¿°äº†ä»£ç æ®µã€æ•°æ®æ®µä¸å†…å­˜çš„æ˜ å°„å…³ç³»ã€‚.bssä¸­çš„æ•°æ®ä¸å ç”¨å¯æ‰§è¡Œæ–‡ä»¶çš„ç©ºé—´ï¼Œä½†åœ¨è¿è¡Œæ—¶éœ€è¦è¢«åˆå§‹åŒ–ä¸º0ï¼Œæ‰€ä»¥åŠ è½½åˆ°å†…å­˜éœ€è¦å¢åŠ ç©ºé—´ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/link/%e6%ae%b5%e6%8f%8f%e8%bf%b0.png&#34; title=&#34;/link/æ®µæè¿°.png&#34; data-thumbnail=&#34;/link/æ®µæè¿°.png&#34; data-sub-html=&#34;&lt;h2&gt;æ®µæè¿°&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/link/æ®µæè¿°.png&#39; alt=&#34;/link/æ®µæè¿°.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;æ®µæè¿°&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;./progè¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ï¼ˆåŠ è½½ï¼‰ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;è°ƒç”¨execve()è°ƒç”¨åŠ è½½å™¨&lt;/li&gt;&#xA;&lt;li&gt;åŠ è½½å™¨å°†å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ä»£ç å’Œæ•°æ®ä»ç£ç›˜å¤åˆ¶åˆ°å†…å­˜&lt;/li&gt;&#xA;&lt;li&gt;è·³è½¬åˆ°ç¨‹åºå…¥å£è¿è¡Œè¯¥ç¨‹åº&#xA;&lt;ul&gt;&#xA;&lt;li&gt;ctrl.oç³»ç»Ÿç›®æ ‡æ–‡ä»¶ä¸­å®šä¹‰äº†ç¨‹åºå…¥å£å‡½æ•°_start()&lt;/li&gt;&#xA;&lt;li&gt;_start()è°ƒç”¨libc.soä¸­çš„_libc_start_main()åˆå§‹åŒ–æ‰§è¡Œç¯å¢ƒ&lt;/li&gt;&#xA;&lt;li&gt;è°ƒç”¨ç”¨æˆ·å±‚ä¸­å¯æ‰§è¡Œç¨‹åºprogä¸­çš„main()ï¼Œå‡½æ•°è¿”å›å€¼è¿”å›ç»™_libc_start_main()ï¼Œä¸”åœ¨éœ€è¦æ—¶æŠŠæ§åˆ¶æƒè¿”å›ç»™æ“ä½œç³»ç»ŸKernel&#xA;æ¯ä¸€ä¸ª Linux ç¨‹åºéƒ½æœ‰ä¸€ä¸ªè¿è¡Œæ—¶å†…å­˜é•œåƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/link/%e8%bf%90%e8%a1%8c%e6%97%b6%e7%a8%8b%e5%ba%8f%e5%86%85%e5%ad%98%e5%88%86%e5%b8%83.png&#34; title=&#34;/link/è¿è¡Œæ—¶ç¨‹åºå†…å­˜åˆ†å¸ƒ.png&#34; data-thumbnail=&#34;/link/è¿è¡Œæ—¶ç¨‹åºå†…å­˜åˆ†å¸ƒ.png&#34; data-sub-html=&#34;&lt;h2&gt;è¿è¡Œæ—¶ç¨‹åºå†…å­˜åˆ†å¸ƒ&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/link/è¿è¡Œæ—¶ç¨‹åºå†…å­˜åˆ†å¸ƒ.png&#39; alt=&#34;/link/è¿è¡Œæ—¶ç¨‹åºå†…å­˜åˆ†å¸ƒ.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;è¿è¡Œæ—¶ç¨‹åºå†…å­˜åˆ†å¸ƒ&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;æ•°æ®æ®µæœ‰åœ°å€å¯¹é½çš„è¦æ±‚ï¼Œæ‰€ä»¥æ•°æ®æ®µå’Œä»£ç æ®µä¹‹é—´æ˜¯æœ‰é—´éš™çš„&lt;/li&gt;&#xA;&lt;li&gt;ä¸ºé˜²æ­¢ç¨‹åºå—åˆ°æ”»å‡»ï¼Œåœ¨åˆ†é…æ ˆã€å…±äº«åº“ä»¥åŠå †çš„è¿è¡Œæ—¶åœ°å€æ—¶ï¼Œé“¾æ¥å™¨ä¼šä½¿ç”¨åœ°å€ç©ºé—´éšæœºåŒ–çš„ç­–ç•¥ï¼Œæ‰€ä»¥æ¯æ¬¡è¿è¡Œæ—¶åœ°å€éƒ½ä¼šå˜ï¼Œä½†ç›¸å¯¹ä½ç½®ä¸å˜&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;åŠ¨æ€é“¾æ¥&#34;&gt;&lt;span&gt;åŠ¨æ€é“¾æ¥&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%8a%a8%e6%80%81%e9%93%be%e6%8e%a5&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;é™æ€é“¾æ¥åº“çš„ç¼ºç‚¹ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;éœ€è¦å®šæœŸç»´æŠ¤å’Œæ›´æ–°&lt;/li&gt;&#xA;&lt;li&gt;å‡ ä¹æ¯ä¸ª C ç¨‹åºéƒ½éœ€è¦ä½¿ç”¨æ ‡å‡†çš„ I/O å‡½æ•°ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½éœ€è¦æŠŠå…¶æ‰€ç”¨åˆ°çš„é™æ€åº“å¤åˆ¶åˆ°å†…å­˜ä¸­ï¼Œå¯¹äºè¿è¡Œæˆç™¾ä¸Šåƒä¸ªè¿›ç¨‹çš„ç³»ç»Ÿï¼Œè¿™æ˜¯å¯¹å†…å­˜èµ„æºçš„æå¤§æµªè´¹&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;å…±äº«åº“æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼Œåœ¨ Linux ç³»ç»Ÿä¸­ç”¨.soè¡¨ç¤ºï¼Œwindows ç³»ç»Ÿä¸­ç”¨ .dllè¡¨ç¤ºã€‚å…±äº«åº“åœ¨è¿è¡Œæˆ–åŠ è½½æ—¶å¯ä»¥è¢«åŠ è½½åˆ°ä»»æ„çš„å†…å­˜åœ°å€ï¼Œè¿˜èƒ½å’Œä¸€ä¸ªåœ¨å†…å­˜ä¸­çš„ç¨‹åºé“¾æ¥èµ·æ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºåŠ¨æ€é“¾æ¥ï¼Œå…·ä½“æ˜¯ç”±åŠ¨æ€é“¾æ¥å™¨æ¥æ‰§è¡Œçš„ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä½¿ç”¨&lt;code&gt;gcc -shared -fpic -o libvector.so addvec.c multvec.c&lt;/code&gt;ç”ŸæˆåŠ¨æ€é“¾æ¥åº“ï¼Œ-sharedåˆ›å»ºå…±äº«çš„ç›®æ ‡æ–‡ä»¶ï¼Œ-fpicç”Ÿæˆä½ç½®æ— å…³çš„ä»£ç ã€‚&lt;/p&gt;&#xA;&lt;p&gt;é“¾æ¥å™¨å¹¶æ²¡æœ‰æŠŠlibvector.soä¸­çš„ä»£ç å’Œæ•°æ®å¤åˆ¶åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯åªå¤åˆ¶äº†ç¬¦å·è¡¨å’Œä¸€äº›é‡å®šä½ä¿¡æ¯ã€‚åœ¨å¯æ‰§è¡Œç¨‹åºè¿è¡Œæ—¶ï¼ŒåŠ è½½å™¨ä¼šå‘ç°å¯æ‰§è¡Œç¨‹åºä¸­å­˜åœ¨ä¸€ä¸ªåä¸º.interpçš„sectionï¼Œè¿™ä¸ªsectionä¸­åŒ…å«äº†åŠ¨æ€é“¾æ¥å™¨çš„è·¯å¾„åï¼ŒåŠ è½½å™¨å°†åŠ¨æ€é“¾æ¥å™¨åŠ è½½åˆ°å†…å­˜ä¸­è¿è¡Œï¼Œç”±å…¶æ‰§è¡Œé‡å®šä½ä»£ç å’Œæ•°æ®çš„å·¥ä½œã€‚&lt;/p&gt;&#xA;&lt;p&gt;åŠ¨æ€é“¾æ¥å™¨ï¼šæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªå…±äº«ç›®æ ‡æ–‡ä»¶ï¼ˆld-linux.soï¼‰&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;åŠ¨æ€é“¾æ¥çš„è¿‡ç¨‹&#34;&gt;&lt;span&gt;åŠ¨æ€é“¾æ¥çš„è¿‡ç¨‹&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%8a%a8%e6%80%81%e9%93%be%e6%8e%a5%e7%9a%84%e8%bf%87%e7%a8%8b&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ol&gt;&#xA;&lt;li&gt;å°†libc.soçš„ä»£ç å’Œæ•°æ®é‡å®šä½åˆ°æŸä¸ªå†…å­˜æ®µ&lt;/li&gt;&#xA;&lt;li&gt;é‡å®šä½libvector.soçš„ä»£ç å’Œæ•°æ®åˆ°å¦ä¸€ä¸ªå†…å­˜æ®µ&lt;/li&gt;&#xA;&lt;li&gt;é‡å®šä½ proc2 ä¸­ç”±libc.soå’Œlibvector.soå®šä¹‰çš„ç¬¦å·å¼•ç”¨&#xA;&lt;ul&gt;&#xA;&lt;li&gt;åº”ç”¨ç¨‹åºa.outé‡Œä¼šæœ‰ä¸€ä¸ªè¡¨PLTå­˜æ”¾ç¬¦å·çš„åœ°å€ï¼Œä»è€ŒæŒ‡å‘ç¬¦å·ä»£ç &lt;/li&gt;&#xA;&lt;li&gt;æ‡’åŠ è½½ï¼Œç”¨åˆ°äº†çš„ç¬¦å·æ‰å›å»æŸ¥è¡¨é—´æ¥è·³è½¬&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;ä»¥ä¸Šæ˜¯ç¼–è¯‘ã€åŠ è½½çš„è¿‡ç¨‹ï¼Œåº”ç”¨ç¨‹åºè¿˜å¯èƒ½åœ¨è¿è¡Œæ—¶è¦æ±‚åŠ¨æ€é“¾æ¥å™¨åŠ è½½å’Œé“¾æ¥æŸä¸ªå…±äº«åº“ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å®ç°ä½ç½®æ— å…³ä»£ç  PIC ï¼š&#xA;PLTï¼ˆè¿‡ç¨‹é“¾æ¥è¡¨ï¼‰ï¼šæ¯ä¸ªå¤–éƒ¨å‡½æ•°çš„è°ƒç”¨éƒ½é€šè¿‡ PLT è¡¨è¿›è¡Œè·³è½¬ï¼ŒPLT æ¡ç›®ä¸­å­˜å‚¨äº†è·³è½¬çš„ç›®æ ‡åœ°å€ï¼ˆåˆå§‹æ—¶æŒ‡å‘ GOT è¡¨ï¼‰ï¼Œå¹¶é€šè¿‡å»¶è¿Ÿç»‘å®šåœ¨è¿è¡Œæ—¶è§£æã€‚&lt;/p&gt;&#xA;&lt;p&gt;GOTï¼ˆå…¨å±€åç§»é‡è¡¨ï¼‰ï¼šGOT å­˜å‚¨äº†æŒ‡å‘å®é™…å‡½æ•°æˆ–æ•°æ®çš„åœ°å€ï¼Œæ¯ä¸ªå‡½æ•°è°ƒç”¨ä¹‹å‰ï¼ŒGOT ä¼šè¢«åŠ¨æ€é“¾æ¥å™¨å¡«å……ä¸ºæ­£ç¡®çš„åœ°å€ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨è´Ÿè´£å°†ç¨‹åºä¸­çš„å¤–éƒ¨ç¬¦å·é“¾æ¥åˆ°å®é™…çš„å…±äº«åº“å‡½æ•°åœ°å€ã€‚ä½ç½®æ— å…³ä»£ç é€šè¿‡å»¶è¿Ÿç»‘å®šï¼ˆlazy bindingï¼‰æœºåˆ¶ä¼˜åŒ–äº†æ€§èƒ½ã€‚åªæœ‰å½“ç¨‹åºç¬¬ä¸€æ¬¡è°ƒç”¨æŸä¸ªå…±äº«åº“å‡½æ•°æ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨æ‰ä¼šè§£æè¯¥å‡½æ•°çš„åœ°å€ï¼Œå¹¶æ›´æ–° GOT è¡¨ã€‚ä¹‹åçš„è°ƒç”¨ä¸éœ€è¦å†è¿›è¡Œé‡å®šä½ï¼Œç›´æ¥é€šè¿‡ PLT è¡¨è¿›è¡Œè·³è½¬ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;åº”ç”¨&#34;&gt;&lt;span&gt;åº”ç”¨&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%ba%94%e7%94%a8&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;ol&gt;&#xA;&lt;li&gt;åˆ†å‘è½¯ä»¶&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Windows åº”ç”¨å¼€å‘è€…åˆ©ç”¨å…±äº«åº“è¿›è¡Œè½¯ä»¶ç‰ˆæœ¬çš„æ›´æ–°&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;æ„å»ºé«˜æ€§èƒ½ web æœåŠ¡å™¨&#xA;&lt;ul&gt;&#xA;&lt;li&gt;ç”Ÿæˆä¸ªæ€§åŒ–çš„ web é¡µé¢åŠè´¦æˆ·ä½™é¢&lt;/li&gt;&#xA;&lt;li&gt;å°†æ¯ä¸ªç”ŸæˆåŠ¨æ€å†…å®¹çš„å‡½æ•°æ‰“åŒ…åœ¨å…±äº«åº“ä¸­ï¼ŒæœåŠ¡å™¨æ ¹æ®è¯·æ±‚åŠ¨æ€åŠ è½½å’Œé“¾æ¥é€‚å½“çš„å‡½æ•°ï¼Œç„¶åç›´æ¥è°ƒç”¨ï¼Œå‡½æ•°ä¼šä¸€ç›´ç¼“å­˜åœ¨æœåŠ¡å™¨çš„åœ°å€ç©ºé—´ä¸­&lt;/li&gt;&#xA;&lt;li&gt;åœ¨æ›´æ–°å‡½æ•°æ—¶å¹¶ä¸éœ€è¦åœæ­¢æ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;å®ç°è¿è¡Œæ—¶åŠ è½½å’Œé“¾æ¥å…±äº«åº“&#34;&gt;&lt;span&gt;å®ç°è¿è¡Œæ—¶åŠ è½½å’Œé“¾æ¥å…±äº«åº“&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e5%ae%9e%e7%8e%b0%e8%bf%90%e8%a1%8c%e6%97%b6%e5%8a%a0%e8%bd%bd%e5%92%8c%e9%93%be%e6%8e%a5%e5%85%b1%e4%ba%ab%e5%ba%93&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;Linux æä¾›äº†dlopen()æ¥å£å…è®¸åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶åŠ è½½å’Œé“¾æ¥å…±äº«åº“ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dlopen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dlopen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;./libvector.so&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RTLD_LAZY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ¨è¿Ÿåˆ°å…±äº«åº“ä¸­ä»£ç æ‰§è¡Œæ—¶å†è¿›è¡Œç¬¦å·è§£æ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dlsym&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;symbol&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;addvec&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dlsym&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;addvec&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// handleå¥æŸ„ ç¬¦å·addvec è¿”å›ç¬¦å·åœ°å€&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;addvec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;z&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dlclose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;dlclose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å¸è½½å…±äº«åº“&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1yq4y1t7is/?spm_id_from=333.1387.collection.video_card.click&amp;amp;vd_source=050bf08a3643c244550421a1ccc94f6b&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;CSAPPè®²è§£è¯¾ç¨‹â€”â€”ä¹æ›²é˜‘å¹²&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV15F411G7Ti?spm_id_from=333.788.videopod.sections&amp;amp;vd_source=050bf08a3643c244550421a1ccc94f6b&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;å—å¤§æ“ä½œç³»ç»Ÿè¯¾ç¨‹â€”â€”jyy&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;</description>
    </item>
    <item>
      <title>ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»è¯»ä¹¦ç¬”è®°</title>
      <link>http://localhost:1313/posts/programmer-note/</link>
      <pubDate>Sun, 06 Apr 2025 14:47:58 +0800</pubDate><author>1022440588@qq.com (UAreFree)</author>
      <guid>http://localhost:1313/posts/programmer-note/</guid>
      <category domain="http://localhost:1313/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/">è®¡ç®—æœºç³»ç»Ÿ</category>
      <description>&lt;p&gt;ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»â€”â€”é“¾æ¥ã€è£…è½½ä¸åº“ã€‹&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;ç®€ä»‹&#34;&gt;&lt;span&gt;ç®€ä»‹&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e7%ae%80%e4%bb%8b&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;å¯¹äºç³»ç»Ÿç¨‹åºå¼€å‘è€…æ¥è¯´ï¼Œè®¡ç®—æœºç¡¬ä»¶è®¾å¤‡ä¸­æœ‰ä¸‰ä¸ªéƒ¨ä»¶æœ€ä¸ºå…³é”®ï¼Œåˆ†åˆ«æ˜¯ä¸­å¤®å¤„ç†å™¨CPUã€å†…å­˜å’ŒI/Oæ§åˆ¶èŠ¯ç‰‡ã€‚è¿æ¥æ‰€æœ‰é«˜é€ŸèŠ¯ç‰‡çš„æ˜¯åŒ—æ¡¥ï¼Œä¸“é—¨å¤„ç†ä½é€Ÿè®¾å¤‡çš„æ˜¯å—æ¡¥ï¼ŒåŒ—æ¡¥è¿æ¥ç€PCIæ€»çº¿ï¼Œå—æ¡¥è¿æ¥ç€ISAæ€»çº¿ã€‚å—æ¡¥æŒ‚åœ¨PCIæ€»çº¿ä¸Šï¼Œä»è€Œä¸åŒ—æ¡¥äº¤æ¢æ•°æ®ã€‚äººä»¬å¸Œæœ›è®¡ç®—æœºè¶Šæ¥è¶Šå¿«ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€æ˜¯æå‡CPUé¢‘ç‡ï¼Œä¸€æ˜¯å¢åŠ CPUæ•°é‡ã€‚&lt;/p&gt;&#xA;&lt;p&gt;â€œè®¡ç®—æœºç§‘å­¦é¢†åŸŸçš„ä»»ä½•é—®é¢˜éƒ½å¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªé—´æ¥çš„ä¸­é—´å±‚æ¥è§£å†³â€ï¼Œè®¡ç®—æœºè½¯ä»¶ä½“ç³»ç»“æ„å°±æ˜¯åˆ†å±‚çš„ï¼š&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/programmer/%e8%ae%a1%e7%ae%97%e6%9c%ba%e8%bd%af%e4%bb%b6%e4%bd%93%e7%b3%bb%e7%bb%93%e6%9e%84.png&#34; title=&#34;/programmer/è®¡ç®—æœºè½¯ä»¶ä½“ç³»ç»“æ„.png&#34; data-thumbnail=&#34;/programmer/è®¡ç®—æœºè½¯ä»¶ä½“ç³»ç»“æ„.png&#34; data-sub-html=&#34;&lt;h2&gt;è®¡ç®—æœºè½¯ä»¶ä½“ç³»ç»“æ„&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/programmer/è®¡ç®—æœºè½¯ä»¶ä½“ç³»ç»“æ„.png&#39; alt=&#34;/programmer/è®¡ç®—æœºè½¯ä»¶ä½“ç³»ç»“æ„.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;è®¡ç®—æœºè½¯ä»¶ä½“ç³»ç»“æ„&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;å±‚ä¸å±‚ä¹‹é—´é€šä¿¡çš„åè®®ç§°ä¸ºæ¥å£ï¼Œæ¥å£ä¸‹é¢é‚£å±‚æ˜¯æ¥å£çš„æä¾›è€…ï¼Œæ¥å£ä¸Šé¢é‚£å±‚æ˜¯æ¥å£çš„ä½¿ç”¨è€…ï¼Œæ¯ä¸ªä¸­é—´å±‚éƒ½æ˜¯å¯¹å®ƒä¸‹é¢é‚£å±‚çš„åŒ…è£…å’Œæ‰©å±•ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¤šä»»åŠ¡ç³»ç»Ÿï¼šOSä»¥è¿›ç¨‹çš„æ–¹å¼è¿è¡Œåœ¨æ¯”ç³»ç»Ÿæƒé™æ›´ä½çš„çº§åˆ«ï¼ŒæŠ¢å å¼åˆ†é…CPUèµ„æºï¼ŒCPUåœ¨å¤šä¸ªè¿›ç¨‹é—´å¿«é€Ÿåˆ‡æ¢ï¼Œé€ æˆå¾ˆå¤šè¿›ç¨‹éƒ½åœ¨åŒæ—¶è¿è¡Œçš„å‡è±¡ã€‚ç›®å‰å‡ ä¹æ‰€æœ‰ç°ä»£OSéƒ½é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è®¾å¤‡é©±åŠ¨ï¼šOSä½œä¸ºç¡¬ä»¶çš„ä¸Šå±‚ï¼Œæ˜¯å¯¹ç¡¬ä»¶çš„ç®¡ç†å’ŒæŠ½è±¡ã€‚æˆ‘ä»¬å¸Œæœ›ä¸è®ºç¡¬ä»¶å‹å·å¦‚ä½•ï¼Œå¯¹åº”ç”¨ç¨‹åºå¼€å‘è€…æ¥è¯´ï¼Œéƒ½åªéœ€è¦è°ƒç”¨ä¸€ä¸ªç»Ÿä¸€çš„å‡½æ•°æ¥å£ï¼Œè€Œä¸æ˜¯é’ˆå¯¹æ¯ä¸ªå‹å·çš„ç¡¬ä»¶éƒ½å»å•ç‹¬å®ç°ã€‚ç¡¬ä»¶é©±åŠ¨ç¨‹åºæ˜¯OSçš„ä¸€éƒ¨åˆ†ï¼Œä½†äº¤ç”±ç¡¬ä»¶ç”Ÿäº§å‚å•†å®Œæˆã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä¹‹åçš„æœ‰å…³å†…å­˜çš„è®²è¿°åœ¨æœ‰äº†OSåŸºç¡€åéƒ½å¯ä»¥çœ‹æ‡‚ï¼Œå‚è€ƒOSTEPè¯»ä¹¦ç¬”è®°æ–‡ç« ã€‚&lt;/p&gt;&#xA;&lt;p&gt;çº¿ç¨‹ï¼šè½»é‡çº§è¿›ç¨‹ï¼Œæ˜¯ç¨‹åºæ‰§è¡Œæµçš„æœ€å°å•å…ƒã€‚ä¸€ä¸ªçº¿ç¨‹ç”±çº¿ç¨‹IDã€PCæŒ‡é’ˆã€å¯„å­˜å™¨å’Œå †æ ˆç»„æˆã€‚ä½¿ç”¨çº¿ç¨‹çš„åŸå› ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;ç­‰å¾…ç½‘ç»œå“åº”ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šè¿›å…¥ç¡çœ çŠ¶æ€ï¼Œæ— æ³•ç»§ç»­æ‰§è¡Œï¼Œè€Œå¤šçº¿ç¨‹æ‰§è¡Œå¯ä»¥æœ‰æ•ˆåˆ©ç”¨ç­‰å¾…çš„æ—¶é—´ã€‚&lt;/li&gt;&#xA;&lt;li&gt;è€—æ—¶é•¿çš„è®¡ç®—æ“ä½œï¼Œå¤šçº¿ç¨‹å¯ä»¥è®©ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£äº¤äº’ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£è®¡ç®—ã€‚&lt;/li&gt;&#xA;&lt;li&gt;ç¨‹åºé€»è¾‘æœ¬èº«è¦æ±‚å¹¶å‘æ“ä½œã€‚&lt;/li&gt;&#xA;&lt;li&gt;å¤šæ ¸è®¡ç®—æœºæœ¬èº«å…·å¤‡åŒæ—¶æ‰§è¡Œå¤šä¸ªçº¿ç¨‹çš„èƒ½åŠ›ï¼Œæœ‰å¿…è¦å……åˆ†å‘æŒ¥ã€‚&lt;/li&gt;&#xA;&lt;li&gt;ç›¸å¯¹äºå¤šè¿›ç¨‹ï¼Œå¤šçº¿ç¨‹åœ¨æ•°æ®å…±äº«æ–¹é¢æ•ˆç‡å¾ˆé«˜ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;çº¿ç¨‹çš„ç§æœ‰å­˜å‚¨ç©ºé—´ï¼š&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;æ ˆ&lt;/li&gt;&#xA;&lt;li&gt;çº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼ˆTLSï¼‰ï¼ŒæŸäº›OSä¸ºçº¿ç¨‹å•ç‹¬æä¾›çš„ç§æœ‰ç©ºé—´ï¼Œä½†é€šå¸¸åªæœ‰æœ‰é™çš„å®¹é‡&lt;/li&gt;&#xA;&lt;li&gt;å¯„å­˜å™¨ï¼Œæ‰§è¡Œæµçš„åŸºæœ¬æ•°æ®&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;ç°ä»£OSåŸºæœ¬ä½¿ç”¨å¤šä»»åŠ¡ç³»ç»Ÿï¼Œå¤šä¸ªè¿›ç¨‹çœ‹èµ·æ¥åŒæ—¶è¿è¡Œï¼Œæ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜èµ„æºï¼ŒCPUåœ¨å¤šä¸ªè¿›ç¨‹é—´å¿«é€Ÿåˆ‡æ¢ã€‚çº¿ç¨‹è°ƒåº¦è‡ªä¸Šè¿°å¤šä»»åŠ¡ç³»ç»Ÿé—®ä¸–æ¥å°±ä¸æ–­è¢«æå‡ºä¸åŒçš„æ–¹æ¡ˆå’Œç®—æ³•ï¼Œä¸»æµçš„éƒ½å¸¦æœ‰ä¼˜å…ˆçº§è°ƒåº¦å’Œæ—¶é—´ç‰‡è½®è½¬è°ƒåº¦çš„ç—•è¿¹ã€‚ç³»ç»Ÿä¼šæ ¹æ®çº¿ç¨‹çš„è¡¨ç°è‡ªåŠ¨è°ƒæ•´ä¼˜å…ˆçº§ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œç›¸å¯¹äºCPUå¯†é›†å‹çš„ç°ç¨‹ï¼ŒCPUæ›´å–œæ¬¢å…ˆè¿è¡ŒIOå¯†é›†å‹çš„çº¿ç¨‹ï¼ŒIOå¯†é›†å‹çš„çº¿ç¨‹æ¶‰åŠé¢‘ç¹çš„ç­‰å¾…ã€‚&lt;/p&gt;&#xA;&lt;p&gt;Windowså†…æ ¸æœ‰æ˜ç¡®çš„çº¿ç¨‹å’Œè¿›ç¨‹çš„æ¦‚å¿µï¼Œå¯ä»¥ä½¿ç”¨æ˜ç¡®çš„APIï¼šCreateProcesså’ŒCreateThreadæ¥åˆ›å»ºè¿›ç¨‹å’Œçº¿ç¨‹ï¼Œå¹¶æœ‰ä¸€ç³»åˆ—çš„APIæ¥æ“çºµå®ƒä»¬ã€‚ä½†Linuxå¯¹å¤šçº¿ç¨‹çš„æ”¯æŒé¢‡ä¸ºè´«ä¹ï¼ŒLinuxå†…æ ¸ä¸­å¹¶ä¸å­˜åœ¨çœŸæ­£çš„çº¿ç¨‹æ¦‚å¿µï¼Œå°†æ‰€æœ‰æ‰§è¡Œå®ä½“éƒ½ç§°ä¸ºä»»åŠ¡ï¼ˆTaskï¼‰ï¼Œä¸åŒtaskä¹‹é—´å¯ä»¥é€‰æ‹©å…±äº«å†…å­˜ç©ºé—´ï¼Œé‚£ä¹ˆè¿™äº›taskå°±æ„æˆäº†ç±»ä¼¼çš„ä¸€ä¸ªè¿›ç¨‹çš„å¤šä¸ªçº¿ç¨‹ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¿‡åº¦ä¼˜åŒ–ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;ç¼–è¯‘å™¨ä¸ºäº†æé«˜é€Ÿåº¦å°†ä¸€ä¸ªå˜é‡ç¼“å­˜åˆ°å¯„å­˜å™¨ä¸­è€Œä¸å†™å›ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Thread1&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;Thread2&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;   &lt;span class=&#34;nf&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;è¿™é‡Œä¸¤ä¸ªçº¿ç¨‹ä½¿ç”¨äº†é”æ¥ä¿æŠ¤å…±äº«å˜é‡xï¼Œä½†ä¹Ÿä¸ä¸€å®šèƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚å¦‚æœThread1è¯»å–xçš„å€¼åˆ°å¯„å­˜å™¨ä¸­ï¼Œè¿›è¡Œäº†x++æ“ä½œï¼Œä½†å¹¶æ²¡æœ‰ç«‹å³å†™å›åˆ°å†…å­˜ä¸­ï¼Œé‡Šæ”¾äº†é”ï¼›Thread2å»è¯»xçš„å€¼ï¼Œä¾æ—§æ˜¯0ï¼Œè¯»çš„æ˜¯ä¹‹å‰åœ¨å†…å­˜ä¸­çš„å€¼ã€‚&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;ç¼–è¯‘å™¨è°ƒæ•´æŒ‡ä»¤é¡ºåºã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Thread1&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;Thread2&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;r1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;r2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æ˜¾ç„¶ï¼Œr1å’Œr2è‡³å°‘ä¸€ä¸ªä¸º1ï¼Œé€»è¾‘ä¸Šä¸å¯èƒ½ä¸º0ã€‚ç„¶è€Œï¼Œç¼–è¯‘å™¨åœ¨ä¼˜åŒ–æ—¶ï¼Œå¯èƒ½ä¸ºäº†æ•ˆç‡è€Œä¸äº¤æ¢æ¯«ä¸ç›¸å¹²çš„ä¸¤æ¡ç›¸é‚»æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºï¼Œé‚£ä¹ˆr1=r2=0å°±å®Œå…¨å¯èƒ½äº†ã€‚&#xA;è§£å†³åŠæ³•ï¼šä½¿ç”¨volatileå…³é”®å­—ï¼Œvolatileå¯ä»¥å®Œç¾è§£å†³ç¬¬ä¸€ç§æƒ…å†µã€‚ä½†ç¬¬äºŒç§æƒ…å†µï¼Œè™½ç„¶å¯ä»¥é˜»æ­¢ç¼–è¯‘å™¨è°ƒæ•´volatileå˜é‡çš„æŒ‡ä»¤é¡ºåºï¼Œä½†æ— æ³•é˜»æ­¢CPUåŠ¨æ€è°ƒåº¦æ¢åºã€‚&#xA;å•ä¾‹æ¨¡å¼çš„double-checkï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;volatile&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;GetInstance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæ’ä¸€ä¸‹ä¸ºä»€ä¹ˆéœ€è¦double-checkï¼Œå¦‚æœä¸double-checkçš„è¯ï¼Œä»£ç æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;volatile&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;GetInstance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;å¦‚æœå½“å‰å®ä¾‹ä¸ºç©ºï¼Œå°±ä¸Šé”newä¸€ä¸ªå¯¹è±¡ï¼Œé˜²æ­¢å¤šçº¿ç¨‹åŒæ—¶newå¤šä¸ªå¯¹è±¡ã€‚ä½†æ˜¯å¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åˆ¤æ–­äº†pInst == NULLï¼Œçº¿ç¨‹Aå…ˆæ‹¿åˆ°é”ï¼Œnewäº†å¯¹è±¡ï¼Œçº¿ç¨‹Bä¾æ—§ä¼šæ‰§è¡Œæ¡ä»¶åˆ¤æ–­é‡Œçš„è¯­å¥ï¼Œnewä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥è¦å†æ¬¡åˆ¤æ–­ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä¹¦ä¸­æŒ‡å‡ºï¼Œè¿™æ ·çš„ä»£ç ä¾ç„¶æ˜¯æœ‰é—®é¢˜çš„ï¼ŒC++ çš„newåŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š1. åˆ†é…å†…å­˜ï¼›2. è°ƒç”¨æ„é€ å‡½æ•°ã€‚æ‰€ä»¥pInst = new T;åŒ…å«ä¸‰æ­¥ï¼š1. åˆ†é…å†…å­˜ï¼›2. åœ¨å†…å­˜çš„ä½ç½®ä¸Šè°ƒç”¨æ„é€ å‡½æ•°; 3. å°†å†…å­˜åœ°å€èµ‹å€¼ç»™pInstã€‚CPUä¹±åºæ‰§è¡Œä¼šå¯¼è‡´2ã€3æ­¥éª¤äº¤æ¢ï¼Œå¦‚æœå…ˆå°†åœ°å€èµ‹å€¼ç»™pInstï¼Œè€Œæ„é€ å‡½æ•°è¿˜æ²¡è°ƒç”¨å®Œæˆï¼Œå¯¹è±¡æ²¡æœ‰æ„é€ å‡ºæ¥ï¼Œæ­¤æ—¶å¹¶å‘çš„è°ƒç”¨GetInstance()ä¼šå‘ç°pInstä¸ä¸ºç©ºï¼Œä»è€Œç›´æ¥å°†æœªæ„é€ å®Œæˆçš„å¯¹è±¡è¿”å›ç»™ç”¨æˆ·ä½¿ç”¨ã€‚å¯¹äºé˜»æ­¢CPUä¹±åºæ‰§è¡Œçš„æ–¹æ³•ï¼Œé€šå¸¸æ˜¯è°ƒç”¨CPUæä¾›çš„ä¸€æ¡æŒ‡ä»¤barrieræ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;volatile&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;GetInstance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;temp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;barrier&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ä¿è¯å¯¹è±¡æ„é€ å®Œæˆ å†è¿”å›åœ°å€&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;temp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;è¿™é‡Œé¢˜å¤–è¯ï¼Œæ¨èä½¿ç”¨å±€éƒ¨é™æ€å˜é‡ï¼ˆè‡ªå¸¦çº¿ç¨‹å®‰å…¨åˆå§‹åŒ–ï¼‰æ¥å®ç°å•ä¾‹æ¨¡å¼ï¼Œè€Œä¸ç”¨åŒæ£€æŸ¥é”ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;GetInstance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;T&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pInst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;å¤šçº¿ç¨‹å†…éƒ¨æƒ…å†µï¼šç”¨æˆ·ä½¿ç”¨çš„çº¿ç¨‹å¹¶ä¸æ˜¯å†…æ ¸çº¿ç¨‹ï¼Œè€Œæ˜¯å­˜åœ¨äºç”¨æˆ·æ€çš„ç”¨æˆ·çº¿ç¨‹ã€‚ç”¨æˆ·çº¿ç¨‹å¹¶ä¸ä¸€å®šåœ¨OSå†…æ ¸é‡Œå¯¹åº”åŒç­‰æ•°é‡çš„å†…æ ¸çº¿ç¨‹ï¼Œä¾‹å¦‚æŸäº›è½»é‡çº§çš„çº¿ç¨‹åº“ï¼Œä¸‰ä¸ªç”¨æˆ·çº¿ç¨‹å¯¹å†…æ ¸æ¥è¯´å¯èƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;ä¸€å¯¹ä¸€æ¨¡å‹ï¼Œä¸€ä¸ªç”¨æˆ·çº¿ç¨‹å¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œçº¿ç¨‹ä¹‹é—´æ˜¯çœŸæ­£çš„å¹¶å‘ã€‚ä¸€èˆ¬ç›´æ¥ä½¿ç”¨APIæˆ–ç³»ç»Ÿè°ƒç”¨åˆ›å»ºçš„çº¿ç¨‹å‡ä¸ºä¸€å¯¹ä¸€çš„çº¿ç¨‹ã€‚ç¼ºç‚¹ï¼šç”¨æˆ·çº¿ç¨‹æ•°é‡å—OSé™åˆ¶ï¼›å†…æ ¸çº¿ç¨‹è°ƒåº¦ä¸Šä¸‹æ–‡å¼€é”€å¤§ï¼Œå¯¼è‡´ç”¨æˆ·çº¿ç¨‹æ‰§è¡Œæ•ˆç‡ä¸‹é™ã€‚&lt;/li&gt;&#xA;&lt;li&gt;å¤šå¯¹ä¸€æ¨¡å‹ï¼Œå°†å¤šä¸ªç”¨æˆ·çº¿ç¨‹æ˜ å°„åˆ°ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œçº¿ç¨‹åˆ‡æ¢ç”±ç”¨æˆ·æ€ä»£ç è¿›è¡Œï¼Œå¿«é€Ÿå¾ˆå¤šï¼Œé«˜æ•ˆçš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œå‡ ä¹æ— é™åˆ¶çš„çº¿ç¨‹æ•°é‡ã€‚ç¼ºç‚¹ï¼šå…¶ä¸­ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹é˜»å¡ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å°†æ— æ³•æ‰§è¡Œï¼›å¤„ç†å™¨å¢å¤šä¹Ÿä¸ä¼šæœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ã€‚&lt;/li&gt;&#xA;&lt;li&gt;å¤šå¯¹å¤šæ¨¡å‹ï¼Œå°†å¤šä¸ªç”¨æˆ·çº¿ç¨‹æ˜ å°„åˆ°å°‘æ•°ä½†ä¸æ­¢ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ä¸Šï¼Œä¸Šè¿°ä¸¤è€…æ¨¡å‹çš„æŠ˜ä¸­ï¼Œä¼˜ç¼ºç‚¹ä¹Ÿå¯¹åº”æŠ˜ä¸­ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;é™æ€é“¾æ¥&#34;&gt;&lt;span&gt;é™æ€é“¾æ¥&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e9%9d%99%e6%80%81%e9%93%be%e6%8e%a5&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;è¢«éšè—äº†çš„è¿‡ç¨‹&#34;&gt;&lt;span&gt;è¢«éšè—äº†çš„è¿‡ç¨‹&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e8%a2%ab%e9%9a%90%e8%97%8f%e4%ba%86%e7%9a%84%e8%bf%87%e7%a8%8b&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/programmer/%e9%9d%99%e6%80%81%e9%93%be%e6%8e%a5%e8%bf%87%e7%a8%8b.png&#34; title=&#34;/programmer/é™æ€é“¾æ¥è¿‡ç¨‹.png&#34; data-thumbnail=&#34;/programmer/é™æ€é“¾æ¥è¿‡ç¨‹.png&#34; data-sub-html=&#34;&lt;h2&gt;é™æ€é“¾æ¥è¿‡ç¨‹&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/programmer/é™æ€é“¾æ¥è¿‡ç¨‹.png&#39; alt=&#34;/programmer/é™æ€é“¾æ¥è¿‡ç¨‹.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;é™æ€é“¾æ¥è¿‡ç¨‹&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;é¢„å¤„ç†&#34;&gt;&lt;span&gt;é¢„å¤„ç†&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e9%a2%84%e5%a4%84%e7%90%86&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;p&gt;å‘½ä»¤ï¼šgcc -E hello.c -o hello.i&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;åˆ é™¤æ‰€æœ‰çš„&amp;quot;#define&amp;quot;ï¼Œå¹¶å±•å¼€æ‰€æœ‰å®å®šä¹‰&lt;/li&gt;&#xA;&lt;li&gt;å¤„ç†æ‰€æœ‰æ¡ä»¶é¢„ç¼–è¯‘æŒ‡ä»¤ï¼Œå¦‚&amp;quot;#if&amp;quot;ã€&amp;quot;#ifdef&amp;quot;ç­‰&lt;/li&gt;&#xA;&lt;li&gt;å¤„ç†&amp;quot;#include&amp;quot;é¢„ç¼–è¯‘æŒ‡ä»¤ï¼Œå°†è¢«åŒ…å«çš„æ–‡ä»¶æ’å…¥åˆ°è¯¥é¢„ç¼–è¯‘æŒ‡ä»¤çš„ä½ç½®&lt;/li&gt;&#xA;&lt;li&gt;åˆ é™¤æ‰€æœ‰çš„æ³¨é‡Š&amp;quot;//&amp;ldquo;å’Œ&amp;rdquo;/**/&amp;quot;&lt;/li&gt;&#xA;&lt;li&gt;æ·»åŠ è¡Œå·å’Œæ–‡ä»¶åæ ‡è¯†&lt;/li&gt;&#xA;&lt;li&gt;ä¿ç•™æ‰€æœ‰çš„#pragmaç¼–è¯‘å™¨æŒ‡ä»¤&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;é¢„å¤„ç†åçš„.iæ–‡ä»¶æ‰€æœ‰å®å·²ç»è¢«å±•å¼€ï¼Œä¸”åŒ…å«çš„æ–‡ä»¶ä¹Ÿå·²ç»è¢«æ’å…¥åˆ°.iæ–‡ä»¶ä¸­ã€‚å½“æ— æ³•åˆ¤æ–­å®å®šä¹‰æ˜¯å¦æ­£ç¡®æˆ–å¤´æ–‡ä»¶æ˜¯å¦æ­£ç¡®æ—¶ï¼Œå¯ä»¥æŸ¥çœ‹é¢„ç¼–è¯‘åçš„æ–‡ä»¶æ¥ç¡®å®šé—®é¢˜ã€‚&lt;/p&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;ç¼–è¯‘&#34;&gt;&lt;span&gt;ç¼–è¯‘&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e7%bc%96%e8%af%91&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;p&gt;å‘½ä»¤ï¼šgcc -S hello.i -o hello.s&#xA;å…·ä½“æ­¥éª¤åœ¨ä¸‹ä¸€èŠ‚ç®€å•ä»‹ç»ã€‚&#xA;gccå‘½ä»¤åªæ˜¯åå°ç¨‹åºçš„åŒ…è£…ï¼Œå®ƒä¼šæ ¹æ®ä¸åŒçš„å‚æ•°è¦æ±‚å»è°ƒç”¨é¢„ç¼–è¯‘ç¼–è¯‘ç¨‹åºcc1ã€æ±‡ç¼–å™¨asã€è¿æ¥å™¨ldã€‚&lt;/p&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;æ±‡ç¼–&#34;&gt;&lt;span&gt;æ±‡ç¼–&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%b1%87%e7%bc%96&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;p&gt;å‘½ä»¤ï¼šgcc -c hello.s -o hello.o&#xA;å°†æ±‡ç¼–ä»£ç è½¬å˜æˆæœºå™¨å¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œæ¯ä¸€ä¸ªæ±‡ç¼–è¯­å¥å‡ ä¹å¯¹åº”ä¸€æ¡æœºå™¨æŒ‡ä»¤ï¼Œè°ƒç”¨æ±‡ç¼–å™¨asæ¥å®Œæˆã€‚&lt;/p&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;é“¾æ¥&#34;&gt;&lt;span&gt;é“¾æ¥&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e9%93%be%e6%8e%a5&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ld -static crt1.o crti.o crtbeginT.o hello.o -start-group -lgcc -lgcc_eh -lc &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-end-group crtend.o crtn.o&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æœ¬ä¹¦ä¸»è¦ä»‹ç»ä¸Šè¿°é“¾æ¥çš„å†…å®¹ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;ç¼–è¯‘å™¨åšäº†ä»€ä¹ˆ&#34;&gt;&lt;span&gt;ç¼–è¯‘å™¨åšäº†ä»€ä¹ˆ&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e7%bc%96%e8%af%91%e5%99%a8%e5%81%9a%e4%ba%86%e4%bb%80%e4%b9%88&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;æºä»£ç é€šè¿‡è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†ææ„å»ºè¯­æ³•æ ‘ï¼Œå¹¶è¿›è¡Œä¼˜åŒ–ï¼Œè½¬ä¸ºä¸­é—´ä»£ç ï¼Œå®ƒæ˜¯è¯­æ³•æ ‘çš„é¡ºåºè¡¨ç¤ºã€‚ä¸­é—´ä»£ç ä½¿å¾—ç¼–è¯‘å™¨å¯ä»¥è¢«åˆ†ä¸ºå‰ç«¯å’Œåç«¯ï¼Œå‰ç«¯è´Ÿè´£äº§ç”Ÿæœºå™¨æ— å…³çš„ä¸­é—´ä»£ç ï¼Œåç«¯å°†ä¸­é—´ä»£ç è½¬æ¢æˆç›®æ ‡æœºå™¨ä»£ç ï¼Œå®ç°è·¨å¹³å°ã€‚ä»£ç ç”Ÿæˆå™¨å°†ä¸­é—´ä»£ç è½¬æ¢ä¸ºç›®æ ‡ä»£ç ï¼Œè¿™æ ·æºä»£ç è¢«ç¼–è¯‘æˆäº†ç›®æ ‡ä»£ç ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä»¥Cè¯­è¨€çš„æºä»£ç ä¸ºä¾‹ï¼š&lt;code&gt;array[index] = (index + 4) * (2 + 6)&lt;/code&gt;ä¸ºä¾‹ï¼Œå®ƒä¼šç¼–è¯‘æˆä¸ºç›®æ ‡ä»£ç ï¼Œä½†ç›®æ ‡ä»£ç ä¸­çš„indexå’Œarrayçš„åœ°å€è¿˜æ²¡ç¡®å®šï¼Œè¦æŠŠç›®æ ‡ä»£ç ç¼–è¯‘æˆèƒ½åœ¨æœºå™¨ä¸Šæ‰§è¡Œçš„æŒ‡ä»¤ï¼Œå¿…é¡»è¦ç¡®å®šindexå’Œarrayçš„åœ°å€ã€‚å¦‚æœindexå’Œarrayè·Ÿæºä»£ç åœ¨åŒä¸€ä¸ªç¼–è¯‘å•å…ƒï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å¯ä»¥ä¸ºå®ƒä»¬åˆ†é…ç©ºé—´ï¼Œç¡®å®šå®ƒä»¬çš„åœ°å€ã€‚ä½†æ˜¯å¦‚æœå®šä¹‰åœ¨å…¶ä»–ç¨‹åºæ¨¡å—ï¼Œæœ€ç»ˆè¿è¡Œæ—¶çš„ç»å¯¹åœ°å€éƒ½è¦åœ¨æœ€ç»ˆé“¾æ¥çš„æ—¶å€™æ‰èƒ½ç¡®å®šã€‚æ‰€ä»¥ç°ä»£ç¼–è¯‘å™¨å¯ä»¥å°†ä¸€ä¸ªæºä»£ç æ–‡ä»¶ç¼–è¯‘æˆä¸€ä¸ªæœªé“¾æ¥çš„ç›®æ ‡æ–‡ä»¶ï¼Œç„¶åç”±é“¾æ¥å™¨å°†è¿™äº›ç›®æ ‡æ–‡ä»¶é“¾æ¥èµ·æ¥å½¢æˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;é“¾æ¥å™¨å¹´é¾„æ¯”ç¼–è¯‘å™¨é•¿&#34;&gt;&lt;span&gt;é“¾æ¥å™¨å¹´é¾„æ¯”ç¼–è¯‘å™¨é•¿&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e9%93%be%e6%8e%a5%e5%99%a8%e5%b9%b4%e9%be%84%e6%af%94%e7%bc%96%e8%af%91%e5%99%a8%e9%95%bf&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;ç›®æ ‡æ–‡ä»¶çš„æŒ‡ä»¤å¯èƒ½ä¸ä¼šä¸€æˆä¸å˜ï¼Œå¯¹åº”çš„åœ°å€ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ï¼Œé‡æ–°è®¡ç®—å„ä¸ªç›®æ ‡çš„åœ°å€è¿‡ç¨‹å«åšé‡å®šä½ã€‚æ±‡ç¼–è¯­è¨€å°†æœºå™¨æŒ‡ä»¤éš¾ä»¥è®°ä½çš„å½¢å¼å˜ä¸ºæ˜“äºç†è§£è®°å¿†çš„ç¬¦å·ï¼Œç¬¦å·ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€å¯èƒ½æ˜¯ä¸€ä¸ªå˜é‡çš„å…¶å®åœ°å€ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€æ®µå­ç¨‹åºï¼ˆå‡½æ•°ï¼‰çš„èµ·å§‹åœ°å€ã€‚ä¸åŒæºä»£ç æ–‡ä»¶æ„æˆä¸åŒæ¨¡å—ï¼Œè¿™äº›æ¨¡å—ç»„åˆæˆç¨‹åºã€‚æœ€å¸¸è§çš„æ¨¡å—é€šä¿¡æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯æ¨¡å—é—´çš„å‡½æ•°è°ƒç”¨ï¼Œä¸€ç§æ˜¯æ¨¡å—é—´çš„å˜é‡è®¿é—®ã€‚å‡½æ•°è®¿é—®éœ€è¦çŸ¥é“ç›®æ ‡å‡½æ•°çš„åœ°å€ï¼Œå˜é‡è®¿é—®ä¹Ÿéœ€è¦çŸ¥é“ç›®æ ‡å˜é‡çš„åœ°å€ã€‚æ‰€ä»¥è¿™ä¸¤ç§æ–¹å¼éƒ½å½’ç»“ä¸ºä¸€ç§ï¼Œå°±æ˜¯æ¨¡å—é—´ç¬¦å·çš„å¼•ç”¨ã€‚è¿™ä¸ªæ¨¡å—æ‹¼æ¥çš„è¿‡ç¨‹å°±æ˜¯é“¾æ¥ã€‚&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;æ¨¡å—æ‹¼æ¥é™æ€é“¾æ¥&#34;&gt;&lt;span&gt;æ¨¡å—æ‹¼æ¥â€”â€”é™æ€é“¾æ¥&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e6%a8%a1%e5%9d%97%e6%8b%bc%e6%8e%a5%e9%9d%99%e6%80%81%e9%93%be%e6%8e%a5&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;ä»åŸç†ä¸Šè®²ï¼Œå®ƒçš„å·¥ä½œæ— éå°±æ˜¯æŠŠä¸€äº›æŒ‡ä»¤å¯¹å…¶ä»–ç¬¦å·åœ°å€çš„å¼•ç”¨åŠ ä»¥ä¿®æ­£ã€‚é“¾æ¥è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬äº†åœ°å€å’Œç©ºé—´åˆ†é…ã€ç¬¦å·å†³è®®å’Œé‡å®šä½ç­‰è¿™äº›æ­¥éª¤ã€‚&lt;/p&gt;&#xA;&lt;p&gt;PSï¼šç¬¦å·å†³è®®ä¹Ÿå¯ç§°ä½œç¬¦å·ç»‘å®šï¼Œå†³è®®æ›´å€¾å‘äºé™æ€é“¾æ¥ï¼Œç»‘å®šæ›´å€¾å‘äºåŠ¨æ€é“¾æ¥ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç›®æ ‡æ–‡ä»¶å’Œåº“ä¸€èµ·é“¾æ¥å½¢æˆæœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œæœ€å¸¸è§çš„åº“æ˜¯è¿è¡Œæ—¶åº“ï¼Œå®ƒæ˜¯æ”¯æŒç¨‹åºè¿è¡Œçš„åŸºæœ¬å‡½æ•°çš„é›†åˆã€‚åº“å…¶å®æ˜¯ä¸€ç»„ç›®æ ‡æ–‡ä»¶çš„åŒ…ï¼Œå°±æ˜¯ä¸€äº›æœ€å¸¸ç”¨çš„ä»£ç ç¼–è¯‘æˆç›®æ ‡æ–‡ä»¶åæ‰“åŒ…å­˜æ”¾ã€‚&lt;/p&gt;&#xA;&lt;p&gt;main.cæ¨¡å—å¦‚æœè°ƒç”¨äº†å¦ä¸€ä¸ªfunc.cæ¨¡å—çš„å‡½æ•°fooï¼Œåœ¨ç¼–è¯‘æ—¶main.cå¹¶ä¸çŸ¥é“fooçš„åœ°å€ï¼Œå®ƒæš‚æ—¶æç½®ï¼Œç­‰æœ€åé“¾æ¥çš„æ—¶å€™é“¾æ¥å™¨å¡«è¿™ä¸ªfooçš„åœ°å€ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨å¡«ã€‚è¿™ä¸ªåœ°å€ä¿®æ­£çš„è¿‡ç¨‹ä¹Ÿè¢«å«åšé‡å®šä½ï¼Œæ¯ä¸ªè¦è¢«ä¿®æ­£çš„åœ°æ–¹å«ä¸€ä¸ªé‡å®šä½å…¥å£ã€‚é‡å®šä½æ‰€åšçš„å°±æ˜¯ç»™ç¨‹åºä¸­æ¯ä¸ªè¿™æ ·çš„ç»å¯¹åœ°å€å¼•ç”¨çš„ä½ç½®â€œæ‰“è¡¥ä¸â€ï¼Œä½¿å®ƒä»¬æŒ‡å‘æ­£ç¡®çš„åœ°å€ã€‚&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;ç›®æ ‡æ–‡ä»¶é‡Œæœ‰ä»€ä¹ˆ&#34;&gt;&lt;span&gt;ç›®æ ‡æ–‡ä»¶é‡Œæœ‰ä»€ä¹ˆ&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e7%9b%ae%e6%a0%87%e6%96%87%e4%bb%b6%e9%87%8c%e6%9c%89%e4%bb%80%e4%b9%88&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;ç°åœ¨PCæµè¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ä¸»è¦æ˜¯Windowsä¸‹çš„PEå’ŒLinuxä¸‹çš„ELFã€‚ç›®æ ‡æ–‡ä»¶è·Ÿå¯æ‰§è¡Œæ–‡ä»¶çš„å†…å®¹ä¸ç»“æ„å¾ˆç›¸ä¼¼ï¼Œä¸€èˆ¬ä¸€èµ·é‡‡ç”¨ä¸€ç§æ ¼å¼å­˜å‚¨ï¼Œå¯ä»¥å¹¿ä¹‰åœ°å°†ç›®æ ‡æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶çœ‹æˆæ˜¯ä¸€ç§ç±»å‹çš„æ–‡ä»¶ã€‚åŠ¨æ€é“¾æ¥åº“åŠé™æ€é“¾æ¥åº“æ–‡ä»¶éƒ½æŒ‰ç…§å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼å­˜å‚¨ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/programmer/ELF%e6%96%87%e4%bb%b6%e7%b1%bb%e5%9e%8b.png&#34; title=&#34;/programmer/ELFæ–‡ä»¶ç±»å‹.png&#34; data-thumbnail=&#34;/programmer/ELFæ–‡ä»¶ç±»å‹.png&#34; data-sub-html=&#34;&lt;h2&gt;ELFæ–‡ä»¶ç±»å‹&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/programmer/ELFæ–‡ä»¶ç±»å‹.png&#39; alt=&#34;/programmer/ELFæ–‡ä»¶ç±»å‹.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;ELFæ–‡ä»¶ç±»å‹&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/programmer/ELF%e6%96%87%e4%bb%b6%e7%b1%bb%e5%9e%8b%e7%bb%ad%e8%a1%a8.png&#34; title=&#34;/programmer/ELFæ–‡ä»¶ç±»å‹ç»­è¡¨.png&#34; data-thumbnail=&#34;/programmer/ELFæ–‡ä»¶ç±»å‹ç»­è¡¨.png&#34; data-sub-html=&#34;&lt;h2&gt;ELFæ–‡ä»¶ç±»å‹ç»­è¡¨&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/programmer/ELFæ–‡ä»¶ç±»å‹ç»­è¡¨.png&#39; alt=&#34;/programmer/ELFæ–‡ä»¶ç±»å‹ç»­è¡¨.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;ELFæ–‡ä»¶ç±»å‹ç»­è¡¨&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;ELFæ–‡ä»¶æ ¼å¼åˆ†æ®µï¼šæ–‡ä»¶å¤´ï¼ˆæ–‡ä»¶å…ƒæ•°æ®ï¼‰ã€.textæ®µï¼ˆä»£ç ï¼‰ã€.dataæ®µï¼ˆæ•°æ®ï¼‰å’Œ.bssæ®µï¼ˆæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡ï¼‰ã€‚&lt;/p&gt;&#xA;&lt;p&gt;æŒ‡ä»¤å’Œæ•°æ®åˆ†å¼€çš„å¥½å¤„ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;æŒ‡ä»¤å’Œæ•°æ®åˆ†åˆ«è¢«æ˜ å°„åˆ°ä¸¤ä¸ªè™šæ‹Ÿå†…å­˜åŒºåŸŸï¼Œæ•°æ®åŒºæ˜¯å¯è¯»å¯å†™çš„ï¼ŒæŒ‡ä»¤åŒºæ˜¯åªè¯»çš„ï¼Œå¯¹åº”æƒé™åˆ†å¼€ã€‚&lt;/li&gt;&#xA;&lt;li&gt;åˆ©äºæé«˜ç¨‹åºçš„å±€éƒ¨æ€§ï¼Œç°ä»£CPUç¼“å­˜è®¾è®¡ä¸ºæ•°æ®ç¼“å­˜å’ŒæŒ‡ä»¤ç¼“å­˜åˆ†ç¦»ï¼Œæ‰€ä»¥ç¨‹åºçš„æ•°æ®å’ŒæŒ‡ä»¤åˆ†å¼€å­˜æ”¾å¯¹CPUç¼“å­˜å‘½ä¸­ç‡æé«˜æœ‰å¥½å¤„ã€‚&lt;/li&gt;&#xA;&lt;li&gt;æœ€é‡è¦çš„åŸå› ï¼Œå…±äº«æŒ‡ä»¤ï¼Œç³»ç»Ÿè¿è¡Œå¤šä¸ªè¯¥ç¨‹åºçš„å‰¯æœ¬æ—¶ï¼Œå†…å­˜åªéœ€è¦ä¿å­˜ä¸€ä»½è¯¥ç¨‹åºçš„æŒ‡ä»¤éƒ¨åˆ†ï¼Œæ•°æ®éƒ¨åˆ†æ˜¯ç§æœ‰çš„ã€‚ç‰¹åˆ«æ˜¯æœ‰åŠ¨æ€é“¾æ¥çš„ç³»ç»Ÿå¯ä»¥èŠ‚çœå¤§é‡çš„å†…å­˜ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;Linuxå‘½ä»¤objdumpæŸ¥çœ‹.oæ–‡ä»¶å†…éƒ¨ç»“æ„ï¼Œobjdump -hæŠŠELFæ–‡ä»¶çš„å„ä¸ªæ®µçš„åŸºæœ¬ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Œobjdump -s -då°†æ–‡ä»¶å†…å®¹ä»¥åå…­è¿›åˆ¶æ–¹å¼æ‰“å°å¹¶å°†æ‰€æœ‰æŒ‡ä»¤æ®µåæ±‡ç¼–ã€‚Linuxå·¥å…·readelfæ˜¯é’ˆå¯¹ELFæ ¼å¼çš„è§£æå™¨ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åœ¨é“¾æ¥ä¸­ï¼Œå°†å‡½æ•°å’Œå˜é‡ç»Ÿç§°ä¸ºç¬¦å·ï¼Œå‡½æ•°åæˆ–å˜é‡åå°±æ˜¯ç¬¦å·åã€‚æ¯ä¸ªç›®æ ‡æ–‡ä»¶éƒ½ä¼šæœ‰ä¸€ä¸ªç›¸åº”çš„ç¬¦å·è¡¨ï¼Œè¡¨é‡Œè®°å½•äº†æ‰€æœ‰ç”¨åˆ°çš„ç¬¦å·ï¼ŒåŠå…¶å¯¹åº”çš„åœ°å€ã€‚é™¤äº†å‡½æ•°å’Œå˜é‡ï¼Œè¿˜å­˜åœ¨å…¶ä»–å‡ ç§ä¸å¸¸ç”¨åˆ°çš„ç¬¦å·ï¼Œå¦‚å®šä¹‰åœ¨æœ¬æ–‡ä»¶ä¸­çš„å…¨å±€ç¬¦å·ã€å¤–éƒ¨ç¬¦å·ã€æ®µåã€å±€éƒ¨ç¬¦å·ã€è¡Œå·ä¿¡æ¯ã€‚é“¾æ¥åªå…³å¿ƒå…¨å±€ç¬¦å·çš„ç›¸äº’ç²˜åˆï¼Œæ‰€ä»¥æ®µåã€å±€éƒ¨ç¬¦å·ã€è¡Œå·ä¿¡æ¯æ— å…³ç´§è¦ã€‚ä½¿ç”¨nmå¯ä»¥æŸ¥çœ‹.oæ–‡ä»¶çš„ç¬¦å·è¡¨ï¼Œæ‰“å°ç¬¦å·åŠå…¶åœ°å€ã€‚&lt;/p&gt;&#xA;&lt;p&gt;C++  ç¬¦å·ä¿®é¥°ï¼šC++  æ”¯æŒå‡½æ•°é‡è½½ã€å¤šæ€ï¼Œå‡½æ•°é‡è½½æ˜¯å‡½æ•°åŒåä½†å‚æ•°åˆ—è¡¨ä¸åŒï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å’Œé“¾æ¥å™¨æ€ä¹ˆåŒºåˆ†è¿™ä¸¤ä¸ªå‡½æ•°å¯¹åº”çš„ç¬¦å·å‘¢ï¼Ÿ&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;float&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;float&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;C2&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;namespace&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;N&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;C&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;è¿™æ®µä»£ç ä¸­æœ‰6ä¸ªåŒåå‡½æ•°ï¼Œç¼–è¯‘å™¨åœ¨å°†C++ æºä»£ç ç¼–è¯‘æˆç›®æ ‡æ–‡ä»¶æ—¶ï¼Œä¼šå°†å‡½æ•°å’Œå˜é‡çš„åå­—è¿›è¡Œä¿®é¥°ï¼Œå½¢æˆç¬¦å·åã€‚ä¸Šé¢6ä¸ªå‡½æ•°ç­¾ååœ¨GCCç¼–è¯‘å™¨ä¸‹ï¼Œå¯¹åº”çš„ä¿®é¥°ååç§°å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/programmer/%e5%87%bd%e6%95%b0%e7%ad%be%e5%90%8d.png&#34; title=&#34;/programmer/å‡½æ•°ç­¾å.png&#34; data-thumbnail=&#34;/programmer/å‡½æ•°ç­¾å.png&#34; data-sub-html=&#34;&lt;h2&gt;å‡½æ•°ç­¾å&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/programmer/å‡½æ•°ç­¾å.png&#39; alt=&#34;/programmer/å‡½æ•°ç­¾å.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;å‡½æ•°ç­¾å&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;å®ƒä»¬ä¾ç…§GCCçš„C++ åç§°ä¿®é¥°æ–¹æ³•è¿›è¡Œä¿®é¥°ï¼Œç­¾åå’Œåç§°ä¿®é¥°æœºåˆ¶ä¸å…‰è¢«ä½¿ç”¨åˆ°å‡½æ•°ä¸Šï¼Œå…¨å±€å˜é‡å’Œé™æ€å˜é‡ä¹Ÿæœ‰åŒæ ·çš„æœºåˆ¶ã€‚ä¸åŒç¼–è¯‘å™¨å‚å•†çš„åç§°ä¿®é¥°æ–¹æ³•ä¹Ÿå¯èƒ½ä¸åŒï¼Œæœ‰æ—¶å¯èƒ½éœ€è¦å°†ä¸€ä¸ªä¿®é¥°ååå­—è½¬æ¢æˆå‡½æ•°ç­¾åï¼Œæ¯”å¦‚åœ¨é“¾æ¥ã€è°ƒè¯•æ—¶å¯èƒ½ä¼šç”¨åˆ°ã€‚è¿™é‡Œç»™å‡ºå‡ ç§å°†ç¬¦å·åè½¬ä¸ºå‡½æ•°ç­¾åçš„æ–¹æ³•ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;ä½¿ç”¨demanglerå·¥å…·ï¼ˆå‡½æ•°ç­¾åä¿®é¥°çš„è¿‡ç¨‹å«åšmanglerï¼Œåè¿‡æ¥å«åšdemanglerï¼‰&lt;/li&gt;&#xA;&lt;li&gt;Linuxä¸‹GCCç¼–è¯‘å™¨ä½¿ç”¨C++ filtå‘½ä»¤ï¼Œå¦‚C++ filt _Z4funciå‘½ä»¤è¾“å‡ºï¼šint func(int)&lt;/li&gt;&#xA;&lt;li&gt;Windowsä¸‹MSVCç¼–è¯‘å™¨ä½¿ç”¨undnameå‘½ä»¤&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;æ­¤å¤–ï¼Œè¿™é‡Œä¹Ÿä½“ç°äº†ç”±äºä¸åŒç¼–è¯‘å™¨é‡‡ç”¨ä¸åŒçš„åå­—ä¿®é¥°æ–¹æ³•ï¼Œå¿…ç„¶ä¼šå¯¼è‡´ç”±ä¸åŒç¼–è¯‘å™¨äº§ç”Ÿçš„ç›®æ ‡æ–‡ä»¶æ— æ³•æ­£å¸¸ç›¸äº’è¿æ¥ï¼Œè¿™æ˜¯å¯¼è‡´ä¸åŒç¼–è¯‘å™¨ä¹‹é—´ä¸èƒ½ç›¸äº’æ“ä½œçš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚&lt;/p&gt;&#xA;&lt;p&gt;C++ ä¸ºäº†å’ŒCå…¼å®¹ï¼Œåœ¨C++ ä¸­è°ƒç”¨Cä»£ç ï¼Œä½¿ç”¨extern &amp;ldquo;C&amp;quot;å…³é”®å­—ç”¨æ³•ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;extern&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;var&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;è¿™æ ·ï¼Œextern &amp;ldquo;C&amp;quot;ä¸­çš„å‡½æ•°å’Œå˜é‡å°±ä¼šæŒ‰ç…§Cè¯­è¨€çš„ç¬¦å·ä¿®é¥°ï¼Œä¹Ÿå°±èƒ½æˆåŠŸé“¾æ¥åˆ°å…¶å¯¹åº”çš„Cå‡½æ•°ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬åœ¨å¼•å…¥Cè¯­è¨€çš„åº“å¤´æ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶å†…åˆä¼šå¼•ç”¨å…¶ä»–Cè¯­è¨€å‡½æ•°ï¼Œæ¯”å¦‚string.hä¸­å£°æ˜memsetå‡½æ•°ï¼Œåœ¨Cè¯­è¨€ä¸­çš„string.hæ˜¯æ²¡æœ‰ç¼–è¯‘é—®é¢˜çš„ï¼Œä½†C++ è°ƒç”¨memsetæ—¶ï¼Œä¼šç”¨C++ ç¬¦å·ä¿®é¥°è§„åˆ™è¿›è¡Œä¿®é¥°ï¼Œæ‰€ä»¥å¿…é¡»å°†memsetå‡½æ•°å£°æ˜ä¸ºextern &amp;ldquo;C&amp;rdquo;ï¼Œä½†string.hæ˜¯Cè¯­è¨€ï¼ŒCè¯­è¨€ä¸­åˆä¸æ”¯æŒextern &amp;ldquo;C&amp;quot;è¯­æ³•ã€‚è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨C++ çš„å®&amp;rdquo;__cplusplus&amp;rdquo;ï¼ŒC++ ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘C++ ç¨‹åºæ—¶é»˜è®¤å®šä¹‰è¿™ä¸ªå®ã€‚æ‰€ä»¥åœ¨æ‰€æœ‰å¤´æ–‡ä»¶ä¸­ä½¿ç”¨è¯¥å®å®šä¹‰è¿›è¡Œåˆ¤æ–­æ˜¯Cä»£ç è¿˜æ˜¯C++ ä»£ç æ¥å®ç°ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#ifdef __cplusplus&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;extern&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;C&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#endif&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;memset&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#ifdef __cplusplus&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;é™æ€é“¾æ¥è¿‡ç¨‹&#34;&gt;&lt;span&gt;é™æ€é“¾æ¥è¿‡ç¨‹&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e9%9d%99%e6%80%81%e9%93%be%e6%8e%a5%e8%bf%87%e7%a8%8b&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;å½“æˆ‘ä»¬æœ‰ä¸¤ä¸ªç›®æ ‡æ–‡ä»¶æ—¶ï¼Œå¦‚ä½•å°†å®ƒä»¬é“¾æ¥èµ·æ¥å½¢æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Ÿè¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿè¿™å°±æ˜¯é“¾æ¥çš„æ ¸å¿ƒå†…å®¹ï¼šé™æ€é“¾æ¥ã€‚å¯æ‰§è¡Œæ–‡ä»¶çš„ä»£ç æ®µå’Œæ•°æ®æ®µéƒ½æ˜¯ç”±ç›®æ ‡æ–‡ä»¶ä¸­åˆå¹¶è€Œæ¥çš„ï¼Œé‚£ä¹ˆå¯¹äºå¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œé“¾æ¥å™¨å¦‚ä½•å°†å®ƒä»¬å„è‡ªæ®µåˆå¹¶åˆ°è¾“å‡ºæ–‡ä»¶ï¼Ÿ&lt;/p&gt;&#xA;&lt;p&gt;æŒ‰åºå åŠ ï¼š&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/programmer/%e6%8c%89%e5%ba%8f%e5%8f%a0%e5%8a%a0.png&#34; title=&#34;/programmer/æŒ‰åºå åŠ .png&#34; data-thumbnail=&#34;/programmer/æŒ‰åºå åŠ .png&#34; data-sub-html=&#34;&lt;h2&gt;æŒ‰åºå åŠ &lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/programmer/æŒ‰åºå åŠ .png&#39; alt=&#34;/programmer/æŒ‰åºå åŠ .png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;æŒ‰åºå åŠ &lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;è¿™æ ·ä¸€ä¸ªè§„æ¨¡è¾ƒå¤§çš„åº”ç”¨ç¨‹åºå¯èƒ½ä¼šæœ‰æ•°ç™¾ä¸ªç›®æ ‡æ–‡ä»¶ï¼Œå°±ä¼šæœ‰æˆç™¾ä¸Šåƒä¸ªé›¶æ•£çš„æ®µï¼Œæ¯ä¸ªæ®µåˆè¦åšåˆ°ç©ºé—´å¯¹é½ï¼ˆæ¯”å¦‚é¡µå¯¹é½ï¼‰ï¼Œé€ æˆæœ‰å¤§é‡çš„å†…éƒ¨ç¢ç‰‡ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç›¸ä¼¼æ®µåˆå¹¶ï¼š&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/programmer/%e7%9b%b8%e4%bc%bc%e6%ae%b5%e5%90%88%e5%b9%b6.png&#34; title=&#34;/programmer/ç›¸ä¼¼æ®µåˆå¹¶.png&#34; data-thumbnail=&#34;/programmer/ç›¸ä¼¼æ®µåˆå¹¶.png&#34; data-sub-html=&#34;&lt;h2&gt;ç›¸ä¼¼æ®µåˆå¹¶&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/programmer/ç›¸ä¼¼æ®µåˆå¹¶.png&#39; alt=&#34;/programmer/ç›¸ä¼¼æ®µåˆå¹¶.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;ç›¸ä¼¼æ®µåˆå¹¶&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;å°†ç›¸åŒæ€§è´¨çš„æ®µåˆå¹¶åˆ°ä¸€èµ·ï¼Œé“¾æ¥å™¨ä¸ºç›®æ ‡æ–‡ä»¶åˆ†é…åœ°å€å’Œç©ºé—´ã€‚è¿™é‡Œçš„åœ°å€å’Œç©ºé—´æœ‰ä¸¤ä¸ªå«ä¹‰ï¼š1. åœ¨è¾“å‡ºçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ç©ºé—´ï¼›2. åœ¨è£…è½½åçš„è™šæ‹Ÿåœ°å€ä¸­çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚å¯¹äºæœ‰å®é™…æ•°æ®çš„æ®µï¼Œæ¯”å¦‚.textå’Œ.dataæ®µæ¥è¯´ï¼Œå®ƒä»¬åœ¨æ–‡ä»¶å’Œè™šæ‹Ÿåœ°å€ä¸­éƒ½è¦åˆ†é…ç©ºé—´ï¼›è€Œå¯¹äº.bssæ®µæ¥è¯´ï¼Œåˆ†é…ç©ºé—´åªåœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå› ä¸ºå®ƒåœ¨æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰å†…å®¹ï¼ˆè¿™é‡Œæ˜¯æŒ‡.bssæ®µåªæ˜¯ä¸ºæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡é¢„ç•™ä½ç½®ï¼Œå®ƒæ²¡æœ‰å†…å®¹ï¼Œæ‰€ä»¥åœ¨æ–‡ä»¶ä¸­ä¹Ÿä¸å æ®ç©ºé—´ï¼Œæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡é»˜è®¤å€¼éƒ½ä¸º0ï¼Œæœ¬æ¥ä¹Ÿè¦æ”¾åœ¨.dataæ®µçš„ï¼Œä½†æ˜¯å› ä¸ºéƒ½æ˜¯0ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦åœ¨.dataä¸­åˆ†é…ç©ºé—´å¹¶å…¨å¡«0ï¼Œä½†ç¨‹åºè¿è¡Œæ—¶å®ƒä»¬çš„ç¡®è¦å å†…å­˜ç©ºé—´ï¼Œå¹¶ä¸”éœ€è¦è®°å½•æ‰€æœ‰æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡çš„å¤§å°æ€»å’Œï¼Œè®°ä¸º.bssæ®µï¼‰ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä¸¤æ­¥é“¾æ¥æ³•ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;ç©ºé—´ä¸åœ°å€åˆ†é…ï¼šæ‰«ææ‰€æœ‰è¾“å…¥ç›®æ ‡æ–‡ä»¶ï¼Œå¹¶è·å¾—å„ä¸ªæ®µçš„é•¿åº¦ã€å±æ€§å’Œä½ç½®ï¼Œå¹¶æ”¶é›†è¾“å…¥ç›®æ ‡æ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨ï¼Œç»Ÿä¸€æ”¾åˆ°ä¸€ä¸ªå…¨å±€ç¬¦å·è¡¨ä¸­ã€‚å¹¶ä¸”è®¡ç®—å‡ºè¾“å‡ºæ–‡ä»¶ä¸­å„ä¸ªæ®µåˆå¹¶åçš„é•¿åº¦ä¸ä½ç½®ï¼Œå¹¶å»ºç«‹æ˜ å°„å…³ç³»ã€‚&lt;/li&gt;&#xA;&lt;li&gt;ç¬¦å·è§£æä¸é‡å®šä½ï¼šè¯»å–è¾“å…¥æ–‡ä»¶ä¸­æ®µçš„æ•°æ®ã€é‡å®šä½ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œç¬¦å·è§£æä¸é‡å®šä½ã€è°ƒæ•´ä»£ç ä¸­çš„ä½ç½®ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/programmer/%e4%b8%a4%e6%ad%a5%e9%93%be%e6%8e%a5%e6%b3%95.png&#34; title=&#34;/programmer/ä¸¤æ­¥é“¾æ¥æ³•.png&#34; data-thumbnail=&#34;/programmer/ä¸¤æ­¥é“¾æ¥æ³•.png&#34; data-sub-html=&#34;&lt;h2&gt;ä¸¤æ­¥é“¾æ¥æ³•&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/programmer/ä¸¤æ­¥é“¾æ¥æ³•.png&#39; alt=&#34;/programmer/ä¸¤æ­¥é“¾æ¥æ³•.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;ä¸¤æ­¥é“¾æ¥æ³•&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;ä¸Šå›¾å°†ä¸¤ä¸ª.oæ–‡ä»¶è¿›è¡Œåˆå¹¶è®¡ç®—å¾—åˆ°è™šæ‹Ÿåœ°å€ç©ºé—´åï¼Œé“¾æ¥å™¨å¼€å§‹è®¡ç®—å„ä¸ªç¬¦å·çš„è™šæ‹Ÿåœ°å€ã€‚å› ä¸ºå„ä¸ªç¬¦å·åœ¨æ®µå†…çš„ç›¸å¯¹ä½ç½®æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥åœ¨ä¸Šè¿°æ®µèµ·å§‹åœ°å€åŸºç¡€ä¸ŠåŠ ä¸Šç¬¦å·å¯¹åº”çš„ç›¸å¯¹ä½ç½®åç§»é‡å³å¯ã€‚&lt;/p&gt;&#xA;&lt;p&gt;é™æ€é“¾æ¥çš„æ ¸å¿ƒå†…å®¹ï¼šç¬¦å·è§£æä¸é‡å®šä½ã€‚&lt;/p&gt;&#xA;&lt;p&gt;.oæ–‡ä»¶å¼•ç”¨äº†å¤–éƒ¨ç¬¦å·ï¼Œæ¯”å¦‚&amp;quot;a.c&amp;quot;æ–‡ä»¶ä½¿ç”¨äº†&amp;quot;b.c&amp;quot;æ–‡ä»¶ä¸­çš„sharedå˜é‡å’Œswapå‡½æ•°ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘&amp;quot;a.c&amp;quot;æ—¶ï¼Œä¼šå¯¹sharedå˜é‡åœ°å€æš‚æ—¶ç”¨&amp;quot;0x00000000&amp;rdquo;ï¼Œswapå‡½æ•°åœ°å€æš‚æ—¶ç”¨&amp;quot;0xFFFFFFFC&amp;quot;æ›¿ä»£ï¼ŒæŠŠçœŸæ­£çš„åœ°å€è®¡ç®—å·¥ä½œç•™ç»™äº†é“¾æ¥å™¨ã€‚åœ¨ç»è¿‡ä¸Šä¸€æ­¥éª¤è®¡ç®—å¾—åˆ°æ¯ä¸ªç¬¦å·çš„è™šæ‹Ÿåœ°å€åï¼Œå°±å¯ä»¥é‡å®šä½ä¸Šè¿°æŒ‡ä»¤ä¸­çš„å¤–éƒ¨ç¬¦å·ï¼Œå¡«ä¸ºæ­£ç¡®çš„åœ°å€ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¯¹äºå¯é‡å®šä½çš„ELFæ–‡ä»¶æ¥è¯´ï¼Œå®ƒå¿…é¡»åŒ…å«æœ‰é‡å®šä½è¡¨ï¼Œç”¨æ¥æè¿°å¦‚ä½•ä¿®æ”¹ç›¸åº”æ®µé‡Œçš„å†…å®¹ã€‚æ¯”å¦‚ï¼Œ&amp;quot;.rel.text&amp;quot;ä¿å­˜ä»£ç æ®µçš„é‡å®šä½è¡¨ï¼Œ&amp;quot;.rel.data&amp;quot;ä¿å­˜æ•°æ®æ®µçš„é‡å®šä½è¡¨ã€‚&lt;/p&gt;&#xA;&lt;p&gt;mainå‡½æ•°è¢«è°ƒç”¨ä¹‹å‰ï¼Œè¦å…ˆåˆå§‹åŒ–è¿›ç¨‹æ‰§è¡Œç¯å¢ƒï¼Œæ¯”å¦‚å †åˆ†é…åˆå§‹åŒ–ï¼ˆmallocã€freeï¼‰ç­‰ï¼ŒC++ çš„å…¨å±€å¯¹è±¡æ„é€ å‡½æ•°ä¹Ÿæ˜¯è¿™ä¸€æ—¶æœŸè¢«æ‰§è¡Œçš„ã€‚C++ çš„å…¨å±€å¯¹è±¡çš„æ„é€ å‡½æ•°åœ¨mainä¹‹å‰è¢«æ‰§è¡Œï¼Œææ„å‡½æ•°åœ¨mainä¹‹åè¢«æ‰§è¡Œã€‚&lt;/p&gt;&#xA;&lt;p&gt;Linuxç³»ç»Ÿä¸‹ä¸€èˆ¬ç¨‹åºçš„å…¥å£æ˜¯&amp;quot;_start&amp;quot;ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯Glibcçš„ä¸€éƒ¨åˆ†ï¼Œå½“æˆ‘ä»¬çš„ç¨‹åºä¸Glibcé“¾æ¥æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶åï¼Œ&amp;quot;_start&amp;quot;å°±æ˜¯ç¨‹åºçš„åˆå§‹åŒ–å…¥å£ï¼Œå®Œæˆä¸€ç³»åˆ—åˆå§‹åŒ–è¿‡ç¨‹ä¹‹åï¼Œä¼šè°ƒç”¨mainå‡½æ•°æ‰§è¡Œç¨‹åºçš„ä¸»ä½“ã€‚mainå‡½æ•°æ‰§è¡Œå®Œæˆåä¼šè¿”å›åˆ°åˆå§‹åŒ–éƒ¨åˆ†ï¼Œè¿›è¡Œä¸€äº›æ¸…ç†å·¥ä½œï¼Œç„¶åç»“æŸè¿›ç¨‹ã€‚å› æ­¤ï¼ŒELFæ–‡ä»¶è¿˜å®šä¹‰äº†ä¸¤ç§ç‰¹æ®Šçš„æ®µï¼š&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;.initæ®µï¼Œä¿å­˜å¯æ‰§è¡ŒæŒ‡ä»¤ï¼Œæ„æˆè¿›ç¨‹çš„åˆå§‹åŒ–ä»£ç ï¼Œåœ¨mainå‡½æ•°è¢«è°ƒç”¨ä¹‹å‰ï¼ŒGlibcçš„åˆå§‹åŒ–éƒ¨åˆ†å®‰æ’æ‰§è¡Œè¿™ä¸ªæ®µçš„ä»£ç &lt;/li&gt;&#xA;&lt;li&gt;.finiæ®µï¼Œä¿å­˜è¿›ç¨‹ç»ˆæ­¢ä»£ç æŒ‡ä»¤ï¼Œåœ¨mainå‡½æ•°æ­£å¸¸é€€å‡ºæ—¶ï¼ŒGlibcå®‰æ’æ‰§è¡Œè¿™ä¸ªæ®µçš„ä»£ç &lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;C++ çš„å…¨å±€æ„é€ å’Œææ„å‡½æ•°å°±æ”¾åˆ°ä¸Šè¿°ä¸¤ä¸ªæ®µä¸­ï¼Œç”±æ­¤å®ç°ã€‚&lt;/p&gt;&#xA;&lt;p&gt;é™æ€é“¾æ¥åº“å¯ä»¥çœ‹æˆä¸€ç»„ç›®æ ‡æ–‡ä»¶çš„é›†åˆï¼ŒæŠŠé›¶æ•£çš„ç›®æ ‡æ–‡ä»¶ç›´æ¥æä¾›ç»™åº“çš„ä½¿ç”¨è€…ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šä¼šé€ æˆæ–‡ä»¶ä¼ è¾“ã€ç®¡ç†å’Œç»„ç»‡çš„ä¸ä¾¿ï¼Œäºæ˜¯äººä»¬ä½¿ç”¨&amp;quot;ar&amp;quot;å°†è¿™äº›ç›®æ ‡æ–‡ä»¶å‹ç¼©åˆ°ä¸€èµ·ï¼Œå¹¶å¯¹å…¶è¿›è¡Œç¼–å·å’Œç´¢å¼•ï¼Œä»¥ä¾¿æŸ¥æ‰¾å’Œæ£€ç´¢ï¼Œå°±å½¢æˆäº†libc.aè¿™ä¸ªé™æ€åº“æ–‡ä»¶ã€‚ä½¿ç”¨objdump -t lib.aåæ±‡ç¼–æŸ¥æ‰¾ä½ æƒ³è¦æ‰¾çš„å‡½æ•°ç¬¦å·æ‰€åœ¨çš„.oæ–‡ä»¶ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è€Œä¸”libc.aä¸­çš„.oæ–‡ä»¶æ˜¯å­˜åœ¨ä¾èµ–çš„ï¼Œä¸æ˜¯åªè§£å‹å…¶ä¸­ä¸€ä¸ªç”¨åˆ°çš„.oæ–‡ä»¶è¿›è¡Œé“¾æ¥å°±å¯ä»¥ï¼Œå…¶ä¸­çš„.oæ–‡ä»¶å¯èƒ½è¿˜ä¾èµ–å…¶ä»–.oæ–‡ä»¶ã€‚ç›´æ¥ä¸lib.aé™æ€åº“è¿›è¡Œé“¾æ¥ä¹Ÿæ˜¯ä¸å¯ä»¥çš„ï¼Œè¿˜éœ€è¦ç”¨åˆ°å…¶ä»–ä¸€äº›è¾…åŠ©æ€§è´¨çš„ç›®æ ‡æ–‡ä»¶å’Œåº“ã€‚&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;è£…è½½ä¸åŠ¨æ€é“¾æ¥&#34;&gt;&lt;span&gt;è£…è½½ä¸åŠ¨æ€é“¾æ¥&lt;/span&gt;&#xA;  &lt;a href=&#34;#%e8%a3%85%e8%bd%bd%e4%b8%8e%e5%8a%a8%e6%80%81%e9%93%be%e6%8e%a5&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;ç”±äºELFæ–‡ä»¶æ ¼å¼çš„æ–‡ä»¶æ˜¯åˆ†æ®µçš„ï¼Œå­˜åœ¨é¡µé¢å¯¹é½çš„é—®é¢˜ï¼Œå³å¯èƒ½ä¼šäº§ç”Ÿé¡µé¢å†…éƒ¨ç¢ç‰‡ï¼Œåœ¨è£…è½½æ—¶ï¼Œä¼šå°†å…·æœ‰ç›¸åŒæƒé™çš„ä¸åŒæ®µè¿›è¡Œåˆå¹¶ã€‚æ‰€æœ‰ç›¸åŒå±æ€§çš„â€œSectionâ€è¢«å½’ç±»ä¸ºä¸€ä¸ªâ€œSegmentâ€ï¼Œå¹¶ä¸”æ˜ å°„åˆ°åŒä¸€ä¸ªVMAã€‚å½“æˆ‘ä»¬è°ˆåˆ°ELFè£…è½½æ—¶ï¼Œâ€œæ®µâ€ä¸“é—¨æŒ‡â€œSegmentâ€ï¼›å…¶ä»–æƒ…å†µä¸‹ï¼Œâ€œæ®µâ€æŒ‡çš„æ˜¯â€œSectionâ€ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/programmer/ELF%e6%96%87%e4%bb%b6%e8%a3%85%e8%bd%bd.png&#34; title=&#34;/programmer/ELFæ–‡ä»¶è£…è½½.png&#34; data-thumbnail=&#34;/programmer/ELFæ–‡ä»¶è£…è½½.png&#34; data-sub-html=&#34;&lt;h2&gt;ELFæ–‡ä»¶è£…è½½&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/programmer/ELFæ–‡ä»¶è£…è½½.png&#39; alt=&#34;/programmer/ELFæ–‡ä»¶è£…è½½.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;ELFæ–‡ä»¶è£…è½½&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;å¯æ‰§è¡Œæ–‡ä»¶æœ€ç»ˆæ˜¯è¦è¢«OSè£…è½½è¿è¡Œçš„ï¼Œè¿™ä¸ªè£…è½½çš„è¿‡ç¨‹ä¸€èˆ¬æ˜¯é€šè¿‡è™šæ‹Ÿå†…å­˜çš„é¡µæ˜ å°„æœºåˆ¶å®Œæˆçš„ã€‚Linuxå†…æ ¸è£…è½½ELFæ–‡ä»¶çš„è¿‡ç¨‹ï¼šç”¨æˆ·å±‚é¢ï¼Œbashè¿›ç¨‹è°ƒç”¨fork()ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œç„¶åè°ƒç”¨execve()ç³»ç»Ÿè°ƒç”¨æ‰§è¡ŒæŒ‡å®šçš„ELFæ–‡ä»¶ï¼Œexecve()ç³»ç»Ÿè°ƒç”¨ç›¸åº”çš„å…¥å£æ˜¯sys_execve()ï¼Œå®ƒè¿›è¡Œä¸€äº›å‚æ•°çš„æ£€æŸ¥å¤åˆ¶ä¹‹åï¼Œè°ƒç”¨do_execve()ï¼Œé¦–å…ˆæŸ¥æ‰¾è¢«æ‰§è¡Œçš„æ–‡ä»¶ï¼Œå¦‚æœæ‰¾åˆ°æ–‡ä»¶ï¼Œåˆ™è¯»å–æ–‡ä»¶çš„å‰128ä¸ªå­—èŠ‚ï¼Œè¿™å‰128ä¸ªå­—èŠ‚çš„ç›®çš„æ˜¯åˆ¤æ–­æ–‡ä»¶çš„æ ¼å¼ã€‚ç„¶åè°ƒç”¨search_binary_handle()å»æœç´¢å’ŒåŒ¹é…åˆé€‚çš„å¯æ‰§è¡Œæ–‡ä»¶è£…è½½å¤„ç†è¿‡ç¨‹ã€‚æ¯ä¸ªæ ¼å¼æ–‡ä»¶æœ‰å…¶å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œä»¥load_elf_binary()ä¸ºä¾‹ï¼Œå®ƒçš„ä¸»è¦æ­¥éª¤æ˜¯ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;æ£€æŸ¥ELFæ–‡ä»¶æ ¼å¼çš„æœ‰æ•ˆæ€§&lt;/li&gt;&#xA;&lt;li&gt;å¯»æ‰¾åŠ¨æ€é“¾æ¥çš„â€œ.interpâ€æ®µï¼Œè®¾ç½®åŠ¨æ€é“¾æ¥å™¨è·¯å¾„&lt;/li&gt;&#xA;&lt;li&gt;æ ¹æ®ELFå¯æ‰§è¡Œæ–‡ä»¶çš„ç¨‹åºå¤´çš„æè¿°ï¼Œå¯¹ELFæ–‡ä»¶è¿›è¡Œæ˜ å°„&lt;/li&gt;&#xA;&lt;li&gt;åˆå§‹åŒ–ELFè¿›ç¨‹ç¯å¢ƒ&lt;/li&gt;&#xA;&lt;li&gt;å°†ç³»ç»Ÿè°ƒç”¨çš„è¿”å›åœ°å€ä¿®æ”¹ä¸ºELFæ–‡ä»¶çš„å…¥å£ç‚¹ï¼Œå¯¹äºé™æ€é“¾æ¥çš„ELFæ–‡ä»¶ï¼Œå…¥å£ç‚¹æ˜¯e_entryæ‰€æŒ‡çš„åœ°å€ï¼›å¯¹äºåŠ¨æ€é“¾æ¥çš„ELFæ–‡ä»¶ï¼Œå…¥å£ç‚¹æ˜¯åŠ¨æ€é“¾æ¥å™¨&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;æ‰€ä»¥å½“sys_execve()ç³»ç»Ÿè°ƒç”¨ä»å†…æ ¸æ€è¿”å›åˆ°ç”¨æˆ·æ€æ—¶ï¼Œè·³è½¬åˆ°äº†ELFç¨‹åºçš„å…¥å£åœ°å€ï¼Œæ–°çš„ç¨‹åºå¼€å§‹è¿è¡Œï¼ŒELFæ–‡ä»¶è£…è½½å®Œæˆã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä¸ºä»€ä¹ˆè¦åŠ¨æ€é“¾æ¥ï¼Ÿ&lt;/p&gt;&#xA;&lt;p&gt;é™æ€é“¾æ¥çš„ä¼˜ç‚¹ï¼šé™æ€é“¾æ¥ä½¿å¾—ä¸åŒçš„ç¨‹åºå¼€å‘è€…å’Œéƒ¨é—¨èƒ½ç›¸å¯¹ç‹¬ç«‹åœ°å¼€å‘å’Œæµ‹è¯•è‡ªå·±çš„ç¨‹åºæ¨¡å—ï¼Œä»è€Œå¤§å¤§ä¿ƒè¿›ç¨‹åºå¼€å‘çš„æ•ˆç‡ã€‚&lt;/p&gt;&#xA;&lt;p&gt;é™æ€é“¾æ¥çš„ç¼ºç‚¹ï¼šæµªè´¹å†…å­˜å’Œç£ç›˜ç©ºé—´ã€æ¨¡å—æ›´æ–°å›°éš¾ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/programmer/%e9%9d%99%e6%80%81%e9%93%be%e6%8e%a5%e8%a3%85%e8%bd%bd.png&#34; title=&#34;/programmer/é™æ€é“¾æ¥è£…è½½.png&#34; data-thumbnail=&#34;/programmer/é™æ€é“¾æ¥è£…è½½.png&#34; data-sub-html=&#34;&lt;h2&gt;é™æ€é“¾æ¥è£…è½½&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/programmer/é™æ€é“¾æ¥è£…è½½.png&#39; alt=&#34;/programmer/é™æ€é“¾æ¥è£…è½½.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;é™æ€é“¾æ¥è£…è½½&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œåœ¨é™æ€é“¾æ¥çš„æƒ…å†µä¸‹ï¼ŒProgram1å’ŒProgram2éƒ½ç”¨åˆ°äº†Lib.oè¿™ä¸ªæ¨¡å—ï¼Œå½“åŒæ—¶è¿è¡ŒProgram1å’ŒProgram2æ—¶ï¼ŒLib.oåœ¨ç£ç›˜å’Œå†…å­˜ä¸­æœ‰ä¸¤ä»½å‰¯æœ¬ã€‚å½“ç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡çš„è¢«å¤šä¸ªç¨‹åºå…±äº«çš„ç›®æ ‡æ–‡ä»¶æ—¶ï¼Œå…¶ä¸­å¾ˆå¤§ä¸€éƒ¨åˆ†ç©ºé—´å°±è¢«æµªè´¹äº†ã€‚&lt;/p&gt;&#xA;&lt;p&gt;é™æ€é“¾æ¥çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯å¯¹ç¨‹åºçš„æ›´æ–°ã€éƒ¨ç½²å’Œå‘å¸ƒä¹Ÿä¼šå¸¦æ¥å¾ˆå¤šéº»çƒ¦ã€‚æ¯”å¦‚ä¸Šå›¾ä¸­çš„Lib.oæ˜¯ç”±ä¸€ä¸ªç¬¬ä¸‰æ–¹å‚å•†æä¾›çš„ï¼Œå½“è¯¥å‚å•†æ›´æ–°äº†Lib.oçš„æ—¶å€™ï¼Œé‚£ä¹ˆProgram1å°±éœ€è¦æ‹¿åˆ°æœ€æ–°çš„Lib.oï¼Œç„¶åå°†å…¶ä¸Program1é“¾æ¥åï¼Œå°†æ–°çš„Program1å‘å¸ƒç»™ç”¨æˆ·ã€‚è¿™æ ·åšçš„ç¼ºç‚¹æ˜¯ï¼Œä¸€æ—¦ç¨‹åºä¸­æœ‰ä»»ä½•æ¨¡å—æ›´æ–°ï¼Œæ•´ä¸ªç¨‹åºå°±è¦é‡æ–°é“¾æ¥ã€å‘å¸ƒç»™ç”¨æˆ·ã€‚å¦‚æœç¨‹åºéƒ½ä½¿ç”¨é™æ€é“¾æ¥ï¼Œé‚£ä¹ˆç½‘ç»œæ¥æ›´æ–°ç¨‹åºå°†ä¼šéå¸¸ä¸ä¾¿ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¦è§£å†³ç©ºé—´æµªè´¹å’Œæ›´æ–°å›°éš¾è¿™ä¸¤ä¸ªé—®é¢˜æœ€ç®€å•çš„åŠæ³•æ˜¯æŠŠç¨‹åºçš„æ¨¡å—äº’ç›¸åˆ†å‰²ï¼Œå½¢æˆç‹¬ç«‹åœ°æ–‡ä»¶ã€‚æŠŠé“¾æ¥çš„è¿‡ç¨‹æ¨è¿Ÿåˆ°äº†è¿è¡Œæ—¶å†è¿›è¡Œï¼Œè¿™å°±æ˜¯åŠ¨æ€é“¾æ¥çš„åŸºæœ¬æ€æƒ³ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/programmer/%e5%85%b1%e4%ba%ab%e7%9b%ae%e6%a0%87%e6%96%87%e4%bb%b6.png&#34; title=&#34;/programmer/å…±äº«ç›®æ ‡æ–‡ä»¶.png&#34; data-thumbnail=&#34;/programmer/å…±äº«ç›®æ ‡æ–‡ä»¶.png&#34; data-sub-html=&#34;&lt;h2&gt;å…±äº«ç›®æ ‡æ–‡ä»¶&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/programmer/å…±äº«ç›®æ ‡æ–‡ä»¶.png&#39; alt=&#34;/programmer/å…±äº«ç›®æ ‡æ–‡ä»¶.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;å…±äº«ç›®æ ‡æ–‡ä»¶&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒProgram2åœ¨è¿è¡Œæ—¶åªéœ€è¦åŠ è½½Program1ä¹‹å‰åŠ è½½çš„Lib.oï¼Œè€Œä¸éœ€è¦é‡æ–°åŠ è½½äº†ï¼Œç³»ç»Ÿè¦åšçš„åªæ˜¯å°†Program2.oå’ŒLib.oé“¾æ¥èµ·æ¥ã€‚åŠ¨æ€é“¾æ¥ä¸ä»…æ˜¯èŠ‚çœå†…å­˜ï¼Œè¿˜å¯ä»¥å‡å°‘ç‰©ç†é¡µçš„æ¢å…¥æ¢å‡ºï¼Œå¢åŠ CPUç¼“å­˜çš„å‘½ä¸­ç‡ï¼Œå› ä¸ºä¸åŒè¿›ç¨‹é—´çš„æ•°æ®å’ŒæŒ‡ä»¤è®¿é—®éƒ½é›†ä¸­åœ¨äº†åŒä¸€ä¸ªå…±äº«æ¨¡å—ä¸Šã€‚&lt;/p&gt;&#xA;&lt;p&gt;åŠ¨æ€é“¾æ¥è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯ç¨‹åºè¿è¡Œæ—¶å¯ä»¥åŠ¨æ€é€‰æ‹©åŠ è½½å„ç§ç¨‹åºæ¨¡å—ï¼Œè¿™ä¸ªä¼˜ç‚¹å°±æ˜¯åæ¥è¢«äººä»¬ç”¨æ¥åˆ¶ä½œç¨‹åºçš„æ’ä»¶ã€‚æ¯”å¦‚æŸä¸ªäº§å“æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åˆ¶å®šå¥½ç¨‹åºçš„æ¥å£ï¼Œå…¶ä»–å…¬å¸æˆ–å¼€å‘è€…å¯ä»¥æŒ‰ç…§è¿™ç§æ¥å£æ¥ç¼–å†™ç¬¦åˆè¦æ±‚çš„åŠ¨æ€é“¾æ¥æ–‡ä»¶ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åŠ¨æ€é“¾æ¥è¿˜å¯ä»¥åŠ å¼ºç¨‹åºçš„å…¼å®¹æ€§ï¼Œä¸€ä¸ªç¨‹åºåœ¨ä¸åŒå¹³å°è¿è¡Œæ—¶å¯ä»¥åŠ¨æ€åœ°é“¾æ¥åˆ°OSæä¾›çš„åŠ¨æ€é“¾æ¥åº“ï¼Œè¿™äº›åŠ¨æ€é“¾æ¥åº“ç›¸å½“äºåœ¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿä¹‹é—´å¢åŠ äº†ä¸€ä¸ªä¸­é—´å±‚ï¼Œä»è€Œæ¶ˆé™¤äº†ç¨‹åºå¯¹ä¸åŒå¹³å°ä¹‹é—´ä¾èµ–çš„å·®å¼‚æ€§ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åŠ¨æ€é“¾æ¥çš„ç¼ºç‚¹ï¼šå½“ç¨‹åºæ‰€ä¾èµ–çš„æŸä¸ªæ¨¡å—æ›´æ–°åï¼Œç”±äºæ–°çš„æ¨¡å—ä¸æ—§çš„æ¨¡å—ä¹‹é—´æ¥å£ä¸å…¼å®¹ï¼Œå¯¼è‡´åŸæœ‰ç¨‹åºæ— æ³•è¿è¡Œã€‚åœ¨æ—©æœŸWindowsç‰ˆæœ¬ä¸­ï¼Œç¼ºä¹æœ‰æ•ˆçš„å…±äº«åº“ç®¡ç†æœºåˆ¶ï¼Œå‡ºç°â€œDLL Hellâ€ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åœ¨Linuxä¸­ï¼ŒELFåŠ¨æ€é“¾æ¥æ–‡ä»¶è¢«ç§°ä¸ºåŠ¨æ€å…±äº«å¯¹è±¡ï¼Œä¸€èˆ¬ä»¥â€œ.soâ€ä¸ºæ‰©å±•åï¼›è€Œåœ¨Windowsä¸­ï¼ŒåŠ¨æ€é“¾æ¥æ–‡ä»¶è¢«ç§°ä¸ºåŠ¨æ€é“¾æ¥åº“ï¼Œä»¥â€œ.dllâ€ä¸ºæ‰©å±•åã€‚å½“ç³»ç»Ÿè¢«è£…è½½æ—¶ï¼Œç³»ç»Ÿçš„åŠ¨æ€é“¾æ¥å™¨ä¼šå°†ç¨‹åºæ‰€éœ€è¦çš„æ‰€æœ‰åŠ¨æ€é“¾æ¥åº“è£…è½½åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå¹¶å°†ç¨‹åºä¸­æ‰€æœ‰æœªå†³è®®çš„ç¬¦å·ç»‘å®šåˆ°ç›¸åº”çš„åŠ¨æ€é“¾æ¥åº“ä¸­ï¼Œå¹¶è¿›è¡Œé‡å®šä½å·¥ä½œã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç¨‹åºä¸lib.soä¹‹é—´çœŸæ­£çš„é“¾æ¥å·¥ä½œæ˜¯ç”±åŠ¨æ€é“¾æ¥å™¨å®Œæˆçš„ï¼Œè€Œä¸æ˜¯ç”±æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„é™æ€é“¾æ¥å™¨ldå®Œæˆçš„ã€‚åŠ¨æ€é“¾æ¥æŠŠé“¾æ¥è¿‡ç¨‹ä»æœ¬æ¥çš„ç¨‹åºè£…è½½å‰è¢«æ¨è¿Ÿåˆ°äº†è£…è½½çš„æ—¶å€™ã€‚è¿™æ ·æ¯æ¬¡è¢«è£…è½½æ—¶éƒ½è¦é‡æ–°è¿›è¡Œé“¾æ¥ï¼Œä¼šå¸¦æ¥ä¸€äº›æ€§èƒ½æŸå¤±ï¼Œç›¸æ¯”é™æ€é“¾æ¥ï¼Œæ€§èƒ½æŸå¤±å¤§çº¦åœ¨5%ä»¥ä¸‹ï¼Œæ˜¯å€¼å¾—çš„ã€‚&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;gcc -fPIC -shared -o Lib.so Lib.c&lt;/code&gt;å°†Lib.cç¼–è¯‘æˆä¸€ä¸ªå…±äº«å¯¹è±¡æ–‡ä»¶ã€‚åŠ¨æ€é“¾æ¥è¿‡ç¨‹ï¼š&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/programmer/%e5%8a%a8%e6%80%81%e9%93%be%e6%8e%a5%e8%bf%87%e7%a8%8b.png&#34; title=&#34;/programmer/åŠ¨æ€é“¾æ¥è¿‡ç¨‹.png&#34; data-thumbnail=&#34;/programmer/åŠ¨æ€é“¾æ¥è¿‡ç¨‹.png&#34; data-sub-html=&#34;&lt;h2&gt;åŠ¨æ€é“¾æ¥è¿‡ç¨‹&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/programmer/åŠ¨æ€é“¾æ¥è¿‡ç¨‹.png&#39; alt=&#34;/programmer/åŠ¨æ€é“¾æ¥è¿‡ç¨‹.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;åŠ¨æ€é“¾æ¥è¿‡ç¨‹&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;å…±äº«å¯¹è±¡çš„æœ€ç»ˆè£…è½½åœ°å€åœ¨ç¼–è¯‘æ—¶æ˜¯ä¸ç¡®å®šçš„ï¼Œè€Œæ˜¯åœ¨è£…è½½æ—¶ï¼Œè£…è½½å™¨æ ¹æ®å½“å‰åœ°å€ç©ºé—´çš„ç©ºé—²æƒ…å†µï¼ŒåŠ¨æ€åˆ†é…ä¸€å—è¶³å¤Ÿå¤§å°çš„è™šæ‹Ÿåœ°å€ç©ºé—´ç»™ç›¸åº”çš„å…±äº«å¯¹è±¡ã€‚é™æ€é“¾æ¥çš„é‡å®šä½å«åšé“¾æ¥æ—¶é‡å®šä½ï¼Œä¸ºäº†èƒ½ä½¿å…±äº«å¯¹è±¡åœ¨ä»»æ„åœ°å€è£…è½½ï¼Œèƒ½æƒ³åˆ°çš„æ˜¯åœ¨é“¾æ¥æ—¶ï¼Œå¯¹æ‰€æœ‰ç»å¯¹åœ°å€çš„å¼•ç”¨ä¸åšé‡å®šä½ï¼Œæ¨è¿Ÿåˆ°è£…è½½æ—¶å†å®Œæˆã€‚ä¸€æ—¦è£…è½½åœ°å€ç¡®å®šï¼Œç³»ç»Ÿå°±å¯¹ç¨‹åºä¸­æ‰€æœ‰çš„ç»å¯¹åœ°å€å¼•ç”¨è¿›è¡Œé‡å®šä½ã€‚è€Œè¿™ç§æƒ…å†µç§°ä¸ºè£…è½½æ—¶é‡å®šä½ã€‚&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;windowsä¸‹åŠ¨æ€é“¾æ¥&#34;&gt;&lt;span&gt;Windowsä¸‹åŠ¨æ€é“¾æ¥&lt;/span&gt;&#xA;  &lt;a href=&#34;#windows%e4%b8%8b%e5%8a%a8%e6%80%81%e9%93%be%e6%8e%a5&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;æ•´ä¸ªWindowsç³»ç»Ÿæœ¬èº«å³åŸºäºåŠ¨æ€é“¾æ¥æœºåˆ¶ï¼ŒWindowsçš„APIä¹Ÿä»¥DLLçš„å½¢å¼æä¾›ç»™ç¨‹åºå¼€å‘è€…ï¼Œè€Œä¸æ˜¯åƒLinuxç­‰ç³»ç»Ÿæ˜¯ä»¥ç³»ç»Ÿè°ƒç”¨ä½œä¸ºOSçš„æœ€ç»ˆå…¥å£ã€‚&lt;/p&gt;&#xA;&lt;p&gt;MSVCç¼–è¯‘å™¨å¯ä»¥é€šè¿‡â€œ__declspecâ€å…³é”®å­—ä¿®é¥°æŸä¸ªå‡½æ•°æˆ–å˜é‡ï¼Œä½¿ç”¨â€œ__declspec(dllexport)â€è¡¨ç¤ºç¬¦å·æ˜¯ä»æœ¬DLLå¯¼å‡ºçš„ç¬¦å·ï¼Œä½¿ç”¨â€œ__declspec(dllimport)â€è¡¨ç¤ºè¯¥ç¬¦å·æ˜¯ä»åˆ«çš„DLLå¯¼å…¥çš„ç¬¦å·ã€‚&lt;/p&gt;</description>
    </item>
    <item>
      <title>C&#43;&#43; æ™ºèƒ½æŒ‡é’ˆ</title>
      <link>http://localhost:1313/posts/cpp-smart-pointer/</link>
      <pubDate>Sun, 02 Mar 2025 15:46:54 +0800</pubDate><author>1022440588@qq.com (UAreFree)</author>
      <guid>http://localhost:1313/posts/cpp-smart-pointer/</guid>
      <category domain="http://localhost:1313/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">ç¼–ç¨‹è¯­è¨€</category>
      <description>&lt;p&gt;æ™ºèƒ½æŒ‡é’ˆï¼ˆSmart Pointerï¼‰æ˜¯C++ ä¸­ç”¨æ¥è‡ªåŠ¨ç®¡ç†åŠ¨æ€å†…å­˜åˆ†é…çš„å·¥å…·ï¼Œå®ƒæ˜¯ä¸€ç§ç±»æ¨¡æ¿ï¼Œèƒ½å¤Ÿè‡ªåŠ¨é‡Šæ”¾å†…å­˜ï¼Œé¿å…æ‰‹åŠ¨ç®¡ç†åŠ¨æ€åˆ†é…å†…å­˜æ—¶å¯èƒ½å‘ç”Ÿçš„å†…å­˜æ³„æ¼å’ŒæŒ‡é’ˆæ‚¬ç©ºç­‰é—®é¢˜ã€‚&#xA;æ™ºèƒ½æŒ‡é’ˆä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªç‰¹æ€§ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼šå½“æ™ºèƒ½æŒ‡é’ˆè¶…å‡ºä½œç”¨åŸŸæ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾å…¶ç®¡ç†çš„åŠ¨æ€å†…å­˜ã€‚&lt;/li&gt;&#xA;&lt;li&gt;RAIIï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰ï¼šæ™ºèƒ½æŒ‡é’ˆåœ¨æ„é€ æ—¶ç»‘å®šåŠ¨æ€å†…å­˜ï¼Œå¹¶åœ¨ææ„æ—¶è‡ªåŠ¨é‡Šæ”¾èµ„æºã€‚&lt;/li&gt;&#xA;&lt;li&gt;å¼•ç”¨è®¡æ•°ï¼ˆéƒ¨åˆ†æ™ºèƒ½æŒ‡é’ˆæ”¯æŒï¼‰ï¼šè¿½è¸ªå…±äº«å¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°ï¼Œå½“å¼•ç”¨è®¡æ•°å˜ä¸º0æ—¶è‡ªåŠ¨é”€æ¯å¯¹è±¡ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;ä»¥ä¸Šæ˜¯GPTç»™å‡ºçš„æ¦‚å¿µè§£é‡Šï¼Œé“ç†å¤§å®¶éƒ½æ‡‚ï¼Œå…·ä½“æ€ä¹ˆä½¿ç”¨ä»¥åŠæ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ&lt;/p&gt;&#xA;&lt;p&gt;åŠ¨æ€å†…å­˜åˆ†é…å°±æ˜¯æˆ‘ä»¬æ‰‹åŠ¨new()æˆ–malloc()ä¸€å—å †ä¸Šçš„å­˜å‚¨åŒºï¼Œæœ€ç»å…¸çš„å°±æ˜¯å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æ–°å¼€è¾Ÿçš„æ•°ç»„ï¼Œç”¨å®Œådeleteæ‰ï¼Œå¦‚æœå¿˜è®°deleteå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œæˆ–è€…é‡å¤deleteå°±ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œdeleteä¹‹åå†æ¬¡è®¿é—®å¯¹è±¡è¿˜å¯èƒ½å‡ºç°æ‚¬ç©ºæŒ‡é’ˆçš„é—®é¢˜ã€‚æ‰€ä»¥æ€»ç»“ä¸€å¥è¯ï¼Œnewçš„æ—¶å€™èƒ½ç”¨æ™ºèƒ½æŒ‡é’ˆå°±ç”¨æ™ºèƒ½æŒ‡é’ˆã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// åŠ¨æ€åˆ†é…ä¸€ä¸ªå¤§å°ä¸º5çš„intæ•°ç»„&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;arr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// åˆå§‹åŒ–æ•°ç»„&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;arr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ä½¿ç”¨æ•°ç»„&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Array elements: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;arr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;endl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// é‡Šæ”¾å†…å­˜&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;arr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆæ“å¿ƒçš„å°±æ¯”è¾ƒå°‘ï¼Œåªéœ€å¼•å…¥#include &lt;memory&gt;ï¼Œå†™ä¸€è¡Œæ™ºèƒ½æŒ‡é’ˆçš„ä»£ç å³å¯ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;memory&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// åŒ…å«æ™ºèƒ½æŒ‡é’ˆå¤´æ–‡ä»¶&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ä½¿ç”¨ unique_ptr ç®¡ç†åŠ¨æ€åˆ†é…çš„æ•°ç»„&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unique_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;arr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// åˆå§‹åŒ–æ•°ç»„&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;arr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ä½¿ç”¨æ•°ç»„&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Array elements: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;arr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;endl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œunique_ptr ä¼šè‡ªåŠ¨é‡Šæ”¾æ•°ç»„å†…å­˜&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æ™ºèƒ½æŒ‡é’ˆæœ‰ä»¥ä¸‹ä¸‰ç§ï¼šstd::unique_ptrã€std::shared_ptrã€std::weak_ptrï¼Œå®ƒä»¬çš„ä½¿ç”¨å°±æ˜¯å°†æ¨¡æ¿å‚æ•°æ›¿æ¢ä¸ºå¯¹åº”newçš„æ•°æ®ç±»å‹ã€‚&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;stdunique_ptr&#34;&gt;&lt;span&gt;std::unique_ptr&lt;/span&gt;&#xA;  &lt;a href=&#34;#stdunique_ptr&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;ç‹¬å æ‰€æœ‰æƒï¼Œåªèƒ½ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€å—åŠ¨æ€å†…å­˜ï¼Œæ— æ³•å¤åˆ¶ï¼Œåªèƒ½moveè½¬ç§»æ‰€æœ‰æƒã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;memory&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;MyClass&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;MyClass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Constructor&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;~&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MyClass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Destructor&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºä¸€ä¸ª unique_ptrï¼Œç®¡ç† MyClass çš„å¯¹è±¡&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unique_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MyClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ptr1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;make_unique&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MyClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æ— æ³•å¤åˆ¶ unique_ptr&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// std::unique_ptr&amp;lt;MyClass&amp;gt; ptr2 = ptr1; // é”™è¯¯&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// è½¬ç§»æ‰€æœ‰æƒ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unique_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MyClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ptr2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;move&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ptr1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æ­¤æ—¶ ptr1 ä¸å†æ‹¥æœ‰å¯¹è±¡ï¼Œptr2 æ‹¥æœ‰å¯¹è±¡&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ptr1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;ptr1 is null&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;stdshared_ptr&#34;&gt;&lt;span&gt;std::shared_ptr&lt;/span&gt;&#xA;  &lt;a href=&#34;#stdshared_ptr&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;å…±äº«æ‰€æœ‰æƒï¼Œå…è®¸å¤šä¸ªæ™ºèƒ½æŒ‡é’ˆå…±äº«åŒä¸€å—åŠ¨æ€å†…å­˜ï¼Œä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥è¿½è¸ªæœ‰å¤šå°‘æŒ‡é’ˆå¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ã€‚&#xA;æ¯æ¬¡ shared_ptr è¢«å¤åˆ¶æ—¶ï¼Œå¼•ç”¨è®¡æ•°å¢åŠ ã€‚æ¯æ¬¡ shared_ptr è¢«é”€æ¯æˆ–è¶…å‡ºä½œç”¨åŸŸæ—¶ï¼Œå¼•ç”¨è®¡æ•°å‡å°‘ã€‚å½“å¼•ç”¨è®¡æ•°å˜ä¸º0æ—¶ï¼Œç®¡ç†çš„å¯¹è±¡è¢«é”€æ¯ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;memory&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;MyClass&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;MyClass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Constructor&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;~&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MyClass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Destructor&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºä¸€ä¸ª shared_ptr&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shared_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MyClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ptr1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;make_shared&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MyClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// å¤åˆ¶ shared_ptrï¼Œå¼•ç”¨è®¡æ•°å¢åŠ &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shared_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MyClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ptr2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ptr1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Shared ownership count: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ptr1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;use_count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¾“å‡º 2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ç¦»å¼€ä½œç”¨åŸŸï¼Œptr2 è¢«é”€æ¯ï¼Œå¼•ç”¨è®¡æ•°å‡å°‘&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Shared ownership count: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ptr1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;use_count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¾“å‡º 1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;ä½†æ˜¯shared_pträ¼šå­˜åœ¨å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œå¯¼è‡´å¼•ç”¨è®¡æ•°æ°¸ä¸ä¸º0ã€‚é‚£ä¹ˆä¸‹é¢è®²è®²ä»€ä¹ˆæ˜¯å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¾ˆç±»ä¼¼äºæ­»é”ï¼Œæ­»é”æ˜¯Aåœ¨ç­‰Bé‡Šæ”¾é”ï¼Œè€ŒBåœ¨ç­‰Aé‡Šæ”¾é”ï¼Œä»è€Œå¯¼è‡´Aä¸Bäº’ç›¸ç­‰å¾…çš„æƒ…å†µã€‚è¿™é‡Œçš„å¾ªç¯åº”ç”¨å°±æ˜¯Aé‡Œçš„shared_ptræŒ‡å‘äº†Bï¼Œè€ŒBé‡Œçš„shared_ptræŒ‡å‘äº†Aï¼Œä¸¤ä¸ªshared_ptrå°±ç®—ç¦»å¼€ä½œç”¨åŸŸï¼Œå¼•ç”¨è®¡æ•°ä¹Ÿéƒ½ä¸º1ï¼Œå¯¼è‡´Aå’ŒBçš„å†…å­˜æ— æ³•é‡Šæ”¾ï¼Œå½¢æˆå†…å­˜æ³„æ¼ã€‚&lt;/p&gt;&#xA;&lt;p&gt;æ­»é”çš„è§£å†³æ–¹æ³•æœ‰ï¼šèµ„æºï¼ˆé”ï¼‰æŒ‰ç›¸åŒé¡ºåºè·å–ï¼›çº¿ç¨‹ä¸»åŠ¨é‡Šæ”¾èµ„æºï¼›é‚£ä¹ˆå¾ªç¯å¼•ç”¨çš„è§£å†³æ–¹æ³•æ˜¯ï¼Ÿå¼•å…¥weak_ptrï¼Œweak_ptrå¹¶ä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ï¼Œé‚£è¿™æ ·weak_ptråœ¨ä½œç”¨åŸŸç»“æŸæ—¶ä¸€å®šä¼šè¢«é‡Šæ”¾ï¼ŒæŒ‡å‘weak_ptrçš„shared_ptrè‡ªç„¶ä¼šå°†å¼•ç”¨è®¡æ•°å‡ä¸€ï¼Œä»è€Œæ­£å¸¸é‡Šæ”¾è‡ªå·±ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä½¿ç”¨shared_ptrè¿˜ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œshared_ptrå¦‚æœç›´æ¥æŒ‡å‘thisæŒ‡é’ˆæ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°double freeçš„æƒ…å†µï¼Œå› ä¸ºshared_ptræŒ‡å‘thisæŒ‡é’ˆä¼šæŒ‡å‘ä¸€ä¸ªæ–°çš„æ§åˆ¶å—ï¼Œè¿™æ ·å¯¹åŒä¸€å¯¹è±¡å°±ä¼šåŒæ—¶æœ‰ä¸¤ä¸ªæ§åˆ¶å—ï¼ˆå¼•ç”¨è®¡æ•°ï¼‰ï¼Œå½“shared_ptrç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶æ‰€æŒ‡å‘çš„å¯¹è±¡ä¼šè¢«é‡Šæ”¾ä¸¤æ¬¡ã€‚è§£å†³æ–¹æ³•æ˜¯ï¼šä½¿ç”¨std::enable_shared_from_thisï¼Œå®ƒå†…éƒ¨å®ç°æ˜¯ä¸€ä¸ªweak_ptræŒ‡å‘å…±äº«çš„æ§åˆ¶å—ï¼Œä¿è¯äº†å¼•ç”¨è®¡æ•°çš„å”¯ä¸€ã€‚&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;stdweak_ptr&#34;&gt;&lt;span&gt;std::weak_ptr&lt;/span&gt;&#xA;  &lt;a href=&#34;#stdweak_ptr&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;ä¸å¤šè¯´äº†ï¼Œä¸Šè¾¹è¯´äº†weak_ptrå­˜åœ¨çš„æ„ä¹‰ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œweak_ptråœ¨è§‚å¯Ÿshared_ptræ‰€ç®¡ç†çš„å¯¹è±¡ï¼Œå½“éœ€è¦è®¿é—®å¯¹è±¡æ—¶ï¼Œå¯ä»¥é€šè¿‡ weak_ptr.lock() è·å–ä¸€ä¸ªä¸´æ—¶çš„ std::shared_ptrã€‚å¦‚æœå¯¹è±¡å·²ç»è¢«é‡Šæ”¾ï¼Œåˆ™è¿”å›ç©ºæŒ‡é’ˆã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;memory&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å‰å‘å£°æ˜&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;A&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shared_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// A æŒæœ‰ B çš„ shared_ptr&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;~&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;A destroyed&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;B&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;weak_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// B æŒæœ‰ A çš„ weak_ptr&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;~&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;B destroyed&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shared_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;make_shared&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shared_ptr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;make_shared&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b_ptr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// A æŒæœ‰ B&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a_ptr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// B æŒæœ‰ Aï¼ˆé€šè¿‡ weak_ptrï¼‰&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œä¸ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æ€»çš„æ¥è¯´ï¼Œæ™ºèƒ½æŒ‡é’ˆæ˜¯å¯¹åŸå§‹æŒ‡é’ˆçš„å°è£…ï¼Œæä¾›èµ„æºç®¡ç†å’Œå®‰å…¨è®¿é—®åŠŸèƒ½çš„æ¨¡æ¿ç±»ã€‚å¯¹äºå…±äº«å‹æ™ºèƒ½æŒ‡é’ˆï¼ˆå¦‚ std::shared_ptr å’Œ std::weak_ptrï¼‰ï¼Œé€šå¸¸å¼•å…¥æ§åˆ¶å—æ¥ç®¡ç†èµ„æºçš„å…±äº«çŠ¶æ€ã€‚æ§åˆ¶å—åŒ…å«å¼ºå¼•ç”¨è®¡æ•°å™¨ã€å¼±å¼•ç”¨è®¡æ•°å™¨ã€èµ„æºåˆ é™¤å™¨ä»¥åŠä¸èµ„æºç»‘å®šçš„åŸå§‹å¯¹è±¡æŒ‡é’ˆç­‰ä¿¡æ¯ã€‚å¤šä¸ªæ™ºèƒ½æŒ‡é’ˆå®ä¾‹å¯ä»¥å…±äº«ä¸€ä¸ªæ§åˆ¶å—æ¥ç®¡ç†åŒä¸€ä¸ªèµ„æºã€‚&lt;/p&gt;</description>
    </item>
    <item>
      <title>C&#43;&#43; Static</title>
      <link>http://localhost:1313/posts/cpp-static/</link>
      <pubDate>Sun, 23 Feb 2025 15:31:49 +0800</pubDate><author>1022440588@qq.com (UAreFree)</author>
      <guid>http://localhost:1313/posts/cpp-static/</guid>
      <category domain="http://localhost:1313/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">ç¼–ç¨‹è¯­è¨€</category>
      <description>&lt;p&gt;staticæ˜¯C++ä¸­éå¸¸å¸¸è§çš„å…³é”®å­—ï¼Œä»¥ä¸‹æ€»ç»“staticå…³é”®å­—çš„ä½¿ç”¨åœºæ™¯ï¼Œå³ä»€ä¹ˆæ—¶å€™ä½¿ç”¨staticã€‚&#xA;é¦–å…ˆè¯´staticæ˜¯é™æ€çš„æ„æ€ï¼Œä»€ä¹ˆæ˜¯é™æ€å‘¢ï¼Ÿä½ å¯èƒ½ä¼šå¬è¿‡é™æ€å­˜å‚¨åŒºï¼Œä¸€æ®µå†…å­˜çš„åŒºåŸŸï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹Cç¨‹åºçš„å†…å­˜åˆ†å¸ƒã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/cpp/%e7%a8%8b%e5%ba%8f%e5%86%85%e5%ad%98%e5%88%86%e5%b8%83.png&#34; title=&#34;/cpp/ç¨‹åºå†…å­˜åˆ†å¸ƒ.png&#34; data-thumbnail=&#34;/cpp/ç¨‹åºå†…å­˜åˆ†å¸ƒ.png&#34; data-sub-html=&#34;&lt;h2&gt;ç¨‹åºå†…å­˜åˆ†å¸ƒ&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/cpp/ç¨‹åºå†…å­˜åˆ†å¸ƒ.png&#39; alt=&#34;/cpp/ç¨‹åºå†…å­˜åˆ†å¸ƒ.png&#34; height=&#34;45%&#34; width=&#34;45%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;ç¨‹åºå†…å­˜åˆ†å¸ƒ&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;Cç¨‹åºå†…å­˜åœ°å€ä»ä½åˆ°é«˜ä¾æ¬¡ä¸ºä»£ç åŒºã€åˆå§‹åŒ–çš„æ•°æ®åŒºï¼ˆ.dataæ®µï¼‰ã€æœªè¢«åˆå§‹åŒ–çš„æ•°æ®åŒº(.bssæ®µ)ã€å †å’Œæ ˆï¼Œé™æ€å­˜å‚¨åŒºå°±ä½äºæ•°æ®åŒºï¼Œè¿™é‡Œçš„æ•°æ®åŒºä¸»è¦æœ‰å…¨å±€å˜é‡ã€staticå˜é‡ï¼Œè€Œä¸€èˆ¬çš„å˜é‡ä¼šè¢«æ”¾åœ¨å †æˆ–æ ˆåŒºï¼Œæ ˆä¸»è¦å­˜å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ã€å †ä¸»è¦å­˜newçš„å†…å­˜ã€‚&lt;/p&gt;&#xA;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;å†…å­˜åŒºåŸŸ&lt;/th&gt;&#xA;          &lt;th&gt;å­˜å‚¨å†…å®¹&lt;/th&gt;&#xA;          &lt;th&gt;ç‰¹ç‚¹&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;ä»£ç åŒº&lt;/td&gt;&#xA;          &lt;td&gt;ç¨‹åºæŒ‡ä»¤&lt;/td&gt;&#xA;          &lt;td&gt;1. åªè¯»&lt;br&gt;2. æ‰€æœ‰çº¿ç¨‹å…±äº«&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;åˆå§‹åŒ–æ•°æ®åŒº&lt;/td&gt;&#xA;          &lt;td&gt;1. å…¨å±€å˜é‡&lt;br&gt;2. staticå˜é‡&lt;/td&gt;&#xA;          &lt;td&gt;1. ç¼–è¯‘æ—¶æ˜¾ç¤ºèµ‹å€¼&lt;br&gt;2. ç¨‹åºåŠ è½½æ—¶åˆ†é…å†…å­˜ï¼Œè¯»å–å¯æ‰§è¡Œæ–‡ä»¶å­˜å‚¨çš„åˆå§‹å€¼&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;æœªåˆå§‹åŒ–çš„æ•°æ®åŒº&lt;/td&gt;&#xA;          &lt;td&gt;1. æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡&lt;br&gt;2. æœªåˆå§‹åŒ–çš„staticå˜é‡&lt;/td&gt;&#xA;          &lt;td&gt;1. ç¨‹åºåŠ è½½æ—¶è¢«è‡ªåŠ¨åˆå§‹åŒ–ä¸ºé›¶ï¼ˆæ•°å€¼ç±»å‹ä¸º 0ï¼ŒæŒ‡é’ˆç±»å‹ä¸º NULLï¼‰&lt;br&gt;2. ç¨‹åºåŠ è½½æ—¶åˆ†é…å†…å­˜ï¼Œä½†å¯æ‰§è¡Œæ–‡ä»¶ä¸ä¼šå­˜å‚¨æœªåˆå§‹åŒ–çš„æ•°æ®&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;å †åŒº&lt;/td&gt;&#xA;          &lt;td&gt;åŠ¨æ€åˆ†é…å‡½æ•°ï¼ˆå¦‚mallocã€callocæˆ–newï¼‰åˆ†é…çš„å†…å­˜&lt;/td&gt;&#xA;          &lt;td&gt;1. åŠ¨æ€åˆ†é…ï¼Œç”±ç¨‹åºå‘˜ç®¡ç†&lt;br&gt;2. ç”Ÿå­˜å‘¨æœŸç”±ç¨‹åºæ§åˆ¶ï¼Œå¯ä»¥è·¨å‡½æ•°ä»£ç å—ä½¿ç”¨&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;æ ˆåŒº&lt;/td&gt;&#xA;          &lt;td&gt;å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°ã€è¿”å›åœ°å€&lt;/td&gt;&#xA;          &lt;td&gt;1. ç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…ï¼Œéµå¾ªâ€œå…ˆè¿›åå‡ºâ€çš„ç»“æ„&lt;br&gt;2. ç”Ÿå‘½å‘¨æœŸä¸ºå‡½æ•°è°ƒç”¨æœŸé—´çš„æ‰§è¡Œå‘¨æœŸ&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;p&gt;initialized data å’Œ uninitialized data æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;åˆå§‹åŒ–çŠ¶æ€ï¼Œé¡¾åæ€ä¹‰ï¼Œåˆå§‹åŒ–åŒºçš„å˜é‡ä¼šæ˜¾ç¤ºèµ‹å€¼åˆå§‹åŒ–ï¼Œæœªè¢«åˆå§‹åŒ–åŒºçš„å˜é‡æœªè¢«æ˜¾ç¤ºèµ‹å€¼åˆå§‹åŒ–ã€‚&lt;/li&gt;&#xA;&lt;li&gt;å¯æ‰§è¡Œæ–‡ä»¶å­˜å‚¨ï¼Œæœªè¢«åˆå§‹åŒ–åŒºå˜é‡çš„æ•°æ®ä¸ä¼šå­˜å‚¨åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯ç›´æ¥å°†åˆ†é…çš„å†…å­˜èµ‹å€¼ä¸ºé›¶ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;æ‰€ä»¥staticå˜é‡çš„ç”Ÿå‘½å‘¨æœŸå°±å’Œå…¨å±€å˜é‡ä¸€æ ·æ˜¯ç¨‹åºè¿è¡Œçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œé‚£staticå˜é‡å’Œå…¨å±€å˜é‡åˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿæˆ‘ä»¬æƒ³ç”¨å¤šä¸ªå‡½æ•°æ“ä½œåŒä¸€ä¸ªå˜é‡å°±ç”¨å…¨å±€å˜é‡ä¸å°±å¯ä»¥äº†ï¼Ÿä¸ºä»€ä¹ˆè¿˜è¦æœ‰staticå˜é‡å‘¢ï¼Ÿ&lt;/p&gt;&#xA;&lt;p&gt;å¯¹äºstaticå±€éƒ¨å˜é‡ï¼Œå®ƒå’Œå…¨å±€å˜é‡çš„åŒºåˆ«æ˜¯ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;ä½œç”¨åŸŸä¸åŒï¼Œå±€éƒ¨å˜é‡é™åˆ¶å…¶ä½œç”¨åŸŸåœ¨å‡½æ•°å†…ï¼Œä»…åœ¨å‡½æ•°å†…å¯è§ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®ï¼Œæé«˜äº†å°è£…æ€§ã€‚&lt;/li&gt;&#xA;&lt;li&gt;staticå±€éƒ¨å˜é‡çš„åŠ¨æ€åˆå§‹åŒ–åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œåˆ°å£°æ˜è¯­å¥æ—¶åˆå§‹åŒ–ï¼Œè€Œå…¨å±€å˜é‡åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±åˆå§‹åŒ–ï¼Œé¿å…äº†èµ„æºæµªè´¹ï¼Œé™æ€åˆå§‹åŒ–ä¸å…¨å±€å˜é‡ä¸€è‡´ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;å¯¹äºstaticå…¨å±€å˜é‡ï¼Œå®ƒå°±æ˜¯åœ¨å…¨å±€å˜é‡çš„åŸºç¡€ä¸Šé™åˆ¶äº†ä½œç”¨åŸŸä¸ºå½“å‰æ–‡ä»¶ï¼Œå³ä½¿ä½¿ç”¨externå¤–éƒ¨æ–‡ä»¶ä¹Ÿæ— æ³•ä½¿ç”¨ã€‚è¿™å¯ä»¥å‡å°‘åŒå‘½åå˜é‡å†²çªï¼Œå‡å°‘æ¨¡å—çš„è€¦åˆåº¦ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åœ¨è¿™é‡Œå¯¹staticå˜é‡æœ‰äº†åˆæ­¥çš„è®¤è¯†ï¼Œé‚£æˆ‘ä»¬åŠ ä¸Šç±»ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ç±»staticå˜é‡ï¼Œé¡¾åæ€ä¹‰å£°æ˜äºæŸä¸ªç±»å†…çš„staticå˜é‡ï¼Œé‚£å®ƒå’Œæ™®é€šæˆå‘˜å˜é‡æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿç±»æ¯”ä¸Šè¿°éç±»çš„æƒ…å†µï¼Œç±»staticå˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ•´ä¸ªç¨‹åºï¼Œä¹Ÿå°±ä¸åƒå¯¹è±¡çš„æˆå‘˜å˜é‡éšå¯¹è±¡åˆ›å»ºæ¶ˆäº¡ï¼Œé‚£ä¹ˆå®ƒçš„åˆå§‹åŒ–å°±è¦åœ¨ç±»å¤–å®šä¹‰å’Œåˆå§‹åŒ–ï¼Œæ‰€æœ‰å¯¹è±¡å…±äº«ä¸€ä¸ªstaticæˆå‘˜å˜é‡ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;A&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//ç±»å†…å£°æ˜    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//ç±»å¤–å®šä¹‰åˆå§‹åŒ–&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥æ˜¯staticå‡½æ•°ï¼Œå¯¹äºç±»å¤–çš„staticå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯é™åˆ¶å…¶ä½œç”¨åŸŸä¸ºæœ¬æ–‡ä»¶å†…ï¼›å¯¹äºç±»å†…çš„staticæˆå‘˜å‡½æ•°ï¼Œç±»ä¼¼äºç±»å†…çš„staticæˆå‘˜å˜é‡ï¼Œå®ƒä¸å±äºå…·ä½“çš„å¯¹è±¡ï¼Œè€Œæ˜¯å±äºç±»æœ¬èº«ï¼Œæ²¡æœ‰å…·ä½“çš„thisæŒ‡é’ˆï¼Œä¸èƒ½è®¿é—®éstaticæˆå‘˜å˜é‡å’Œéstaticæˆå‘˜å‡½æ•°ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;A&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//ç±»å†…å£°æ˜   &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;display&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//staticæˆå‘˜å‡½æ•°&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;A::count: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;endl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//ç±»å¤–å®šä¹‰åˆå§‹åŒ–&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;display&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//ç›´æ¥é€šè¿‡ç±»åè°ƒç”¨&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;staticæˆå‘˜å‡½æ•°çš„ä½œç”¨å…¶å®æ›´åƒæ˜¯æä¾›ç±»çº§åˆ«çš„å‡½æ•°ï¼Œå®ç°ä¸ç±»å…·ä½“å¯¹è±¡æ— å…³çš„é€šç”¨åŠŸèƒ½ã€‚å®ƒé¿å…äº†å®ä¾‹åŒ–å¯¹è±¡ï¼Œå‡å°‘äº†thisæŒ‡é’ˆçš„å¼€é”€ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C++&#34; data-lang=&#34;C++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;A&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//ç±»å†…å£°æ˜   &#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;display&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//staticæˆå‘˜å‡½æ•°&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;A::count: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;endl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//ç±»å¤–å®šä¹‰åˆå§‹åŒ–&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;display&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//ç›´æ¥é€šè¿‡ç±»åè°ƒç”¨&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cout&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;endl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//å®ç°é€šç”¨åŠŸèƒ½&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æ‰©å±•ï¼ŒC++ä¸­æœ‰å››ç§å­˜å‚¨å‘¨æœŸï¼š&lt;/p&gt;&#xA;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;å­˜å‚¨å‘¨æœŸ&lt;/th&gt;&#xA;          &lt;th&gt;å£°æ˜å‘¨æœŸ&lt;/th&gt;&#xA;          &lt;th&gt;ç¤ºä¾‹&lt;/th&gt;&#xA;          &lt;th&gt;ç”¨æ³•&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;é™æ€ static&lt;/td&gt;&#xA;          &lt;td&gt;ç¨‹åºå¼€å§‹åˆ°ç¨‹åºç»“æŸ&lt;/td&gt;&#xA;          &lt;td&gt;å…¨å±€å˜é‡ï¼Œstaticå±€éƒ¨å˜é‡ï¼Œç±»çš„é™æ€æˆå‘˜&lt;/td&gt;&#xA;          &lt;td&gt;ç”¨äºå…¨å±€çŠ¶æ€å˜é‡æˆ–éœ€è¦è·¨å‡½æ•°çš„æŒä¹…çŠ¶æ€&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;åŠ¨æ€ dynamic&lt;/td&gt;&#xA;          &lt;td&gt;æ˜¾ç¤ºåˆ†é…åˆ°æ˜¾ç¤ºé‡Šæ”¾&lt;/td&gt;&#xA;          &lt;td&gt;ä½¿ç”¨ new æˆ– malloc åˆ†é…çš„å˜é‡&lt;/td&gt;&#xA;          &lt;td&gt;ç”¨äºåœ¨è¿è¡Œæ—¶éœ€è¦çµæ´»åˆ†é…å†…å­˜çš„åœºæ™¯&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;è‡ªåŠ¨ automatic&lt;/td&gt;&#xA;          &lt;td&gt;å®šä¹‰æ—¶ç¦»å¼€ä½œç”¨åŸŸ&lt;/td&gt;&#xA;          &lt;td&gt;å‡½æ•°å†…çš„æ™®é€šå±€éƒ¨å˜é‡&lt;/td&gt;&#xA;          &lt;td&gt;ç”¨äºä¸´æ—¶è®¡ç®—æˆ–å±€éƒ¨æ“ä½œï¼Œæ•ˆç‡é«˜&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;çº¿ç¨‹ thread_local&lt;/td&gt;&#xA;          &lt;td&gt;çº¿ç¨‹å¯åŠ¨åˆ°çº¿ç¨‹ç»“æŸ&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;thread_local&lt;/code&gt; ä¿®é¥°çš„å˜é‡&lt;/td&gt;&#xA;          &lt;td&gt;ç”¨äºçº¿ç¨‹ç‹¬ç«‹çš„å˜é‡å­˜å‚¨ï¼Œé¿å…å¤šçº¿ç¨‹å†²çª&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;p&gt;å‚è€ƒï¼š&lt;a href=&#34;https://www.geeksforgeeks.org/c/memory-layout-of-c-program/&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;Memory Layout of C Programs&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>MIT6.1810 Lab:Mmap</title>
      <link>http://localhost:1313/posts/mit-lab-mmap/</link>
      <pubDate>Sun, 24 Nov 2024 11:29:08 +0800</pubDate><author>1022440588@qq.com (UAreFree)</author>
      <guid>http://localhost:1313/posts/mit-lab-mmap/</guid>
      <category domain="http://localhost:1313/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      <description>&lt;p&gt;MIT6.1810 lab xv6 2024 mmap&lt;/p&gt;&#xA;&lt;p&gt;å…ˆè¯»ä¸€ä¸‹ä»å†…æ ¸ä¸–ç•Œé€è§†&lt;a href=&#34;https://mp.weixin.qq.com/s/AUsgFOaePwVsPozC3F6Wjw&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;mmapå†…å­˜æ˜ å°„çš„æœ¬è´¨ï¼ˆåŸç†ç¯‡ï¼‰&lt;/a&gt;è¿™ç¯‡æ–‡ç« ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;sys/mman.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;mmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;off_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;ç³»ç»Ÿè°ƒç”¨mmapæ˜ å°„çš„æ˜¯è™šæ‹Ÿå†…å­˜ä¸­çš„æ–‡ä»¶æ˜ å°„ä¸åŒ¿åæ˜ å°„åŒºï¼Œåœ¨è¿™æ®µè™šæ‹Ÿå†…å­˜åŒºåŸŸä¸­ï¼ŒåŒ…å«äº†ä¸€æ®µä¸€æ®µçš„è™šæ‹Ÿæ˜ å°„åŒºï¼Œæ¯è°ƒç”¨ä¸€æ¬¡mmapå°±ä¼šåœ¨æ–‡ä»¶æ˜ å°„ä¸åŒ¿åæ˜ å°„åŒºåˆ’åˆ†ä¸€æ®µä½œä¸ºç”³è¯·çš„è™šæ‹Ÿå†…å­˜ã€‚&lt;/p&gt;&#xA;&lt;p&gt;addrï¼šæŒ‡å®šæ˜ å°„çš„è™šæ‹Ÿå†…å­˜èµ·å§‹åœ°å€ï¼Œä¸€èˆ¬è®¾ä¸ºNULLï¼Œäº¤ç”±å†…æ ¸å†³å®šèµ·å§‹åœ°å€ã€‚&lt;/p&gt;&#xA;&lt;p&gt;lengthï¼šç”³è¯·çš„å†…å­˜æœ‰å¤šå¤§ï¼Œå†³å®šåŒ¿åæ˜ å°„çš„ç‰©ç†å†…å­˜æœ‰å¤šå¤§æˆ–æ–‡ä»¶æ˜ å°„çš„æ–‡ä»¶åŒºåŸŸæœ‰å¤šå¤§ã€‚addrå’Œlengthå¿…é¡»æŒ‰ç…§PAGE_SIZEå¯¹é½ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å¦‚æœæ˜¯æ–‡ä»¶æ˜ å°„ï¼Œå°±è¦é€šè¿‡å‚æ•°fdæŒ‡å®šè¦æ˜ å°„æ–‡ä»¶çš„æè¿°ç¬¦ï¼Œé€šè¿‡offsetæŒ‡å®šæ–‡ä»¶æ˜ å°„åŒºåœ¨æ–‡ä»¶çš„åç§»ã€‚Linuxä¸­å†…å­˜é¡µå’Œç£ç›˜å—å¤§å°ä¸€èˆ¬æƒ…å†µéƒ½æ˜¯4KBï¼Œè¿™é‡Œçš„offsetä¹Ÿå¿…é¡»æŒ‰ç…§4KBå¯¹é½ã€‚&lt;/p&gt;&#xA;&lt;p&gt;mmapæ˜ å°„çš„è™šæ‹Ÿå†…å­˜åœ¨å†…æ ¸ä¸­ç”¨struct vm_area_structç»“æ„è¡¨ç¤ºï¼Œè¿›ç¨‹ä¸­çš„VMAæœ‰ä¸¤ç§ç»„ç»‡å½¢å¼ï¼ŒåŒå‘é“¾è¡¨å’Œçº¢é»‘æ ‘ã€‚mmapç³»ç»Ÿè°ƒç”¨æœ¬è´¨æ˜¯å…ˆè¦åœ¨è™šæ‹Ÿå†…å­˜ç©ºé—´ä¸­åˆ’åˆ†å‡ºä¸€æ®µVMAå‡ºæ¥ï¼Œè¿™æ®µVMAåŒºåŸŸçš„å¤§å°ç”±vm_startï¼Œvm_endè¡¨ç¤ºï¼Œè€Œå®ƒä»¬ç”±mmapå‚æ•°addrã€lengthå†³å®šï¼›éšåå†…æ ¸ä¼šå¯¹è¿™æ®µVMAè¿›è¡Œç›¸å…³çš„æ˜ å°„ï¼Œå¦‚æœæ˜¯æ–‡ä»¶æ˜ å°„ï¼Œå†…æ ¸ä¼šå°†æ˜ å°„çš„æ–‡ä»¶ä»¥åŠè¦æ˜ å°„æ–‡ä»¶åŒºåŸŸåœ¨æ–‡ä»¶ä¸­çš„offsetï¼Œä¸VMAä¸­çš„vm_fileã€vm_pgoffå…³è”æ˜ å°„èµ·æ¥ï¼Œä»–ä»¬ç”±mmapå‚æ•°fdã€offsetå†³å®šï¼›mmapæ˜ å°„çš„è¿™æ®µVMAä¸­çš„ç›¸å…³æƒé™å’Œæ ‡å¿—ä½ï¼Œæ˜¯ç”±mmapå‚æ•°çš„protã€flagså†³å®šçš„ï¼Œæœ€ç»ˆä¼šæ˜ å°„åˆ°VMAä¸­çš„vm_page_protã€vm_flagsä¸­ï¼ŒæŒ‡å®šè¿›ç¨‹å¯¹è¿™å—VMAçš„è®¿é—®æƒé™å’Œç›¸å…³æ ‡å¿—ä½ã€‚PSï¼šè¿›ç¨‹æ‰€ä¾èµ–çš„åŠ¨æ€é“¾æ¥åº“.soæ–‡ä»¶ä¹Ÿæ˜¯é€šè¿‡mmapæ–‡ä»¶æ˜ å°„çš„æ–¹å¼å°†ä»£ç æ®µã€æ•°æ®æ®µæ˜ å°„åˆ°æ–‡ä»¶æ˜ å°„ä¸åŒ¿åæ˜ å°„åŒºä¸­ã€‚&lt;/p&gt;&#xA;&lt;p&gt;mmapä¸­å‚æ•°protæŒ‡å®šVMAçš„è®¿é—®æƒé™ï¼Œå–å€¼æœ‰å››ç§ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#define PROT_READ 0x1  &lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/* page can be read */&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#define PROT_WRITE 0x2  &lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/* page can be written */&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#define PROT_EXEC 0x4  &lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/* page can be executed */&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#define PROT_NONE 0x0  &lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/* page can not be accessed */&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;mmapä¸­å‚æ•°flagsæŒ‡å®šVMAæ˜ å°„æ–¹å¼ï¼ŒOSå¯¹ç‰©ç†é¡µçš„ç®¡ç†ç±»å‹æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯åŒ¿åé¡µã€ä¸€ç§æ˜¯æ–‡ä»¶é¡µï¼Œå¯¹åº”çš„æ˜ å°„ä¹Ÿå°±åˆ†ä¸ºä¸¤ç§ï¼ŒåŒ¿åæ˜ å°„ã€æ–‡ä»¶æ˜ å°„ï¼Œmmapæ‰€æ˜ å°„çš„ç‰©ç†å†…å­˜èƒ½å¦åœ¨å¤šè¿›ç¨‹é—´å…±äº«åˆåˆ†ä¸ºå…±äº«æ˜ å°„ã€ç§æœ‰æ˜ å°„ä¸¤ç§æ˜ å°„æ–¹å¼ï¼Œå…±äº«æ˜ å°„æ˜¯å¤šè¿›ç¨‹å…±äº«çš„ï¼Œä¸€ä¸ªè¿›ç¨‹ä¿®æ”¹äº†å…±äº«æ˜ å°„çš„å†…å­˜å…¶ä»–è¿›ç¨‹æ˜¯å¯ä»¥çœ‹åˆ°çš„ï¼Œç”¨äºå¤šè¿›ç¨‹é—´çš„é€šä¿¡ï¼›ç§æœ‰æ˜ å°„æ˜¯è¿›ç¨‹ç§æœ‰çš„ï¼Œå…¶ä»–è¿›ç¨‹çœ‹ä¸åˆ°ï¼Œå¤šè¿›ç¨‹ä¿®æ”¹åŒä¸€æ˜ å°„æ–‡ä»¶å°†ä¸ä¼šå›å†™åˆ°ç£ç›˜æ–‡ä»¶ä¸Šã€‚&lt;/p&gt;&#xA;&lt;p&gt;æŒ‰ç…§åŒ¿åã€æ–‡ä»¶ä¸å…±äº«ã€ç§æœ‰è¿›è¡Œç»„åˆï¼Œå°±æœ‰å››ç§æ˜ å°„æ–¹å¼ã€‚&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;ç§æœ‰åŒ¿åæ˜ å°„ï¼šMAP_PRIVATE | MAP_ANONYMOUSï¼Œglibåº“ä¸­å°è£…çš„mallocå‡½æ•°ç”³è¯·å†…å­˜å¤§äº128KBæ—¶ä½¿ç”¨mmapç§æœ‰åŒ¿åæ˜ å°„æ–¹å¼æ¥ç”³è¯·å †å†…å­˜ã€‚è¿™é‡Œmmapåªæ˜¯å…ˆç”³è¯·ä¸€æ®µVMAï¼Œè¿˜æ²¡æœ‰çœŸæ­£åˆ†é…ç‰©ç†å†…å­˜ï¼ŒPTEæ˜¯ç©ºçš„ï¼Œåªæœ‰è¯»å†™æ­¤åŒºåŸŸæ—¶ï¼Œæ‰ä¼šè§¦å‘ç¼ºé¡µå¼‚å¸¸åˆ†é…ç‰©ç†å†…å­˜ã€‚ç§æœ‰åŒ¿åæ˜ å°„é™¤äº†ç”¨äºç”³è¯·è™šæ‹Ÿå†…å­˜ä¹‹å¤–ï¼Œè¿˜ä¼šç”¨äºexecveç³»ç»Ÿè°ƒç”¨ä¸­ï¼Œå†…æ ¸éœ€è¦åˆ é™¤é‡Šæ”¾æ—§çš„è™šæ‹Ÿå†…å­˜ç©ºé—´å¹¶æƒ…å†µé¡µè¡¨ï¼Œç„¶åæ‰“å¼€å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè§£ææ–‡ä»¶å¤´ï¼Œåˆ¤æ–­å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼ï¼Œå¯¹åº”å‡½æ•°è¿›è¡ŒåŠ è½½ã€‚è¿™ä¸ªè¿‡ç¨‹å°±éœ€è¦ç§æœ‰åŒ¿åæ˜ å°„åˆ›å»ºæ–°çš„è™šæ‹Ÿå†…å­˜ç©ºé—´ä¸­çš„BSSæ®µã€å †å’Œæ ˆã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e7%a7%81%e6%9c%89%e5%8c%bf%e5%90%8d%e6%98%a0%e5%b0%84.png&#34; title=&#34;/xv6/ç§æœ‰åŒ¿åæ˜ å°„.png&#34; data-thumbnail=&#34;/xv6/ç§æœ‰åŒ¿åæ˜ å°„.png&#34; data-sub-html=&#34;&lt;h2&gt;ç§æœ‰åŒ¿åæ˜ å°„&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/ç§æœ‰åŒ¿åæ˜ å°„.png&#39; alt=&#34;/xv6/ç§æœ‰åŒ¿åæ˜ å°„.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;ç§æœ‰åŒ¿åæ˜ å°„&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;ç§æœ‰æ–‡ä»¶æ˜ å°„ï¼šMAP_PRIVATEï¼Œmmapå†…å­˜æ–‡ä»¶æ˜ å°„çš„æœ¬è´¨æ˜¯vm_area_structç»“æ„ä½“ä¸­ä¼ å…¥å‚æ•°fdæ‰€å¯¹åº”çš„fileç»“æ„ä½“æŒ‡é’ˆï¼ŒæŒ‡å‘fileç»“æ„ä½“ï¼Œfileç»“æ„ä½“ä¸­å­˜æœ‰inodeç»“æ„ä½“æˆå‘˜ï¼Œå³è¯¥æ–‡ä»¶å¯¹åº”çš„inodeç´¢å¼•ï¼Œä»è€Œæ‰¾åˆ°å¯¹åº”çš„ç£ç›˜å—blockã€‚å’Œç§æœ‰åŒ¿åæ˜ å°„ä¸€æ ·ï¼Œå®ƒä¸ä¼šç«‹å³åˆ†é…ç‰©ç†é¡µé¢ï¼Œè€Œæ˜¯åˆ©ç”¨ç¼ºé¡µå¼‚å¸¸ï¼Œè¿›ç¨‹1åœ¨å»ºç«‹PTEä¹‹åï¼Œå†æ¬¡è®¿é—®è¿™æ®µæ–‡ä»¶å†…å­˜æ˜ å°„æ—¶å°±ç›¸å½“äºç›´æ¥è®¿é—®æ–‡ä»¶çš„page cacheï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨ç”¨æˆ·æ€çš„ï¼Œæ²¡æœ‰åˆ‡æ€ã€‚è¿›ç¨‹2åŒæ ·åœ¨è®¿é—®è¿™æ®µæ–‡ä»¶æ—¶ä¹Ÿè§¦å‘ç¼ºé¡µå¼‚å¸¸ï¼Œå»ºç«‹PTEï¼Œä½†ä¼šç›´æ¥æŒ‡å‘è¿›ç¨‹1ä¸­çš„page cacheã€‚æ‰€æœ‰è¿›ç¨‹çš„PTEéƒ½è®¾ä¸ºåªè¯»ï¼Œå½“ä»»ä¸€è¿›ç¨‹è¯•å›¾å†™å…¥æ—¶ï¼Œåˆä¼šè§¦å‘ç¼ºé¡µä¸­æ–­ï¼Œä¼šç”³è¯·ä¸€ä¸ªå†…å­˜é¡µï¼Œç„¶åå°†page cacheçš„å†…å®¹æ‹·è´åˆ°æ–°å†…å­˜é¡µä¸­ï¼Œå¹¶æ›´æ–°PTEã€‚å½“è¿›ç¨‹éƒ½æœ‰å„è‡ªä¸“å±çš„ç‰©ç†å†…å­˜é¡µæ—¶ï¼Œå°±å’Œpage cacheè„±ç¦»å…³ç³»äº†ï¼Œå„è‡ªçš„ä¿®æ”¹åœ¨è¿›ç¨‹ä¹‹é—´æ—¶äº’ä¸å¯è§çš„ï¼Œä¸”å‡ä¸ä¼šå›å†™åˆ°ç£ç›˜æ–‡ä»¶ä¸­ã€‚å¯æ‰§è¡Œæ–‡ä»¶çš„.textã€.dataå°±ä½¿ç”¨ç§æœ‰æ–‡ä»¶æ˜ å°„åˆ°äº†è¿›ç¨‹è™šæ‹Ÿå†…å­˜ç©ºé—´ä¸­çš„ä»£ç æ®µå’Œæ•°æ®æ®µä¸­ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e7%a7%81%e6%9c%89%e6%96%87%e4%bb%b6%e6%98%a0%e5%b0%84%e5%a4%9a%e8%bf%9b%e7%a8%8b.png&#34; title=&#34;/xv6/ç§æœ‰æ–‡ä»¶æ˜ å°„å¤šè¿›ç¨‹.png&#34; data-thumbnail=&#34;/xv6/ç§æœ‰æ–‡ä»¶æ˜ å°„å¤šè¿›ç¨‹.png&#34; data-sub-html=&#34;&lt;h2&gt;ç§æœ‰æ–‡ä»¶æ˜ å°„å¤šè¿›ç¨‹&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/ç§æœ‰æ–‡ä»¶æ˜ å°„å¤šè¿›ç¨‹.png&#39; alt=&#34;/xv6/ç§æœ‰æ–‡ä»¶æ˜ å°„å¤šè¿›ç¨‹.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;ç§æœ‰æ–‡ä»¶æ˜ å°„å¤šè¿›ç¨‹&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e7%a7%81%e6%9c%89%e6%96%87%e4%bb%b6%e6%98%a0%e5%b0%84%e8%bf%9b%e7%a8%8b%e7%a9%ba%e9%97%b4.png&#34; title=&#34;/xv6/ç§æœ‰æ–‡ä»¶æ˜ å°„è¿›ç¨‹ç©ºé—´.png&#34; data-thumbnail=&#34;/xv6/ç§æœ‰æ–‡ä»¶æ˜ å°„è¿›ç¨‹ç©ºé—´.png&#34; data-sub-html=&#34;&lt;h2&gt;ç§æœ‰æ–‡ä»¶æ˜ å°„è¿›ç¨‹ç©ºé—´&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/ç§æœ‰æ–‡ä»¶æ˜ å°„è¿›ç¨‹ç©ºé—´.png&#39; alt=&#34;/xv6/ç§æœ‰æ–‡ä»¶æ˜ å°„è¿›ç¨‹ç©ºé—´.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;ç§æœ‰æ–‡ä»¶æ˜ å°„è¿›ç¨‹ç©ºé—´&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;å…±äº«æ–‡ä»¶æ˜ å°„ï¼šMAP_SHAREDï¼Œå’Œç§æœ‰æ–‡ä»¶æ˜ å°„è¿‡ç¨‹ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„ç‚¹æ˜¯ï¼Œå¤šè¿›ç¨‹ä¸­çš„è™šæ‹Ÿå†…å­˜æ˜ å°„åŒºé€šè¿‡ç¼ºé¡µä¸­æ–­ä¼šæ˜ å°„åˆ°åŒä¸€page cacheä¸­ï¼Œä¸”æ˜¯å¯è¯»å¯å†™ï¼Œä¸ä¼šå†æ¬¡è§¦å‘ç¼ºé¡µä¸­æ–­å»å„è‡ªåˆ†é…æ–°çš„ç‰©ç†é¡µã€‚å¤šè¿›ç¨‹å¯¹å…±äº«æ˜ å°„åŒºçš„ä»»ä½•ä¿®æ”¹éƒ½ä¼šé€šè¿‡å†…æ ¸å›å†™çº¿ç¨‹pdflushåˆ·æ–°åˆ°ç£ç›˜æ–‡ä»¶ä¸­ã€‚æ ¹æ® mmap å…±äº«æ–‡ä»¶æ˜ å°„å¤šè¿›ç¨‹ä¹‹é—´è¯»å†™å…±äº«ï¼ˆä¸ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶ï¼‰çš„ç‰¹ç‚¹ï¼Œå¸¸ç”¨äºå¤šè¿›ç¨‹ä¹‹é—´å…±äº«å†…å­˜ï¼ˆpage cacheï¼‰ï¼Œå¤šè¿›ç¨‹ä¹‹é—´çš„é€šè®¯ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e5%85%b1%e4%ba%ab%e6%96%87%e4%bb%b6%e6%98%a0%e5%b0%84.png&#34; title=&#34;/xv6/å…±äº«æ–‡ä»¶æ˜ å°„.png&#34; data-thumbnail=&#34;/xv6/å…±äº«æ–‡ä»¶æ˜ å°„.png&#34; data-sub-html=&#34;&lt;h2&gt;å…±äº«æ–‡ä»¶æ˜ å°„&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/å…±äº«æ–‡ä»¶æ˜ å°„.png&#39; alt=&#34;/xv6/å…±äº«æ–‡ä»¶æ˜ å°„.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;å…±äº«æ–‡ä»¶æ˜ å°„&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;å…±äº«åŒ¿åæ˜ å°„ï¼šMAP_SHARED | MAP_ANONYMOUSï¼Œå°†fdè®¾ä¸º-1æ¥å®ç°å…±äº«åŒ¿åæ˜ å°„ï¼Œè¿™ç§æ˜ å°„æ–¹å¼å¸¸ç”¨äºçˆ¶å­è¿›ç¨‹ä¹‹é—´å…±äº«å†…å­˜ï¼Œçˆ¶å­è¿›ç¨‹ä¹‹é—´çš„é€šè®¯ã€‚è¿™ä¸ªæ€è·¯å¦‚æœæŒ‰ç…§ä¸Šè¿°çš„è¯ï¼Œå°±æ˜¯è¿›ç¨‹1ç¼ºé¡µä¸­æ–­åˆ†é…ä¸€ä¸ªç‰©ç†é¡µï¼Œè¿›ç¨‹2åŒæ ·ç¼ºé¡µä¸­æ–­è¦åˆ†é…è¿›ç¨‹1æ‰€æŒ‡çš„ç‰©ç†é¡µï¼Œä½†æ˜¯è¿›ç¨‹2æ€ä¹ˆæ‰¾åˆ°è¿™ä¸ªç‰©ç†é¡µï¼Ÿæ‰¾ä¸åˆ°çš„ã€‚ä½†è¿™å¯¹äºå…±äº«æ–‡ä»¶æ˜ å°„å¾ˆå®¹æ˜“ï¼Œå› ä¸ºæœ‰æ–‡ä»¶çš„page cacheå­˜åœ¨ï¼Œè¿›ç¨‹2å¯ä»¥æ ¹æ®offsetä»page cacheä¸­æŸ¥æ‰¾æ˜¯å¦å·²ç»æœ‰å…¶ä»–è¿›ç¨‹æŠŠæ˜ å°„çš„æ–‡ä»¶å†…å®¹åŠ è½½åˆ°æ–‡ä»¶é¡µä¸­ã€‚å¦‚æœæ–‡ä»¶é¡µå·²ç»å­˜åœ¨ page cache ä¸­äº†ï¼Œè¿›ç¨‹ 2 ç›´æ¥æ˜ å°„è¿™ä¸ªæ–‡ä»¶é¡µå°±å¯ä»¥äº†ã€‚å…±äº«åŒ¿åæ˜ å°„åœ¨å†…æ ¸ä¸­æ˜¯é€šè¿‡ä¸€ä¸ªå«åš tmpfs çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿæ¥å®ç°çš„ï¼Œtmpfs ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ˜¯åŸºäºå†…å­˜å®ç°çš„ï¼ŒæŒ‚è½½åœ¨ dev/zero ç›®å½•ä¸‹ã€‚å½“å¤šä¸ªè¿›ç¨‹é€šè¿‡ mmap è¿›è¡Œå…±äº«åŒ¿åæ˜ å°„çš„æ—¶å€™ï¼Œå†…æ ¸ä¼šåœ¨ tmpfs æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªåŒ¿åæ–‡ä»¶ï¼Œè¿™ä¸ªåŒ¿åæ–‡ä»¶å¹¶ä¸æ˜¯çœŸå®å­˜åœ¨äºç£ç›˜ä¸Šçš„ï¼Œå®ƒæ˜¯å†…æ ¸ä¸ºäº†å…±äº«åŒ¿åæ˜ å°„è€Œæ¨¡æ‹Ÿå‡ºæ¥çš„ï¼ŒåŒ¿åæ–‡ä»¶ä¹Ÿæœ‰è‡ªå·±çš„ inode ç»“æ„ä»¥åŠ page cacheã€‚åœ¨ mmap è¿›è¡Œå…±äº«åŒ¿åæ˜ å°„çš„æ—¶å€™ï¼Œå†…æ ¸ä¼šæŠŠè¿™ä¸ªåŒ¿åæ–‡ä»¶å…³è”åˆ°è¿›ç¨‹çš„è™šæ‹Ÿæ˜ å°„åŒº VMA ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼Œå½“è¿›ç¨‹è™šæ‹Ÿæ˜ å°„åŒºåŸŸä¸ tmpfs æ–‡ä»¶ç³»ç»Ÿä¸­çš„è¿™ä¸ªåŒ¿åæ–‡ä»¶æ˜ å°„èµ·æ¥ä¹‹åï¼Œåé¢çš„æµç¨‹å°±å’Œå…±äº«æ–‡ä»¶æ˜ å°„ä¸€æ¨¡ä¸€æ ·äº†ã€‚ç”±äºæ˜¯åŸºäºå†…å­˜å®ç°çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨å…¶ä»–è¿›ç¨‹æ˜¯ä¸å¯è§çš„ï¼Œè€Œå­è¿›ç¨‹æ˜¯å¯è§çš„ï¼Œé€‚ç”¨äºçˆ¶å­è¿›ç¨‹é—´çš„å…±äº«åŒ¿åæ˜ å°„ã€‚&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;æ€»ç»“ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;ç§æœ‰åŒ¿åæ˜ å°„ï¼Œå…¶ä¸»è¦ç”¨äºè¿›ç¨‹ç”³è¯·è™šæ‹Ÿå†…å­˜ï¼Œä»¥åŠåˆå§‹åŒ–è¿›ç¨‹è™šæ‹Ÿå†…å­˜ç©ºé—´ä¸­çš„ BSS æ®µï¼Œå †ï¼Œæ ˆè¿™äº›è™šæ‹Ÿå†…å­˜åŒºåŸŸã€‚&lt;/li&gt;&#xA;&lt;li&gt;ç§æœ‰æ–‡ä»¶æ˜ å°„ï¼Œå…¶æ ¸å¿ƒç‰¹ç‚¹æ˜¯èƒŒåæ˜ å°„çš„æ–‡ä»¶é¡µåœ¨å¤šè¿›ç¨‹ä¹‹é—´æ˜¯è¯»å…±äº«çš„ï¼Œå¤šä¸ªè¿›ç¨‹å¯¹å„è‡ªè™šæ‹Ÿå†…å­˜åŒºçš„ä¿®æ”¹åªèƒ½ååº”åˆ°å„è‡ªå¯¹åº”çš„æ–‡ä»¶é¡µä¸Šï¼Œè€Œä¸”å„è‡ªçš„ä¿®æ”¹åœ¨è¿›ç¨‹ä¹‹é—´æ˜¯äº’ä¸å¯è§çš„ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹æ˜¯è¿™äº›ä¿®æ”¹å‡ä¸ä¼šå›å†™åˆ°ç£ç›˜æ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›ç‰¹ç‚¹æ¥åŠ è½½äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶çš„ .text , .data section åˆ°è¿›ç¨‹è™šæ‹Ÿå†…å­˜ç©ºé—´ä¸­çš„ä»£ç æ®µå’Œæ•°æ®æ®µä¸­ã€‚&lt;/li&gt;&#xA;&lt;li&gt;å…±äº«æ–‡ä»¶æ˜ å°„ï¼Œå¤šè¿›ç¨‹ä¹‹é—´è¯»å†™å…±äº«ï¼ˆä¸ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶ï¼‰ï¼Œå¸¸ç”¨äºå¤šè¿›ç¨‹ä¹‹é—´å…±äº«å†…å­˜ï¼ˆpage cacheï¼‰ï¼Œå¤šè¿›ç¨‹ä¹‹é—´çš„é€šè®¯ã€‚&lt;/li&gt;&#xA;&lt;li&gt;å…±äº«åŒ¿åæ˜ å°„ï¼Œç”¨äºçˆ¶å­è¿›ç¨‹ä¹‹é—´å…±äº«å†…å­˜ï¼Œçˆ¶å­è¿›ç¨‹ä¹‹é—´çš„é€šè®¯ã€‚çˆ¶å­è¿›ç¨‹ä¹‹é—´éœ€è¦ä¾èµ– tmpfs ä¸­çš„åŒ¿åæ–‡ä»¶æ¥å®ç°å…±äº«å†…å­˜ã€‚æ˜¯ä¸€ç§ç‰¹æ®Šçš„å…±äº«æ–‡ä»¶æ˜ å°„ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;xv6çš„mmapå‡½æ•°å£°æ˜ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;mmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;off_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹å‡ºå’Œä¸Šè¿°Linuxçš„mmapå‡½æ•°å£°æ˜æ˜¯ä¸€è‡´çš„ï¼Œæœ¬å®éªŒå°±æ˜¯è¦å®ç°ç±»ä¼¼äºUnixçš„ä¸Šè¿°ç®€åŒ–å®ç°ã€‚åªå®ç°æ–‡ä»¶æ˜ å°„éƒ¨åˆ†ï¼Œæ²¡æœ‰åŒ¿åæ˜ å°„ã€‚å®éªŒè¯´æ˜ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;å†…æ ¸è‡ªå·±å†³å®šæ–‡ä»¶æ˜ å°„çš„è™šæ‹Ÿåœ°å€ï¼Œmmapè¿”å›è¯¥åœ°å€ï¼Œå¤±è´¥è¿”å›0xffffffffffffffffã€‚&lt;/li&gt;&#xA;&lt;li&gt;lenæ˜¯æ˜ å°„çš„å­—èŠ‚æ•°ã€‚&lt;/li&gt;&#xA;&lt;li&gt;protæœ‰å¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œä¸‰ç§ã€‚&lt;/li&gt;&#xA;&lt;li&gt;flagsæ˜¯MAP_PRIVATEæˆ–MAP_SHAREDï¼Œå³ç§æœ‰æ–‡ä»¶æ˜ å°„æˆ–å…±äº«æ–‡ä»¶æ˜ å°„ï¼Œå°±æ˜¯ä¸Šè¿°æ‰€æçš„2ã€3ä¸¤ç§æƒ…å†µã€‚&lt;/li&gt;&#xA;&lt;li&gt;åœ¨usertrap()ä¸­page faultè¿›è¡Œå¤„ç†åˆ†é…ç‰©ç†å†…å­˜ã€‚&lt;/li&gt;&#xA;&lt;li&gt;MAP_SHAREDå¯ä»¥ä¸åˆ†é…ç‰©ç†å†…å­˜ã€‚&#xA;munmapå‡½æ•°å£°æ˜ï¼š&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;munmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;ol&gt;&#xA;&lt;li&gt;ç§»é™¤æŒ‡å®šåœ°å€èŒƒå›´å†…çš„mmapæ˜ å°„ã€‚&lt;/li&gt;&#xA;&lt;li&gt;MAP_SHAREDè¦å°†ä¿®æ”¹å†™å…¥æ–‡ä»¶ï¼Œè¿›ç¨‹é€€å‡ºæ—¶ä¹Ÿè¦å¯¹MAP_SHAREDçš„ä»»ä½•ä¿®æ”¹å†™å…¥æ–‡ä»¶ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;hintsï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;æŒ‰ç…§ä¹‹å‰çš„è€æ–¹æ³•æ·»åŠ mmapå’Œmunmapç³»ç»Ÿè°ƒç”¨ã€‚&lt;/li&gt;&#xA;&lt;li&gt;å®šä¹‰VMAç»“æ„ä½“ï¼Œè®°å½•æ˜ å°„çš„è™šæ‹Ÿåœ°å€ç©ºé—´çš„èµ·å§‹åœ°å€ã€é•¿åº¦ã€æƒé™ã€æ–‡ä»¶ç­‰ä¿¡æ¯ã€‚&lt;/li&gt;&#xA;&lt;li&gt;å£°æ˜ä¸€ä¸ªå¤§å°ä¸º16çš„VMAæ•°ç»„ã€‚&lt;/li&gt;&#xA;&lt;li&gt;æŠŠVMAæ•°ç»„å¯¹åº”åˆ°ä¸€ä¸ªæœªä½¿ç”¨çš„åŒºåŸŸã€‚&lt;/li&gt;&#xA;&lt;li&gt;VMAç»“æ„ä½“ä¸­åº”åŒ…å«ä¸€ä¸ªæŒ‡å‘fileç»“æ„ä½“çš„æŒ‡é’ˆã€‚&lt;/li&gt;&#xA;&lt;li&gt;mmapåº”å¢åŠ æ–‡ä»¶çš„å¼•ç”¨è®¡æ•°ã€‚&lt;/li&gt;&#xA;&lt;li&gt;VMAåŒºåŸŸå¼•å‘çš„page faultè¿›è¡Œå¤„ç†ï¼Œåˆ†é…ä¸€é¡µç‰©ç†å†…å­˜ï¼Œä½¿ç”¨readiè¯»å…¥æ–‡ä»¶çš„4KBå¹¶æ˜ å°„åˆ°ç”¨æˆ·åœ°å€ç©ºé—´ï¼Œè®¾ç½®æ­£ç¡®çš„é¡µé¢æƒé™ã€‚&lt;/li&gt;&#xA;&lt;li&gt;ä½¿ç”¨uvmunmapå–æ¶ˆå¯¹åº”åœ°å€èŒƒå›´çš„æ˜ å°„ï¼Œå¹¶å‡å°‘ç›¸åº”fileçš„å¼•ç”¨è®¡æ•°ï¼Œå¦‚æœé¡µé¢MAP_SHAREDï¼Œéœ€è¦å°†å…¶å†™å›æ–‡ä»¶ï¼Œå‚è€ƒfilewriteã€‚&lt;/li&gt;&#xA;&lt;li&gt;ä¿®æ”¹exit()å–æ¶ˆè¿›ç¨‹çš„æ˜ å°„åŒºåŸŸï¼Œå°±åƒè°ƒç”¨munmapä¸€æ ·ã€‚&lt;/li&gt;&#xA;&lt;li&gt;ä¿®æ”¹fork()ç¡®ä¿çˆ¶å­è¿›ç¨‹æœ‰ç›¸åŒçš„æ˜ å°„åŒºåŸŸï¼Œå¢åŠ VMAçš„å¼•ç”¨è®¡æ•°ï¼Œå­è¿›ç¨‹çš„page faultå¯ä»¥åˆ†é…ä¸€ä¸ªæ–°çš„ç‰©ç†é¡µï¼Œä¸ä¸çˆ¶è¿›ç¨‹å…±äº«ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;æ³¨æ„é€šè¿‡mmapå¯¹æ˜ å°„æ–‡ä»¶çš„å†™æ“ä½œä¸èƒ½è¶…è¿‡æ–‡ä»¶å¤§å°ã€‚mmapå‚æ•°lengthå¤§å°æ˜¯2é¡µä½†æ˜¯æ–‡ä»¶åªæœ‰1.5é¡µæ€ä¹ˆåŠï¼Ÿ&lt;/p&gt;&#xA;&lt;p&gt;ä»£ç å®ç°ï¼š&lt;/p&gt;&#xA;&lt;p&gt;è€åŠæ³•æ·»åŠ sys_mmapå’Œsys_munmapä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨çš„å‡½æ•°å£°æ˜ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚&lt;/p&gt;&#xA;&lt;p&gt;æ·»åŠ VMAç»“æ„ä½“ï¼Œå¹¶å£°æ˜ä¸€ä¸ªå¤§å°ä¸º16çš„VMAç»“æ„ä½“æ•°ç»„ã€‚å‚ç…§mmapçš„å‡½æ•°å‚æ•°ï¼Œç»“æ„ä½“æˆå‘˜å˜é‡éœ€è¦æœ‰èµ·å§‹åœ°å€ã€ç»“æŸåœ°å€ã€æ˜ å°„é•¿åº¦ã€æƒé™ã€ç±»å‹ã€æ–‡ä»¶æè¿°ç¬¦ã€åç§»é‡ã€å¯¹åº”çš„æ˜ å°„æ–‡ä»¶è¿™äº›ï¼Œæ­¤å¤–åŠ å…¥validå˜é‡è¡¨ç¤ºè¿™å—vmaåŒºåŸŸæ˜¯å¦æ˜ å°„åˆ°äº†å¯¹åº”çš„æ–‡ä»¶ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;mmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;off_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// proc.h&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vma&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;valid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// æ˜¯å¦è¢«æ˜ å°„&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// èµ·å§‹åœ°å€&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// ç»“æŸåœ°å€&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ˜ å°„é•¿åº¦&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// æƒé™&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// ç±»å‹&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// æ–‡ä»¶&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åç§»é‡&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æŒ‡å‘å¯¹åº”çš„æ˜ å°„æ–‡ä»¶&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#define NVMA 16&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Per-process state&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proc&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;spinlock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// p-&amp;gt;lock must be held when using these:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;procstate&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;state&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// Process state&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;chan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;                  &lt;span class=&#34;c1&#34;&gt;// If non-zero, sleeping on chan&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;killed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;                  &lt;span class=&#34;c1&#34;&gt;// If non-zero, have been killed&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;xstate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;                  &lt;span class=&#34;c1&#34;&gt;// Exit status to be returned to parent&amp;#39;s wait&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;                     &lt;span class=&#34;c1&#34;&gt;// Process ID&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// wait_lock must be held when using this:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;         &lt;span class=&#34;c1&#34;&gt;// Parent process&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// these are private to the process, so p-&amp;gt;lock need not be held.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;kstack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// Virtual address of kernel stack&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sz&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;                   &lt;span class=&#34;c1&#34;&gt;// Size of process memory (bytes)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;pagetable_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pagetable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// User page table&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;trapframe&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;trapframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// data page for trampoline.S&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// swtch() here to run process&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ofile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NOFILE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// Open files&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;inode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cwd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// Current directory&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// Process name (debugging)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vma&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NVMA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// mmap virtual memory area&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;å®ç°sys_mmapå‡½æ•°ï¼Œè¯»å…¥ä¼ å…¥çš„å‚æ•°ï¼Œæ³¨æ„ä½¿ç”¨argfdåŒæ—¶è¯»å…¥fdå¯¹åº”çš„fileç»“æ„ä½“ï¼Œéå†vmaæ•°ç»„æ‰¾ä¸€å—æœªè¢«æ˜ å°„çš„vmaï¼Œç„¶åé€šè¿‡vmaend()å»ä¸ºå®ƒåˆ†é…ä¸€æ®µç©ºé—²çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸã€‚è¿™é‡Œæˆ‘ä»¬å°†vmaæ”¾åˆ°å †åŒºä¹‹ä¸Šï¼ŒTRAPFRAMEä¹‹ä¸‹ï¼Œä»é«˜åœ°å€å‘ä½åœ°å€æ‰©å±•ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// sysfile.c&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;sys_mmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é•¿åº¦&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// æƒé™&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// ç±»å‹&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// æ–‡ä»¶&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åç§»é‡&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;argaddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;argint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;argint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;argint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;argfd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;argint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flags&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// å¦‚æœæ˜¯ MAP_SHARED æ–‡ä»¶å¿…é¡»å¯å†™&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flags&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MAP_SHARED&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PROT_WRITE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;writable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ‰¾ä¸€ä¸ªæœªè¢«æ˜ å°„çš„VMA&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vma&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;myproc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NVMA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// æœªè¢«æ˜ å°„çš„VMA&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ‰¾ä¸€ç‰‡åŒºåŸŸç»™vma&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;vmaend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// åˆå§‹åŒ–vma&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flags&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// å¢åŠ æ–‡ä»¶çš„å¼•ç”¨è®¡æ•°&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nf&#34;&gt;filedup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æ‰€ä»¥æˆ‘ä»¬ä»éœ€éå†æ‰€æœ‰vmaï¼Œæ‰¾ä½äºæœ€ä½åŒºåŸŸçš„vmaï¼Œå°†æ–°çš„vmaæ”¾åˆ°å®ƒä¸‹é¢ã€‚å…·ä½“å°±æ˜¯æ¯”è¾ƒv-&amp;gt;startåœ°å€ï¼Œæ‰¾æœ€ä½åœ°å€ä½œä¸ºæ–°vmaçš„æœ€é«˜åœ°å€v-&amp;gt;endã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// sysfile.c&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;vmaend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ä»TRAPFRAMEå‘ä¸‹åˆ†é…ä¸€ç‰‡ä¸€ç‰‡çš„vma&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// éå†æ‰€æœ‰å·²åˆ†é…çš„vma æ‰¾æœ€ä½åœ°å€ä½œä¸ºæ–°åˆ†é…çš„endåœ°å€&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;myproc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minstart&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TRAPFRAME&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vma&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NVMA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minstart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;minstart&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minstart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;PGROUNDDOWN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æ­¤æ—¶æˆ‘ä»¬å»ºç«‹äº†vmaè™šæ‹Ÿå†…å­˜åˆ°æ–‡ä»¶ç»“æ„ä½“fileçš„æ˜ å°„å…³è”ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åˆ†é…ç‰©ç†é¡µï¼Œè€Œæ˜¯ä¾èµ–å»¶æ—¶åˆ†é…çš„æœºåˆ¶åœ¨page faultæ—¶æ‰å»åˆ†é…ç‰©ç†é¡µï¼Œè¯»å…¥fileå¯¹åº”çš„æ–‡ä»¶å—ã€‚æ‰€ä»¥éœ€è¦åœ¨usertrapä¸­å®ç°ä»¥ä¸Špage faultçš„å¤„ç†ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// trap.c&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ...&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;which_dev&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;devintr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ok&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;r_scause&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;r_scause&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// page fault&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;mmapfault&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;r_stval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;usertrap(): mmapfault scause 0x%lx pid=%d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;r_scause&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;            sepc=0x%lx stval=0x%lx&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;r_sepc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;r_stval&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;setkilled&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;mmapfaultè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœæ˜¯å†™é”™è¯¯ï¼ˆr_scause() == 15ï¼‰ï¼Œè¦åˆ¤æ–­æ–‡ä»¶æƒé™ã€æ˜ å°„ç±»å‹æ˜¯å¦æ˜¯åªè¯»çš„ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// trap.c&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;mmapfault&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;myproc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vma&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ‰¾addrå¯¹åº”çš„vma&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NVMA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ä¸èƒ½å¯¹åªè¯»æ–‡ä»¶è¿›è¡Œå†™æ“ä½œ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// r_scause() == 15 æ˜¯å†™å†…å­˜å‡ºé”™ r_scause() == 13 æ˜¯è¯»å†…å­˜å‡ºé”™&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;r_scause&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PROT_READ&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PROT_WRITE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flags&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MAP_SHARED&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// åˆ†é…ç‰©ç†é¡µ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pa&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;kalloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;memset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PGSIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// è¯»å–æ–‡ä»¶å†…å®¹åˆ°ç‰©ç†å†…å­˜ä¸­&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;PGROUNDDOWN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;ilock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;readi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PGSIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;iunlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;iunlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// è®¾ç½®é¡µé¢æƒé™&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;perm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;perm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PTE_V&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PTE_U&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PROT_READ&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;perm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PTE_R&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PROT_WRITE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;perm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PTE_W&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PROT_EXEC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;perm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PTE_X&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// è®¾ç½®æ˜ å°„&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nf&#34;&gt;mappages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pagetable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;PGROUNDDOWN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PGSIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;perm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;è‡³æ­¤å®Œäº†mmapçš„éƒ¨åˆ†ï¼Œæ¥ä¸‹æ¥å®ç°munmapã€‚munmapé™¤äº†é‡Šæ”¾æ˜ å°„ï¼Œè¿˜è¦åˆ¤æ–­MAP_SHAREDè¿›è¡Œå†™å›ã€‚å…ˆè¯»å…¥ä¼ å…¥çš„å‚æ•°ï¼Œè¿™é‡Œä½¿ç”¨å‡½æ•°munmapæ¥å°è£…å…·ä½“æ“ä½œï¼Œå› ä¸ºåè¾¹æ‰€æåˆ°çš„exitä¸­ä¹Ÿæ˜¯åŒæ ·çš„æ“ä½œï¼Œå¯å¤ç”¨ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// sysfile.c&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;sys_munmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;argaddr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;argint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;munmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;munmapæ‰¾åˆ°å¯¹åº”çš„vmaåŒºåŸŸå¹¶è°ƒç”¨writebackå‡½æ•°é‡Šæ”¾æ˜ å°„å¹¶å†™å›æ–‡ä»¶ï¼Œæç¤ºä¸­è¯´åˆ°ï¼Œmunmapçš„èŒƒå›´æœ‰ä¸‰ç§ç±»å‹ï¼Œä»startå¼€å§‹é‡Šæ”¾ã€é‡Šæ”¾åˆ°endã€startåˆ°endåŒºåŸŸå…¨é‡Šæ”¾ã€‚æ‰€ä»¥éœ€è¦æ›´æ–°å¯¹åº”çš„vmaï¼Œå°¤å…¶æ˜¯ä»starté‡Šæ”¾éƒ¨åˆ†æ˜ å°„æ—¶ï¼Œå¯¹åº”çš„æ–‡ä»¶åç§»é‡offsetä¹Ÿè¦ç›¸åº”å¢åŠ ï¼Œä¸ç„¶mmaptestä¸­çš„éƒ¨åˆ†æµ‹è¯•ç”¨ä¾‹æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ¯”å¦‚é‡Šæ”¾äº†å‰ä¸€é¡µï¼Œå†é‡Šæ”¾ååŠé¡µï¼Œæœ€åè¯»å–æ–‡ä»¶æ—¶çš„é¦–ä¸ªå­—ç¬¦å´æ˜¯ååŠé¡µçš„é¦–å­—ç¬¦çš„æƒ…å†µï¼Œè¿™æ˜¯å› ä¸ºæ²¡æœ‰æ›´æ–°å¯¹åº”æ–‡ä»¶çš„offsetï¼Œè€ŒæŠŠååŠé¡µå†™å›åˆ°äº†æ–‡ä»¶çš„é¦–é¡µä¸­ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// sysfile.c&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;munmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;myproc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vma&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ‰¾å¯¹åº”çš„vmaåŒºåŸŸ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NVMA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// unmapå¹¶å†™å›æ–‡ä»¶&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;writeback&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pagetable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ä»starté‡Šæ”¾&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ³¨æ„ æ–‡ä»¶ä¹Ÿè¦å¯¹åº”åç§» å¦åˆ™éƒ¨åˆ†é‡Šæ”¾æœ‰é—®é¢˜&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é‡Šæ”¾åˆ°end&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// å‡å°‘fileå¼•ç”¨è®¡æ•°&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;fileclose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;writebackå‡½æ•°å‚ç…§filewriteï¼Œè°ƒç”¨writeiè¿›è¡Œæ–‡ä»¶å†™å…¥ã€‚è¿™é‡Œä¹Ÿè¦æ³¨æ„å†™å…¥æ–‡ä»¶ä¸èƒ½è¶…è¿‡æ–‡ä»¶åŸæœ¬çš„å¤§å°ï¼Œmmapæ˜ å°„çš„æ–‡ä»¶å¤§å°å·²ç»å›ºå®šï¼Œä¸èƒ½æ‰©å……æ–‡ä»¶ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// sysfile.c&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;writeback&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;pagetable_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pgtbl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;va&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;vma&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;pte_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// éå†vmaåŒºåŸŸé¡µé¢&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;PGROUNDDOWN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;va&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;PGROUNDDOWN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;va&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PGSIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// è·å–å¯¹åº”PTE&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pte&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;walk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pgtbl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;va&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æœªåˆ†é…ç‰©ç†é¡µ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pte&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PTE_V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// å¦‚æœæ˜¯MAP_SHARED ä¸”å¯å†™ è¦å†™å›æ–‡ä»¶&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// hintè¯´æ˜å¯ä»¥ä¸è€ƒè™‘PTE_D&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flags&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MAP_SHARED&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prot&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PROT_WRITE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;begin_op&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;ilock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// å†™å…¥ä¸èƒ½è¶…è¿‡åŸæ–‡ä»¶å¤§å°&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PGSIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PGSIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;writei&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;iunlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;end_op&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// é‡Šæ”¾ç‰©ç†é¡µåŠæ˜ å°„&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;kfree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;PTE2PA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pte&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æœ€åå®ç°forkæ—¶çš„å­è¿›ç¨‹ä¹Ÿè¦copyçˆ¶è¿›ç¨‹çš„vmaåŒºåŸŸï¼Œä»¥åŠexitå­è¿›ç¨‹é€€å‡ºæ—¶æ‰§è¡Œmunmapæ“ä½œã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// proc.c&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;fork&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;np&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;myproc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// Allocate process.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;np&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;allocproc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NVMA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;np&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;filedup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ...&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// proc.c&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;status&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;myproc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;initproc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;init exiting&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// é‡Šæ”¾vmaæ˜ å°„&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NVMA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;munmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vmas&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;exit munmap&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ...&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;è‡³æ­¤ï¼Œmmaptestå…¨éƒ¨é€šè¿‡ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/mmaptest.png&#34; title=&#34;/xv6/mmaptest.png&#34; data-thumbnail=&#34;/xv6/mmaptest.png&#34; data-sub-html=&#34;&lt;h2&gt;mmaptest&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/mmaptest.png&#39; alt=&#34;/xv6/mmaptest.png&#34; height=&#34;20%&#34; width=&#34;20%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;mmaptest&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;æ€»ç»“ï¼šmmapä½œä¸ºxv6çš„æœ€åä¸€ä¸ªå®éªŒï¼Œç»¼åˆäº†å†…å­˜ç®¡ç†ã€è¿›ç¨‹ç®¡ç†ã€æ–‡ä»¶ç³»ç»Ÿè¿™ä¸‰å¤§å—çš„å†…å®¹ï¼Œæ˜¯ä¸€ä¸ªç»¼åˆæ€§æä½³çš„å®éªŒã€‚é¦–å…ˆè®¤è¯†åˆ°äº†ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿå†…å­˜è¿™ä¸€é—®é¢˜çš„ç­”æ¡ˆï¼Œé™¤äº†å®ç°è¿›ç¨‹éš”ç¦»é˜²æ­¢å¤šè¿›ç¨‹è®¿é—®åœ°å€å†²çªã€ç»™è¿›ç¨‹æä¾›ä¸€ä¸ªçœ‹èµ·æ¥æ›´å¤§çš„åœ°å€ç©ºé—´ä»¥å¤–ï¼Œä»–è¿˜å¯ä»¥åœ¨æ­¤åŸºç¡€ä¹‹ä¸Šåˆ©ç”¨page faulté™·å…¥trapå¤„ç†ç¨‹åºï¼Œä»è€Œå®ç°å»¶æ—¶åˆ†é…ï¼ˆå…ˆæä¾›è™šæ‹Ÿç©ºé—´ï¼Œåœ¨è®¿é—®æ—¶å†å»åˆ†é…ç‰©ç†ç©ºé—´ï¼Œæ¯”å¦‚sbrkæ‰©å……äº†è™šæ‹Ÿåœ°å€ç©ºé—´å¤§å°ï¼Œåœ¨è®¿é—®æ‰©å……åçš„è™šæ‹Ÿåœ°å€æ—¶æ‰ä¼šå®é™…åˆ†é…ç‰©ç†é¡µï¼Œè¿™é‡Œæ˜¯æ ¹æœ¬æ²¡æœ‰å»ºç«‹PTEæ˜ å°„ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰PTEçš„page faultï¼‰ã€å†™æ—¶å¤åˆ¶ï¼ˆforkæ—¶å­è¿›ç¨‹copyçˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼ŒæŒ‡å‘åŒä¸€å—è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œä½†å°†PTEè®¾ä¸ºä¸å¯å†™ï¼Œå½“å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹è¯•å›¾å†™å…¥æ—¶ï¼Œè§¦å‘page faultå†å»åˆ†é…ç‰©ç†é¡µï¼ŒcopyåŸæ¥çš„ç‰©ç†é¡µï¼Œè¿™é‡Œæ˜¯å»ºç«‹äº†PTEï¼Œä½†æƒé™ä¸ºä¸å¯å†™ï¼‰æœºåˆ¶ã€‚ä»¥åŠå»æ˜ å°„æ–‡ä»¶é¿å…è¯»å†™æ–‡ä»¶å¤šæ¬¡åœ°ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆä¹Ÿå°±æ˜¯æœ¬å®éªŒå®ç°çš„ï¼Œæœ¬è´¨ä¸Šæ˜¯ä½¿ç”¨è¯¥ç³»ç»Ÿè°ƒç”¨å°†æ–‡ä»¶å†…å®¹è¯»åˆ°å†…å­˜ä¸­ï¼Œä»è€Œå†æ¬¡è¯»å†™æ–‡ä»¶æ—¶ä¸ç”¨é¢‘ç¹è°ƒç”¨readã€writeç³»ç»Ÿè°ƒç”¨ï¼‰ã€‚&lt;/p&gt;&#xA;&lt;p&gt;PSï¼šå¼ºçƒˆæ¨èæ–‡ä¸­å¼€å¤´æåˆ°çš„æ–‡ç« ï¼Œmmapè¿™ä¸ªæ¦‚å¿µå…¶å®ä¸€ç›´å›°æ‰°äº†æˆ‘å¾ˆä¹…ï¼Œå°±åƒæ–‡ä¸­è¯´åˆ°çš„ï¼š&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e6%96%87%e4%bb%b6%e6%98%a0%e5%b0%84%e7%9a%84%e7%96%91%e9%97%ae.png&#34; title=&#34;/xv6/æ–‡ä»¶æ˜ å°„çš„ç–‘é—®.png&#34; data-thumbnail=&#34;/xv6/æ–‡ä»¶æ˜ å°„çš„ç–‘é—®.png&#34; data-sub-html=&#34;&lt;h2&gt;æ–‡ä»¶æ˜ å°„çš„ç–‘é—®&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/æ–‡ä»¶æ˜ å°„çš„ç–‘é—®.png&#39; alt=&#34;/xv6/æ–‡ä»¶æ˜ å°„çš„ç–‘é—®.png&#34; height=&#34;60%&#34; width=&#34;60%&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;æ–‡ä»¶æ˜ å°„çš„ç–‘é—®&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;&#xA;&lt;p&gt;æˆ‘è„‘å­ä¸­å°±å…¨æ˜¯è¿™äº›ç–‘æƒ‘ï¼Œçœ‹åˆ°è¿™æ®µè¯æ—¶ï¼Œé¡¿æ—¶æ„Ÿåˆ°ç»ˆäºæœ‰äººæ‡‚æˆ‘äº†ã€‚è¿™ç¯‡æ–‡ç« çœŸæ˜¯è·ªç€è¯»å®Œçš„ï¼Œç›¸æ¯”äºç½‘ä¸ŠæŸ¥é˜…çš„å¤§å¤šæ•°èµ„æ–™ã€gptç­”æ¡ˆï¼Œç®€ç›´æ˜¯å¥½å¤ªå¤šï¼Œé†é†çŒé¡¶çš„æ„Ÿè§‰ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä»¥åŠç½‘ä¸Šå‚è€ƒçš„å®éªŒå®ç°å¯èƒ½åœ¨xv6 2024ç‰ˆæœ¬çš„å®éªŒä¸­æœ‰äº›å·²ç»è¿‡ä¸äº†äº†ï¼Œæ¨æµ‹æ˜¯è¿™äº›è€å¤´åœ¨ä¸æ–­æ›´æ–°æµ‹è¯•ç”¨ä¾‹ï¼ŒæŸ¥çœ‹testæ–‡ä»¶çš„ä»£ç å¾ˆæœ‰å¸®åŠ©ï¼Œæ¯”å¦‚mmaptestä¸­è¿‡ä¸äº†çš„æµ‹è¯•å¯ä»¥å›æŸ¥æºç ï¼Œçœ‹å®ƒæ˜¯åœ¨æµ‹è¯•å“ªæ–¹é¢ï¼Œå¯¹åº”å“ªé‡Œå‡ºäº†é—®é¢˜ï¼Œèƒ½å¿«é€Ÿå®šä½è§£å†³ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s/AUsgFOaePwVsPozC3F6Wjw&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;ä»å†…æ ¸ä¸–ç•Œé€è§† mmap å†…å­˜æ˜ å°„çš„æœ¬è´¨ï¼ˆåŸç†ç¯‡ï¼‰&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://kerolt.work/posts/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/mit6.s081lab10-mmap/&#34;target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;keroltçš„å®ç°&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;</description>
    </item>
    <item>
      <title>MIT6.1810 Lab:File system</title>
      <link>http://localhost:1313/posts/mit-lab-fs/</link>
      <pubDate>Sun, 17 Nov 2024 11:22:27 +0800</pubDate><author>1022440588@qq.com (UAreFree)</author>
      <guid>http://localhost:1313/posts/mit-lab-fs/</guid>
      <category domain="http://localhost:1313/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      <description>&lt;p&gt;MIT6.1810 lab xv6 2024 fs&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;large-files&#34;&gt;&lt;span&gt;Large files&lt;/span&gt;&#xA;  &lt;a href=&#34;#large-files&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;å¢åŠ xv6æ–‡ä»¶å¤§å°ï¼Œä¸€ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯ç”±inodeå†³å®šçš„ï¼Œinodeè®°å½•æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼Œå…¶ä¸­çš„addressæ•°ç»„è®°å½•ç£ç›˜çš„å—å·ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ–‡ä»¶å°±æ˜¯ä¸€å †ç£ç›˜å—ï¼Œç£ç›˜å—çš„æ•°é‡è¶Šå¤šæ–‡ä»¶è¶Šå¤§ï¼Œæ‰€ä»¥ç†è®ºä¸Šaddressæ•°ç»„è¶Šå¤§ï¼Œæ–‡ä»¶è¶Šå¤§ã€‚ä½†inodeä¹Ÿæ˜¯å ç”¨ä¸€ä¸ªå—å¤§å°ï¼ˆxv6æ˜¯1024å­—èŠ‚ï¼‰çš„ï¼Œé‚£ä¹ˆaddressçš„å¤§å°ä¼šè¢«é™åˆ¶åœ¨äºŒç™¾å¤šï¼Œå¾ˆæ˜æ˜¾æ˜¯ä¸å¤Ÿçš„ã€‚è¿™é‡Œinodeé™åˆ¶addressæ•°ç»„å¤§å°ä¸º13ï¼Œå‰12ä¸ªå…ƒç´ æ˜¯ç›´æ¥å—ï¼Œå³addressç´¢å¼•ï¼ˆé€»è¾‘å—å·ï¼‰ä¸å…¶å€¼ï¼ˆç£ç›˜å—å·ï¼‰æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œç¬¬13ä¸ªå…ƒç´ æ˜¯é—´æ¥å—ï¼Œå³æŒ‡å‘äº†ä¸€ä¸ªç£ç›˜å—ï¼Œé‚£ä¸ªç£ç›˜å—é‡Œåˆåˆ’åˆ†äº†ï¼ˆBSIZE / sizeof(uint)ï¼‰å¤§å°çš„æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ æŒ‡å‘ä¸€ä¸ªç£ç›˜å—ï¼Œè¿™æ ·å°±ç”±1ä¸ªç£ç›˜å—æ‰©å……ä¸ºäº†256ä¸ªç£ç›˜å—ã€‚&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/%e9%97%b4%e6%8e%a5%e5%9d%97%e6%89%a9%e5%85%85%e6%96%87%e4%bb%b6.png&#34; title=&#34;/xv6/é—´æ¥å—æ‰©å……æ–‡ä»¶.png&#34; data-thumbnail=&#34;/xv6/é—´æ¥å—æ‰©å……æ–‡ä»¶.png&#34; data-sub-html=&#34;&lt;h2&gt;é—´æ¥å—æ‰©å……æ–‡ä»¶&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/é—´æ¥å—æ‰©å……æ–‡ä»¶.png&#39; alt=&#34;/xv6/é—´æ¥å—æ‰©å……æ–‡ä»¶.png&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;é—´æ¥å—æ‰©å……æ–‡ä»¶&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&#xA;æŒ‰ç…§ç±»ä¼¼çš„æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸Šè¿°é—´æ¥å—æŒ‡å‘çš„ç£ç›˜å—æ”¹ä¸ºé—´æ¥å—ï¼Œè¿™æ ·å»ºç«‹äºŒçº§é—´æ¥å—ï¼Œåœ¨äºŒçº§é—´æ¥å—ä¸ŠæŒ‡å‘å®é™…çš„ç£ç›˜å—ï¼Œä»è€Œå°†1ä¸ªç£ç›˜å—æ‰©å……ä¸ºäº†256*256ä¸ªç£ç›˜å—ï¼ˆè¿™é‡Œå…¶å®ç‰ºç‰²äº†éƒ¨åˆ†ç£ç›˜å—ä½œä¸ºé—´æ¥å—è€Œä¸æ˜¯æ–‡ä»¶å—ï¼‰ã€‚å…·ä½“å®ç°ä»£ç ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;bmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;inode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å°äºç›´æ¥å—æ•°ç›®&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;balloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åˆ†é…ä¸€ä¸ªç£ç›˜å—ç»™æ–‡ä»¶&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;bn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NINDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å°äºé—´æ¥å—æ•°ç›®&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// Load indirect block, allocating if necessary.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;balloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åˆ†é…ä¸€ä¸ªç£ç›˜å—ä½œä¸ºé—´æ¥å—&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;bread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// ä»é—´æ¥å—é‡Œè¯»&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¿™é‡Œè½¬ä¸ºäº†uint* ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å…¶åˆ†é…çš„ç£ç›˜å—&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// bpçš„sizeå°±æ˜¯NINDIRECT BSIZE/sizeof(uint)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;balloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åˆ†é…ä¸€ä¸ªç£ç›˜å—ç»™æ–‡ä»¶&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;log_write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;brelse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;bn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NINDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// 0-256*256&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// 0-255&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NDBINDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å°äºäºŒçº§é—´æ¥å—æ•°ç›®&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;balloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åˆ†é…ä¸€ä¸ªç£ç›˜å—ä½œä¸ºä¸€çº§é—´æ¥å—&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NINDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åœ¨ä¸€çº§é—´æ¥å—çš„index&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;bread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;balloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å†åˆ†é…ä¸€ä¸ªç£ç›˜å—ä½œä¸ºäºŒçº§é—´æ¥å—&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;log_write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;brelse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NINDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åœ¨äºŒçº§é—´æ¥å—çš„index&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;bread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;balloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å†åˆ†é…ä¸€ä¸ªç£ç›˜å—ç»™æ–‡ä»¶&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;log_write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;brelse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;bmap: out of range&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;æ³¨æ„æ›´æ”¹fs.hä¸­çš„å¯¹åº”å®å®šä¹‰ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#define NDIRECT 11&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#define NINDIRECT (BSIZE / sizeof(uint))&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#define NDBINDIRECT (NINDIRECT * NINDIRECT)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#define MAXFILE (NDIRECT + NINDIRECT + NDBINDIRECT)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dinode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;short&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// File type&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;short&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;major&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;          &lt;span class=&#34;c1&#34;&gt;// Major device number (T_DEVICE only)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;short&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;          &lt;span class=&#34;c1&#34;&gt;// Minor device number (T_DEVICE only)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;short&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nlink&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;          &lt;span class=&#34;c1&#34;&gt;// Number of links to inode in file system&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// Size of file (bytes)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// Data block addresses&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;ä»¥åŠfile.hä¸­inodeçš„addressæ•°ç»„çš„å¤§å°ï¼Œè¿™é‡Œè¦å’Œdinodeçš„addressæ•°ç»„çš„å¤§å°ç›¸å¯¹åº”ï¼Œä¸ç„¶fs.imgæ„å»ºä¼šå‡ºé”™ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// in-memory copy of an inode&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;inode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// Device number&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;inum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;          &lt;span class=&#34;c1&#34;&gt;// Inode number&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ref&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// Reference count&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sleeplock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// protects everything below here&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;valid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;          &lt;span class=&#34;c1&#34;&gt;// inode has been read from disk?&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;short&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;         &lt;span class=&#34;c1&#34;&gt;// copy of disk inode&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;short&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;major&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;short&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;minor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;short&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nlink&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;è¿˜æœ‰æ ¹æ®æç¤ºè¦ç¡®ä¿itruncé‡Šæ”¾æ–‡ä»¶çš„æ‰€æœ‰å—ï¼Œç±»ä¼¼çš„è¿›è¡Œæ›´æ”¹ï¼Œè‡³æ­¤èƒ½é€šè¿‡usertestsã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;itrunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;inode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é‡Šæ”¾æ‰€æœ‰çš„ç›´æ¥å—&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;bfree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]){&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å¦‚æœä¸€çº§é—´æ¥å—å­˜åœ¨&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;bread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NINDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é‡Šæ”¾æ‰€æœ‰çš„æ–‡ä»¶å—&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;bfree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;brelse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;bfree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é‡Šæ”¾ä¸€çº§é—´æ¥å—&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]){&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å¦‚æœäºŒçº§é—´æ¥å—å­˜åœ¨&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;bread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NINDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;bread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NINDIRECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nf&#34;&gt;bfree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;brelse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;bfree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;brelse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;bfree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é‡Šæ”¾ä¸€çº§é—´æ¥å—&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addrs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NDIRECT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;iupdate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;symbolic-links&#34;&gt;&lt;span&gt;Symbolic links&lt;/span&gt;&#xA;  &lt;a href=&#34;#symbolic-links&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;è¿™ä¸ªå®éªŒå¦‚æœæ˜ç™½äº†ç¬¦å·é“¾æ¥çš„åŸç†è¿‡ç¨‹å°±èƒ½è¿åˆƒè€Œè§£ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åœ¨pathçš„è·¯å¾„åˆ›å»ºäº†ä¸€ä¸ªæ–°æ–‡ä»¶ï¼ˆä»£ç ä»¥inodeè¡¨è¾¾ï¼‰ï¼Œåœ¨æ–‡ä»¶é‡Œå†™å…¥targetè·¯å¾„ï¼ŒåŒæ—¶æ ‡è®°æ­¤æ–‡ä»¶ä¸ºT_SYMLINKç±»å‹ï¼Œé‡åˆ°è¿™ç§æ–‡ä»¶è¦è¯»æ–‡ä»¶å†…å®¹å†ä¸€æ¬¡ä»¥æ–‡ä»¶å†…å®¹ä¸ºpathå»æ‰¾å¯¹åº”çš„inodeï¼Œä»è€Œå¾—åˆ°æ‰€æŒ‡å‘æ–‡ä»¶çš„å†…å®¹ã€‚ä»£ç å…·ä½“å®ç°ï¼š&lt;/p&gt;&#xA;&lt;p&gt;å¢åŠ symlinkç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨pathå¤„åˆ›å»ºä¸€ä¸ªT_SYMLINKç±»å‹çš„æ–‡ä»¶ï¼Œwriteiå†™å…¥targetè·¯å¾„ä¸ºæ–‡ä»¶å†…å®¹ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;sys_symlink&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MAXPATH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MAXPATH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;inode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;argstr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MAXPATH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;argstr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MAXPATH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;//printf(&amp;#34;link path: %s\n&amp;#34;, path);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nf&#34;&gt;begin_op&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// åœ¨pathä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;T_SYMLINK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;end_op&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ–‡ä»¶å†…å®¹ä¸ºtarget&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;writei&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;strlen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;end_op&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;iunlockput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;end_op&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æˆåŠŸ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;ä¿®æ”¹openç³»ç»Ÿè°ƒç”¨ï¼Œå¾ªç¯è¯»å–pathï¼Œå¦‚æœæ˜¯ç¬¦å·é“¾æ¥æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹targetè¯»åˆ°pathé‡Œï¼Œä¸‹ä¸ªå¾ªç¯å†å»è¯»æŒ‡å‘targetçš„å†…å®¹ã€‚è¿™é‡Œè°ƒè¯•äº†ä¸ªå°bugï¼Œå¼€å§‹æ²¡æœ‰åœ¨readiä¹‹å‰memset(path, 0, MAXPATH);å¯¼è‡´symlinktestè¿‡ä¸äº†ï¼ŒæŠ¥é”™ï¼šFAILURE: open() failed in many testã€‚ç„¶åæ‰“å°pathå‘ç°ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;open path: /testsymlink/aa&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; path: /testsymlink/aa&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; path: /testsymlink/4a&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;FAILURE: open&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; failed in many test&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;åˆ†æåœ¨å»ºç«‹ç¬¦å·é“¾æ¥æ—¶æ˜¯æ²¡æœ‰/testsymlink/4aè¿™ä¸ªpathçš„ï¼Œçœ‹symlinktest.cä¹ŸçŸ¥é“æ˜¯åœ¨æµ‹è¯•ä»/testsymlink/aaåˆ°/testsymlink/azï¼Œè¿™äº›ç¬¦å·é“¾æ¥æŒ‡å‘çš„/testsymlink/4ã€‚å¾ˆå®¹æ˜“çœ‹å‡ºæ¥æ˜¯pathåœ¨readiæ—¶åªè¦†ç›–äº†/testsymlink/aaçš„/testsymlink/aè¿™ä¸ªåŒºåŸŸä¸º/testsymlink/4ï¼Œè€Œ/testsymlink/aaæœ€åä¸€ä¸ªaè¿˜æ®‹ç•™åœ¨pathé‡Œï¼Œæ‰€ä»¥å¢åŠ memsetè¿›è¡Œäº†æ•°æ®çš„æ¸…ç†ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;47&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;48&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;49&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;50&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;51&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;52&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;53&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;54&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;55&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;56&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;57&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;58&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;59&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;60&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;61&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;62&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;63&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;64&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;65&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;66&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;67&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;68&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;69&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;70&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;71&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;72&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;73&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;74&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;75&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;76&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;77&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;78&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;79&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;80&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;81&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;82&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;83&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;84&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;85&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;86&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;87&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;88&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;89&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;90&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;91&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;92&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;93&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;sys_open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MAXPATH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;omode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;inode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;argint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;omode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;argstr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MAXPATH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;//printf(&amp;#34;open path: %s\n&amp;#34;, path);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;begin_op&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;omode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;O_CREATE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºæ–‡ä»¶&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;T_FILE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;end_op&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;depth&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;//printf(&amp;#34;while path: %s\n&amp;#34;, path);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;namei&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;end_op&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;ilock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;T_SYMLINK&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;omode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;O_NOFOLLOW&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;depth&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é™åˆ¶å¾ªç¯é“¾æ¥æ·±åº¦&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;          &lt;span class=&#34;nf&#34;&gt;iunlockput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nf&#34;&gt;end_op&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;memset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MAXPATH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ²¡æœ‰æ­¤å¥ä¼šå‡ºé”™ pathå¯èƒ½ä¼šæœ‰ä¹‹å‰çš„æ®‹ç•™æ•°æ®æœªè¢«readiè¦†ç›–&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;readi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MAXPATH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¯»æ–‡ä»¶å†…å®¹ targetè·¯å¾„&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;          &lt;span class=&#34;nf&#34;&gt;iunlockput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nf&#34;&gt;end_op&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;iunlockput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¦é‡Šæ”¾ip&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;T_DIR&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;omode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;O_RDONLY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;iunlockput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;end_op&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;T_DEVICE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;major&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;major&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NDEV&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;iunlockput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;end_op&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;filealloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;fdalloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;fileclose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;iunlockput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;end_op&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;T_DEVICE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FD_DEVICE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;major&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;major&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FD_INODE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;off&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;readable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;omode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;O_WRONLY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;writable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;omode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;O_WRONLY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;omode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;O_RDWR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;omode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;O_TRUNC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;T_FILE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;itrunc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;iunlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;end_op&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;</description>
    </item>
    <item>
      <title>MIT6.1810 Lab:Locks</title>
      <link>http://localhost:1313/posts/mit-lab-lock/</link>
      <pubDate>Sun, 10 Nov 2024 11:18:35 +0800</pubDate><author>1022440588@qq.com (UAreFree)</author>
      <guid>http://localhost:1313/posts/mit-lab-lock/</guid>
      <category domain="http://localhost:1313/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      <description>&lt;p&gt;MIT6.1810 lab xv6 2024 locks&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;buffer-cache&#34;&gt;&lt;span&gt;Buffer cache&lt;/span&gt;&#xA;  &lt;a href=&#34;#buffer-cache&#34; class=&#34;heading-mark&#34;&gt;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xA;  &lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;å¦‚æœå¤šä¸ªè¿›ç¨‹å¯†é›†ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒä»¬å¯èƒ½ä¼šäº‰ç”¨bcache.lockï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§é”ï¼Œä¿æŠ¤bcacheä¸­çš„buffersã€‚ä¿®æ”¹bcacheã€bgetã€brelseä½¿ä¸åŒå—ä¸­çš„å¹¶å‘æŸ¥æ‰¾å’Œé‡Šæ”¾ä¸å¤ªå¯èƒ½å‘ç”Ÿé”å†²çªã€‚ä¸èƒ½å¢åŠ bufferçš„æ•°é‡ï¼Œä¹Ÿå°±æ˜¯ä¾æ—§30ä¸ªbufferã€‚ä¸éœ€è¦å®ç°LRUç¼“å­˜æ›¿æ¢ç­–ç•¥ï¼Œä½†å¿…é¡»å½“ç¼“å­˜æœªå‘½ä¸­æ—¶ï¼Œèƒ½ä½¿ç”¨ä»»ä½•refcntä¸ºé›¶çš„bufferã€‚è¿™ä¸ªrefcntè¡¨ç¤ºå½“å‰æœ‰å¤šå°‘è¿›ç¨‹åœ¨ä½¿ç”¨è¿™ä¸ªbufferï¼Œæ¯æ¬¡bget()å¾—åˆ°ä¸€ä¸ªbufferåï¼Œä¼šå¯¹è¿™ä¸ªbufferçš„refcntåŠ ä¸€ï¼Œåªæœ‰å½“refcntå˜ä¸º0æ—¶ï¼Œæ‰ä¼šè¢«å›æ”¶ã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ bcachetest&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;start test0&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;test0 results:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--- lock kmem/bcache stats&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: kmem: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 33030&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: kmem: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 28&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: kmem: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 73&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: bcache: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 96&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: bcache.bucket: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 6229&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: bcache.bucket: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 6204&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: bcache.bucket: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 4298&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: bcache.bucket: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 4286&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: bcache.bucket: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 2302&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: bcache.bucket: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 4272&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: bcache.bucket: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 2695&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: bcache.bucket: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 4709&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: bcache.bucket: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 6512&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: bcache.bucket: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 6197&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: bcache.bucket: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 6196&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: bcache.bucket: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 6201&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: bcache.bucket: &lt;span class=&#34;c1&#34;&gt;#test-and-set 0 #acquire() 6201&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--- top &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; contended locks:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: virtio_disk: &lt;span class=&#34;c1&#34;&gt;#test-and-set 1483888 #acquire() 1221&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: proc: &lt;span class=&#34;c1&#34;&gt;#test-and-set 38718 #acquire() 76050&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: proc: &lt;span class=&#34;c1&#34;&gt;#test-and-set 34460 #acquire() 76039&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: proc: &lt;span class=&#34;c1&#34;&gt;#test-and-set 31663 #acquire() 75963&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lock: wait_lock: &lt;span class=&#34;c1&#34;&gt;#test-and-set 11794 #acquire() 16&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;tot&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;test0: OK&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;å®éªŒæ‰€æœŸæœ›çš„è¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œlock: bcacheçš„é”äº‰ç”¨æ¬¡æ•°å˜ä¸ºäº†0ï¼Œä¸”å¤šäº†13ä¸ªlock: bcache.bucketï¼Œæ¯ä¸ªbucketçš„é”äº‰ç”¨æ¬¡æ•°ä¹Ÿä¸º0ã€‚&lt;/p&gt;&#xA;&lt;p&gt;éœ€è¦ä»¥â€œbcacheâ€å¼€å¤´ä¸ºæ¯ä¸ªé”è°ƒç”¨initlockæ–¹æ³•ã€‚bcacheæ˜¯å¤šä¸ªè¿›ç¨‹å…±äº«çš„ï¼Œä¸èƒ½åƒkallocä¸€æ ·å°†æ‰€æœ‰çš„bufferåˆ‡å‰²ä¸ºæ¯ä¸ªè¿›ç¨‹æ‰€ç‹¬äº«ï¼Œå¾ˆæ˜æ˜¾bufferæ˜¯å›ºå®š30ä¸ªå¤§å°ï¼Œå¤šè¿›ç¨‹éœ€è¦éƒ½èƒ½å¤Ÿè®¿é—®çš„ã€‚å»ºè®®ä½¿ç”¨å“ˆå¸Œè¡¨æ¥æŸ¥æ‰¾ç¼“å­˜ä¸­çš„å—å·ï¼Œæ¯ä¸ªå“ˆå¸Œæ¡¶æŒæœ‰ä¸€æŠŠé”ã€‚å“ˆå¸Œè¡¨å°±æ˜¯key-valueå¯¹ï¼Œé‚£æˆ‘çš„keyå°±æ˜¯hash(å—å·)ï¼Œvalueå°±æ˜¯å­˜å‚¨çš„bufferï¼Œæ¯ä¸ªæ¡¶è¿˜è¦æŒæœ‰ä¸€æŠŠé”ã€‚&lt;/p&gt;&#xA;&lt;p&gt;è¿™äº›é”å†²çªæƒ…å†µæ˜¯å¯ä»¥æ¥å—çš„ï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;ä¸¤ä¸ªè¿›ç¨‹å»ä½¿ç”¨ç›¸åŒçš„å—å·ã€‚&lt;/li&gt;&#xA;&lt;li&gt;ä¸¤ä¸ªè¿›ç¨‹æŸ¥bcacheä¸­çš„bufferï¼ˆéå†æ‰¾å¯¹åº”çš„å—å·ï¼‰ï¼Œå‘ç°æ²¡æœ‰ï¼Œéœ€è¦æŸ¥æ‰¾æœªä½¿ç”¨çš„å—ï¼ˆrefcnt=0ï¼‰è¿›è¡Œæ›¿æ¢ã€‚&lt;/li&gt;&#xA;&lt;li&gt;ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶ä½¿ç”¨å“ˆå¸Œåˆ°ä¸€ä¸ªbucketçš„å—å·ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;hintsï¼š&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;å“ˆå¸Œè¡¨å¤§å°è®¾ä¸º13ï¼Œå›ºå®šå€¼ï¼Œå°è¯äº†ä¸Šè¿°ç»“æœæ‰“å°å¯ä»¥é€šè¿‡testã€‚&lt;/li&gt;&#xA;&lt;li&gt;åœ¨å“ˆå¸Œè¡¨ä¸­ç»´æŠ¤bufferæ“ä½œå¿…é¡»æ˜¯åŸå­æ€§çš„ã€‚&lt;/li&gt;&#xA;&lt;li&gt;åˆ é™¤åŒå‘é“¾è¡¨å½¢å¼çš„bcacheä¸”ä¸å®ç°LRUï¼Œåœ¨bget()ä¸­å¯ä»¥é€‰æ‹©ä»»ä½•refcnt==0çš„bufferï¼Œåœ¨brelse()ä¸­ä¹Ÿæ— éœ€è·å–bcache.lockã€‚&lt;/li&gt;&#xA;&lt;li&gt;éå†å“ˆå¸Œè¡¨ä»¥åŠéå†bucketçš„å…ƒç´ å»æŸ¥æ‰¾æœªä½¿ç”¨çš„bufferæ˜¯å¯ä»¥çš„ã€‚&lt;/li&gt;&#xA;&lt;li&gt;åœ¨é©±é€ä¸€ä¸ªbufferæ—¶éœ€è¦æŒæœ‰bcacheé”å’Œæ¯ä¸ªbucketçš„é”ã€‚&lt;/li&gt;&#xA;&lt;li&gt;æ­£å¸¸æ¥è¯´ï¼Œé©±é€ä¸€ä¸ªbufferä¼šå°†å…¶æ¬åˆ°å¦ä¸€ä¸ªæ§½ä½ä¸Šï¼ˆå—å·hashåå¾—åˆ°ä¸åŒçš„keyï¼‰ï¼Œå¦‚æœåœ¨åŒä¸€ä¸ªæ§½ä½ä¸Šéœ€è¦é¿å…æ­»é”ã€‚&lt;/li&gt;&#xA;&lt;li&gt;è°ƒè¯•æ—¶éœ€è¦ä¿ç•™å…¨å±€bcache.lockçš„acquie/relseåœ¨bget()çš„å¼€å¤´å’Œç»“å°¾ï¼Œä¸€æ—¦ä»£ç æ­£ç¡®removeè¿™ä¸ªå…¨å±€é”ã€‚&lt;/li&gt;&#xA;&lt;li&gt;ä½¿ç”¨xv6çš„ç«äº‰æ£€æµ‹å™¨æ¥æ‰¾æ½œåœ¨çš„ç«äº‰ã€‚&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;å®éªŒæ€è·¯ï¼š&lt;/p&gt;&#xA;&lt;p&gt;å»ºç«‹å¤§å°ä¸º13çš„å“ˆå¸Œè¡¨ï¼Œè¦è®¿é—®çš„bufferå—å“ˆå¸Œåˆ°æ¡¶ä¸Šï¼Œæ¯ä¸ªæ¡¶ä¸€æŠŠé”ï¼Œè¿™æ ·å°±å°†åŸæ¥çš„ä¸€æŠŠå¤§é”åŒ–ä¸ºäº†13æŠŠå°é”ã€‚å½“ç¼“å­˜å‘½ä¸­æ—¶å°±ç›´æ¥æ‹¿å–å¯¹åº”çš„é”è¿›è¡Œæ›´æ–°æ“ä½œï¼Œå¾ˆå®¹æ˜“å¤„ç†ï¼Œå°±æ˜¯æ‹¿åˆ°è‡ªå·±æ¡¶å¯¹åº”çš„å°é”å³å¯ï¼›ä½†å½“ç¼“å­˜æœªå‘½ä¸­æ—¶ï¼Œå°±è¦éå†bufferå»æ‰¾æœ€ä¹…æœªä½¿ç”¨çš„bufferè¿›è¡Œé©±é€æ›¿æ¢å¤„ç†ã€‚è¿™é‡Œåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œå¦‚æœè¦é©±é€çš„bufferå’Œæ–°åŠ å…¥çš„bufferå“ˆå¸Œåˆ°ä¸€ä¸ªæ¡¶ä¸Šï¼Œä»¥åŠæœªå“ˆå¸Œåˆ°ä¸€ä¸ªæ¡¶ä¸Šã€‚ä¸åœ¨åŒä¸€ä¸ªæ¡¶ä¸Šå°±æ¶‰åŠé“¾è¡¨æ–­å¼€ã€é‡åˆ†é…çš„æ“ä½œï¼Œåœ¨åŒä¸€ä¸ªæ¡¶ä¸Šå°±ä¸éœ€è¦é“¾è¡¨æ“ä½œã€‚&lt;/p&gt;&#xA;&lt;p&gt;å®éªŒè¦å¤„ç†çš„ä¸Šè¿°ä»£ç é€»è¾‘ä¸»è¦ä½“ç°åœ¨bgetå‡½æ•°ä¸Šï¼Œåœ¨bgetä¸­å°±æ˜¯å…ˆè·å–æ¡¶Açš„é”ï¼Œå»éå†æ‰€æœ‰æ¡¶æ‰¾æœ€ä¹…æœªä½¿ç”¨çš„bufferï¼Œç„¶åæ‹¿åˆ°å¯¹åº”æ¡¶Bçš„é”è¿›è¡Œé“¾è¡¨æ–­å¼€é©±é€bufferæ“ä½œï¼Œé‡Šæ”¾æ¡¶Bçš„é”ï¼Œå°†bufferæŒ‚åœ¨æ¡¶Aä¸Šï¼Œå†é‡Šæ”¾æ¡¶Açš„é”ã€‚è¿™æ˜¯æˆ‘æœ€å¼€å§‹çš„å®ç°æ–¹å¼ï¼Œè¿è¡Œxv6åä¼šå‘ç°ç³»ç»Ÿå¡ä½ä¸åŠ¨äº†ï¼Œåˆ†ææ˜¯å‘ç”Ÿäº†æ­»é”ã€‚è¿™é‡Œç”±äºæ˜¯éå†æ‰€æœ‰æ¡¶ï¼Œå°±æœ‰å¯èƒ½å‡ºç°è¿™ç§æƒ…å†µï¼Œå³CPU1æ‹¿åˆ°æ¡¶Açš„é”ï¼Œéå†å‘ç°è¦é©±é€çš„bufferåœ¨æ¡¶Bï¼Œäºæ˜¯ç”³è¯·æ¡¶Bçš„é”ï¼Œè€ŒåŒæ—¶CPU2æ‹¿åˆ°æ¡¶Bçš„é”ï¼ŒåŒæ ·éå†å‘ç°è¦é©±é€çš„bufferåœ¨æ¡¶Aï¼Œå»ç”³è¯·æ¡¶Açš„é”ã€‚è¿™æ ·å°±æ˜¯CPU1æ‹¿ç€æ¡¶Açš„é”å»ç”³è¯·æ¡¶Bçš„é”ï¼ŒCPU2æ‹¿ç€æ¡¶Bçš„é”å»ç”³è¯·æ¡¶Açš„é”ï¼Œé€ æˆæ­»é”ã€‚æ­»é”çš„å‘ç”Ÿæ¡ä»¶ï¼šäº’æ–¥ã€è¯·æ±‚ä¿æŒã€ä¸å¯å‰¥å¤ºã€å¾ªç¯ç­‰å¾…ã€‚ç ´åä¸Šè¿°4ä¸ªæ¡ä»¶ä¹‹ä¸€å°±å¯ä»¥é¿å…æ­»é”ï¼Œè¿™é‡Œå¯ä»¥ç ´åè¯·æ±‚ä¿æŒæ¡ä»¶ï¼Œå³åœ¨éå†æŸ¥æ‰¾è¦é©±é€çš„bufferæ—¶é‡Šæ”¾è‡ªå·±çš„æ¡¶é”ï¼Œåè¾¹é‡åˆ†é…æ“ä½œæ—¶å†è·å–ã€‚&lt;/p&gt;&#xA;&lt;p&gt;ä¸Šè¿°å¤„ç†æ–¹å¼è™½ç„¶è§£å†³äº†æ­»é”çš„é—®é¢˜ï¼Œä½†åˆä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨é‡Šæ”¾æ¡¶Açš„é”ä¹‹åï¼Œæ‹¿åˆ°æ¡¶Bçš„é”ä¹‹å‰ï¼Œè¿™ä¸ªé—´éš™å¯èƒ½ä¼šåŒæ—¶æœ‰ä¸€ä¸ªçº¿ç¨‹ä¹Ÿåœ¨å¯¹åŒä¸€ä¸ªè¦æ·»åŠ çš„å—è¿›è¡Œbgetï¼Œé‚£ä¹ˆå°±ä¼šåŒæ ·åˆ¤æ–­ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆå»é‡å¤è¿›è¡Œé©±é€æ›¿æ¢æ“ä½œï¼Œå¯¼è‡´åŒä¸€åŒºå—æœ‰å¤šä»½ç¼“å­˜çš„æƒ…å†µã€‚é‚£ä¹ˆæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿè¿™é‡Œé‡‡å–çš„åŠæ³•æ˜¯ä½¿ç”¨ä¸€æŠŠé©±é€é”ä¿æŠ¤è¿™ä¸ªé—´éš™ï¼Œè®©æ¡¶Aé‡Šæ”¾è‡ªå·±çš„é”ä¹‹åï¼Œæ‹¿åˆ°æ¡¶Bçš„é”ä¹‹å‰è¿™ä¸ªè¿‡ç¨‹ä¸²è¡ŒåŒ–ã€‚å¹¶ä¸”åœ¨è·å–è¿™ä¸ªé©±é€é”åå†æ¬¡åˆ¤æ–­æ˜¯å¦ç¼“å­˜å‘½ä¸­ï¼Œè¿™æ ·å°±ä¿è¯åªæœ‰ç¬¬ä¸€ä¸ªè¿›å…¥çš„çº¿ç¨‹å¯¹è¯¥å—è¿›è¡Œäº†ç¼“å­˜æ“ä½œï¼Œä»¥ä¸‹æ˜¯å…·ä½“çš„ä»£ç å®ç°ã€‚&lt;/p&gt;&#xA;&lt;p&gt;åœ¨bufç»“æ„ä½“ä¸­æ–°å¢lastuseæˆå‘˜å˜é‡ï¼Œç»´æŠ¤ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œæ–¹ä¾¿æŸ¥æ‰¾æœ€ä¹…æœªä½¿ç”¨çš„bufferã€‚&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;valid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// has data been read from disk?&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;disk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// does disk &amp;#34;own&amp;#34; buf?&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;blockno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sleeplock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;refcnt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lastuse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;//struct buf *prev; // LRU cache list&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uchar&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BSIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;bio.cä»£ç ï¼š&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;&#xA;&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;  1&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  2&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  3&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  4&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  5&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  6&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  7&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  8&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;  9&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 10&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 11&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 12&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 13&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 14&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 15&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 16&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 17&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 18&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 19&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 20&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 21&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 22&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 23&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 24&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 25&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 26&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 27&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 28&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 29&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 30&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 31&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 32&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 33&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 34&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 35&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 36&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 37&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 38&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 39&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 40&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 41&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 42&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 43&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 44&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 45&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 46&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 47&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 48&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 49&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 50&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 51&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 52&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 53&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 54&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 55&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 56&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 57&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 58&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 59&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 60&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 61&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 62&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 63&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 64&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 65&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 66&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 67&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 68&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 69&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 70&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 71&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 72&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 73&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 74&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 75&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 76&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 77&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 78&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 79&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 80&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 81&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 82&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 83&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 84&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 85&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 86&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 87&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 88&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 89&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 90&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 91&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 92&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 93&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 94&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 95&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 96&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 97&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 98&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 99&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;100&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;101&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;102&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;103&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;104&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;105&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;106&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;107&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;108&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;109&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;110&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;111&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;112&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;113&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;114&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;115&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;116&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;117&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;118&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;119&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;120&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;121&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;122&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;123&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;124&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;125&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;126&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;127&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;128&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;129&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;130&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;131&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;132&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;133&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;134&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;135&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;136&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;137&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;138&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;139&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;140&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;141&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;142&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;143&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;144&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;145&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;146&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;147&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;148&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;149&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;150&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;151&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;152&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;153&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;154&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;155&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;156&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;157&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;158&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;159&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;160&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;161&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;162&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;163&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;164&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;165&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;166&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;167&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;168&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;169&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;170&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;171&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;172&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;173&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;174&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;175&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;176&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;177&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;178&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;179&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;180&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;181&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;182&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;183&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;184&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;185&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;186&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;187&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;188&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;189&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;190&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;191&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;192&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;193&#xA;&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;194&#xA;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;&lt;td class=&#34;lntd&#34;&gt;&#xA;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;#34;types.h&amp;#34;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;#34;param.h&amp;#34;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;#34;spinlock.h&amp;#34;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;#34;sleeplock.h&amp;#34;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;#34;riscv.h&amp;#34;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;#34;defs.h&amp;#34;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;#34;fs.h&amp;#34;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;#34;buf.h&amp;#34;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#define NBUCKET 13&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#define HASH(dev, blockno) (((dev) &amp;lt;&amp;lt; 27 | (blockno)) % NBUCKET)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NBUF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bufmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NBUCKET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å“ˆå¸Œæ¡¶&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;spinlock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NBUCKET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ¯ä¸ªæ¡¶ä¸€æŠŠé”&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;spinlock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;evictionlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NBUCKET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ¯ä¸ªæ¡¶ä¸€æŠŠé©±é€é”&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;binit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NBUCKET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;initlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;bcache_bucket_lock&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;initlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;evictionlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;bcache_eviction_lock&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bufmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NBUF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;initsleeplock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;buffer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lastuse&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;refcnt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// bæ¥åˆ°0å·bucketä¸Š&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bufmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æŒ‚ä¸Šæ–°çš„b&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bufmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Look through buffer cache for block on device dev.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// If not found, allocate a buffer.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// In either case, return locked buffer.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;bget&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;blockno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;HASH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;blockno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ‹¿åˆ°keyå¯¹åº”çš„æ¡¶é”&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ç¼“å­˜å‘½ä¸­&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bufmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;blockno&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;blockno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;refcnt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// é‡Šæ”¾keyæ¡¶é”&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;acquiresleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// ç¼“å­˜æœªå‘½ä¸­&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// å…ˆé‡Šæ”¾keyæ¡¶é” é¿å…æ­»é”&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ‹¿åˆ°æ¡¶çš„é©±é€é”ä¸²è¡ŒåŒ– é¿å…å¯¹åŒä¸€ä¸ªå—è¿›è¡Œå¤šæ¬¡ç¼“å­˜é©±é€åŠé‡åˆ†é…&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;evictionlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// å†æ¬¡æ£€æŸ¥ æ˜¯é¿å…ç¬¬äºŒä¸ªè¿›ç¨‹æ‹¿åˆ°é”åè¿›è¡Œç¼“å­˜é©±é€åŠé‡åˆ†é…&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bufmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;blockno&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;blockno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;refcnt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;evictionlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;nf&#34;&gt;acquiresleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ²¡æœ‰ç¼“å­˜å‘½ä¸­æ‰§è¡Œçš„æ“ä½œ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;beforeleast&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;holdingbucket&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NBUCKET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æ‹¿åˆ°å½“å‰æ¡¶é”&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;newfound&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bufmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// éå†å½“å‰æ¡¶çš„buffer&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// æ²¡æœ‰æ–‡ä»¶å¼•ç”¨çš„ç©ºé—²å— æ‰¾lastuseæœ€å°çš„&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;refcnt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;beforeleast&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lastuse&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;beforeleast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lastuse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;beforeleast&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;newfound&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;newfound&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// æ²¡æ‰¾åˆ° é‡Šæ”¾å½“å‰æ¡¶é”&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;c1&#34;&gt;// æ–°æ¡¶æ‰¾åˆ°äº†å°±æ›´æ–° é‡Šæ”¾æ—§æ¡¶çš„é”&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;holdingbucket&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;holdingbucket&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;n&#34;&gt;holdingbucket&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// éå†æ‰€æœ‰æ¡¶éƒ½æ²¡æœ‰æ‰¾åˆ°&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;beforeleast&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;bget: no buffers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ‰¾çš„å¯¹åº”buffer&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;beforeleast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// é©±é€çš„bufferå’Œæ–°åŠ çš„bufferä¸æ˜¯ä¸€ä¸ªæ¡¶&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;holdingbucket&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// ç§»é™¤é©±é€æ¡¶çš„buffer&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;beforeleast&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;holdingbucket&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// é‡æ–°æ‹¿åˆ°keyæ¡¶çš„é”&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æŒ‚åˆ°keyæ¡¶ä¸Š&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bufmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bufmap&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;next&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// æ˜¯ä¸€ä¸ªæ¡¶å°±ä¸éœ€è¦é“¾è¡¨æ“ä½œ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;blockno&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;blockno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;refcnt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;evictionlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;acquiresleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Return a locked buf with the contents of the indicated block.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;bread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;blockno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;bget&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;blockno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;virtio_disk_rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valid&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Write b&amp;#39;s contents to disk.  Must be locked.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;bwrite&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;holdingsleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;bwrite&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;virtio_disk_rw&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Release a locked buffer.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Move to the head of the most-recently-used list.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;brelse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;holdingsleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;panic&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;brelse&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;releasesleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;HASH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;blockno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;refcnt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;refcnt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// æ›´æ–°æ—¶é—´æˆ³&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lastuse&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ticks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;bpin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;HASH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;blockno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;refcnt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;bunpin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;HASH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;blockno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;acquire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;refcnt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nf&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bucketlocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#xA;&lt;/div&gt;&#xA;&lt;/div&gt;&lt;p&gt;testç»“æœï¼š&#xA;&lt;figure&gt;&lt;a class=&#34;lightgallery&#34; href=&#34;http://localhost:1313/xv6/bcachetest.png&#34; title=&#34;/xv6/bcachetest.png&#34; data-thumbnail=&#34;/xv6/bcachetest.png&#34; data-sub-html=&#34;&lt;h2&gt;bcachetest&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/xv6/bcachetest.png&#39; alt=&#34;/xv6/bcachetest.png&#34;&gt;&lt;/a&gt;&lt;figcaption class=&#34;image-caption&#34;&gt;bcachetest&lt;/figcaption&gt;&#xA;  &lt;/figure&gt;&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
